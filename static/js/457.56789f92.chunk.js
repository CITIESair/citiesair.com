"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[457],{35429:(e,t,n)=>{n.d(t,{Z:()=>g});var a=n(72791),r=n(697),o=n(20890),i=n(53540),s=n(64377),l=n(80223),d=n(62070),c=n(19132),u=n(25878),h=n(80184);const p="Explanation of the US Air Quality Index (AQI) for PM2.5",x="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',g=()=>{const{themePreference:e}=(0,a.useContext)(c.p);return(0,h.jsx)(d.Z,{title:p,icon:(0,h.jsx)(u.Z,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(r.Z,{children:[(0,h.jsx)(l.Z,{themePreference:e}),(0,h.jsx)(o.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,i.ZP)(x,{replace:s.T1})}),(0,h.jsx)(d.Z,{title:"Reference",content:(0,h.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:(0,i.ZP)(m,{replace:s.T1})})})]})})}},80223:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(66934),r=n(79836),o=n(697),i=n(56890),s=n(35855),l=n(53994),d=n(53382),c=n(53540),u=n(64377),h=n(44709),p=n(72791),x=n(19132),m=n(41212),g=n(80184);const v=(0,a.ZP)(r.Z,{shouldForwardProp:e=>"tiny"!==e})((e=>{let{theme:t,tiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const b=function(e){const{themePreference:t}=(0,p.useContext)(x.p),{tiny:n,hideAQIDescription:a}=e,r=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(o.Z,{overflow:"auto",children:(0,g.jsxs)(v,{size:"small",tiny:n,children:[(0,g.jsx)(i.Z,{children:(0,g.jsxs)(s.Z,{children:[(0,g.jsx)(l.Z,{sx:{pr:0},children:(0,g.jsx)(o.Z,{sx:{width:"1em",height:"1em"}})}),(0,g.jsx)(l.Z,{sx:{pl:1},children:"Category"}),(0,g.jsx)(l.Z,{align:"right",children:"US AQI"}),(0,g.jsxs)(l.Z,{align:"right",children:["PM2.5 (\xb5g/m",(0,g.jsx)("sup",{children:"3"}),")"]}),!a&&(0,g.jsx)(l.Z,{align:"left",children:"Description"}),!a&&(0,g.jsxs)(l.Z,{align:"left",children:[m.DE,"' Suggested Actions"]})]})}),(0,g.jsx)(d.Z,{children:h._R.map(((e,n)=>(0,g.jsxs)(s.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,g.jsx)(l.Z,{sx:{pr:0},children:(0,g.jsx)(o.Z,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,g.jsx)(l.Z,{sx:{pl:1},children:e.category}),(0,g.jsx)(l.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:r(e.aqiUS.low,e.aqiUS.high)}),(0,g.jsx)(l.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:r(e.rawPM2_5.low,e.rawPM2_5.high)}),!a&&(0,g.jsx)(l.Z,{align:"left",children:e.description}),!a&&(0,g.jsx)(l.Z,{align:"left",children:(0,c.ZP)(e.healthSuggestions.outdoors,{replace:u.T1})})]},n)))})]})})})}},62070:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(72791),r=n(66934),o=n(40911),i=n(55818),s=n(3721),l=n(697),d=n(20068),c=n(20890),u=n(26759),h=n(47438),p=n(80184);const x=(0,r.ZP)(o.Z)((e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}})),m=(0,r.ZP)(i.Z)((e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(2):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(2),marginBottom:t.spacing(2)}}})),g="Click to expand section",v="Click to collapse section",b=e=>{const{title:t,content:n,icon:r,disabled:o}=e,[i,b]=(0,a.useState)(void 0);return(0,p.jsx)(l.Z,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,p.jsxs)(x,{expanded:"panel1"===i,onChange:(y="panel1",(e,n)=>{b(n?y:void 0),h.y(n?h.z.expandSection:h.z.collapseSection,{section:t})}),disabled:o,children:[(0,p.jsx)(m,{expanded:i,expandIcon:(0,p.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,p.jsx)(d.Z,{title:i?v:g,enterDelay:0,leaveDelay:200,children:(0,p.jsxs)(c.Z,{component:"a",variant:"body1",children:[t,(0,p.jsx)(l.Z,{component:"span",sx:{ml:.25},children:r})]})})}),(0,p.jsx)(s.Z,{sx:{pt:0},children:n})]})});var y}},61745:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(20890),r=n(47047),o=n(80184);function i(e){let{text:t,sx:n,...i}=e;return(0,o.jsx)(a.Z,{variant:"h4",color:"text.primary",sx:{fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1,...n},...i,children:t||(0,o.jsx)(r.Z,{variant:"text"})})}},26082:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ba});var a=n(72791),r=n(66934),o=n(697),i=n(5022),s=n(95193),l=n(36314),d=n(43896),c=n(65117),u=n(20890),h=n(47047),p=n(26935),x=n(67761),m=n(41009),g=n(63867),v=n(47896),b=n(83165),y=n(26084),f=n(19658),j=n(61889),Z=n(13967),w=n(68096),S=n(99321),D=n(94454),k=n(19055),C=n(9955),T=n(81918),A=n(3746),P=n(80184);const I="Display All Series",M=48,E=8;function _(e){const{items:t,selectorID:n,allowMultiple:r,seriesLabel:o,onSeriesSelection:s,displayChip:d=!0}=e,c=(0,Z.Z)(),h={PaperProps:{style:{maxHeight:5.55*M+E,overflow:"visible !important",background:c.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[p,x]=(0,a.useState)(t),[m,g]=(0,a.useState)(r);(0,a.useEffect)((()=>{x(t)}),[t]),(0,a.useEffect)((()=>{g(p.every((e=>e.selected)))}),[p]);const v=e=>{const{target:{value:t}}=e;if(t.includes(I)){const e=p.map(((e,t)=>({...e,selected:0==t||!m})));s({newDataColumns:e}),g(!m)}else{const e=p.filter((e=>t.includes(e.label))),n=p.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));s({newDataColumns:n}),g(!1)}},b=e=>{const t=p.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));s({newDataColumns:t})};return(0,P.jsxs)(l.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,P.jsx)(w.Z,{sx:{[c.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(c.shape.borderRadius,"px")}},size:"small",children:(0,P.jsxs)(S.Z,{labelId:"".concat(n,"-label"),id:n,multiple:r,value:p.filter((e=>e.selected)).map((e=>e.label)),onChange:v,MenuProps:h,renderValue:e=>(e=>(0,P.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,P.jsx)(A.Z,{fontSize:"1.5rem",sx:{color:c.palette.text.secondary}}),(0,P.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:r?"".concat(e.length,"/").concat(p.length," ").concat(o||""," displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[p.map((e=>(0,P.jsxs)(i.Z,{disabled:!(1!==p.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[r?(0,P.jsx)(D.Z,{checked:e.selected,onClick:()=>b(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,P.jsx)(k.Z,{checked:e.selected,onChange:()=>v(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,P.jsx)(u.Z,{variant:"caption",children:e.label})]},e.label))),r?(0,P.jsx)(i.Z,{value:I,sx:{borderTop:"solid 0.5px",borderColor:c.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:c.spacing(-1),background:c.palette.customAlternateBackground,"&:hover":{background:c.palette.customAlternateBackground}},children:(0,P.jsxs)(l.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,P.jsx)(u.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:I}),(0,P.jsx)(C.Z,{checked:m,onClick:()=>b(I),sx:{transform:"scale(0.8)"}})]})},I):null]})}),d&&r&&(0,P.jsx)(j.ZP,{container:!0,spacing:1,sx:{[c.breakpoints.down("sm")]:{display:"none"}},children:p.filter((e=>e.selected)).map((e=>(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(T.Z,{label:(0,P.jsx)(u.Z,{variant:"caption",children:e.label}),size:"small",...1!==p.filter((e=>e.selected)).length&&{onDelete:()=>b(e)}})},e.label)))})]})}const z={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},R=()=>Math.random().toString(36).substr(2,9),W={stem:{length:0},textStyle:{opacity:0},boxStyle:null},O=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},L=e=>{var t,n,a,r,o,i,s,l,d,c,u,h,p,x,m,g,v,b,y,f,j,Z,w,S,D,k,C,T,A,P,I,M,E,_,z,R,W,L,B,F,V,H,N,Y,U,q,G,Q,X;const{chartData:$,subchartIndex:K,isPortrait:J,theme:ee}=e,te={italic:!1,bold:!0,color:ee.palette.chart.axisTitle,fontSize:O({isPortrait:J})},ne={color:ee.palette.chart.axisText,fontSize:O({isPortrait:J})};let ae=null!==(t=$.subcharts)&&void 0!==t&&t[K].options?{...$.subcharts[K].options}:{};if(ae={...ae,...$.options,theme:"material",curveType:ae.curveType||(null===(n=$.options)||void 0===n?void 0:n.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(a=$.options)||void 0===a||null===(r=a.backgroundColor)||void 0===r?void 0:r.fill)||"transparent"},chartArea:{...null===(o=$.options)||void 0===o?void 0:o.chartArea,width:J?(null===(i=$.options)||void 0===i||null===(s=i.chartArea)||void 0===s||null===(l=s.width)||void 0===l?void 0:l.portrait)||"80%":(null===(d=$.options)||void 0===d||null===(c=d.chartArea)||void 0===c||null===(u=c.width)||void 0===u?void 0:u.landscape)||"75%",height:J?(null===(h=$.options)||void 0===h||null===(p=h.chartArea)||void 0===p||null===(x=p.height)||void 0===x?void 0:x.portrait)||"60%":(null===(m=$.options)||void 0===m||null===(g=m.chartArea)||void 0===g||null===(v=g.height)||void 0===v?void 0:v.landscape)||"70%"},width:J?(null===(b=$.options)||void 0===b||null===(y=b.width)||void 0===y?void 0:y.portrait)||"100%":(null===(f=$.options)||void 0===f||null===(j=f.width)||void 0===j?void 0:j.landscape)||"100%",height:$.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:J?"center":"start",position:null!==(Z=null===(w=$.options)||void 0===w||null===(S=w.legend)||void 0===S?void 0:S.position)&&void 0!==Z?Z:J?"top":"right",scrollArrows:{activeColor:ee.palette.chart.axisTitle,inactiveColor:ee.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ee.palette.chart.axisTitle,bold:!0}}},ae.vAxis={...ae.vAxis,format:null!==(D=null===(k=ae.vAxis)||void 0===k?void 0:k.format)&&void 0!==D?D:"decimal",title:null!==(C=null===(T=ae.vAxis)||void 0===T?void 0:T.title)&&void 0!==C?C:"",viewWindow:{min:null!==(A=null===(P=ae.vAxis)||void 0===P||null===(I=P.viewWindow)||void 0===I?void 0:I.min)&&void 0!==A?A:0,max:null!==(M=null===(E=ae.vAxis)||void 0===E||null===(_=E.viewWindow)||void 0===_?void 0:_.max)&&void 0!==M?M:null,max:null!==(z=null===(R=ae.vAxis)||void 0===R||null===(W=R.viewWindow)||void 0===W?void 0:W.max)&&void 0!==z?z:null}},ae.hAxis={...ae.hAxis,title:null!==(L=null===(B=ae.hAxis)||void 0===B?void 0:B.title)&&void 0!==L?L:""},J&&(ae.hAxis={...ae.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof ae.colors&&ae.colors||(ae.colors=ee.palette.chart.optionsColors[ae.colors||"multiColor"]),ae.series&&Object.values(ae.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=ee.palette.primary.main)})),ae.trendlines&&ae.trendlines.forEach((e=>{e.color=ee.palette.primary.main})),ae.colorAxis)switch(ae.colorAxis.colors){case"matchingColor":ae.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.chart.optionsColors.multiColor[ae.colorAxis.colorIndex]];break;case"default":ae.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.NYUpurple];break;default:try{ae.colorAxis=ee.palette.chart.colorAxes[ae.colorAxis.colors]}catch{ae.colorAxis=[]}}return ae.vAxis={...ae.vAxis,titleTextStyle:te,textStyle:ne,gridlines:{...null===(F=ae.vAxis)||void 0===F?void 0:F.gridlines,color:(null===(V=ae.vAxis)||void 0===V||null===(H=V.gridlines)||void 0===H?void 0:H.color)||ee.palette.chart.gridlines},minorGridlines:{count:0}},ae.hAxis={...ae.hAxis,titleTextStyle:te,textStyle:ne,gridlines:{...null===(N=ae.hAxis)||void 0===N?void 0:N.gridlines,color:(null===(Y=ae.hAxis)||void 0===Y||null===(U=Y.gridlines)||void 0===U?void 0:U.color)||ee.palette.chart.gridlines},minorGridlines:{...null===(q=ae.hAxis)||void 0===q?void 0:q.minorGridlines,color:(null===(G=ae.hAxis)||void 0===G||null===(Q=G.gridlines)||void 0===Q?void 0:Q.color)||ee.palette.chart.gridlines}},ae.legend={...ae.legend,textStyle:ne},ae.annotations={...ae.annotations,highContrast:!0,textStyle:{color:ee.palette.primary.contrastText,fontSize:O({isPortrait:J,isSmaller:!0}),opacity:.8},stem:{...null===(X=ae.annotations)||void 0===X?void 0:X.stem,color:ee.palette.chart.axisTitle,thickness:2},boxStyle:{rx:ee.shape.borderRadius,ry:ee.shape.borderRadius,fill:ee.palette.chart.annotationBoxFill,fillOpacity:.5}},ae},B=e=>{var t;const{chartControl:n,mainChartData:a,mainChartOptions:r,subchartIndex:o,theme:i,isPortrait:s}=e;let l={...null===(t=n.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===n.controlType&&(l={...l,chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[o].columns||null},chartOptions:{...r,hAxis:{...r.hAxis,textPosition:"out",textStyle:{color:i.palette.chart.axisText,fontSize:O({isPortrait:s,isSmaller:!0})},title:null},vAxis:{...r.vAxis,title:null},annotations:W,legend:null}}),l},F=e=>{let{controlWrapper:t,chartID:n}=e;const a=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var a=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let r=!0;if(!t)return;const o=document.querySelector("#control-".concat(n));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.addEventListener(e,a,{capture:!0})})),()=>{r=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.removeEventListener(e,a,{capture:!0})}))}):void 0},V=(0,r.ZP)(o.Z,{shouldForwardProp:e=>"gradientBackgroundId"!==e&&"isPortrait"!==e})((e=>{let{theme:t,isPortrait:n,gradientBackgroundId:a}=e;return{"& svg>g:nth-of-type(2)>rect:first-of-type":{fill:"url(#".concat(a,")"),fillOpacity:1,filter:"contrast(0.4) brightness(1.4)"},"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(n?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(n?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var H=n(6694),N=n(18970),Y=n(64377);const U=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;if(!(0,Y.qt)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map(((t,n)=>({color:t,offset:n/(e-1)})))}{let e=t;n&&(e=t.filter((e=>e.offset>=n))),a&&(e=t.filter((e=>e.offset<=a)));const r=e.map((e=>e.offset)),o=(e=>{let{offsets:t,minOffset:n,maxOffset:a}=e;return t.map((e=>(e-n)/(a-n)))})({offsets:r,minOffset:n||Math.min(...r),maxOffset:a||Math.max(...r)});return e.map(((e,t)=>({color:e.color,offset:o[t]})))}},q=e=>{let{colors:t,numSteps:n=100}=e;function a(e,t,n){return"#"+[e,t,n].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function r(e,t,n){if(e.every(((e,n)=>e===t[n])))return e;let a=e.slice();for(let r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a}const o=U({colors:t});o.forEach((e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,a){return t+t+n+n+a+a}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)}));let i=[];const s=Array.from({length:n},((e,t)=>t/(n-1)));for(let l=0;l<s.length;l++){const e=s[l];let t,n,d,c;for(let a=0;a<o.length-1;a++)if(e>=o[a].offset&&e<=o[a+1].offset){t=o[a].color,n=o[a+1].color,d=o[a].offset,c=o[a+1].offset;break}const u=r(t,n,(e-d)/(c-d));i.push(a(...u))}return i},G=e=>{let{gradientDirection:t,colors:n,optionalMinValue:a,optionalMaxValue:r}=e;const o=U({colors:n,optionalMinValue:a,optionalMaxValue:r});return"linear-gradient(".concat(t,", ").concat(o.map((e=>"".concat(e.color," ").concat(100*e.offset,"%"))).join(", "),")")},Q=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;return U({colors:t,optionalMinValue:n,optionalMaxValue:a}).map((e=>({color:e.color,offset:100*e.offset+"%"})))},X=e=>{let{id:t,colors:n}=e;return(0,P.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,P.jsx)("defs",{children:(0,P.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map(((e,t)=>(0,P.jsx)("stop",{offset:e.offset,stopColor:e.color},t)))})})})},$=e=>{let{title:t,valueRange:n,colorAxis:a,isPortrait:r}=e;const i=(0,Z.Z)();if(null===(null===n||void 0===n?void 0:n.min)||null===(null===n||void 0===n?void 0:n.max))return null;const{colors:s,minValue:l,maxValue:d}=a;let c=l,h=d;void 0===l&&(c=n.min),void 0===d&&(h=n.max),n.min<c&&(c=n.min),n.max>h&&(h=n.max);const p=e=>"".concat((e-c)/(h-c)*100,"%"),x={position:"absolute",fontSize:"0.75rem",color:i.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},m={bottom:"-1.25rem",transform:r?"translateX(-100%)":"translateX(-50%)"},g={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},v={top:"-0.5rem",borderTop:"0.25rem solid ".concat(i.palette.text.secondary)},b={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(i.palette.text.secondary)};return(0,P.jsxs)(o.Z,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:r?"0":"50px"},children:[(0,P.jsx)(u.Z,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,P.jsxs)(o.Z,{sx:{background:G({gradientDirection:"to right",colors:s,optionalMaxValue:h}),color:i.palette.text.secondary,border:"1px solid ".concat(i.palette.text.secondary),width:r?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,P.jsxs)("span",{style:{...x,top:"-1.5rem",transform:"translateX(-50%)",left:p(n.min)},children:["min: ",Math.round(n.min)]}),(0,P.jsxs)("span",{style:{...x,...m,left:p(n.max)},children:["max: ",Math.round(n.max)]}),(0,P.jsx)("div",{style:{...g,...v,left:p(n.min)}}),(0,P.jsx)("div",{style:{...g,...b,left:p(n.max)}})]})]})};var K=n(53540);const J=e=>{let{day:t,color:n,tooltipText:r,dateRange:i,inFirstTwoRowsOfChart:s}=e;const l=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(l.current&&s(t,i)){const e=l.current.parentElement;e&&(e.style.top="11vh")}}),[l,s]),(0,P.jsxs)(o.Z,{ref:l,className:"nivo-tooltip",children:[(0,P.jsx)(T.Z,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,K.ZP)(r,{replace:Y.T1})]})},ee=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},te=e=>{var t,n,r,i,s;const{dataArray:l,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[p,x]=(0,a.useState)({min:null,max:null}),[m,g]=(0,a.useState)({min:null,max:null}),[v,b]=(0,a.useState)(400);(0,a.useEffect)((()=>{if(!(0,Y.qt)(l))return;const e=(e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}))(l.map((e=>e.day)));x(e);const t=l.map((e=>e.value));g((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const n=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,a=ee(c),r=n*(7*Math.min(h[0]/60,20)+40)+a.top+a.bottom;b(r)}),[l,h]);const y=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,f=ee(c),j=(0,Z.Z)(),w=(e,t)=>{const n=new Date(e),a=n.getDay(),r=0===a||1===a,o=new Date(t.min).getFullYear(),i=n.getFullYear()===o;return r&&i},S=q({colors:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.colors,numSteps:null===u||void 0===u||null===(r=u.colorAxis)||void 0===r?void 0:r.gradientSteps});return(0,P.jsxs)(V,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[y?(0,P.jsx)($,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,P.jsx)(o.Z,{sx:{height:"".concat(v,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,P.jsx)(o.Z,{sx:{height:"".concat(v,"px"),position:"absolute",width:"100%"},children:(0,P.jsx)(N.DQ,{data:l,from:p.min,to:p.max,emptyColor:"transparent",align:"top",theme:{text:{fill:j.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(i=u.colorAxis)||void 0===i?void 0:i.minValue,maxValue:null===u||void 0===u||null===(s=u.colorAxis)||void 0===s?void 0:s.maxValue,margin:f,yearSpacing:40,monthBorderColor:j.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:a}=e;const r=l.find((e=>e.day===t)),o=r?(i=r.tooltip,(new DOMParser).parseFromString(i,"text/html").body.innerHTML):"";var i;return(0,P.jsx)(J,{day:t,color:a,tooltipText:o,dateRange:p,inFirstTwoRowsOfChart:w})}})})})]})};var ne=n(7161),ae=(n(42978),n(666),n(13239)),re=n(94294),oe=n(35527),ie=n(42755),se=n(3874),le=n(4531),de=n(87210),ce=n(62573);const ue=e=>{let{today:t,minDateOfDataset:n,aggregationType:a}=e;const r=[{label:"Last 14d",range:()=>({startDate:(0,ie.b)((0,se.E)(t,-14)),endDate:(0,le.i)(t)})},{label:"Last 30d",range:()=>({startDate:(0,ie.b)((0,se.E)(t,-30)),endDate:(0,le.i)(t)})}],o=[{label:"Last 90d",range:()=>({startDate:(0,ie.b)((0,se.E)(t,-90)),endDate:(0,le.i)(t)})},{label:"Last 365d",range:()=>({startDate:(0,ie.b)((0,se.E)(t,-365)),endDate:(0,le.i)(t)})},{label:"All Time",range:()=>({startDate:n,endDate:(0,le.i)(t)})}];return a===ce.Z.hourly?r:[...r,...o]},he=(0,r.ZP)(oe.Z,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})((e=>{let{theme:t,showPickerPanel:n,smallScreen:a}=e;return{zIndex:!0===n&&1,position:"relative",padding:n?t.spacing(1):0,margin:n&&!a?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}})),pe=e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,de.WU)(t,"yyyy-MM-dd"),endDate:(0,de.WU)(n,"yyyy-MM-dd")}};var xe=n(77997),me=n(40630);function ge(e){let{aggregationType:t,setAggregationType:n}=e;return(0,P.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,P.jsx)(u.Z,{variant:"caption",display:"block",color:"text.secondary",children:"DATA AVERAGE"}),(0,P.jsxs)(xe.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",children:[(0,P.jsx)(me.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:ce.Z.hourly,"aria-label":ce.Z.hourly,children:ce.Z.hourly}),(0,P.jsx)(me.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:ce.Z.daily,"aria-label":ce.Z.daily,children:ce.Z.daily})]})]})}var ve=n(2165),be=n(33026);const ye=(0,a.createContext)(),fe={startDate:null,endDate:null,key:"selection"};function je(e){let{children:t}=e;const[n,r]=(0,a.useState)(fe),[o,i]=(0,a.useState)(ce.Z.hourly),s=(0,a.useMemo)((()=>({dateRange:n,setDateRange:r,aggregationType:o,setAggregationType:i})),[n,o]);return(0,P.jsx)(ye.Provider,{value:s,children:t})}const Ze=()=>(0,a.useContext)(ye),we="HOURLY data is limited to max 30d",Se="Start and end dates must be different",De=v.aT.findIndex((e=>e===v.Xh.historical)),ke=e=>(0,P.jsx)(f.Z,{severity:"error",sx:{py:.5,px:1,display:"flex",alignItems:"center","& div":{fontSize:"0.75rem",p:0},"& .MuiAlert-icon":{fontSize:"1rem",mr:.5}},children:e}),Ce=e=>{const{minDateOfDataset:t,dataType:n}=e,{currentSchoolID:r,setIndividualChartData:o}=(0,a.useContext)(b.G),[i,d]=(0,a.useState)(),[c,u]=(0,a.useState)(!0),h=new Date,p=(0,Z.Z)(),x=(0,s.Z)(p.breakpoints.down("sm")),{dateRange:y,setDateRange:f,aggregationType:j,setAggregationType:w}=Ze();(0,a.useEffect)((()=>{f({...ue({today:h,minDateOfDataset:t})[0].range(),key:"selection"}),w(ce.Z.hourly)}),[]);const[S,D]=(0,a.useState)(),[k,C]=(0,a.useState)(!1),T=(0,a.useRef)(null),[A,I]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[T]);const M=e=>{const{startDate:t,endDate:n}=e||{};if(t&&n){if((0,ve.K)(t,n))return d(Se),void u(!0);if(d(null),u(!1),j===ce.Z.hourly){const e=(0,be.j)(n,t)>30;d(e?we:null),u(e)}else null!==i&&d(null),!0===c&&u(!1)}};(0,a.useEffect)((()=>{M(y)}),[j]);return(0,P.jsx)(he,{showPickerPanel:k,smallScreen:x,ref:T,elevation:8,onClick:()=>C(!0),children:(0,P.jsxs)(l.Z,{direction:"column",spacing:1,children:[(0,P.jsx)(ne.Dw,{ranges:[y],onChange:e=>{e&&(M(e.selection),f(e.selection))},staticRanges:(0,ne.$z)(ue({today:h,minDateOfDataset:t,aggregationType:j})),inputRanges:[],rangeColors:[p.palette.primary.main,p.palette.secondary.main,p.palette.text.secondary],minDate:t,maxDate:h,months:1,showMonthAndYearPickers:!1,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,calendarFocus:"backwards",startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0}),k&&(0,P.jsxs)(l.Z,{direction:"column",alignItems:"end",width:"100%",spacing:1,children:[(0,P.jsx)(ge,{aggregationType:j,setAggregationType:w,smallScreen:x}),(0,P.jsxs)(l.Z,{direction:"row",spacing:1,children:[i&&ke(i),(0,P.jsx)(re.Z,{variant:"contained",size:"small",disabled:c,onClick:e=>{if(null!==i)return;e.stopPropagation();const t=pe({startDateObject:y.startDate,endDateObject:y.endDate}),a=(0,g.kq)({endpoint:v.Xh.historical,school_id:r,aggregationType:j,dataType:n,startDate:t.startDate,endDate:t.endDate});a!==S&&(I(!0),(0,m.d)({url:a}).then((e=>{o(De,e),D(a),I(!1),C(!1)})).catch((e=>{console.log(e)})))},sx:{transform:"translateY(-1px)"},children:A?(0,P.jsx)(ae.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})]})]})]})})};var Te=n(94925);const Ae=(0,a.createContext)();function Pe(e){let{children:t}=e;const[n,r]=(0,a.useState)(),[o,i]=(0,a.useState)(),s=(0,a.useMemo)((()=>({hAxis:n,setHAxis:r,vAxis:o,setVAxis:i})),[n,o]);return(0,P.jsx)(Ae.Provider,{value:s,children:t})}const Ie=()=>(0,a.useContext)(Ae),Me=v.aT.findIndex((e=>e===v.Xh.correlationDailyAverage)),Ee=(0,r.ZP)(w.Z)((e=>{let{theme:t}=e;return{borderTopRightRadius:0,borderBottomRightRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}})),_e=(0,r.ZP)(w.Z)((e=>{let{theme:t}=e;return{borderTopLeftRadius:0,borderBottomLeftRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0}}})),ze=e=>{const{currentSchoolID:t,setIndividualChartData:n}=(0,a.useContext)(b.G),{allowedAxes:r,selectedAxes:o,dataType:s}=e,{hAxis:d,vAxis:c,setHAxis:u,setVAxis:h}=Ie(),[p,x]=(0,a.useState)(),[y,f]=(0,a.useState)(!1),[Z,w]=(0,a.useState)(!0);(0,a.useEffect)((()=>{const{hAxis:e,vAxis:t}=o;e&&t?d===e&&c===t||(h(t),u(e)):w(!0)}),[o]);(0,a.useEffect)((()=>{const{hAxis:e,vAxis:t}=o;e&&t&&w(d===e&&c===t)}),[d,c,o]);const D=e=>!e.allowedDataTypes.includes(s);return(0,P.jsxs)(j.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,P.jsx)(j.ZP,{item:!0,xs:12,sm:"auto",children:(0,P.jsxs)(l.Z,{direction:"row",spacing:0,children:[(0,P.jsxs)(Ee,{fullWidth:!0,size:"small",children:[(0,P.jsx)(Te.Z,{id:"x-axis-select-label",children:"X Axis"}),(0,P.jsx)(S.Z,{labelId:"x-axis-select-label",value:d||(null===o||void 0===o?void 0:o.hAxis)||null,label:"X Axis",onChange:e=>{const t=e.target.value;u(t),t===c&&h("")},autoWidth:!0,children:null===r||void 0===r?void 0:r.map((e=>(0,P.jsxs)(i.Z,{value:e.sensor,disabled:e.sensor===c||D(e),sx:{textTransform:"capitalize"},children:[e.sensor,D(e)&&" (No Data)"]},e.sensor)))})]}),(0,P.jsxs)(_e,{fullWidth:!0,size:"small",children:[(0,P.jsx)(Te.Z,{id:"y-axis-select-label",children:"Y Axis"}),(0,P.jsx)(S.Z,{labelId:"y-axis-select-label",value:c||(null===o||void 0===o?void 0:o.vAxis)||null,label:"Y Axis",onChange:e=>{h(e.target.value),e.target.value===d&&u("")},autoWidth:!0,children:null===r||void 0===r?void 0:r.map((e=>(0,P.jsxs)(i.Z,{value:e.sensor,disabled:e.sensor===d||D(e),sx:{textTransform:"capitalize"},children:[e.sensor,D(e)&&" (No Data)"]},e.sensor)))})]})]})}),(0,P.jsx)(j.ZP,{item:!0,xs:12,sm:"auto",children:(0,P.jsx)(re.Z,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{if(!c||!d)return;const e=(0,g.Qo)({endpoint:v.Xh.correlationDailyAverage,school_id:t,dataType:s,sensorX:d,sensorY:c});e!==p&&(f(!0),(0,m.d)({url:e}).then((t=>{n(Me,t),x(e),f(!1)})).catch((e=>{console.log(e)})))},disabled:Z,children:y?(0,P.jsx)(ae.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})})]})},Re=e=>{let{dataType:t,height:n,selectableAxes:a}=e,r="This sensor ",i=" data. Please choose a different sensor.";return a&&(r="This pair of sensors ",i=" correlation data. Please choose another pair or a different data type."),(0,P.jsx)(o.Z,{height:n,children:(0,P.jsxs)(f.Z,{severity:"error",sx:{my:2},children:[r,"does not have\xa0",(0,P.jsx)(o.Z,{component:"span",textTransform:"capitalize",children:t}),i]})})};function We(e){var t;const{chartData:n,subchartIndex:r,windowSize:i,isPortrait:s,height:d,maxHeight:c,selectedDataType:u,allowedDataTypes:h}=e,p=(0,a.useContext)(y.R),[m,g]=(0,a.useState)(),[v,b]=(0,a.useState)(),[f,w]=(0,a.useState)(),[S,D]=(0,a.useState)(),k=(0,Z.Z)(),[C,T]=(0,a.useState)(!0),[A,I]=(0,a.useState)(!0),[M,E]=(0,a.useState)(!1),[W,O]=(0,a.useState)(),[N,U]=(0,a.useState)(),[q,G]=(0,a.useState)(),[$,K]=(0,a.useState)(R()),J=(0,a.useMemo)((()=>L({...e,theme:k})),[e,k,n.chartType]),[ee,ne]=(0,a.useState)(null);if("Calendar"===n.chartType)return(0,a.useEffect)((()=>{const e=n.dataArray||n.subcharts&&n.subcharts[r].dataArray||null;(0,Y.qt)(e)?(ne(e),I(!0)):I(!1)}),[n]),ee?A?(0,P.jsx)(te,{dataArray:ee,valueRangeBoxTitle:(0,x.UT)({dataTypeKey:u,dataTypes:h,showUnit:!0}),isPortrait:s,options:J,windowSize:i}):(0,P.jsx)(Re,{dataType:(0,x.UT)({dataTypeKey:u,dataTypes:h})}):(0,P.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,P.jsx)(H.Z,{})});let ae,re=!1,oe=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[r].control);oe&&(re=!0,ae={...oe.options,ui:B({chartControl:oe,mainChartData:n,mainChartOptions:J,subchartIndex:r,theme:k,isPortrait:s})},"ChartRangeFilter"===oe.controlType&&(0,a.useEffect)((()=>F({controlWrapper:f,chartID:$})),[f]));const ie=J.seriesSelector||!1,se=J.dateRangePicker||null,le=J.formatters||null;let de=n.selectableAxes||null;de&&(0,Y.qt)(de.allowedAxes)&&de.allowedAxes.length<=2&&(de=null),(0,a.useEffect)((()=>{ie?he({newDataColumns:N}):(null===v||void 0===v||v.setOptions({...J}),null===v||void 0===v||v.draw(),re&&(null===f||void 0===f||f.setOptions(ae),null===f||void 0===f||f.draw()))}),[k,s,i]),(0,a.useEffect)((()=>{N&&ie&&"setViewColumn"==ie.method&&(ce({dataColumns:N}),he({newDataColumns:N}))}),[k]);const ce=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=J.colors[e.seriesIndex%J.colors.length],e.serieAttribute=null===(t=J.series)||void 0===t?void 0:t[e.seriesIndex]}))},ue=e=>{let t,n,{dataTable:a,allInitialColumns:r}=e;return r.forEach(((e,r)=>{if(0===r)return;const o=a.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(n=n?Math.max(n,o.max):o.max)})),{min:t,max:n}},he=(0,a.useCallback)((e=>{let{newDataColumns:t,_allInitialColumns:n=W,_chartWrapper:a=v,_controlWrapper:r=f}=e;if(n){if(U(t),"toggleVisibility"===ie.method||null===ie.method){const e={};if(t.forEach((t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===a||void 0===a||a.setOptions({...J,series:{...J.series,...e}}),re){const t=null===r||void 0===r?void 0:r.getOptions();null===r||void 0===r||r.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,series:{...J.series,...e}}}})}}else if("setViewColumn"===ie.method){let e=[];e.push(0),t.forEach((t=>{if(t.selected){e.push(t);for(let a=t.indexIn_+1;a<n.length&&"data"!==n[a].role;a++)e.push(n[a])}})),null===a||void 0===a||a.setView({columns:e});const o={...J};o.colors=t.filter((e=>e.selected)).map((e=>e.color));const i={};let s=0;if(t.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(i[s]=e.serieAttribute),s++)})),o.series=i,null===a||void 0===a||a.setOptions(o),re){const t=null===r||void 0===r?void 0:r.getOptions();null===r||void 0===r||r.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,colors:o.colors,series:o.series},chartView:{columns:e}}})}}null===a||void 0===a||a.draw(),re&&(null===r||void 0===r||r.draw())}}),[W,J,ie,v,f,q,re]);(0,a.useEffect)((()=>{if(p&&n){if(JSON.stringify(n)===JSON.stringify(S))return;D(n);const e=n.dataArray||n.subcharts&&n.subcharts[r].dataArray||null,t=(0,Y.qt)(e);if(I(t),!0===t){E(!0);const t=p.visualization.arrayToDataTable(e);if(le&&"object"===typeof le&&le.hasOwnProperty("numberFormatter")){const e=new p.visualization.NumberFormat(le.numberFormatter.numberFormat);le.numberFormatter.columns.forEach((n=>e.format(t,n)))}g(t)}}}),[p,n]),(0,a.useEffect)((()=>{if(!0===M){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push({...n,calc:e})}else t.push(n);return t})(n.columns||n.subcharts&&n.subcharts[r].columns||null),t=new p.visualization.ChartWrapper({chartType:n.chartType,dataTable:re?void 0:m,options:J,view:{columns:e},containerId:$});let a;if(b(t),re){const e=new p.visualization.Dashboard(document.getElementById("dashboard-".concat($)));p.visualization.events.addListener(e,"ready",fe),a=new p.visualization.ControlWrapper({controlType:oe.controlType,options:ae,containerId:"control-".concat($)}),w(a),e.bind(a,t),e.draw(m)}else p.visualization.events.addListener(t,"ready",fe),t.draw();if(ie){const{initAllInitialColumns:e,initDataColumns:n}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:a}=e;var r=t.getView();if(null==r.columns){const e=new p.visualization.DataView(n);t.setView({columns:e.columns}),r=t.getView()}let o=!0,i=0;const s=r.columns.map(((e,t)=>("number"===typeof e&&(e={role:o?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,o=o&&!1,"data"===e.role&&(a.defaultSeriesToDisplayInitially?a.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:a.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e)));O(s);const l=ue({dataTable:n,allInitialColumns:s});G(l);const d=s.filter((e=>{var t,n;return"data"===e.role&&!1!==(null===(t=J.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)}));return"setViewColumn"===a.method&&ce({dataColumns:d}),U(d),{initAllInitialColumns:s,initDataColumns:d}})({chartWrapper:t,dataTable:m,seriesSelector:ie});he({_allInitialColumns:e,newDataColumns:n,_chartWrapper:t,_controlWrapper:a})}E(!1)}}),[M]);const pe=J.gradientBackgroundColor;let xe,me;var ge,ve,be,ye;pe&&(xe="".concat($,"-backgroundGradient"),me=Q({colors:k.palette.chart.colorAxes[pe].colors,optionalMinValue:null===(ge=J.vAxis)||void 0===ge||null===(ve=ge.viewWindow)||void 0===ve?void 0:ve.min,optionalMaxValue:null===(be=J.vAxis)||void 0===be||null===(ye=be.viewWindow)||void 0===ye?void 0:ye.max}));const fe=()=>{C&&T(!1)};return A?(0,P.jsxs)(V,{isPortrait:s,gradientBackgroundId:xe,className:n.chartType,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[C&&(0,P.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,P.jsx)(H.Z,{})}),C?null:(0,P.jsxs)(j.ZP,{container:!0,mt:1,sx:{gap:2,[k.breakpoints.down("sm")]:{gap:1}},children:[ie&&(0,P.jsx)(j.ZP,{item:!0,sx:{[k.breakpoints.down("sm")]:{width:"100%"}},children:(0,P.jsx)(_,{items:N,allowMultiple:ie.allowMultiple,seriesLabel:ie.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),se&&(0,P.jsx)(j.ZP,{item:!0,sx:{height:"2rem",width:{[k.breakpoints.down("sm")]:{width:"100%"}}},children:(0,P.jsx)(Ce,{dataType:u,minDateOfDataset:new Date(se.minDate)})}),de&&(0,P.jsx)(ze,{allowedAxes:de.allowedAxes,selectedAxes:de.selectedAxes,dataType:u})]}),(()=>{const e=(0,P.jsx)(o.Z,{id:$,sx:{height:d,maxHeight:c}});var t;return re?(0,P.jsxs)(l.Z,{id:"dashboard-".concat($),direction:(null===(t=z[oe.controlType])||void 0===t?void 0:t.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,P.jsx)(o.Z,{id:"control-".concat($),sx:{height:"calc(".concat(d," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),e]}):e})(),pe?(0,P.jsx)(X,{id:xe,colors:me}):null]}):(0,P.jsxs)(P.Fragment,{children:[de&&(0,P.jsx)(o.Z,{mt:1,children:(0,P.jsx)(ze,{allowedAxes:de.allowedAxes,selectedAxes:de.selectedAxes,dataType:u})}),(0,P.jsx)(Re,{dataType:(0,x.UT)({dataTypeKey:u,dataTypes:h}),selectableAxes:de,height:ie||re?1.2*parseFloat(d)+"vw":d})]})}var Oe=n(53767);const Le=function(e){let{text:t,wordLimit:n=40,reference:r}=e;const[i,l]=(0,a.useState)(!1),d=(0,Z.Z)(),c=(0,s.Z)(d.breakpoints.down("sm")),h=(0,a.useRef)(null),p=t.split(" ");if(!c||p.length/n<=1.4)return(0,P.jsxs)(o.Z,{children:[(0,P.jsx)(u.Z,{children:(0,K.ZP)(t,{replace:Y.T1})}),r&&(0,P.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:(0,K.ZP)(r,{replace:Y.T1})})]});let x=p.slice(0,n).join(" ");const m=x.lastIndexOf(".");return-1!==m&&(x=x.slice(0,m+1)),(0,P.jsx)(Oe.d,{onClickAway:e=>{(e=>{let{target:t}=e;const n=h.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(a.has(t.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||l(!1)},children:(0,P.jsx)(o.Z,{ref:h,onClick:()=>l(!i),style:{cursor:"pointer"},children:i?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(u.Z,{children:(0,K.ZP)(t,{replace:Y.T1})}),r&&(0,P.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:(0,K.ZP)(r,{replace:Y.T1})})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(u.Z,{display:"inline",children:[(0,K.ZP)(x,{replace:Y.T1}),"..."]}),(0,P.jsx)(u.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Be=n(26759);const Fe=e=>{let{selectedDataType:t,dataTypes:n,fetchChartDataType:r}=e;const[o,s]=(0,a.useState)(null);if(!(0,Y.qt)(n))return null;if(n.length<=1)return(0,P.jsx)(u.Z,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const l=Boolean(o),d=()=>{s(null)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(re.Z,{id:"data-type-drop-down-menu-button","aria-controls":l?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":l?"true":void 0,onClick:e=>{s(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,P.jsx)(u.Z,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,x.UT)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,P.jsx)(Be.Z,{})]}),(0,P.jsx)(c.Z,{id:"data-type-drop-down-menu",anchorEl:o,open:l,onClose:d,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map(((e,t)=>(0,P.jsx)(i.Z,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{r(e),d()})(e.key),children:e.name_title},t)))})]})};var Ve=n(25228);const He=(0,r.ZP)(Ve.Z,{shouldForwardProp:e=>"smallFontSize"!==e})((e=>{let{theme:t,smallFontSize:n="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:n,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}})),Ne=(0,r.ZP)(o.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),Ye=(0,r.ZP)(i.Z)((e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}}));const Ue=function(e){const{chartTitle:t,generalChartSubtitle:n,generalChartReference:r,chartData:i,chartHeight:y,chartID:f,chartIndex:j}=e,{currentSchoolID:Z,setIndividualChartData:w}=(0,a.useContext)(b.G),S=(0,s.Z)((e=>e.breakpoints.down("sm"))),[D,k]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[C,T]=(0,a.useState)([window.innerWidth,window.innerHeight]);let I,M=y;const E=i,[_,z]=(0,a.useState)(0),[R,W]=(0,a.useState)(0),[O,L]=(0,a.useState)(-1),[B,F]=(0,a.useState)(),[V,H]=(0,a.useState)(null),[N,U]=(0,a.useState)([]),[q,G]=(0,a.useState)(null),{dateRange:Q,aggregationType:X}=Ze(),{hAxis:$,vAxis:K}=Ie();return(0,a.useEffect)((()=>{if(E.allowedDataTypes){const e=[];for(let t of E.allowedDataTypes){const{name_title:n,name_short:a,unit:r}=x.oS[t];e.push({key:t,name_title:n,name_short:a,unit:r})}U(e)}G(E.selectedDataType)}),[E]),(0,a.useEffect)((()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{k(window.matchMedia("(orientation: portrait)").matches),T([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[E]),(0,a.useEffect)((()=>{W(_),z(0)}),[Z]),"Calendar"===E.chartType||M||(M=D?"80vw":"35vw",I=D?"800px":"500px"),t?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(o.Z,{children:[(0,P.jsxs)(u.Z,{display:"inline",variant:"h6",color:"text.primary",children:[j+1,". ",t,"\xa0"]}),(0,P.jsx)(o.Z,{display:"inline",children:(0,P.jsx)(Fe,{selectedDataType:q,dataTypes:N,fetchChartDataType:async e=>{const t=v.aT[f];let n;if(t===v.Xh.historical){const{startDate:a,endDate:r}=Q||{};if(!a||!r)return;const o=pe({startDateObject:a,endDateObject:r});n=(0,g.kq)({endpoint:t,school_id:Z,startDate:o.startDate,endDate:o.endDate,aggregationType:X,dataType:e})}else n=t===v.Xh.correlationDailyAverage?(0,g.Qo)({endpoint:v.Xh.correlationDailyAverage,school_id:Z,dataType:e,sensorX:$,sensorY:K}):(0,g.Eh)({endpoint:t,school_id:Z,dataType:e});n&&(0,m.d)({url:n}).then((e=>{w(f,e),G(e.selectedDataType)})).catch((e=>{console.log(e)}))}})})]}),(0,P.jsxs)(Ne,{height:"100%",children:[E.subcharts?(()=>{const e=E.subcharts.length>4,t=e?E.subcharts.slice(0,3):E.subcharts,n=e?E.subcharts.slice(3):null,a=e=>-1===_?R===e:_===e;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(He,{value:_,onChange:(t,n)=>{W(_),z(n),e&&n<3&&n!==O&&(F(),L(-1))},variant:S?"fullWidth":"standard",children:[t.map(((e,t)=>(0,P.jsx)(d.Z,{value:t,label:E.subcharts[t].subchartTitle,sx:{textDecoration:!(0,Y.qt)(E.subcharts[t].dataArray)&&"line-through"}},t))),e&&(0,P.jsx)(d.Z,{value:O,label:(0,P.jsxs)(l.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,P.jsxs)(o.Z,{flex:1,children:["Other sensors",B&&" (".concat(B,")"),"\xa0"]}),(0,P.jsx)(p.Z,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>H(e.currentTarget)})]}),e&&(0,P.jsx)(c.Z,{id:"submenu",anchorEl:V,open:Boolean(V),onClose:()=>{-1===_&&(W(_),z(R)),H(null)},children:n.map(((e,t)=>(0,P.jsx)(Ye,{selected:t===_-3,onClick:()=>(e=>{W(_),z(3+e),L(3+e),F(n[e].subchartTitleShort),H(null)})(t),sx:{textDecoration:!(0,Y.qt)(E.subcharts[t+3].dataArray)&&"line-through"},children:(0,P.jsxs)(l.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,P.jsx)(o.Z,{children:n[t].subchartTitle}),t===_-3&&(0,P.jsx)(A.Z,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t)))}),(0,P.jsx)(o.Z,{position:"relative",sx:{overflowX:D&&"auto",WebkitOverflowScrolling:D&&"touch",overflowY:"hidden"},children:E.subcharts.map(((e,t)=>(0,P.jsx)(o.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:a(t)?"1":"0",pointerEvents:a(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,P.jsx)(We,{selectedDataType:q,allowedDataTypes:N,chartData:E,subchartIndex:t,isPortrait:D,windowSize:C,height:E.height?E.height:M,maxHeight:["Calendar"].includes(E.chartType)?"":I,currentSubchart:_})},t)))})]})})():(0,P.jsx)(We,{selectedDataType:q,allowedDataTypes:N,chartData:E,isPortrait:D,windowSize:C,height:E.height?E.height:M}),(0,P.jsx)(o.Z,{sx:{my:3},children:(0,P.jsx)(u.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,P.jsx)(Le,{text:(()=>{var e;let t=n||"";return E.subcharts&&null!==(e=E.subcharts[_])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=E.subcharts[_].subchartSubtitle),t})(),reference:(()=>{var e;let t=r||"";return E.subcharts&&null!==(e=E.subcharts[_])&&void 0!==e&&e.reference&&(t+="<br/>",t+=E.subcharts[_].reference),t})()})})})]})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(h.Z,{variant:"text",sx:{width:"100%",fontSize:"2rem"}}),(0,P.jsx)(h.Z,{variant:"rounded",width:"100%",height:300})]})};var qe=n(61745),Ge=n(89164),Qe=n(78723),Xe=n(71478),$e=n(41212);const Ke=(0,r.ZP)(o.Z)((e=>{let{theme:t}=e;return{paddingBottom:t.spacing(2),"& *":{color:t.palette.text.secondary},"& hyvor-talk-comments":{"--ht-color-accent":t.palette.primary.main,"--ht-color-accent-text":t.palette.primary.contrastText,"--ht-color-box":t.palette.customBackground,"--ht-color-box-text":t.palette.text.secondary,"--ht-color-box-text-light":t.palette.text.secondaryRGB,"--ht-button-radius":t.spacing(1)}}}));const Je=function(e){let{pageID:t}=e;return(0,P.jsxs)(Ge.Z,{children:[(0,P.jsx)(qe.Z,{text:(0,Y.Fb)(Xe.Sf.id)}),(0,P.jsx)(o.Z,{maxWidth:"lg",margin:"auto",children:(0,P.jsxs)(oe.Z,{elevation:2,sx:{p:3,pb:0},children:[(0,P.jsx)(u.Z,{variant:"body2",color:"text.secondary",sx:{pb:1},children:(0,K.ZP)(Xe.Sf.content,{replace:Y.T1})}),(0,P.jsx)(Ke,{children:(0,P.jsx)(Qe.HW,{"website-id":$e.oS,"page-id":t,loading:"lazy"})})]})})]})};var et=n(94721),tt=n(30604),nt=n(60173),at=n(49877),rt=n(55396),ot=n(60627),it=n(61162),st=n(53524),lt=n(47438),dt=n(80223);function ct(e){const[t,n]=(0,a.useState)(null),r=e=>{n(e.currentTarget),lt.y(lt.z.airQualityIndexLegendQuickGlance)},o=()=>{n(null)},i=Boolean(t);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(st.TF,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,P.jsx)(at.Z,{sx:{mt:1},"aria-owns":i?lt.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:r,onMouseLeave:o,onClick:e=>nt.tq&&(i?o():r(e)),"aria-label":lt.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,P.jsxs)(l.Z,{direction:"column",alignItems:"center",children:[(0,P.jsx)(it.Z,{fontSize:"1rem"}),(0,P.jsx)(u.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,P.jsx)(rt.Z,{id:lt.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:i,anchorEl:t,placement:"top-end",onClose:o,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,P.jsx)(ot.Z,{...t,timeout:350,children:(0,P.jsxs)(oe.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,P.jsx)(u.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,P.jsx)(dt.Z,{tiny:!0,hideAQIDescription:!0})]})})}})]})}var ut=n(16344),ht=n(1414),pt=n(74475),xt=n(26459),mt=n(19132),gt=n(35429),vt=n(22981),bt=n(57689),yt=n(31781),ft=n(35552),jt=n(63501);const Zt=e=>{const{authenticationState:t,user:n}=(0,a.useContext)(yt.S),r=t.authenticated&&t.checkedAuthentication,{currentSchoolID:o}=(0,a.useContext)(b.G),{enqueueSnackbar:i}=(0,ft.Ds)(),s=(0,a.useCallback)((t=>{r?null!==n&&void 0!==n&&n.allowedSchools.some((e=>e.school_id===o))?null===t||void 0===t||t():i("Your account does not have access to ".concat(o.toUpperCase()," Alerts"),jt.P.error):null===e||void 0===e||e()}),[r,e,o,n,i]);return{loggedIn:r,handleRestrictedAccess:s}},wt=e=>{let{onButtonClick:t}=e;const{currentSchoolID:n,schoolMetadata:r}=(0,a.useContext)(b.G),{handleRestrictedAccess:o}=Zt(t),[s,l]=(0,a.useState)(null),d=(0,bt.s0)();if(!r)return null;const u=r.screens;if(!(0,Y.qt)(u))return null;const h=()=>{o((()=>d("/screen/".concat(n))))};if(u.length<=1)return(0,P.jsxs)(re.Z,{variant:"contained",size:"small",onClick:h,children:[(0,P.jsx)(vt.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const p=Boolean(s);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(re.Z,{id:"basic-button","aria-controls":p?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,onClick:e=>{o((()=>l(e.currentTarget)))},variant:"contained",size:"small",children:[(0,P.jsx)(vt.Z,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,P.jsx)(c.Z,{id:"tv-screen-list-menu",anchorEl:s,open:p,onClose:()=>{l(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:u.map(((e,t)=>(0,P.jsx)(i.Z,{onClick:()=>{return t=e.screen_name,void o((()=>{l(null),d("/screen/".concat(n,"/").concat(t))}));var t},sx:{fontSize:"0.8rem"},children:e.location_long},t)))})]})};var St=n(50533),Dt=n(79836),kt=n(56890),Ct=n(35855),Tt=n(53994),At=n(53382),Pt=n(73518),It=n(71566),Mt=n(20068),Et=n(13400),_t=n(5289),zt=n(97123),Rt=n(65661),Wt=n(39157),Ot=n(31009),Lt=n(62564);const Bt=e=>{const{buttonIcon:t,buttonIconAria:n,buttonLabel:r,trackingEvent:o,dialogTitle:i,dialogOpenHandler:l=null,dialogCloseHandler:d=null,displaySchoolID:c=!0,maxWidth:u="lg",children:h,disabled:p}=e;let x;x=!(!t||r);const{currentSchoolID:m}=(0,a.useContext)(b.G),g=(0,s.Z)((e=>e.breakpoints.down("sm"))),[v,y]=(0,a.useState)(!1),f=()=>{l?l((()=>{y(!0),o&&lt.y(o)})):(y(!0),o&&lt.y(o))},j=()=>{y(!1),d&&d()},Z=(0,Lt.u)();return(0,P.jsxs)(P.Fragment,{children:[x?(0,P.jsx)(Mt.Z,{title:n,children:(0,P.jsx)(Et.Z,{onClick:f,"aria-label":n,size:"small",sx:{"&:hover,:focus":{color:Z.palette.primary.main}},disabled:p,children:t})}):(0,P.jsxs)(re.Z,{onClick:f,variant:"contained",disabled:p,size:"small",children:[t,"\xa0",r]}),(0,P.jsxs)(_t.Z,{open:v,onClose:j,maxWidth:u,fullWidth:!0,fullScreen:g,keepMounted:!0,children:[(0,P.jsx)(zt.Z,{sx:{justifyContent:"start"},children:(0,P.jsxs)(re.Z,{onClick:j,children:[(0,P.jsx)(Ot.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,P.jsxs)(Rt.Z,{children:[!0===c?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T.Z,{label:m?"School: ".concat(m.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,P.jsx)("br",{})]}):null,i]}),(0,P.jsx)(Wt.Z,{children:h})]})]})};function Ft(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Zt(t),{currentSchoolID:r,current:o}=(0,a.useContext)(b.G),[i,s]=(0,a.useState)({}),[l,d]=(0,a.useState)("placeholder");return(0,a.useEffect)((()=>{if(!o)return;const e=o.filter((e=>e&&e.sensor)).reduce(((e,t)=>(e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:t.sensor.last_seen.split("T")[0],rawDatasets:Object.keys(v.M$).reduce(((e,t)=>(e[v.M$[t]]={sample:null,full:null},e)),{})},e)),{});s(e)}),[o]),(0,P.jsxs)(Bt,{buttonIcon:(0,P.jsx)(It.Z,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:lt.z.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),n(e)},children:[(0,P.jsx)(Vt,{sensorsDatasets:i,updateSensorsDatasets:s,previewingDataset:l,setPreviewingDataset:d,schoolID:r}),i&&(0,P.jsxs)(u.Z,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["These datasets are provided by ",$e.DE," from sensors operated by ",$e.DE,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,P.jsx)(St.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Vt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,setPreviewingDataset:o,schoolID:i}=e,l=(0,Z.Z)(),d=(0,s.Z)(l.breakpoints.down("sm"));return(0,a.useEffect)((()=>{if(Object.keys(t).length>0&&!r){const e=Object.keys(t)[0],a=v.M$.hourly;if(o({sensor:e,datasetType:a}),t[e].rawDatasets[a].sample)return;const r=(0,g.OM)({school_id:i,sensor_location_short:e,datasetType:a,isSample:!0});(0,m.d)({url:r,extension:v.j.csv,needsAuthorization:!0}).then((r=>{const o={...t};o[e].rawDatasets[a].sample=r,n(o)})).catch((e=>console.log(e)))}}),[t,r]),(0,P.jsxs)(j.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:d?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,P.jsx)(j.ZP,{item:!0,sm:12,md:6,children:(0,P.jsx)(Ht,{schoolID:i,sensorsDatasets:t,updateSensorsDatasets:n,smallScreen:d,previewingDataset:r,setPreviewingDataset:o})}),(0,P.jsx)(j.ZP,{item:!0,sm:12,md:6,maxWidth:d?"100%":"unset",sx:{mt:1},children:(0,P.jsx)(Yt,{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,schoolID:i,smallScreen:d})})]})},Ht=e=>{const{schoolID:t,sensorsDatasets:n,smallScreen:a,previewingDataset:r,setPreviewingDataset:o,updateSensorsDatasets:i}=e;return(0,P.jsxs)(Dt.Z,{size:"small",sx:{tableLayout:"fixed"},children:[(0,P.jsx)(kt.Z,{children:(0,P.jsxs)(Ct.Z,{children:[(0,P.jsx)(Tt.Z,{sx:{pl:1},children:"Sensor Location"}),(0,P.jsx)(Tt.Z,{sx:{width:a?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,P.jsx)(At.Z,{children:n&&Object.keys(n).map((e=>(0,P.jsx)(Nt,{schoolID:t,smallScreen:a,sensor:e,sensorsDatasets:n,previewingDataset:r,setPreviewingDataset:o,isPreviewing:e===(null===r||void 0===r?void 0:r.sensor),updateSensorsDatasets:i},e)))})]})},Nt=e=>{const{schoolID:t,sensorsDatasets:n,sensor:r,previewingDataset:o,setPreviewingDataset:s,isPreviewing:d,updateSensorsDatasets:c}=e,[u,h]=(0,a.useState)(v.M$.hourly);(0,a.useEffect)((()=>{u!==v.M$.hourly&&h(v.M$.hourly)}),[t]);const p=e=>{if(!n[r].rawDatasets[e].sample){const a=(0,g.OM)({school_id:t,sensor_location_short:n[r].location_short,datasetType:e,isSample:!0});(0,m.d)({url:a,extension:v.j.csv,needsAuthorization:!0}).then((t=>{const a={...n};a[r].rawDatasets[e].sample=t,c(a)}))}},x=(0,Z.Z)();return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(Ct.Z,{children:[(0,P.jsx)(Tt.Z,{sx:{pl:1,cursor:"pointer",background:d&&x.palette.background.NYUpurpleLight},onClick:()=>{(null===o||void 0===o?void 0:o.sensor)!==r&&(s({datasetType:u,sensor:r}),p(u))},children:n[r].location_long}),(0,P.jsx)(Tt.Z,{sx:{position:"relative",background:d&&x.palette.background.NYUpurpleLight},children:(0,P.jsx)(w.Z,{size:"small",children:(0,P.jsx)(S.Z,{value:u,onChange:e=>{const t=e.target.value;h(t),s({datasetType:t,sensor:r}),p(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(n[r].rawDatasets).reverse().map(((e,t)=>(0,P.jsx)(i.Z,{value:e,children:(0,P.jsx)(l.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},r)})},Yt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:r,schoolID:i,smallScreen:s}=e,d=(0,Z.Z)(),[c,h]=(0,a.useState)("Not previewing any dataset"),[p,x]=(0,a.useState)("No dataset"),[b,y]=(0,a.useState)(!1),f=e=>{const t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=p,document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a)},[j,w]=(0,a.useState)(""),[S,D]=(0,a.useState)("");return(0,a.useEffect)((()=>{var e,n;if(!r)return;h("Previewing: ".concat(r.sensor," (").concat(r.datasetType,")"));const a=null===(e=t[r.sensor])||void 0===e||null===(n=e.rawDatasets[r.datasetType])||void 0===n?void 0:n.sample;if(!a)return D(null),w(null),x("Loading..."),void y(!0);b&&y(!1);const o=a.split("\n"),s=o[0].split(","),l=o.slice(1);let d;if(D(["",...l.map((e=>e.split(",")[0]))].join("\n")),w([s.slice(1).join(","),...l.map((e=>e.split(",").slice(1).join(",")))].join("\n")),l.length>0){const e=l[l.length-1].split(",");if(e.length>=2){d=e[1].split("T")[0]}}const c="".concat(i,"-").concat(r.sensor,"-").concat(r.datasetType,"-").concat(d,".csv");x(c)}),[r,t]),(0,P.jsxs)(l.Z,{spacing:1,children:[(0,P.jsxs)(o.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,P.jsx)(l.Z,{direction:"row",children:(0,P.jsx)(u.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:c})}),(0,P.jsx)(o.Z,{component:"pre",sx:{overflowX:"auto",color:d.palette.text.secondary,backgroundColor:d.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:s?"11.8rem":"14rem",width:s?"100%":"unset",marginTop:0},children:(0,P.jsx)(l.Z,{direction:"row",sx:{fontSize:"0.75rem"},children:j?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(o.Z,{sx:{mr:2,userSelect:"none"},children:S}),(0,P.jsx)(o.Z,{children:j})]}):(0,P.jsx)(H.Z,{optionalText:"Loading"})})})]}),(0,P.jsx)(o.Z,{textAlign:"center",children:(0,P.jsxs)(re.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!r)return;const e=t[r.sensor].rawDatasets[r.datasetType].full;if(e)f(e);else{const e=(0,g.OM)({school_id:i,sensor_location_short:r.sensor,datasetType:r.datasetType,isSample:!1});(0,m.d)({url:e,extension:v.j.csv,needsAuthorization:!0}).then((e=>{const a={...t};a[r.sensor].rawDatasets[r.datasetType].full=e,n(a),f(e)}))}})(),lt.y(lt.z.rawDatasetDownloaded,{dataset_type:null===r||void 0===r?void 0:r.datasetType,sensor:null===r||void 0===r?void 0:r.sensor})},disabled:b,children:[(0,P.jsx)(Pt.Z,{sx:{fontSize:"1.25rem",mr:.5}}),p]})})]})};var Ut=n(21805),qt=n(27391);const Gt=()=>{const{currentSchoolID:e}=(0,a.useContext)(b.G),{enqueueSnackbar:t}=(0,ft.Ds)(),n=(0,s.Z)((e=>e.breakpoints.down("sm"))),[r,d]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[x,y]=(0,a.useState)(!1),[Z,w]=(0,a.useState)(""),[S,D]=(0,a.useState)(null),[k,C]=(0,a.useState)("");(0,a.useEffect)((()=>{e&&(0,m.d)({url:(0,g.kG)({endpoint:v.eV.alertsEmails,school_id:e}),extension:"json",needsAuthorization:!0}).then((e=>{d(e)})).catch((e=>{t("There was an error loading the email list, please try again",jt.P.error)}))}),[e]),(0,a.useEffect)((()=>{p(r)}),[r]),(0,a.useEffect)((()=>{var e,t;y((e=h,t=r,!(JSON.stringify(e)===JSON.stringify(t))))}),[h]),(0,a.useEffect)((()=>{C(x?"Click to save new changes on server":"No changes detected to save")}),[x]);const A=e=>{const n=e.trim().toLowerCase();if((0,Y.oH)(n)){const e=[...h,n];if(h.includes(n))return t("Already added: ".concat(n),jt.P.error),void w("");150===e.length&&t("Maximum number of recipients reached",jt.P.warning),p(e),w("")}else t("Invalid email address. Valid format: abc@def.xyz",jt.P.error)},I=e=>{const t=h.filter(((t,n)=>n!==e));p(t)},M=()=>{D(null)};return(0,a.useEffect)((()=>{const e=e=>{h!==r&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[h,r]),(0,P.jsxs)(o.Z,{children:[(0,P.jsxs)(j.ZP,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(u.Z,{variant:"body1",fontWeight:500,sx:{p:0,mb:n&&1,mr:!n&&2},children:"Email Recipients:"})}),(0,P.jsx)(j.ZP,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,P.jsxs)(j.ZP,{container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%"},children:[h.map(((e,t)=>(0,P.jsx)(j.ZP,{item:!0,sx:{m:.5},children:(0,P.jsx)(T.Z,{label:e,onDelete:()=>I(t),onClick:e=>((e,t)=>{D({index:t,element:e.currentTarget})})(e,t)})},t))),h.length<150?(0,P.jsx)(j.ZP,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,P.jsx)(qt.Z,{fullWidth:!0,variant:"standard",value:Z,onChange:e=>{const t=e.target.value;w(t),""!==t&&C("Finalize currently edited email by pressing Enter/Return")},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&A(Z)},onPaste:e=>{const t=e.clipboardData.getData("text");w(t),A(t),e.preventDefault()},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,P.jsxs)(l.Z,{sx:{mt:1},spacing:1,alignItems:n?"stretch":"end",children:[(0,P.jsxs)(l.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,P.jsxs)(u.Z,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[h.length," / ",150," recipient",h.length>1?"s":null," added"]}),(0,P.jsx)(St.Z,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),w(""),p([])},children:"Clear All"})]}),0===r.length?(0,P.jsx)(f.Z,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,P.jsx)(Mt.Z,{title:k,enterTouchDelay:0,children:(0,P.jsx)("span",{children:(0,P.jsx)(re.Z,{onClick:n=>{const a=(0,Y.qt)(n)?n:(0,Y.qt)(h)?h:[];(0,m.d)({url:(0,g.kG)({endpoint:v.eV.alertsEmails,school_id:e}),restMethod:v.j2.POST,body:a}).then((e=>{d(e),t("Email list saved successfully!",jt.P.success)})).catch((()=>{t("There was an error saving the email. Please try again.",jt.P.error)}))},variant:"contained",sx:{width:n?"100%":"fit-content"},disabled:!x,children:"SAVE EMAIL LIST"})})})]}),(0,P.jsx)(c.Z,{anchorEl:null===S||void 0===S?void 0:S.element,open:Boolean(S),onClose:M,children:(0,P.jsx)(i.Z,{onClick:()=>{var e;e=S.index,w(h[e]),I(e),M()},children:"Edit"})})]})};var Qt=n(13208),Xt=n(41286),$t=n(51859),Kt=n(12600),Jt=n(90772);const en={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,P.jsx)(Kt.Z,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,P.jsx)(Jt.Z,{})}},tn={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:">",name:"exceed"}},nn=en,an=(0,a.createContext)(),rn={id:"id",alert_type:"alert_type",sensor_id:"sensor_id",location_short:"location_short",datatypekey:"datatypekey",threshold_value:"threshold_value",days_of_week:"days_of_week",minutespastmidnight:"minutespastmidnight",is_enabled:"is_enabled",excluded_dates:"excluded_dates"},on=function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nn.daily.id;return t===nn.threshold.id&&(e=tn.above_threshold.id),{[rn.id]:"",[rn.alert_type]:e||t,[rn.sensor_id]:"",[rn.datatypekey]:"",[rn.days_of_week]:[0,1,2,3,4],[rn.threshold_value]:-1,[rn.minutespastmidnight]:"",[rn.is_enabled]:!0,[rn.excluded_dates]:[]}};function sn(e){let{children:t}=e;const{schoolMetadata:n,currentSchoolID:r}=(0,a.useContext)(b.G),[o,i]=(0,a.useState)(on()),[s,l]=(0,a.useState)(o),[d,c]=(0,a.useState)([]),[u,h]=(0,a.useState)([]);(0,a.useEffect)((()=>{l({...o})}),[o]),(0,a.useEffect)((()=>{const e=s[rn.sensor_id];e&&""!==e&&c(p(e))}),[s]);const p=e=>{if(!n)return;const{sensors:t}=n;if(!(0,Y.qt)(t))return;const a=(t.find((t=>t.sensor_id===e))||[]).allowedDataTypes;return a?a.map((e=>({value:e,label:x.oS[e].name_title}))):[]};(0,a.useEffect)((()=>{r&&(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:r})}).then((e=>{h(e)})).catch((e=>{console.log(e)}))}),[r]);const y=(0,a.useMemo)((()=>({selectedAlert:o,setSelectedAlert:i,editingAlert:s,setEditingAlert:l,allowedDataTypesForSensor:d,setAllowedDataTypesForSensor:c,alerts:u,setAlerts:h})),[o,s,d,u]);return(0,P.jsx)(an.Provider,{value:y,children:t})}const ln=()=>(0,a.useContext)(an);var dn=n(51691);const cn=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",un="ADD",hn="EDIT",pn="DELETE",xn="Sensor Location",mn="Data Type",gn="Days";var vn=n(69212),bn=n(58562),yn=n(29454),fn=n(44709);const jn={[un]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[hn]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[pn]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}},Zn=e=>{let{thisAlertType:t,handleChange:n,disabled:a,...r}=e;return(0,P.jsx)(xe.Z,{color:a?"standard":"primary",disabled:a,defaultValue:tn.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:n,...r,children:Object.keys(tn).map((e=>{const t=tn[e];return(0,P.jsxs)(me.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)}))})},wn=e=>{const{icon:t,label:n,value:a,options:r,handleChange:s,disabled:d}=e,c=(0,Lt.u)();return(0,P.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,P.jsx)(o.Z,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:d?c.palette.text.secondary:c.palette.text.primary}},children:t}),(0,P.jsxs)(w.Z,{fullWidth:!0,size:"small",disabled:d,sx:{minWidth:"200px"},children:[(0,P.jsx)(Te.Z,{id:"".concat(n,"-picker-label"),children:n}),(0,P.jsx)(S.Z,{labelId:"".concat(n,"-picker-label"),id:"".concat(n,"-picker"),value:a,label:n,onChange:s,children:(0,Y.qt)(r)&&r.map((e=>(0,P.jsx)(i.Z,{value:e.value,children:e.label},e.value)))})]})]})},Sn=Array.from({length:23},((e,t)=>{const n=60*(t+1);return{label:cn(n),value:n}}));var Dn=n(5519),kn=n(90375),Cn=n(49768);const Tn=e=>{const{min:t=0,max:n=100,value:r,defaultValue:o,stepsForThreshold:i=10,marks:s=null,handleChange:l,disabled:d,backgroundCssGradient:c,invertSelection:h=!1,showInput:p=!0,inputUnit:x}=e,m=(0,Lt.u)(),[g,v]=(0,a.useState)(h?r||o:t),[b,y]=(0,a.useState)(h?n:r||o),[f,Z]=(0,a.useState)(-1),[w,S]=(0,a.useState)(!1),[D,k]=(0,a.useState)("");(0,a.useEffect)((()=>{const e=h?r:t,a=h?n:r;v(e),y(a),Z(C(h?e:a))}),[h,r,n,t]);const C=e=>{if(!s)return-1;const t=s.filter((t=>t.value>=e));if(0===t.length)return-1;const n=t.reduce(((t,n)=>n.value-e<t.value-e?n:t)),a=s.indexOf(n);return h?a-1:a},T="repeating-linear-gradient(-45deg, ".concat(Dn.Z[800],", ").concat(Dn.Z[800]," 4px, ").concat(kn.Z.white," 4px, ").concat(kn.Z.white," 8px)");return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(j.ZP,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,P.jsx)(j.ZP,{item:!0,xs:"auto",minWidth:"4.5rem",children:p?(0,P.jsx)(qt.Z,{variant:"standard",type:"number",label:"Threshold",value:h?g:b,onChange:e=>{const a=""===e.target.value?"":Number(e.target.value);""!==a&&a>=t&&a<=n?(v(h?a:t),y(h?n:a),l(a),Z(C(a)),S(!1),k("")):(S(!0),k("Threshold must be between ".concat(t," and ").concat(n)))},error:w,helperText:D,size:"small",fullWidth:!0,disabled:d,inputProps:{step:i,min:t,max:n,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),x?(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(u.Z,{variant:"body2",children:x})}):null]}),(0,P.jsx)(j.ZP,{item:!0,xs:12,sx:{mt:2,ml:6},children:(0,P.jsx)(Cn.ZP,{"aria-label":"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[g,b],defaultValue:[g,b],step:null===s?i:null,marks:s,disabled:d,min:t,max:n,onChange:(e,a)=>{const r=a[h?0:1];v(h?r:t),y(h?n:r),l(r),Z(C(r))},valueLabelDisplay:"on",orientation:"vertical",sx:{height:"35vh",minHeight:"250px",maxHeight:"500px",cursor:d?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:kn.Z.black},['& .MuiSlider-thumb[data-index="'.concat(h?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:m.palette.background.paper,backgroundImage:m.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:d?Dn.Z[400]:c},"& .MuiSlider-track":{background:T,...h?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}},['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(f,'"]')]:{color:m.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:m.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}}})}),(0,P.jsx)(j.ZP,{item:!0,sx:{mt:1},children:(0,P.jsx)(u.Z,{variant:"caption",display:"block",fontStyle:"italic",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})};var An=n(32467),Pn=n.n(An);const In=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];function Mn(e){const{value:t,handleChange:n,disabled:a}=e;return(0,P.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,P.jsx)(Jt.Z,{}),(0,P.jsx)(xe.Z,{value:t||[0,1,2,3,4],onChange:n,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:a,color:a?"standard":"primary",children:In.map((e=>(0,P.jsx)(Mt.Z,{title:e.label,arrow:!0,children:(0,P.jsx)(me.Z,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value)))})]})}var En=n(97892),_n=n.n(En),zn=n(23634),Rn=n(71652),Wn=n(84639),On=n(86767),Ln=n(52502),Bn=n(62070);const Fn=(0,r.ZP)(Wn.H,{shouldForwardProp:e=>"selected"!==e})((e=>{let{theme:t,selected:n}=e;return{...n&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"}}})),Vn=e=>{const{day:t,selectedDates:n,...a}=e,r=n.includes(_n()(t).format("YYYY-MM-DD"));return(0,P.jsx)(Fn,{...a,day:t,selected:r})};function Hn(e){const{selectedDates:t,handleChange:n,disabled:a}=e,r=t.map((e=>_n()(e).format("YYYY-MM-DD")));return(0,P.jsx)(Bn.Z,{title:(()=>{const e=t.length;return e>0?"Excluded Dates (".concat(e," Days)"):"Excluded Dates"})(),icon:(0,P.jsx)(Ln.Z,{sx:{fontSize:"1rem"}}),disabled:a,content:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(u.Z,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,P.jsx)("b",{children:"NOT"})," want to receive alerts. Useful for holidays or school breaks."]}),(0,P.jsx)(St.Z,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),n(t)},children:"Clear All"}),(0,P.jsx)(Rn._,{dateAdapter:zn.y,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,P.jsx)(On.W,{displayWeekNumber:!0,slots:{day:e=>(0,P.jsx)(Vn,{...e,selectedDates:r})},onChange:(e,t)=>{"finish"===t&&n([_n()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:_n()().startOf("month")})})]})})}function Nn(e){const{onConfirmedDelete:t}=e,[n,r]=(0,a.useState)(!1),o=(0,Z.Z)();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(re.Z,{variant:"text",color:"error",onClick:()=>{r(!0)},children:"Delete"}),(0,P.jsxs)(_t.Z,{open:n,onClose:()=>{r(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,P.jsx)(Rt.Z,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,P.jsx)(Wt.Z,{children:(0,P.jsx)(dn.Z,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,P.jsxs)(zt.Z,{sx:{justifyContent:"end"},children:[(0,P.jsx)(re.Z,{onClick:()=>{r(!1)},sx:{color:o.palette.text.secondary},children:"Cancel"}),(0,P.jsx)(re.Z,{onClick:()=>{t(),r(!1)},children:"Delete"})]})]})]})}const Yn=e=>{const t=e[rn.is_enabled]?"enabled":"disabled",n=e[rn.id]?"is":"will be";return"This alert ".concat(n," ").concat(t)},Un=e=>{var t,n;const{alertTypeKey:r,openAlertModificationDialog:o,crudType:i,handleClose:d}=e,{schoolMetadata:c,currentSchoolID:h}=(0,a.useContext)(b.G),{selectedAlert:p,setSelectedAlert:y,editingAlert:f,allowedDataTypesForSensor:Z,setEditingAlert:w,setAlerts:S}=ln(),[D,k]=(0,a.useState)(!1),{enqueueSnackbar:T}=(0,ft.Ds)(),A=e=>{const t=e.target.value;w({...f,[rn.sensor_id]:t,[rn.datatypekey]:""})},I=e=>{const t=e.target.value,n=x.oS[t],a=O.palette.chart.colorAxes[n.color_axis],{defaultValueForAlert:r}=a;w({...f,[rn.datatypekey]:t,[rn.threshold_value]:r})},M=(e,t)=>{const n=Array.isArray(t)?t:[];w({...f,[rn.days_of_week]:n.sort()})},E=e=>{w({...f,[rn.threshold_value]:e})},_=e=>{w({...f,[rn.alert_type]:e.target.value})},z=e=>{const t=f[rn.excluded_dates]||[],n=e.reduce(((e,t)=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]),t);w({...f,[rn.excluded_dates]:n})},R=e=>{w({...f,[rn.minutespastmidnight]:e.target.value})},W=e=>{w({...f,[rn.is_enabled]:e.target.checked})},O=(0,Lt.u)(),L=null===c||void 0===c||null===(t=c.sensors)||void 0===t?void 0:t.map((e=>({value:e.sensor_id,label:(0,Y.Fb)(e.location_short)}))),B=e=>{let{passedCrudType:t}=e;const n=e=>{T(jn[t].errorMessage,jt.P.error)},a=()=>{T(jn[t].successMessage,jt.P.success),d()};switch(t){case un:(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:h}),restMethod:v.j2.POST,body:f}).then((e=>{S((t=>[...t,e])),a();const t=on(r);y(t),w(t)})).catch((e=>n()));break;case hn:const e=p[rn.id];(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:h,alert_id:e}),restMethod:v.j2.PUT,body:f}).then((t=>{S((n=>n.map((n=>n.id===e?t:n)))),a()})).catch((e=>n()));break;case pn:(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:h,alert_id:p.id}),restMethod:v.j2.DELETE}).then((()=>{S((e=>e.filter((e=>e.id!==p.id)))),a()})).catch((e=>n()))}};(0,a.useEffect)((()=>{switch(i){case un:const e=on(r);f[rn.sensor_id]===e[rn.sensor_id]||f[rn.datatypekey]===e[rn.datatypekey]?r===nn.daily.id?k(f[rn.minutespastmidnight]===e[rn.minutespastmidnight]):k(!0):r===nn.daily.id?k(f[rn.minutespastmidnight]===e[rn.minutespastmidnight]):k(!1);break;case hn:k(Pn()(p,f));break;default:k(!1)}}),[i,p,f,r]);const F=(0,s.Z)((e=>e.breakpoints.down("sm")));return(0,P.jsxs)(_t.Z,{open:o,onClose:d,"aria-labelledby":"alert-modification-dialog",maxWidth:"xs",fullWidth:!0,fullScreen:F,children:[(0,P.jsx)(Rt.Z,{id:"alert-modification-dialog",children:null===(n=jn[i])||void 0===n?void 0:n.title}),(0,P.jsx)(Wt.Z,{children:(()=>{var e,t;const n=e=>{const t={[rn.sensor_id]:null,[rn.datatypekey]:rn.sensor_id,[rn.days_of_week]:rn.datatypekey,[rn.excluded_dates]:rn.datatypekey,[rn.alert_type]:rn.datatypekey,[rn.threshold_value]:rn.datatypekey,[rn.minutespastmidnight]:rn.datatypekey}[e];if(!t)return!1;const n=on(r);return f[t]===n[t]};let a=null;switch(r){case nn.daily.id:a=(0,P.jsx)(wn,{icon:(0,P.jsx)(vn.Z,{}),label:nn.daily.tableColumnHeader,value:f[rn.minutespastmidnight],options:Sn,disabled:n(rn.minutespastmidnight),handleChange:R});break;case nn.threshold.id:let t=null;const r=f[rn.datatypekey];if(r&&""!==r){const e=x.oS[r],a=O.palette.chart.colorAxes[e.color_axis],{colors:o,minValue:i,maxValue:s,defaultValueForAlert:l,stepsForThreshold:d}=a,c=G({gradientDirection:"to top",colors:o});let u,h;const p=f[rn.alert_type]===tn.below_threshold.id;r===x.Yx.voc?h=fn.MS:[x.Yx.aqi,x.Yx.pm2_5,x.Yx.pm10_raw,x.Yx.co2].includes(r)&&(h=fn._R),h&&(u=h.filter(((e,t)=>0!==t)).map((t=>({value:t[e.threshold_mapping_name].low,label:t.category}))));const m=Object.keys(x.oS).filter((e=>e===f[rn.datatypekey])).map((e=>x.oS[e].unit))[0];t=(0,P.jsx)(Tn,{min:i,max:s,marks:u,defaultValue:l,value:f[rn.threshold_value],stepsForThreshold:d,disabled:n(rn.threshold_value),backgroundCssGradient:c,invertSelection:p,handleChange:E,inputUnit:m})}else t=(0,P.jsx)(Tn,{min:0,max:100,defaultValue:50,value:50,disabled:!0,showInput:!1});a=(0,P.jsxs)(j.ZP,{container:!0,alignItems:"stretch",children:[(0,P.jsx)(j.ZP,{item:!0,xs:12,children:(0,P.jsxs)(u.Z,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mb:1},children:["Alert me if ",(null===(e=x.oS[r])||void 0===e?void 0:e.name_title)||"selected data type"," is:"]})}),(0,P.jsx)(j.ZP,{item:!0,sx:{mr:2},children:(0,P.jsx)(Zn,{thisAlertType:f[rn.alert_type],handleChange:_,disabled:n(rn.alert_type),sx:{height:"100%"}})}),t]})}return(0,P.jsxs)(l.Z,{direction:"column",spacing:3,mt:1,width:"100%",children:[null!==(t=jn[i])&&void 0!==t&&t.contentText?(0,P.jsx)(dn.Z,{fontWeight:"500",children:jn[i].contentText}):null,(0,P.jsxs)(l.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,P.jsx)(C.Z,{size:"small",checked:f[rn.is_enabled],onChange:W,disabled:n(rn.is_enabled)}),(0,P.jsx)(u.Z,{fontWeight:500,color:"text.secondary",children:Yn(f)})]}),(0,P.jsx)(wn,{icon:(0,P.jsx)(bn.Z,{}),label:xn,value:f[rn.sensor_id],options:L,disabled:n(rn.sensor_id),handleChange:A}),(0,P.jsx)(wn,{icon:(0,P.jsx)(yn.Z,{}),label:mn,value:f[rn.datatypekey],options:Z,disabled:n(rn.datatypekey),handleChange:I}),(0,P.jsx)(Mn,{value:f[rn.days_of_week],disabled:n(rn.days_of_week),handleChange:M}),(0,P.jsx)(Hn,{selectedDates:f[rn.excluded_dates]||[],disabled:n(rn.excluded_dates),handleChange:z}),a]})})()}),(0,P.jsxs)(zt.Z,{sx:{justifyContent:"space-between"},children:[i===hn?(0,P.jsx)(Nn,{onConfirmedDelete:()=>{B({passedCrudType:pn})}}):null,(0,P.jsxs)(l.Z,{direction:"row",width:"100%",justifyContent:"end",children:[(0,P.jsx)(re.Z,{onClick:d,sx:{color:O.palette.text.secondary},children:"Cancel"}),(0,P.jsx)(re.Z,{onClick:()=>{B({passedCrudType:i})},color:"primary",disabled:D,children:"Save Edit"})]})]})]})};var qn=n(50255);const Gn=e=>{if(!e||!(0,Y.qt)(e))return"N/A";if(e.length===In.length)return"Everyday";const t=In.filter((t=>!e.includes(t.value)));return 2===t.length&&t.every((e=>[5,6].includes(e.value)))?"Only weekdays":e.map((e=>{var t;return null===(t=In.find((t=>t.value===e)))||void 0===t?void 0:t.label.slice(0,2)})).join(", ")},Qn=e=>{var t;const{selectedAlert:n,setSelectedAlert:r,setAlerts:i}=ln(),{currentSchoolID:s}=(0,a.useContext)(b.G),{enqueueSnackbar:d}=(0,ft.Ds)(),{alertTypeKey:c,alertsForTable:u}=e,h=(0,Lt.u)(),[p,y]=(0,a.useState)(!1),[j,Z]=(0,a.useState)(null),w=e=>{let{alert:t,crudType:n}=e;r(t),Z(n),y(!0)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(l.Z,{spacing:2,alignItems:"center",children:[(0,P.jsx)(o.Z,{sx:{width:"100%"},children:(0,Y.qt)(u)?(0,P.jsxs)(Dt.Z,{size:"small",sx:{my:1},children:[(0,P.jsx)(kt.Z,{children:(0,P.jsxs)(Ct.Z,{children:[(0,P.jsx)(Tt.Z,{sx:{px:0}}),(0,P.jsx)(Tt.Z,{children:xn}),(0,P.jsx)(Tt.Z,{children:mn}),(0,P.jsx)(Tt.Z,{children:gn}),(0,P.jsx)(Tt.Z,{children:(null===(t=nn[c])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,P.jsx)(Tt.Z,{sx:{px:0}})]})}),(0,P.jsx)(qn.Z,{component:At.Z,children:(0,Y.qt)(u)?u.map(((e,t)=>(0,P.jsx)(Qt.Z,{children:(0,P.jsxs)(Ct.Z,{sx:{background:e[rn.id]===n[rn.id]&&h.palette.background.NYUpurpleLight,textDecoration:!1===e[rn.is_enabled]?"line-through":"none"},children:[(0,P.jsxs)(Tt.Z,{sx:{px:0},children:[(0,P.jsx)(Mt.Z,{title:"Click to ".concat(e[rn.is_enabled]?"disable":"enable"," alert"),children:(0,P.jsx)(C.Z,{size:"small",checked:e[rn.is_enabled],onClick:()=>{(e=>{let{alert:t}=e;const n=!t[rn.is_enabled];(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:s,alert_id:t[rn.id]}),restMethod:v.j2.PUT,body:{...t,[rn.is_enabled]:n}}).then((e=>{i((n=>n.map((n=>n[rn.id]===t[rn.id]?e:n)))),d("This alert will be ".concat(n?"enabled":"disabled"),jt.P.success)})).catch((e=>{d("There was an error ".concat(n?"enabling":"disabling"," this alert, try again!"),jt.P.error)}))})({alert:e})}})}),(0,P.jsx)(Mt.Z,{title:"Edit Alert",children:(0,P.jsx)(Et.Z,{"aria-label":"edit",size:"small",sx:{"&:hover,:focus":{color:h.palette.primary.main}},onClick:()=>w({alert:e,crudType:hn}),children:(0,P.jsx)(Xt.Z,{})})})]}),(0,P.jsx)(Tt.Z,{sx:{textTransform:"capitalize"},children:e[rn.location_short]}),(0,P.jsx)(Tt.Z,{children:Object.keys(x.oS).filter((t=>t===e[rn.datatypekey])).map((e=>x.oS[e].name_title))[0]}),(0,P.jsx)(Tt.Z,{children:Gn(e[rn.days_of_week])}),c===nn.threshold.id?(0,P.jsxs)(Tt.Z,{children:[tn[e[rn.alert_type]].sign,e[rn.threshold_value],"\xa0",Object.keys(x.oS).filter((t=>t===e[rn.datatypekey])).map((e=>x.oS[e].unit))[0]]}):null,c===nn.daily.id?(0,P.jsx)(Tt.Z,{children:cn(e[rn.minutespastmidnight])}):null,(0,P.jsx)(Tt.Z,{sx:{px:0}})]})},t))):null})]}):(0,P.jsxs)(f.Z,{severity:"warning",sx:{mt:2},children:["No ",nn[c].name.toLowerCase()," alert has been set up"]})}),(0,P.jsx)(re.Z,{variant:"outlined",startIcon:(0,P.jsx)($t.Z,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>w({alert:on(c),crudType:un}),children:"Add Alert"})]}),(0,P.jsx)(Un,{alertTypeKey:c,crudType:j,openAlertModificationDialog:p,handleClose:()=>{y(!1),r(on(c))}})]})};function Xn(e){const{children:t,value:n,index:a,alertType:r,alertsArray:i,...s}=e;return(0,P.jsx)(o.Z,{role:"tabpanel",hidden:n!==a,id:"alert-tabpanel-".concat(r.id),"aria-labelledby":"alert-tab-".concat(r.id),width:"100%",...s,children:(0,P.jsx)(Qn,{alertTypeKey:r.id,alertsForTable:i})})}function $n(){const e=(0,s.Z)((e=>e.breakpoints.down("sm"))),[t,n]=(0,a.useState)(0),{setSelectedAlert:r}=ln(),{alerts:i}=ln(),l=e=>{const t=i.filter((t=>{var n;return(null===t||void 0===t||null===(n=t.alert_type)||void 0===n?void 0:n.toLowerCase()).includes(e)?t:null}));return{array:t,alertsLength:(0,Y.qt)(t)?t.length:"0"}};return(0,P.jsxs)(o.Z,{children:[(0,P.jsx)(He,{value:t,onChange:(e,t)=>{var a,o;n(t),r(on(null===(a=nn[null===(o=Object.keys(nn))||void 0===o?void 0:o[t]])||void 0===a?void 0:a.id))},variant:e?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(nn).map((e=>{const t=l(e.id);return(0,P.jsx)(d.Z,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)}))}),Object.values(nn).map((e=>{const n=l(e.id);return(0,P.jsx)(Xn,{alertType:e,value:t,index:e.index,alertsArray:n.array},e.id)}))]})}var Kn=n(12569);function Jn(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Zt(t),{user:r}=(0,a.useContext)(yt.S),o=[Kn.v.admin,Kn.v.school].includes(null===r||void 0===r?void 0:r.user_role);return(0,P.jsx)(Bt,{buttonIcon:(0,P.jsx)(Ut.Z,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:e=>n(e),children:(0,P.jsxs)(l.Z,{width:"100%",spacing:o?5:2,children:[(0,P.jsx)(sn,{children:(0,P.jsx)($n,{})}),o?(0,P.jsx)(Gt,{}):(0,P.jsxs)(u.Z,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,P.jsx)("b",{children:null===r||void 0===r?void 0:r.email})]})]})})}var ea=n(85332),ta=n(40655);const na=e=>{let{onLoginSuccess:t,children:n}=e;const r=(0,a.useRef)(null),{enqueueSnackbar:o}=(0,ft.Ds)(),{setAuthenticationState:i,setUser:s}=(0,a.useContext)(yt.S),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),h=(0,a.useCallback)((()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,n=window.open(ea.$.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(n){n.focus(),r.current=n;const e=setInterval((()=>{n.closed&&(clearInterval(e),window.removeEventListener("message",p),r.current=null)}),500)}else alert("Popup blocked. Please enable popups for login.")}),[]),p=(0,a.useCallback)((e=>{if(e.origin===window.location.origin&&e.data.type===Kn.$.password&&e.data.success){const n=e.data.user;i({checkedAuthentication:!0,authenticated:!0}),s(n),n.message&&o(n.message,jt.P.success),!1===n.is_verified&&(d(!0),u(n.email)),null===t||void 0===t||t()}}),[t]);return(0,a.useEffect)((()=>(window.addEventListener("message",p),()=>{window.removeEventListener("message",p)})),[p]),(0,P.jsxs)(P.Fragment,{children:[n({openLoginPopup:h}),(0,P.jsx)(ta.Z,{open:l,email:c})]})},aa=()=>{const{loggedIn:e}=Zt(),{enqueueSnackbar:t}=(0,ft.Ds)();return(0,P.jsx)(na,{onLoginSuccess:()=>{t("You can now access TV Screens, Dataset, and Alerts.",{variant:jt.P.success.name,duration:2*jt.P.success.duration})},children:t=>{let{openLoginPopup:n}=t;return(0,P.jsxs)(j.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(wt,{onButtonClick:e?null:n})}),(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(Ft,{onButtonClick:e?null:n})}),(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(Jn,{onButtonClick:e?null:n})})]})}})};var ra=n(25028);const oa=e=>{const{tooltipTitle:t,label:n,...a}=e;return(0,P.jsx)(Mt.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,P.jsx)(T.Z,{size:"small",label:n||(0,P.jsx)(h.Z,{variant:"text",sx:{minWidth:"5rem"}}),...a})})};var ia=n(16071),sa=n(70366);const la=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,a.useContext)(b.G),{user:n}=(0,a.useContext)(yt.S);if(!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1)return(0,P.jsx)(oa,{icon:(0,P.jsx)(bn.Z,{}),label:(null===t||void 0===t?void 0:t.name)||"No School Name Given",tooltipTitle:"School"});const[r,s]=(0,a.useState)(null),l=()=>{s(null)},d=(0,bt.s0)();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(oa,{icon:(0,P.jsx)(bn.Z,{}),label:(0,P.jsxs)(o.Z,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[(null===t||void 0===t?void 0:t.name)||"Loading...",Boolean(r)?(0,P.jsx)(sa.Z,{}):(0,P.jsx)(Be.Z,{})]}),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{s(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,P.jsx)(c.Z,{anchorEl:r,open:Boolean(r),onClose:l,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,P.jsx)(ra.Z,{dense:!0,children:n.allowedSchools.map(((t,n)=>{return(0,P.jsx)(i.Z,{onClick:(a=t.school_id,()=>{e!==a&&(localStorage.setItem(ia.m.schoolID,a),lt.y(lt.z.internalNavigation,{origin_school:e,destination_school_id:a,origin_id:"school_selector"}),d("".concat(ea.$.dashboard,"/").concat(a))),l()}),children:t.name},n);var a}))})})]})};var da=n(40501),ca=n(44281),ua=n(69161),ha=n(81131);const pa=e=>{let{displayCommentSection:t}=e;const{schoolMetadata:n}=(0,a.useContext)(b.G),{commentCounts:r,fetchCommentCounts:o,setCommentCounts:i}=(0,a.useContext)(pt.s);return(0,a.useEffect)((()=>{if(!n)return;n.school_id===$e.Ki&&!r&&o().then((e=>{i(e)}))}),[n]),(0,P.jsxs)(j.ZP,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(la,{})}),(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(oa,{icon:(0,P.jsx)(da.Z,{}),label:null===n||void 0===n?void 0:n.contactPerson,tooltipTitle:"Contact Person"})}),(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(oa,{icon:(0,P.jsx)(ca.Z,{}),label:null===n||void 0===n?void 0:n.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===n||void 0===n?void 0:n.contactEmail),clickable:!0})}),!0===t&&null!==r?(0,P.jsx)(j.ZP,{item:!0,children:(0,P.jsx)(oa,{icon:(0,P.jsx)(ua.Z,{}),label:"".concat(r[$e.j0]," Comment").concat(r[$e.j0]>1?"s":""),tooltipTitle:"Number of Comments",onClick:()=>{(0,ha.Qj)(Xe.Sf.id),lt.y(lt.z.internalNavigation,{destination_id:Xe.Sf.id,destination_label:Xe.Sf.toString(),origin_id:"chip"})}})}):null]})},xa=()=>{const e=(0,Z.Z)(),{schoolMetadata:t}=(0,a.useContext)(b.G);return t?(0,P.jsx)(u.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,K.ZP)(t.description||"",{replace:Y.T1})}):Array.from({length:3}).map(((e,t)=>(0,P.jsx)(h.Z,{variant:"text"},t)))};var ma=n(85172);const ga=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,a.useContext)(b.G);return!1===e?(0,P.jsx)(l.Z,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,P.jsxs)(re.Z,{variant:"contained",onClick:()=>{t(!0)},children:[(0,P.jsx)(ma.Z,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null},va=()=>{const{setChartsTitlesList:e}=(0,a.useContext)(pt.s),{schoolMetadata:t,current:n,allChartsData:r}=(0,a.useContext)(b.G),{themePreference:i,temperatureUnitPreference:s}=(0,a.useContext)(mt.p),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!t)return;const e=t.school_id===$e.Ki;d(e),u(e)}),[t]),(0,a.useEffect)((()=>{if(!r)return;const t=Object.keys(r).map(((e,t)=>{var n;return{chartTitle:(null===(n=r[e])||void 0===n?void 0:n.title)||"",chartID:"chart-".concat(t+1)}}));e(t)}),[r]);return(0,P.jsxs)(o.Z,{width:"100%",children:[(0,P.jsx)(ct,{}),(0,P.jsx)(ut.Z,{backgroundColor:"customAlternateBackground",children:(0,P.jsxs)(Ge.Z,{sx:{pt:2,pb:2},children:[(0,P.jsxs)(j.ZP,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,P.jsx)(j.ZP,{item:!0,xs:12,children:(0,P.jsx)(qe.Z,{text:(()=>{if(null!==t&&void 0!==t&&t.school_id)return"Air Quality | ".concat(null===t||void 0===t?void 0:t.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,P.jsx)(j.ZP,{item:!0,xs:12,children:(0,P.jsx)(pa,{displayCommentSection:l})}),(0,P.jsx)(j.ZP,{item:!0,xs:12,children:(0,P.jsx)(aa,{})})]}),!0===c&&(0,P.jsx)(xt.Z,{initialNyuadCurrentData:n,isOnBannerPage:!1,themePreference:i,minMapHeight:"250px"}),!1===c&&(0,P.jsx)(o.Z,{textAlign:"center",sx:{mb:2},children:(0,P.jsx)(ht.Z,{currentSensorsData:n,isScreen:!1,temperatureUnitPreference:s})}),(0,P.jsx)(xa,{}),(0,P.jsx)(gt.Z,{})]})}),(0,P.jsx)(o.Z,{id:Xe.O3.id,children:Object.keys(r).length>0?(0,P.jsx)(P.Fragment,{children:Object.keys(r).map(((e,t)=>(0,P.jsx)(ut.Z,{backgroundColor:t%2!==0?"customAlternateBackground":"",children:(0,P.jsxs)(Ge.Z,{sx:{pt:4,pb:4},height:"auto",className:i===tt.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,P.jsx)(Pe,{children:(0,P.jsx)(je,{children:(0,P.jsx)(Ue,{chartTitle:r[e].title,generalChartSubtitle:r[e].subtitle,generalChartReference:r[e].reference,chartData:{chartIndex:t,...r[e]},chartID:e,chartIndex:t})})}),t===Object.keys(r).length-1?(0,P.jsx)(ga,{}):null]})},e)))}):(0,P.jsx)(H.Z,{optionalText:"Loading Visualizations"})}),(0,P.jsx)(et.Z,{}),!0===l&&(0,P.jsx)(ut.Z,{id:Xe.Sf.id,sx:{pt:3,pb:4},children:(0,P.jsx)(Je,{pageID:$e.j0})})]})},ba=()=>{const{user:e}=(0,a.useContext)(yt.S),{loadMoreCharts:t,setIndividualChartData:n,currentSchoolID:r}=(0,a.useContext)(b.G);(0,a.useEffect)((()=>{r&&(document.title="".concat($e.DE," | ").concat(r.toUpperCase()))}),[r]);const{setCurrentPage:o}=(0,a.useContext)(pt.s);return(0,a.useEffect)((()=>{o(ea.$.dashboard)}),[]),(0,a.useEffect)((()=>{if(!r)return;(t?v.aT:v.aT.slice(0,$e.oX)).forEach(((e,t)=>{n(t,{}),(0,m.d)({url:(0,g.Eh)({endpoint:e,school_id:r})}).then((e=>{n(t,e)})).catch((e=>{console.log(e)}))}))}),[e,r]),(0,P.jsx)(va,{})}}}]);
//# sourceMappingURL=457.56789f92.chunk.js.map