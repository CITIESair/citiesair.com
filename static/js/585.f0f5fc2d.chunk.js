"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[585],{4967:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(92535),r=n(65043),o=n(9209),l=n(96157),s=n(38119),i=n(22126);const d=()=>{const{currentSchoolID:e}=(0,r.useContext)(l.C);return(0,a.I)({queryKey:[i.tK.schoolmetadata,e],queryFn:async()=>{const t=(0,s.e9)({endpoint:i.tK.schoolmetadata,school_id:e});return(0,o.i)({url:t})},enabled:!!e,staleTime:36e5,placeholderData:e=>e})}},27962:(e,t,n)=>{n.r(t),n.d(t,{default:()=>nr});var a=n(65043),r=n(22555),o=n(34535),l=n(96446),s=n(91449),i=n(30344),d=n(88911),c=n(24056),u=n(72437),h=n(85865),p=n(21337),x=n(49881),m=n(96157),A=n(33656),g=n(68903),v=n(26240),y=n(53193),f=n(69285),b=n(51962),j=n(36694),w=n(4598),S=n(43845),C=n(47260),D=n(70579);const T="Show All Sensors";function k(e){const{items:t,selectorID:n,allowMultiple:o,seriesLabel:l,onSeriesSelection:c,displayChip:u=!0}=e,p=(0,v.A)(),x=(0,i.A)(e=>e.breakpoints.up("lg")),m={PaperProps:{style:{maxHeight:274.4,overflow:"visible !important",background:p.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[A,k]=(0,a.useState)(t),[I,E]=(0,a.useState)(o);(0,a.useEffect)(()=>{k(e=>{const n=new Map(e.map(e=>[e.label,e.selected]));return t.map(e=>"boolean"===typeof e.selected?(0,r.A)({},e):(0,r.A)((0,r.A)({},e),{},{selected:n.has(e.label)?n.get(e.label):!!e.selected}))})},[t]),(0,a.useEffect)(()=>{E(A.every(e=>e.selected))},[A]);const M=e=>{const{target:{value:t}}=e;if(t.includes(T)){const e=A.map((e,t)=>(0,r.A)((0,r.A)({},e),{},{selected:0==t||!I}));c({newDataColumns:e}),E(!I)}else{const e=A.filter(e=>t.includes(e.label)),n=A.map(t=>(0,r.A)((0,r.A)({},t),{},{selected:e.some(e=>e.label===t.label)}));c({newDataColumns:n}),E(!1)}},P=e=>{const t=A.map(t=>t.label===e.label?(0,r.A)((0,r.A)({},t),{},{selected:!t.selected}):t);c({newDataColumns:t})};return(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[x?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Show/Hide"}):null,(0,D.jsxs)(d.A,{spacing:1,direction:"row",alignItems:"center",children:[(0,D.jsx)(y.A,{sx:{width:"100%",minWidth:"10rem","& .MuiInputBase-root":{borderRadius:"".concat(p.shape.borderRadius,"px")}},size:"small",children:(0,D.jsxs)(f.A,{labelId:"".concat(n,"-label"),id:n,multiple:o,value:A.filter(e=>e.selected).map(e=>e.label),onChange:M,MenuProps:m,renderValue:e=>(e=>(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:.5,children:[(0,D.jsx)(C.A,{fontSize:"1.5rem",sx:{color:p.palette.text.secondary}}),(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:o?"".concat(e.length,"/").concat(A.length," ").concat(l||""," shown"):e})]}))(e),sx:{fontSize:"0.75em","& .MuiSelect-select":{py:"6.5px"},"& .MuiSvgIcon-root":{color:"text.secondary"}},children:[A.map(e=>(0,D.jsxs)(s.A,{disabled:!(1!==A.filter(e=>e.selected).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[o?(0,D.jsx)(b.A,{checked:e.selected,onClick:()=>P(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,D.jsx)(j.A,{checked:e.selected,onChange:()=>M(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,D.jsx)(h.A,{variant:"caption",children:e.label})]},e.label)),o?(0,D.jsx)(s.A,{value:T,sx:{borderTop:"solid 0.5px",borderColor:p.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:p.spacing(-1),background:p.palette.customAlternateBackground,"&:hover":{background:p.palette.customAlternateBackground}},children:(0,D.jsxs)(d.A,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,D.jsx)(h.A,{fontWeight:500,variant:"caption",sx:{pl:1},children:T}),(0,D.jsx)(w.A,{checked:I,onClick:()=>P(T),sx:{transform:"scale(0.8)"}})]})},T):null]})}),u&&o&&(0,D.jsx)(g.Ay,{container:!0,spacing:1,sx:{[p.breakpoints.down("sm")]:{display:"none"}},children:A.filter(e=>e.selected).map(e=>(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(S.A,(0,r.A)({label:(0,D.jsx)(h.A,{variant:"caption",children:e.label}),size:"small"},1!==A.filter(e=>e.selected).length&&{onDelete:()=>P(e)}))},e.label))})]})]})}const I={stem:{length:0},textStyle:{opacity:0},boxStyle:null},E=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},M=e=>{var t;const{chartControl:n,mainChartData:a,mainChartOptions:o,subchartIndex:l,theme:s,isPortrait:i}=e;let d=(0,r.A)((0,r.A)({},null===(t=n.options)||void 0===t?void 0:t.ui),{},{snapToData:!0});return"ChartRangeFilter"===n.controlType&&(d=(0,r.A)((0,r.A)({},d),{},{chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[l].columns||null},chartOptions:(0,r.A)((0,r.A)({},o),{},{hAxis:(0,r.A)((0,r.A)({},o.hAxis),{},{textPosition:"out",textStyle:{color:s.palette.chart.axisText,fontSize:E({isPortrait:i,isSmaller:!0})},title:null}),vAxis:(0,r.A)((0,r.A)({},o.vAxis),{},{title:null}),annotations:I,legend:null,pointSize:0})})),d};var P=n(5362),O=n(66477),R=n(17535),_=n(8011);const z=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;if(!(0,_.OP)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map((t,n)=>({color:t,offset:n/(e-1)}))}{let e=t;n&&(e=t.filter(e=>e.offset>=n)),a&&(e=t.filter(e=>e.offset<=a));const r=e.map(e=>e.offset),o=(e=>{let{offsets:t,minOffset:n,maxOffset:a}=e;return t.map(e=>(e-n)/(a-n))})({offsets:r,minOffset:n||Math.min(...r),maxOffset:a||Math.max(...r)});return e.map((e,t)=>({color:e.color,offset:o[t]}))}};function W(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}function L(e,t,n){if(e.every((e,n)=>e===t[n]))return e;let a=e.slice();for(let r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a}const F=e=>{let{colors:t,numSteps:n=100}=e;const a=z({colors:t});a.forEach(e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,a){return t+t+n+n+a+a});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)});let r=[];const o=Array.from({length:n},(e,t)=>t/(n-1));for(let l=0;l<o.length;l++){const e=o[l];let t,n,s,i;for(let r=0;r<a.length-1;r++)if(e>=a[r].offset&&e<=a[r+1].offset){t=a[r].color,n=a[r+1].color,s=a[r].offset,i=a[r+1].offset;break}const d=L(t,n,(e-s)/(i-s));r.push(W(...d))}return r},B=e=>{let{gradientDirection:t,colors:n,optionalMinValue:a,optionalMaxValue:r}=e;const o=z({colors:n,optionalMinValue:a,optionalMaxValue:r});return"linear-gradient(".concat(t,", ").concat(o.map(e=>"".concat(e.color," ").concat(100*e.offset,"%")).join(", "),")")},H=e=>{let{id:t,colors:n}=e;return(0,D.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,D.jsx)("defs",{children:(0,D.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map((e,t)=>(0,D.jsx)("stop",{offset:e.offset,stopColor:e.color},t))})})})},V=e=>{let{title:t,valueRange:n,colorAxis:a,isPortrait:o}=e;const s=(0,v.A)();if(null===(null===n||void 0===n?void 0:n.min)||null===(null===n||void 0===n?void 0:n.max))return null;const{colors:i,minValue:d,maxValue:c}=a;let u=d,p=c;void 0===d&&(u=n.min),void 0===c&&(p=n.max),n.min<u&&(u=n.min),n.max>p&&(p=n.max);const x=e=>"".concat((e-u)/(p-u)*100,"%"),m={position:"absolute",fontSize:"0.75rem",color:s.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},A={bottom:"-1.25rem",transform:o?"translateX(-100%)":"translateX(-50%)"},g={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},y={top:"-0.5rem",borderTop:"0.25rem solid ".concat(s.palette.text.secondary)},f={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(s.palette.text.secondary)};return(0,D.jsxs)(l.A,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:o?"0":"50px"},children:[(0,D.jsx)(h.A,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,D.jsxs)(l.A,{sx:{background:B({gradientDirection:"to right",colors:i,optionalMaxValue:p}),color:s.palette.text.secondary,border:"1px solid ".concat(s.palette.text.secondary),width:o?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,D.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),{top:"-1.5rem",transform:"translateX(-50%)"}),{},{left:x(n.min)}),children:["min: ",Math.round(n.min)]}),(0,D.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),A),{},{left:x(n.max)}),children:["max: ",Math.round(n.max)]}),(0,D.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},g),y),{},{left:x(n.min)})}),(0,D.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},g),f),{},{left:x(n.max)})})]})]})};var U=n(85721);const N=e=>{let{day:t,color:n,tooltipText:r,dateRange:o,inFirstTwoRowsOfChart:s}=e;const i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(i.current&&s(t,o)){const e=i.current.parentElement;e&&(e.style.top="11vh")}},[i,s]),(0,D.jsxs)(l.A,{ref:i,className:"nivo-tooltip",children:[(0,D.jsx)(S.A,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,U.Ay)(r,{replace:_.H$})]})},Y=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},q=e=>{var t,n,r,o,s;const{dataArray:i,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[p,x]=(0,a.useState)({min:null,max:null}),[m,A]=(0,a.useState)({min:null,max:null}),[g,y]=(0,a.useState)(400);(0,a.useEffect)(()=>{if(!(0,_.OP)(i))return;const e=(e=>({min:e.reduce((e,t)=>t<e?t:e),max:e.reduce((e,t)=>t>e?t:e)}))(i.map(e=>e.day));x(e);const t=i.map(e=>e.value);A((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const n=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,a=Y(c),r=n*(7*Math.min(h[0]/60,20)+40)+a.top+a.bottom;y(r)},[i,h]);const f=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,b=Y(c),j=(0,v.A)(),w=(e,t)=>{const n=new Date(e),a=n.getDay(),r=0===a||1===a,o=new Date(t.min).getFullYear(),l=n.getFullYear()===o;return r&&l},S=F({colors:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.colors,numSteps:null===u||void 0===u||null===(r=u.colorAxis)||void 0===r?void 0:r.gradientSteps});return(0,D.jsxs)(P.A,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[f?(0,D.jsx)(V,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,D.jsx)(l.A,{sx:{height:"".concat(g,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,D.jsx)(l.A,{sx:{height:"".concat(g,"px"),position:"absolute",width:"100%"},children:(0,D.jsx)(R.Zm,{data:i,from:p.min,to:p.max,emptyColor:"transparent",align:"top",theme:{text:{fill:j.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(o=u.colorAxis)||void 0===o?void 0:o.minValue,maxValue:null===u||void 0===u||null===(s=u.colorAxis)||void 0===s?void 0:s.maxValue,margin:b,yearSpacing:40,monthBorderColor:j.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:a}=e;const r=i.find(e=>e.day===t),o=r?(l=r.tooltip,(new DOMParser).parseFromString(l,"text/html").body.innerHTML):"";var l;return(0,D.jsx)(N,{day:t,color:a,tooltipText:o,dateRange:p,inFirstTwoRowsOfChart:w})}})})})]})};var K=n(86347),Q=(n(87151),n(74864),n(63336)),G=n(76859),X=n(93043),$=n(56036),J=n(36870),Z=n(4006),ee=n(73561);const te=new Date,ne={label:"Yesterday",range:()=>({startDate:(0,G.o)((0,X.L)(te,-48)),endDate:te})},ae={label:"Last 14d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-14)),endDate:(0,J.D)(te)})},re={label:"Last 30d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-30)),endDate:(0,J.D)(te)})},oe={label:"Last 365d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-365)),endDate:(0,J.D)(te)})},le=e=>{let{minDateOfDataset:t}=e;const n=(0,Z.GP)(t,"MMM yyyy");return{label:"All Time (".concat(n," - Now)"),range:()=>({startDate:t,endDate:(0,J.D)(te)})}},se=e=>{let{minDateOfDataset:t,aggregationType:n}=e;switch(n){case ee.A.minute:return[ne];case ee.A.day:return[re,oe];case ee.A.month:case ee.A.year:return[le({minDateOfDataset:t})];default:return[ae,re]}},ie={[ee.A.minute]:{maxDays:2,label:"Live"},[ee.A.hour]:{maxDays:30,label:"Hourly"},[ee.A.day]:{maxDays:365,label:"Daily"},[ee.A.month]:{maxDays:1/0,label:"Monthly"},[ee.A.year]:{maxDays:1/0,label:"Yearly"}},de=(0,o.Ay)(Q.A,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})(e=>{let{theme:t,showPickerPanel:n,smallScreen:a}=e;return{zIndex:!0===n&&1,position:"relative",padding:n?t.spacing(1):0,margin:n&&!a?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDateInput::before":{display:"none !important"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none",padding:0},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"10rem",display:"flex",justifyContent:"center",alignItems:"center",height:"2rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"9rem",height:"2rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"10.5rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}});var ce,ue=n(57528),he=n(1119),pe=n(84511),xe=n(83290),me=n(69369),Ae=n(87332),ge=n(52687);const ve=(0,xe.i7)(ce||(ce=(0,ue.A)(["\n  0% { opacity: 1; }\n  50% { opacity: 0.6; }\n  100% { opacity: 1; }\n"])));function ye(e){let{aggregationType:t,setAggregationType:n}=e;const a=(0,me.u)(),o=(0,i.A)(e=>e.breakpoints.up("lg")),l=(0,i.A)(e=>e.breakpoints.down("sm"));return(0,D.jsx)(he.A,{fullWidth:l,color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",sx:{height:"100%",[a.breakpoints.down("sm")]:{width:"100%"}},orientation:o?"vertical":"horizontal",children:Object.values(ee.A).map(e=>{var t;return(0,D.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5,color:"text.secondary"},value:e,"aria-label":e,children:[e===ee.A.minute&&(0,D.jsx)(Ae.A,{sx:(0,r.A)((0,r.A)({},o?{position:"absolute",left:"50%",transform:"translateX(calc(-50% - 2.5rem))"}:{mr:.3}),{},{color:ge.m7[3].color.Light,fontSize:"0.75rem",animation:"".concat(ve," 2s infinite ease-in-out")})}),(null===(t=ie[e])||void 0===t?void 0:t.label)||""]},e)})})}var fe=n(46560),be=n(31021),je=n(46987),we=n(79958),Se=n(92535),Ce=n(9209),De=n(38119),Te=n(22126);const ke=e=>{const{allChartsConfigs:t,currentSchoolID:n}=(0,a.useContext)(m.C),r=t[e];return(0,Se.I)({queryKey:[Te.tK.chartdata,e,r,n],queryFn:async()=>{const e=(0,De.e9)({endpoint:r.endpoint,school_id:n,queryParams:r.queryParams});return(0,Ce.i)({url:e})},enabled:!!n&&!(null===r||void 0===r||!r.endpoint),staleTime:6e5,placeholderData:e=>e})},Ie=e=>{const{minDateOfDataset:t,chartIndex:n}=e,[o,s]=(0,a.useState)(!0),{enqueueSnackbar:c}=(0,je.dh)(),{isFetching:u}=ke(n),{allChartsConfigs:p,updateIndividualChartConfigQueryParams:x}=(0,a.useContext)(m.C),A=(p[n]||{}).queryParams||{},[y,f]=(0,a.useState)(A.aggregationType||ee.A.hour),[b,j]=(0,a.useState)(()=>{const{startDate:e,endDate:t}=A;return e&&t?{startDate:new Date(e),endDate:new Date(t),key:"selection"}:{startDate:null,endDate:null,key:"selection"}}),w=new Date,S=(0,v.A)(),C=(0,i.A)(S.breakpoints.down("sm")),T=(0,i.A)(e=>e.breakpoints.up("lg"));(0,a.useEffect)(()=>{const e=(0,r.A)((0,r.A)({},se({aggregationType:y||ee.A.hour,minDateOfDataset:t})[0].range()),{},{key:"selection"});j(e)},[y]),(0,a.useEffect)(()=>{var e;if(o)return void s(!1);const{startDate:t,endDate:a}=b||{};if(!t||!a)return;if((0,fe.r)(t,a))return;const r=null===(e=ie[y])||void 0===e?void 0:e.maxDays;if((0,be.c)(a,t)>r)return void c("".concat(ie[y].label," data is limited to maximum ").concat(r," day").concat(r>1?"s":""),we.n.error);const l=(e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,Z.GP)(t,"yyyy-MM-dd"),endDate:(0,Z.GP)(n,"yyyy-MM-dd")}})({startDateObject:t,endDateObject:a});x(n,{aggregationType:y,startDate:l.startDate,endDate:l.endDate})},[b]);const[k,I]=(0,a.useState)(!1),E=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=e=>{E.current&&!E.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[E]),(0,a.useEffect)(()=>{!u&&k&&I(!1)},[u]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(g.Ay,{item:!0,alignItems:k?"start":"stretch",xs:!0,sm:"auto",lg:!0,children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[T?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Averaging Period"}):null,(0,D.jsx)(ye,{aggregationType:y,setAggregationType:f,smallScreen:C})]})}),(0,D.jsx)(g.Ay,{item:!0,sx:{height:"2rem",flex:1,[S.breakpoints.up("lg")]:{minHeight:"4rem"}},children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,children:[T?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Date Range"}):null,(0,D.jsx)(de,{showPickerPanel:k,smallScreen:C,ref:E,elevation:8,onClick:()=>I(!0),sx:{position:"relative"},children:(0,D.jsx)(l.A,{sx:{transition:"filter 0.2s ease-in-out"},children:(0,D.jsx)(K.Ur,{ranges:[b],onChange:e=>{e&&j(e.selection)},staticRanges:(0,K.hs)(se({minDateOfDataset:t,aggregationType:y})),inputRanges:[],rangeColors:[S.palette.primary.main,S.palette.secondary.main,S.palette.text.secondary],minDate:t,maxDate:w,months:1,showMonthAndYearPickers:!0,direction:"vertical",fixedHeight:!0,preventSnapRefocus:!0,startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0,weekStartsOn:1})})})]})})]})};var Ee=n(79190),Me=n(11906);const Pe=(0,a.createContext)();function Oe(e){let{children:t}=e;const[n,r]=(0,a.useState)(),[o,l]=(0,a.useState)(),s=(0,a.useMemo)(()=>({hAxis:n,setHAxis:r,vAxis:o,setVAxis:l}),[n,o]);return(0,D.jsx)(Pe.Provider,{value:s,children:t})}const Re="150px",_e=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Re,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"}},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}}),ze=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Re,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderLeft:"none"}}}}),We=e=>{const{currentSchoolID:t,setIndividualChartConfig:n}=(0,a.useContext)(m.C),{chartID:r,allowedAxes:o,selectedAxes:l,dataType:c}=e,{hAxis:u,vAxis:p,setHAxis:x,setVAxis:A}=(0,a.useContext)(Pe),{isFetching:v}=ke(r),[y,b]=(0,a.useState)(!0);(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=l||{};e&&t?(x(e),A(t)):b(!0)},[l,x,A]),(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=l;e&&t&&b(u===e&&p===t)},[u,p,l]);const j=e=>!e.allowedDataTypes.includes(c),w=(0,i.A)(e=>e.breakpoints.up("lg"));return(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:1.5,width:"100%",children:[w?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Sensor Pair Selection"}):null,(0,D.jsxs)(g.Ay,{container:!0,item:!0,rowGap:1.5,columnGap:1,alignItems:"center",children:[(0,D.jsxs)(g.Ay,{container:!0,item:!0,rowGap:1.5,children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsxs)(_e,{fullWidth:!0,size:"small",children:[(0,D.jsx)(Ee.A,{id:"x-axis-select-label",children:"Horizontal Axis"}),(0,D.jsx)(f.A,{labelId:"x-axis-select-label",value:u||(null===l||void 0===l?void 0:l.hAxis)||null,label:"Horizontal Axis",onChange:e=>{x(e.target.value)},autoWidth:!0,children:null===o||void 0===o?void 0:o.map(e=>(0,D.jsxs)(s.A,{value:e.sensor,disabled:e.sensor===p||j(e),sx:{textTransform:"capitalize"},children:[e.sensor,j(e)&&" (No Data)"]},e.sensor))})]})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsxs)(ze,{fullWidth:!0,size:"small",children:[(0,D.jsx)(Ee.A,{id:"y-axis-select-label",children:"Vertical Axis"}),(0,D.jsx)(f.A,{labelId:"y-axis-select-label",value:p||(null===l||void 0===l?void 0:l.vAxis)||null,label:"Vertical Axis",onChange:e=>{A(e.target.value)},autoWidth:!0,children:null===o||void 0===o?void 0:o.map(e=>(0,D.jsxs)(s.A,{value:e.sensor,disabled:e.sensor===u||j(e),sx:{textTransform:"capitalize"},children:[e.sensor,j(e)&&" (No Data)"]},e.sensor))})]})})]}),(0,D.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsx)(Me.A,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{p&&u&&n(r,{endpoint:Te.HG[r],school_id:t,queryParams:{dataType:c,sensorX:u,sensorY:p}})},disabled:y||v,children:"APPLY"})})]})]})};var Le=n(14194);const Fe=e=>{let{customMessage:t,dataType:n,height:a,selectableAxes:r}=e,o="This sensor ",s=" data. Choose a different sensor or data type.";return r&&(o="This pair of sensors ",s=" correlation data. Choose another pair or a different data type."),(0,D.jsx)(l.A,{height:a,children:(0,D.jsx)(Le.A,{severity:"error",sx:{my:2},children:t||(0,D.jsxs)(D.Fragment,{children:[o,"does not have\xa0",(0,D.jsx)(l.A,{component:"span",textTransform:"capitalize",children:n}),s]})})})},Be=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",He=Array.from({length:24},(e,t)=>{const n=60*t;return{label:Be(n),value:n}}),Ve={allday:{id:"allday",label:"All Day",start:He[0].value,end:He[He.length-1].value,timeRangeLabel:"0-23h"},schoolHour:{id:"schoolHour",label:"School Hour",start:He[7].value,end:He[17].value,timeRangeLabel:"7-17h"},custom:{id:"custom",label:"Custom"}};var Ue=n(51715),Ne=n(80045);const Ye=["icon","label","value","options","handleChange","disabled","isExtraSmall"],qe=e=>{const{icon:t,label:n,value:a,options:o,handleChange:i,disabled:c,isExtraSmall:u}=e,h=(0,Ne.A)(e,Ye),p=(0,v.A)();return(0,D.jsxs)(d.A,(0,r.A)((0,r.A)({direction:"row",gap:t?1:0,alignItems:"center"},h),{},{children:[(0,D.jsx)(l.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:c?p.palette.text.secondary:p.palette.primary.main,verticalAlign:"middle"}},children:t}),(0,D.jsxs)(y.A,{fullWidth:!0,size:"small",disabled:c,sx:{minWidth:"5rem",marginLeft:"0 !important","& .MuiInputBase-root":{[p.breakpoints.down("sm")]:{fontSize:null!==u&&void 0!==u?u:"0.75rem"}}},children:[(0,D.jsx)(Ee.A,{id:"".concat(n,"-picker-label"),children:n}),(0,D.jsx)(f.A,{labelId:"".concat(n,"-picker-label"),id:"".concat(n,"-picker"),value:a,label:n,onChange:i,children:(0,_.OP)(o)&&o.map(e=>(0,D.jsx)(s.A,{value:e.value,is:!0,children:e.label},e.value))})]})]}))},Ke=e=>{const{timeRange:t,defaultTimeRange:n,disabled:r,handleChange:o,isResponsive:s=!1,hasTitle:c=!1}=e,u=(0,v.A)(),p=(0,i.A)(e=>e.breakpoints.up("lg")),[x,m]=(0,a.useState)(!1),[A,g]=(0,_.OP)(t)?t:n,[y,f]=(0,a.useState)(()=>{const e=Object.values(Ve).find(e=>e.start===A&&e.end===g);return e?e.id:Ve.custom.id});(0,a.useEffect)(()=>{const e=Object.values(Ve).find(e=>e.start===A&&e.end===g);f(e?e.id:Ve.custom.id)},[A,g]);const b=(0,a.useCallback)((e,t)=>{if(!t)return;f(t);const n=Ve[t];null!=n.start&&null!=n.end&&o([n.start,n.end]),m(t===Ve.custom.id)},[o]),j=(0,i.A)(e=>e.breakpoints.down("sm"));return(0,D.jsxs)(d.A,{direction:c?"column":"row",alignItems:"start",gap:.5,width:"100%",children:[c?p&&s?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Time Range"}):null:(0,D.jsx)(l.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:r?u.palette.text.secondary:u.palette.primary.main,verticalAlign:"-webkit-baseline-middle"}},children:(0,D.jsx)(Ue.A,{sx:{mt:.75}})}),(0,D.jsxs)(d.A,{direction:"column",width:"100%",gap:1.5,children:[(0,D.jsx)(he.A,{fullWidth:j,color:r?"standard":"primary",value:y,exclusive:!0,onChange:b,size:"small",disabled:r,orientation:s&&p?"vertical":"horizontal",children:Object.values(Ve).map((e,t,n)=>(0,D.jsxs)(pe.A,{value:e.id,"aria-label":e.label,sx:{color:"text.secondary",textTransform:"none",px:t===n.length-1?2:1,py:.5,flex:t===n.length-1?1:void 0},size:"small",children:[e.label,e.timeRangeLabel&&(0,D.jsxs)(D.Fragment,{children:["\xa0(",e.timeRangeLabel,")"]})]},e.id))}),x?(0,D.jsxs)(d.A,{direction:"row",flex:1,gap:1,children:[(0,D.jsx)(qe,{label:"From",value:A,options:He,disabled:r||"custom"!==y,handleChange:e=>{e.target.value>g?o([e.target.value,null]):o([e.target.value,g])},flex:1}),(0,D.jsx)(qe,{label:"To",value:g,options:He.filter(e=>e.value>A),disabled:r||"custom"!==y,handleChange:e=>o([A,e.target.value]),flex:1})]}):null]})]})},Qe=e=>{const{defaultTimeRange:t,isResponsive:n,hasTitle:r,chartIndex:o}=e,{allChartsConfigs:l,updateIndividualChartConfigQueryParams:s}=(0,a.useContext)(m.C),i=(l[o]||{}).queryParams||{},{startTime:d,endTime:c}=i,[u,h]=(0,a.useState)([null!==d&&void 0!==d?d:t.startTime,null!==c&&void 0!==c?c:t.endTime]);return(0,D.jsx)(Ke,{timeRange:u,defaultTimeRange:t,handleChange:e=>{h(e);const[t,n]=e||[];null===t||null===n||t>n||(t===Ve.allday.start&&n===Ve.allday.end?s(o,{startTime:null,endTime:null}):s(o,{startTime:t,endTime:n}))},isResponsive:n,hasTitle:r})};function Ge(e){var t;const{chartData:n,subchartIndex:o,windowSize:s,isPortrait:i,height:c,maxHeight:u,selectedDataType:h,allowedDataTypes:p}=e,m=(0,a.useContext)(A.d),[y,f]=(0,a.useState)(),[b,j]=(0,a.useState)(),[w,S]=(0,a.useState)(),[C,T]=(0,a.useState)(),I=(0,v.A)(),[R,W]=(0,a.useState)(!0),[L,F]=(0,a.useState)(!0),[B,V]=(0,a.useState)(!1),[U,N]=(0,a.useState)(),[Y,K]=(0,a.useState)(),[Q,G]=(0,a.useState)(),[X,$]=(0,a.useState)(Math.random().toString(36).substr(2,9)),J=(0,a.useMemo)(()=>(e=>{var t,n,a,o,l,s,i,d,c,u,h,p,x,m,A,g,v,y,f,b,j,w,S,C,D,T,k,I,M,P,O,R,_,z,W,L,F,B,H,V,U,N,Y,q,K,Q,G,X,$,J;const{chartData:Z,subchartIndex:ee,isPortrait:te,theme:ne}=e,ae={italic:!1,bold:!0,color:ne.palette.chart.axisTitle,fontSize:E({isPortrait:te})},re={color:ne.palette.chart.axisText,fontSize:E({isPortrait:te})};let oe=null!==(t=Z.subcharts)&&void 0!==t&&null!==(n=t[ee])&&void 0!==n&&n.options?(0,r.A)({},Z.subcharts[ee].options):{};if(oe=(0,r.A)((0,r.A)((0,r.A)({},oe),Z.options),{},{theme:"material",curveType:oe.curveType||(null===(a=Z.options)||void 0===a?void 0:a.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(o=Z.options)||void 0===o||null===(l=o.backgroundColor)||void 0===l?void 0:l.fill)||"transparent"},chartArea:(0,r.A)((0,r.A)({},null===(s=Z.options)||void 0===s?void 0:s.chartArea),{},{width:te?(null===(i=Z.options)||void 0===i||null===(d=i.chartArea)||void 0===d||null===(c=d.width)||void 0===c?void 0:c.portrait)||"80%":(null===(u=Z.options)||void 0===u||null===(h=u.chartArea)||void 0===h||null===(p=h.width)||void 0===p?void 0:p.landscape)||"80%",height:te?(null===(x=Z.options)||void 0===x||null===(m=x.chartArea)||void 0===m||null===(A=m.height)||void 0===A?void 0:A.portrait)||"60%":(null===(g=Z.options)||void 0===g||null===(v=g.chartArea)||void 0===v||null===(y=v.height)||void 0===y?void 0:y.landscape)||"80%",top:!te&&20}),width:te?(null===(f=Z.options)||void 0===f||null===(b=f.width)||void 0===b?void 0:b.portrait)||"100%":(null===(j=Z.options)||void 0===j||null===(w=j.width)||void 0===w?void 0:w.landscape)||"100%",height:Z.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:te?"center":"start",position:null!==(S=null===(C=Z.options)||void 0===C||null===(D=C.legend)||void 0===D?void 0:D.position)&&void 0!==S?S:te?"top":"right",scrollArrows:{activeColor:ne.palette.chart.axisTitle,inactiveColor:ne.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ne.palette.chart.axisTitle,bold:!0}}}),oe.vAxis=(0,r.A)((0,r.A)({},oe.vAxis),{},{format:null!==(T=null===(k=oe.vAxis)||void 0===k?void 0:k.format)&&void 0!==T?T:"decimal",title:null!==(I=null===(M=oe.vAxis)||void 0===M?void 0:M.title)&&void 0!==I?I:"",viewWindow:{min:null!==(P=null===(O=oe.vAxis)||void 0===O||null===(R=O.viewWindow)||void 0===R?void 0:R.min)&&void 0!==P?P:0,max:null!==(_=null===(z=oe.vAxis)||void 0===z||null===(W=z.viewWindow)||void 0===W?void 0:W.max)&&void 0!==_?_:null,max:null!==(L=null===(F=oe.vAxis)||void 0===F||null===(B=F.viewWindow)||void 0===B?void 0:B.max)&&void 0!==L?L:null}}),oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{title:null!==(H=null===(V=oe.hAxis)||void 0===V?void 0:V.title)&&void 0!==H?H:""}),te&&(oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{slantedText:!0,slantedTextAngle:30})),"string"!==typeof oe.colors&&oe.colors||(oe.colors=ne.palette.chart.optionsColors[oe.colors||"multiColor"]),oe.series&&Object.values(oe.series).forEach(e=>{const t=e;"default"===t.color&&(t.color=ne.palette.primary.main)}),oe.trendlines&&oe.trendlines.forEach(e=>{e.color=ne.palette.primary.main}),oe.colorAxis)switch(oe.colorAxis.colors){case"matchingColor":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.chart.optionsColors.multiColor[oe.colorAxis.colorIndex]];break;case"default":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.NYUpurple];break;default:try{oe.colorAxis=ne.palette.chart.colorAxes[oe.colorAxis.colors]}catch(le){oe.colorAxis=[]}}return oe.vAxis=(0,r.A)((0,r.A)({},oe.vAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(U=oe.vAxis)||void 0===U?void 0:U.gridlines),{},{color:(null===(N=oe.vAxis)||void 0===N||null===(Y=N.gridlines)||void 0===Y?void 0:Y.color)||ne.palette.chart.gridlines}),minorGridlines:{count:0}}),oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(q=oe.hAxis)||void 0===q?void 0:q.gridlines),{},{color:(null===(K=oe.hAxis)||void 0===K||null===(Q=K.gridlines)||void 0===Q?void 0:Q.color)||ne.palette.chart.gridlines}),minorGridlines:(0,r.A)((0,r.A)({},null===(G=oe.hAxis)||void 0===G?void 0:G.minorGridlines),{},{color:(null===(X=oe.hAxis)||void 0===X||null===($=X.gridlines)||void 0===$?void 0:$.color)||ne.palette.chart.gridlines})}),oe.legend=(0,r.A)((0,r.A)({},oe.legend),{},{textStyle:re}),oe.annotations=(0,r.A)((0,r.A)({},oe.annotations),{},{highContrast:!0,textStyle:{color:ne.palette.primary.contrastText,fontSize:E({isPortrait:te,isSmaller:!0}),opacity:.8},stem:(0,r.A)((0,r.A)({},null===(J=oe.annotations)||void 0===J?void 0:J.stem),{},{color:ne.palette.chart.axisTitle,thickness:2}),boxStyle:{rx:ne.shape.borderRadius,ry:ne.shape.borderRadius,fill:ne.palette.chart.annotationBoxFill,fillOpacity:.5}}),te&&"LineChart"===(null===Z||void 0===Z?void 0:Z.chartType)&&(oe.pointSize=0),oe})((0,r.A)((0,r.A)({},e),{},{theme:I})),[e,I,n.chartType]),[Z,ee]=(0,a.useState)(null);if("Calendar"===n.chartType)return(0,a.useEffect)(()=>{const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null;(0,_.OP)(e)?(ee(e),F(!0)):F(!1)},[n]),Z?L?(0,D.jsx)(q,{dataArray:Z,valueRangeBoxTitle:(0,x.MU)({dataTypeKey:h,dataTypes:p,showUnit:!0}),isPortrait:i,options:J,windowSize:s}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Fe,{dataType:(0,x.MU)({dataTypeKey:h,dataTypes:p})}),(0,D.jsx)(q,{dataArray:[],valueRangeBoxTitle:(0,x.MU)({dataTypeKey:h,dataTypes:p,showUnit:!0}),isPortrait:i,options:J,windowSize:s})]}):(0,D.jsx)(l.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,D.jsx)(O.A,{})});let te,ne=!1,ae=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[o].control);ae&&(ne=!0,te=(0,r.A)((0,r.A)({},ae.options),{},{ui:M({chartControl:ae,mainChartData:n,mainChartOptions:J,subchartIndex:o,theme:I,isPortrait:i})}),"ChartRangeFilter"===ae.controlType&&(0,a.useEffect)(()=>{const e=(e=>{let{controlWrapper:t,chartID:n}=e;const a=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var a=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let r=!0;if(!t)return;const o=document.querySelector("#other-chart-control-".concat(n));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.addEventListener(e,a,{capture:!0})}),()=>{r=!1,["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.removeEventListener(e,a,{capture:!0})})}):void 0})({controlWrapper:w,chartID:X});return e},[w]));const re=J.seriesSelector||!1,oe=J.dateRangePicker||null,le=J.timeRangeSelector||null,se=J.formatters||null;let ie=n.selectableAxes||null;ie&&(0,_.OP)(ie.allowedAxes)&&ie.allowedAxes.length<=2&&(ie=null);const de=re||oe||ie||le;(0,a.useEffect)(()=>{re?he({newDataColumns:Y}):(null===b||void 0===b||b.setOptions((0,r.A)({},J)),null===b||void 0===b||b.draw(),ne&&(null===w||void 0===w||w.setOptions(te),null===w||void 0===w||w.draw()))},[I,i,s]),(0,a.useEffect)(()=>{Y&&re&&"setViewColumn"==re.method&&(ce({dataColumns:Y}),he({newDataColumns:Y}))},[I]);const ce=e=>{let{dataColumns:t}=e;t.forEach(e=>{var t;e.color=J.colors[e.seriesIndex%J.colors.length],e.serieAttribute=null===(t=J.series)||void 0===t?void 0:t[e.seriesIndex]})},ue=e=>{let t,n,{dataTable:a,allInitialColumns:r}=e;return r.forEach((e,r)=>{if(0===r)return;const o=a.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(n=n?Math.max(n,o.max):o.max)}),{min:t,max:n}},he=(0,a.useCallback)(e=>{let{newDataColumns:t,_allInitialColumns:n=U,_chartWrapper:a=b,_controlWrapper:o=w}=e;if(n){if(K(t),"toggleVisibility"===re.method||null===re.method){const e={};if(t.forEach(t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})}),null===a||void 0===a||a.setOptions((0,r.A)((0,r.A)({},J),{},{series:(0,r.A)((0,r.A)({},J.series),e)})),ne){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{series:(0,r.A)((0,r.A)({},J.series),e)})})}))}}else if("setViewColumn"===re.method){let e=[];e.push(0),t.forEach(t=>{if(t.selected&&(e.push(t),(0,_.OP)(n)))for(let a=t.indexIn_+1;a<n.length&&"data"!==n[a].role;a++)e.push(n[a])}),null===a||void 0===a||a.setView({columns:e});const l=(0,r.A)({},J);l.colors=t.filter(e=>e.selected).map(e=>e.color);const s={};let i=0;if(t.forEach(e=>{e.selected&&(null!=e.serieAttribute&&(s[i]=e.serieAttribute),i++)}),l.series=s,null===a||void 0===a||a.setOptions(l),ne){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{colors:l.colors,series:l.series}),chartView:{columns:e}})}))}}null===a||void 0===a||a.draw(),ne&&(null===o||void 0===o||o.draw())}},[U,J,re,b,w,Q,ne]);(0,a.useEffect)(()=>{if(m&&n){if(JSON.stringify(n)===JSON.stringify(C))return;T(n);const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null,t=(0,_.OP)(e);if(F(t),!0===t){V(!0);const t=m.visualization.arrayToDataTable(e);if(se&&"object"===typeof se&&se.hasOwnProperty("numberFormatter")){const e=new m.visualization.NumberFormat(se.numberFormatter.numberFormat);se.numberFormatter.columns.forEach(n=>e.format(t,n))}f(t)}}},[m,n]),(0,a.useEffect)(()=>{if(!0===B){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push((0,r.A)((0,r.A)({},n),{},{calc:e}))}else t.push(n);return t})(n.columns||n.subcharts&&n.subcharts[o].columns||null),t=new m.visualization.ChartWrapper({chartType:n.chartType,dataTable:ne?void 0:y,options:J,view:{columns:e},containerId:X});let a;if(j(t),ne){const e=new m.visualization.Dashboard(document.getElementById("dashboard-".concat(X)));m.visualization.events.addListener(e,"ready",fe),a=new m.visualization.ControlWrapper({controlType:ae.controlType,options:te,containerId:"".concat("CategoryFilter"===ae.controlType?"CategoryFilter":"other-chart-control","-").concat(X)}),S(a),e.bind(a,t),e.draw(y)}else m.visualization.events.addListener(t,"ready",fe),t.draw();if(re){const{initAllInitialColumns:e,initDataColumns:n}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:a}=e;const r=(null===Y||void 0===Y?void 0:Y.map(e=>({label:e.label,selected:e.selected})))||[];let o=t.getView();if(null==o.columns){const e=new m.visualization.DataView(n);t.setView({columns:e.columns}),o=t.getView()}let l=!0,s=0;const i=o.columns.map((e,t)=>{if("number"===typeof e&&(e={role:l?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,l=!1,"data"===e.role){const n=r.find(t=>t.label===e.label);n?e.selected=n.selected:a.defaultSeriesToDisplayInitially?e.selected=a.defaultSeriesToDisplayInitially.includes(t):a.allowMultiple?e.selected=!0:e.selected=0===s,e.seriesIndex=s,s++}return e});N(i);const d=ue({dataTable:n,allInitialColumns:i});G(d);const c=i.filter(e=>{var t,n;return"data"===e.role&&!1!==(null===(t=J.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)});return"setViewColumn"===a.method&&ce({dataColumns:c}),K(c),{initAllInitialColumns:i,initDataColumns:c}})({chartWrapper:t,dataTable:y,seriesSelector:re});he({_allInitialColumns:e,newDataColumns:n,_chartWrapper:t,_controlWrapper:a})}V(!1)}},[B]);const pe=J.gradientBackgroundColor;let xe,me;var Ae,ge,ve,ye;pe&&(xe="".concat(X,"-backgroundGradient"),me=(e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;return z({colors:t,optionalMinValue:n,optionalMaxValue:a}).map(e=>({color:e.color,offset:100*e.offset+"%"}))})({colors:I.palette.chart.colorAxes[pe].colors,optionalMinValue:null===(Ae=J.vAxis)||void 0===Ae||null===(ge=Ae.viewWindow)||void 0===ge?void 0:ge.min,optionalMaxValue:null===(ve=J.vAxis)||void 0===ve||null===(ye=ve.viewWindow)||void 0===ye?void 0:ye.max}));const fe=()=>{R&&W(!1)};return L?(0,D.jsxs)(P.A,{isPortrait:i,gradientBackgroundId:xe,className:n.chartType,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[R&&(0,D.jsx)(l.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,D.jsx)(O.A,{})}),(0,D.jsxs)(g.Ay,{id:"dashboard-".concat(X),container:!0,alignItems:"start",children:[de&&(0,D.jsxs)(g.Ay,{lg:2,container:!0,item:!0,sx:{mt:1,ml:2,gap:2,[I.breakpoints.down("lg")]:{gap:1,ml:0}},children:[!1===R&&(0,D.jsxs)(D.Fragment,{children:[re&&(0,D.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(k,{items:Y,allowMultiple:re.allowMultiple,seriesLabel:re.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),oe&&(0,D.jsx)(Ie,{minDateOfDataset:new Date(oe.minDate),chartIndex:n.id}),ie&&(0,D.jsx)(We,{chartID:n.id,allowedAxes:ie.allowedAxes,selectedAxes:ie.selectedAxes,dataType:h}),le&&(0,D.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(Qe,{defaultTimeRange:[Ve.allday.start,Ve.allday.end],handleChange:()=>null,isResponsive:!0,hasTitle:!0,chartIndex:n.id})})]}),(0,D.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(l.A,{id:"CategoryFilter-".concat(X),sx:{display:ne&&"CategoryFilter"===ae.controlType?"block":"none"}})})]}),(0,D.jsx)(g.Ay,{item:!0,xs:!0,children:(0,D.jsxs)(d.A,{children:[(0,D.jsx)(l.A,{id:X,sx:{height:c,maxHeight:u}}),(0,D.jsx)(l.A,{id:"other-chart-control-".concat(X),sx:{display:ne&&"CategoryFilter"!==ae.controlType?"block":"none",height:"calc(".concat(c," / 8)"),filter:"saturate(0.3)",opacity:.7}})]})})]}),pe?(0,D.jsx)(H,{id:xe,colors:me}):null]}):(0,D.jsx)(Fe,{dataType:(0,x.MU)({dataTypeKey:h,dataTypes:p}),selectableAxes:ie,height:re||ne?1.2*parseFloat(c)+"vw":c})}var Xe=n(20036);const $e=function(e){let{text:t,wordLimit:n=40,reference:r}=e;const[o,s]=(0,a.useState)(!1),d=(0,v.A)(),c=(0,i.A)(d.breakpoints.down("sm")),u=(0,a.useRef)(null),p=t.split(" ");if(!c||p.length/n<=1.4)return(0,D.jsxs)(l.A,{children:[(0,D.jsx)(h.A,{children:(0,U.Ay)(t,{replace:_.H$})}),r&&(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,U.Ay)(r,{replace:_.H$})})]});let x=p.slice(0,n).join(" ");const m=x.lastIndexOf(".");return-1!==m&&(x=x.slice(0,m+1)),(0,D.jsx)(Xe.x,{onClickAway:e=>{(e=>{let{target:t}=e;const n=u.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){var r;if(a.has(null===(r=t)||void 0===r?void 0:r.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||s(!1)},children:(0,D.jsx)(l.A,{ref:u,onClick:()=>s(!o),style:{cursor:"pointer"},children:o?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(h.A,{children:(0,U.Ay)(t,{replace:_.H$})}),r&&(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,U.Ay)(r,{replace:_.H$})})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(h.A,{display:"inline",children:[(0,U.Ay)(x,{replace:_.H$}),"..."]}),(0,D.jsx)(h.A,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Je=n(40430);const Ze=e=>{let{selectedDataType:t,dataTypes:n,chartID:r}=e;const{updateIndividualChartConfigQueryParams:o}=(0,a.useContext)(m.C),[l,i]=(0,a.useState)(null);if(!(0,_.OP)(n))return null;if(n.length<=1)return(0,D.jsx)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const d=Boolean(l),c=()=>{i(null)};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Me.A,{id:"data-type-drop-down-menu-button","aria-controls":d?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,D.jsx)(h.A,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,x.MU)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,D.jsx)(Je.A,{})]}),(0,D.jsx)(u.A,{id:"data-type-drop-down-menu",anchorEl:l,open:d,onClose:c,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map((e,t)=>(0,D.jsx)(s.A,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{o(r,{dataType:e}),c()})(e.key),children:e.name_title},t))})]})};var et=n(14912);const tt=(0,o.Ay)(et.A,{shouldForwardProp:e=>"smallFontSize"!==e})(e=>{let{theme:t,smallFontSize:n="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:n,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}}),nt=(0,o.Ay)(l.A)(e=>{let{theme:t}=e;return(0,r.A)((0,r.A)({},"dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}}),{},{"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}})}),at=(0,o.Ay)(s.A)(e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}});const rt=function(e){let{chartID:t}=e;const{data:n,isLoading:r,isFetching:o,error:s}=ke(t),{currentSchoolID:A}=(0,a.useContext)(m.C),g=(0,i.A)(e=>e.breakpoints.down("sm")),[v,y]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[f,b]=(0,a.useState)([window.innerWidth,window.innerHeight]),[j,w]=(0,a.useState)(0),[S,T]=(0,a.useState)(0),[k,I]=(0,a.useState)(-1),[E,M]=(0,a.useState)(),[P,R]=(0,a.useState)(null),[z,W]=(0,a.useState)([]),[L,F]=(0,a.useState)(null);let B,H;if((0,a.useEffect)(()=>{if(!n)return;((e,t,n)=>{if(null===e||void 0===e||!e.allowedDataTypes)return;t(e.allowedDataTypes.map(e=>{const{name_title:t,name_short:n,unit:a}=x.Uy[e];return{key:e,name_title:t,name_short:n,unit:a}})),n(e.selectedDataType)})(n,W,F);const e=((e,t,n)=>{let a=null;const r=()=>{clearTimeout(a),a=setTimeout(()=>{t(window.matchMedia("(orientation: portrait)").matches),e([window.innerWidth,window.innerHeight])},n)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}})(b,y,100);return e},[n]),(0,a.useEffect)(()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout(()=>{y(window.matchMedia("(orientation: portrait)").matches),b([window.innerWidth,window.innerHeight])},100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[n]),(0,a.useEffect)(()=>{T(j),w(0)},[A]),"Calendar"!==(null===n||void 0===n?void 0:n.chartType)&&(B=v?"80vw":"35vw",H=v?"800px":"450px"),n)return r?(0,D.jsx)(O.A,{optionalText:"Loading chart ".concat(t+1,"...")}):s?(0,D.jsx)(Fe,{customMessage:"Error loading chart ".concat(t+1,", please try later")}):(0,D.jsxs)(l.A,{position:"relative",children:[(0,D.jsxs)(l.A,{children:[(0,D.jsxs)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:[t+1,". ",n.title,"\xa0"]}),(0,D.jsx)(l.A,{display:"inline",children:(0,D.jsx)(Ze,{selectedDataType:L,dataTypes:z,chartID:t})})]}),(0,D.jsxs)(nt,{height:"100%",sx:{filter:o?"blur(1px)":"none",transition:"filter 0.2s",pointerEvents:o?"none":"auto"},children:[(0,_.OP)(n.subcharts)?(()=>{const e=n.subcharts.length>4,t=e?n.subcharts.slice(0,3):n.subcharts,a=e?n.subcharts.slice(3):null,r=e=>-1===j?S===e:j===e;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(tt,{value:j,onChange:(t,n)=>{T(j),w(n),e&&n<3&&n!==k&&(M(),I(-1))},variant:g?"fullWidth":"standard",children:[t.map((e,t)=>(0,D.jsx)(c.A,{value:t,label:n.subcharts[t].subchartTitle,sx:{textDecoration:!(0,_.OP)(n.subcharts[t].dataArray)&&"line-through"}},t)),e&&(0,D.jsx)(c.A,{value:k,label:(0,D.jsxs)(d.A,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,D.jsxs)(l.A,{flex:1,children:["Other sensors",E&&" (".concat(E,")"),"\xa0"]}),(0,D.jsx)(p.A,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>R(e.currentTarget)})]}),e&&(0,D.jsx)(u.A,{id:"submenu",anchorEl:P,open:Boolean(P),onClose:()=>{-1===j&&(T(j),w(S)),R(null)},children:a.map((e,t)=>(0,D.jsx)(at,{selected:t===j-3,onClick:()=>(e=>{T(j),w(3+e),I(3+e),M(a[e].subchartTitleShort),R(null)})(t),sx:{textDecoration:!(0,_.OP)(n.subcharts[t+3].dataArray)&&"line-through"},children:(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",gap:1,children:[(0,D.jsx)(l.A,{children:a[t].subchartTitle}),t===j-3&&(0,D.jsx)(C.A,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t))}),(0,D.jsx)(l.A,{position:"relative",sx:{overflowX:v&&"auto",WebkitOverflowScrolling:v&&"touch",overflowY:"hidden"},children:n.subcharts.map((e,t)=>(0,D.jsx)(l.A,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:r(t)?"1":"0",pointerEvents:r(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,D.jsx)(Ge,{selectedDataType:L,allowedDataTypes:z,chartData:n,subchartIndex:t,isPortrait:v,windowSize:f,height:n.height?n.height:B,maxHeight:["Calendar"].includes(n.chartType)?"":H,currentSubchart:j})},t))})]})})():(0,_.OP)(n.dataArray)?(0,D.jsx)(Ge,{selectedDataType:L,allowedDataTypes:z,chartData:n,isPortrait:v,windowSize:f,height:n.height?n.height:B}):(0,D.jsx)(Fe,{customMessage:"Not enough historical data to display this chart"}),(0,D.jsx)(l.A,{sx:{my:3},children:(0,D.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,D.jsx)($e,{text:(()=>{var e;let t=n.subtitle||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=n.subcharts[j].subchartSubtitle),t})(),reference:(()=>{var e;let t=n.reference||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.reference&&(t+="<br/>",t+=n.subcharts[j].reference),t})()})})})]}),o&&(0,D.jsx)(l.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255,255,255,0.3)",zIndex:10},children:(0,D.jsx)(O.A,{})})]})};var ot=n(35197),lt=n(19252),st=n(39336),it=n(11530),dt=n(8738),ct=n(24010),ut=n(95953),ht=n(56258),pt=n(4710),xt=n(38198),mt=n(97847),At=n(47298);function gt(e){const[t,n]=(0,a.useState)(null),o=e=>{n(e.currentTarget),mt.n(mt.s.airQualityIndexLegendQuickGlance)},l=()=>{n(null)},s=Boolean(t);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(xt.An,(0,r.A)((0,r.A)({},e),{},{distanceFromBottomOfWindow:"5.5rem",children:(0,D.jsx)(ct.A,{sx:{mt:1},"aria-owns":s?mt.s.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:o,onMouseLeave:l,onClick:e=>dt.Fr&&(s?l():o(e)),"aria-label":mt.s.airQualityIndexLegendQuickGlance,color:"primary",children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"center",children:[(0,D.jsx)(pt.A,{fontSize:"1rem"}),(0,D.jsx)(h.A,{variant:"body2",fontWeight:"500",children:"AQI"})]})})})),(0,D.jsx)(ut.A,{id:mt.s.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:s,anchorEl:t,placement:"top-end",onClose:l,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,D.jsx)(ht.A,(0,r.A)((0,r.A)({},t),{},{timeout:350,children:(0,D.jsxs)(Q.A,{elevation:8,sx:{py:.5,mb:1},children:[(0,D.jsx)(h.A,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,D.jsx)(At.A,{tiny:!0,hideAQIDescription:!0})]})}))}})]})}var vt=n(74033),yt=n(8051),ft=n(89521),bt=n(65290),jt=n(73605),wt=n(94922),St=n(83250),Ct=n(73216),Dt=n(4967);const Tt=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C),{data:t}=(0,Dt.A)(),[n,r]=(0,a.useState)(null),o=(0,Ct.Zp)();if(!t)return null;const l=t.screens;if(!(0,_.OP)(l))return null;const i=()=>{var t;const n=l&&(null===(t=l[0])||void 0===t?void 0:t.screen_name);o("screen"===n?"/screen/".concat(e):"/screen/".concat(e,"/").concat(n))};if(l.length<=1)return(0,D.jsxs)(Me.A,{variant:"contained",size:"small",onClick:i,children:[(0,D.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const d=Boolean(n);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Me.A,{id:"basic-button","aria-controls":d?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{r(e.currentTarget)},variant:"contained",size:"small",children:[(0,D.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,D.jsx)(u.A,{id:"tv-screen-list-menu",anchorEl:n,open:d,onClose:()=>{r(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:l.map((t,n)=>(0,D.jsx)(s.A,{onClick:()=>{return n=t.screen_name,void o("/screen/".concat(e,"/").concat(n));var n},sx:{fontSize:"0.8rem"},children:t.location_long},n))})]})};var kt=n(88446),It=n(71806),Et=n(84882),Mt=n(28076),Pt=n(10039),Ot=n(73460),Rt=n(41132),_t=n(6519),zt=n(77739),Wt=n(17392),Lt=n(90035),Ft=n(29347),Bt=n(26600),Ht=n(35316),Vt=n(55896);const Ut=e=>{const{buttonIcon:t,buttonIconAria:n,buttonLabel:r,buttonVariant:o="contained",trackingEvent:l,dialogTitle:s,dialogOpenHandler:d=null,dialogCloseHandler:c=null,displaySchoolID:u=!0,maxWidth:h="lg",children:p,disabled:x}=e;let A;A=!(!t||r);const{currentSchoolID:g}=(0,a.useContext)(m.C),y=(0,i.A)(e=>e.breakpoints.down("sm")),[f,b]=(0,a.useState)(!1),j=()=>{d?d(()=>{b(!0),l&&mt.n(l)}):(b(!0),l&&mt.n(l))},w=()=>{b(!1),c&&c()},C=(0,v.A)();return(0,D.jsxs)(D.Fragment,{children:[A?(0,D.jsx)(zt.A,{title:n,children:(0,D.jsx)(Wt.A,{onClick:j,"aria-label":n,size:"small",sx:{"&:hover,:focus":{color:C.palette.primary.main}},disabled:x,children:t})}):(0,D.jsxs)(Me.A,{onClick:j,variant:o,disabled:x,size:"small",children:[t,"\xa0",r]}),(0,D.jsxs)(Lt.A,{open:f,onClose:w,maxWidth:h,fullWidth:!0,fullScreen:y,keepMounted:!0,children:[(0,D.jsx)(Ft.A,{sx:{justifyContent:"start"},children:(0,D.jsxs)(Me.A,{onClick:w,children:[(0,D.jsx)(Vt.A,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,D.jsxs)(Bt.A,{children:[!0===u?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(S.A,{label:g?"School: ".concat(g.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,D.jsx)("br",{})]}):null,s]}),(0,D.jsx)(Ht.A,{children:p})]})]})};var Nt=n(93332);const Yt=e=>{const{authenticationState:t,user:n}=(0,a.useContext)(Nt.R),r=t.authenticated&&t.checkedAuthentication,{currentSchoolID:o}=(0,a.useContext)(m.C),{enqueueSnackbar:l}=(0,je.dh)(),s=(0,a.useCallback)(t=>r?null!==n&&void 0!==n&&n.allowedSchools.some(e=>e.school_id===o)?(null===t||void 0===t||t(),!0):(l("Your account does not have access to ".concat(o.toUpperCase()," Alerts"),we.n.error),!1):(null===e||void 0===e||e(),!1),[r,e,o,n,l]);return{loggedIn:r,handleRestrictedAccess:s}};var qt=n(41e3);function Kt(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Yt(t),{currentSchoolID:r}=(0,a.useContext)(m.C),{data:o}=(0,qt.A)(),[l,s]=(0,a.useState)({}),[i,d]=(0,a.useState)("placeholder");return(0,a.useEffect)(()=>{if(!o)return;const e=o.filter(e=>e&&e.sensor).reduce((e,t)=>{var n;return e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:null===(n=t.sensor.last_seen)||void 0===n?void 0:n.split("T")[0],rawDatasets:Object.keys(ee.A).reverse().reduce((e,t)=>(e[ee.A[t]]={sample:null,full:null},e),{})},e},{});s(e)},[o]),(0,D.jsxs)(Ut,{buttonIcon:(0,D.jsx)(_t.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:mt.s.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),n(e)},children:[(0,D.jsx)(Qt,{sensorsDatasets:l,updateSensorsDatasets:s,previewingDataset:i,setPreviewingDataset:d,schoolID:r}),l&&(0,D.jsxs)(h.A,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["These datasets are provided by ",wt.sG," from sensors operated by ",wt.sG,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,D.jsx)(kt.A,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Qt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,setPreviewingDataset:l,schoolID:s}=e,d=(0,v.A)(),c=(0,i.A)(d.breakpoints.down("sm"));return(0,a.useEffect)(()=>{if(Object.keys(t).length>0&&!o){const e=Object.keys(t)[0],a=ee.A.hour;if(l({sensor:e,datasetType:a}),t[e].rawDatasets[a].sample)return;const o=(0,De.A4)({school_id:s,sensor_location_short:e,aggregationType:a,isSample:!0});(0,Ce.i)({url:o,extension:Te.Fc.csv,needsAuthorization:!0}).then(o=>{const l=(0,r.A)({},t);l[e].rawDatasets[a].sample=o,n(l)}).catch(e=>console.log(e))}},[t,o]),(0,D.jsxs)(g.Ay,{container:!0,justifyContent:"center",alignItems:"start",spacing:c?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,D.jsx)(g.Ay,{item:!0,sm:12,md:6,children:(0,D.jsx)(Gt,{schoolID:s,sensorsDatasets:t,updateSensorsDatasets:n,smallScreen:c,previewingDataset:o,setPreviewingDataset:l})}),(0,D.jsx)(g.Ay,{item:!0,sm:12,md:6,maxWidth:c?"100%":"unset",sx:{mt:1},children:(0,D.jsx)($t,{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,schoolID:s,smallScreen:c})})]})},Gt=e=>{const{schoolID:t,sensorsDatasets:n,smallScreen:a,previewingDataset:r,setPreviewingDataset:o,updateSensorsDatasets:l}=e;return(0,D.jsxs)(It.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,D.jsx)(Et.A,{children:(0,D.jsxs)(Mt.A,{children:[(0,D.jsx)(Pt.A,{sx:{pl:1},children:"Sensor Location"}),(0,D.jsx)(Pt.A,{sx:{width:a?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,D.jsx)(Ot.A,{children:n&&Object.keys(n).map(e=>(0,D.jsx)(Xt,{schoolID:t,smallScreen:a,sensor:e,sensorsDatasets:n,previewingDataset:r,setPreviewingDataset:o,isPreviewing:e===(null===r||void 0===r?void 0:r.sensor),updateSensorsDatasets:l},e))})]})},Xt=e=>{const{schoolID:t,sensorsDatasets:n,sensor:o,previewingDataset:l,setPreviewingDataset:i,isPreviewing:c,updateSensorsDatasets:u}=e,[h,p]=(0,a.useState)(ee.A.hour);(0,a.useEffect)(()=>{h!==ee.A.hour&&p(ee.A.hour)},[t]);const x=e=>{if(!n[o].rawDatasets[e].sample){const a=(0,De.A4)({school_id:t,sensor_location_short:n[o].location_short,aggregationType:e,isSample:!0});(0,Ce.i)({url:a,extension:Te.Fc.csv,needsAuthorization:!0}).then(t=>{const a=(0,r.A)({},n);a[o].rawDatasets[e].sample=t,u(a)})}},m=(0,v.A)();return(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)(Mt.A,{children:[(0,D.jsx)(Pt.A,{sx:{pl:1,cursor:"pointer",background:c&&m.palette.background.NYUpurpleLight},onClick:()=>{(null===l||void 0===l?void 0:l.sensor)!==o&&(i({datasetType:h,sensor:o}),x(h))},children:n[o].location_long}),(0,D.jsx)(Pt.A,{sx:{position:"relative",background:c&&m.palette.background.NYUpurpleLight},children:(0,D.jsx)(y.A,{size:"small",children:(0,D.jsx)(f.A,{value:h,onChange:e=>{const t=e.target.value;p(t),i({datasetType:t,sensor:o}),x(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(n[o].rawDatasets).reverse().map((e,t)=>(0,D.jsx)(s.A,{value:e,children:(0,D.jsx)(d.A,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t))})})})]},o)})},$t=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,schoolID:s,smallScreen:i}=e,c=(0,v.A)(),[u,p]=(0,a.useState)("Not previewing any dataset"),[x,m]=(0,a.useState)("No dataset"),[A,g]=(0,a.useState)(!1),y=e=>{const t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=x,document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a)},[f,b]=(0,a.useState)(""),[j,w]=(0,a.useState)("");return(0,a.useEffect)(()=>{var e,n;if(!o)return;p("Previewing: ".concat(o.sensor," (").concat(o.datasetType,")"));const a=null===(e=t[o.sensor])||void 0===e||null===(n=e.rawDatasets[o.datasetType])||void 0===n?void 0:n.sample;if(!a)return w(null),b(null),m("Loading..."),void g(!0);A&&g(!1);const r=a.split("\n"),l=r[0].split(","),i=r.slice(1);let d;if(w(["",...i.map(e=>e.split(",")[0])].join("\n")),b([l.slice(1).join(","),...i.map(e=>e.split(",").slice(1).join(","))].join("\n")),i.length>0){const e=i[i.length-1].split(",");if(e.length>=2){d=e[1].split("T")[0]}}const c="".concat(s,"-").concat(o.sensor,"-").concat(o.datasetType,"-").concat(d,".csv");m(c)},[o,t]),(0,D.jsxs)(d.A,{spacing:1,children:[(0,D.jsxs)(l.A,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,D.jsx)(d.A,{direction:"row",children:(0,D.jsx)(h.A,{variant:"body2",gutterBottom:!0,fontWeight:500,children:u})}),(0,D.jsx)(l.A,{component:"pre",sx:{overflowX:"auto",color:c.palette.text.secondary,backgroundColor:c.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:i?"11.8rem":"14rem",width:i?"100%":"unset",marginTop:0},children:(0,D.jsx)(d.A,{direction:"row",sx:{fontSize:"0.75rem"},children:f?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(l.A,{sx:{mr:2,userSelect:"none"},children:j}),(0,D.jsx)(l.A,{children:f})]}):(0,D.jsx)(O.A,{optionalText:"Loading"})})})]}),(0,D.jsx)(l.A,{textAlign:"center",children:(0,D.jsxs)(Me.A,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!o)return;const e=t[o.sensor].rawDatasets[o.datasetType].full;if(e)y(e);else{const e=(0,De.A4)({school_id:s,sensor_location_short:o.sensor,aggregationType:o.datasetType,isSample:!1});(0,Ce.i)({url:e,extension:Te.Fc.csv,needsAuthorization:!0}).then(e=>{const a=(0,r.A)({},t);a[o.sensor].rawDatasets[o.datasetType].full=e,n(a),y(e)})}})(),mt.n(mt.s.rawDatasetDownloaded,{dataset_type:null===o||void 0===o?void 0:o.datasetType,sensor:null===o||void 0===o?void 0:o.sensor})},disabled:A,children:[(0,D.jsx)(Rt.A,{sx:{fontSize:"1.25rem",mr:.5}}),x]})})]})};var Jt=n(23621),Zt=n(67784),en=n(81637),tn=n(63248),nn=n(47097);const an=(e,t)=>JSON.stringify(e)===JSON.stringify(t),rn=()=>{const{enqueueSnackbar:e}=(0,je.dh)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{data:n=[]}=(0,Se.I)({queryKey:[Te.tK.alertsEmails,t],queryFn:async()=>{const e=(0,De.e9)({endpoint:Te.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:e,extension:"json",needsAuthorization:!0})},enabled:!!t,staleTime:0}),r=(0,tn.jE)(),o=(0,nn.n)({mutationFn:async e=>{const n=(0,De.e9)({endpoint:Te.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:n,restMethod:Te.Xo.POST,body:e})},onSuccess:n=>{r.setQueryData([Te.tK.alertsEmails,t],n),e("Email recipients saved successfully.",we.n.success)},onError:()=>{e("There was an error saving email recipients. Please try again.",we.n.error)}}),c=(0,i.A)(e=>e.breakpoints.down("sm")),[p,x]=(0,a.useState)([]),[A,v]=(0,a.useState)(!1),[y,f]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),[w,C]=(0,a.useState)("");(0,a.useEffect)(()=>{x(n)},[n]),(0,a.useEffect)(()=>{v(!an(p,n))},[p,n]),(0,a.useEffect)(()=>{C(A?"Click to save new changes on server":"No changes detected to save")},[A]);const T=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.trim().toLowerCase();a.startsWith("<")&&a.endsWith(">")&&(a=a.slice(1,-1).trim()),a&&((0,_.DT)(a)?p.includes(a)?e(n?"Some pasted email addresses already existed":"Already existed: ".concat(a),we.n.error):p.length>=150?e("Maximum number of recipients reached",we.n.warning):(x(e=>[...e,a]),f("")):n||e("Invalid email address: ".concat(a),we.n.error))},k=e=>{const t=p.filter((t,n)=>n!==e);x(t)},I=(0,a.useRef)(null),E=(0,a.useRef)(null),M=(0,a.useRef)(""),[P,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const t=t=>{if(null===t||void 0===t||!t.key)return;const n=t.key.toLowerCase(),a=t.metaKey||t.ctrlKey,r=document.activeElement===E.current;if(!a||"a"!==n){if(a&&"c"===n&&P)return t.preventDefault(),0===p.length?void e("No emails to copy.",we.n.warning):void navigator.clipboard.writeText(p.join(", ")).then(()=>e("All emails copied to clipboard.",we.n.success)).catch(()=>e("Failed to copy emails.",we.n.error));if(P&&("backspace"===n||"delete"===n)){if(t.preventDefault(),0===p.length)return;return x([]),O(!1),void e("All emails deleted.",we.n.info)}return"escape"===n&&P?(t.preventDefault(),void O(!1)):void 0}r&&""===y.trim()&&(t.preventDefault(),O(!0),I.current&&I.current.focus({preventScroll:!0}))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[y,P,p,e]),(0,a.useEffect)(()=>{const e=e=>{I.current&&(I.current.contains(e.target)||P&&O(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[P]),(0,a.useEffect)(()=>{""!==y&&P&&O(!1)},[y,P]);const R=(e,t)=>{j({index:t,element:e.currentTarget})},z=()=>{j(null)};return(0,a.useEffect)(()=>{const e=e=>{an(p,n)||(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[p,n]),(0,D.jsxs)(l.A,{children:[(0,D.jsxs)(g.Ay,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,sx:{p:0,mb:c&&1,mr:!c&&2},children:"Email Recipients:"})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,D.jsxs)(g.Ay,{ref:I,id:"emails-container",tabIndex:-1,container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%",outline:"none"},children:[p.map((e,t)=>(0,D.jsx)(g.Ay,{item:!0,sx:{m:.5},children:(0,D.jsx)(S.A,{label:e,onDelete:()=>k(t),onClick:e=>R(e,t),onContextMenu:e=>{e.preventDefault(),R(e,t)},color:P||Boolean(b)&&b.index===t?"primary":"default"})},t)),p.length<150?(0,D.jsx)(g.Ay,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,D.jsx)(Zt.A,{inputRef:E,fullWidth:!0,variant:"standard",value:y,onChange:e=>{const t=e.target.value,n=e.nativeEvent||{},a=(n.inputType||"").toString(),r=!!n.isComposing||!!e.isComposing;if(f(t),""!==t&&C("Finalize currently edited email by pressing Enter/Return"),r)return void(M.current=t);const o=t.trim(),l=/insertReplacementText|insertFromPaste|insertFromDrop|insertFromAutocomplete/i.test(a),s=""===M.current&&t.length>1&&"insertText"!==a;(0,_.DT)(o)&&(l||s)&&setTimeout(()=>T(t),0),M.current=t},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&T(y)},onPaste:e=>{const t=e.clipboardData.getData("text");e.preventDefault();const n=t.split(/[\s,;\t]+/).map(e=>e.trim()).filter(e=>""!==e);n.forEach(e=>T(e,n.length>1)),f("")},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,D.jsxs)(d.A,{sx:{mt:1},spacing:1,alignItems:c?"stretch":"end",children:[(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,D.jsxs)(h.A,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[p.length," / ",150," recipient",p.length>1?"s":null," added"]}),(0,D.jsx)(kt.A,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),f(""),x([])},children:"Clear All"})]}),0===n.length?(0,D.jsx)(Le.A,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,D.jsx)(zt.A,{title:w,enterTouchDelay:0,children:(0,D.jsx)("span",{children:(0,D.jsx)(Me.A,{onClick:e=>{const t=(0,_.OP)(e)?e:(0,_.OP)(p)?p:[];o.mutate(t)},variant:"contained",sx:{width:c?"100%":"fit-content"},disabled:!A||o.isPending,children:o.isPending?(0,D.jsx)(en.A,{disableShrink:!0,color:"inherit",size:"1.5rem"}):"SAVE EMAIL LIST"})})})]}),(0,D.jsxs)(u.A,{anchorEl:null===b||void 0===b?void 0:b.element,open:Boolean(b),onClose:z,children:[(0,D.jsx)(s.A,{onClick:()=>{var e;e=b.index,f(p[e]),k(e),z()},children:"Edit"}),(0,D.jsx)(s.A,{onClick:()=>{(t=>{const n=p[t];n&&navigator.clipboard.writeText(n).then(()=>{e("Copied to clipboard: ".concat(n),we.n.success)}).catch(()=>{e("Failed to copy email to clipboard.",we.n.error)})})(b.index),z()},children:"Copy"})]})]})};var on=n(86328),ln=n(95540),sn=n(25776),dn=n(38409),cn=n(55722);const un={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,D.jsx)(dn.A,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,D.jsx)(cn.A,{})}},hn={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:"\u2265",name:"above"}},pn=un,xn="ADD",mn="EDIT",An="DELETE",gn="Location",vn="Data Type",yn="Days",fn="Created By",bn="id",jn="alert_type",wn="sensor_id",Sn="location_short",Cn="datatypekey",Dn="threshold_value",Tn="days_of_week",kn="minutespastmidnight",In="time_range",En="is_enabled",Mn="excluded_dates",Pn="owner_role",On="self_is_owner",Rn="is_allowed_to_modify",_n="message",zn="max_once_a_day",Wn="parent_alert_id",Ln="child_alert",Fn="has_child_alert",Bn=function(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pn.daily.id;return n===pn.threshold.id&&(e=hn.above_threshold.id,t=hn.below_threshold.id),{[bn]:"",[jn]:e||n,[wn]:"",[Cn]:"",[Tn]:[0,1,2,3,4],[In]:n===pn.threshold.id?[Ve.schoolHour.start,Ve.schoolHour.end]:null,[Dn]:-1,[kn]:"",[En]:!0,[Mn]:[],[_n]:"",[zn]:!0,[Wn]:null,[Fn]:!1,[Ln]:n===pn.threshold.id?{[jn]:t||n,[Dn]:-1,[_n]:""}:null}},Hn=function(){const e=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];return e.forEach(t=>{if(!t)return;if(!!t[Wn]){const n=e.find(e=>e[bn]===t[Wn]);n&&(n[Fn]=!0,n[Ln]={[bn]:t[bn],[jn]:t[jn],[Dn]:t[Dn],[_n]:t[_n]})}else{if(t[jn]===pn.daily.id)return;t[Fn]=!1,t[Ln]={[jn]:t[jn]===hn.above_threshold.id?hn.below_threshold.id:hn.above_threshold.id,[Dn]:t[Dn],[_n]:""}}}),e};var Vn=n(20067),Un=n.n(Vn),Nn=n(98533);function Yn(e){const{onConfirmedDelete:t}=e,[n,r]=(0,a.useState)(!1),o=(0,v.A)();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Me.A,{variant:"text",color:"error",onClick:()=>{r(!0)},children:"Delete"}),(0,D.jsxs)(Lt.A,{open:n,onClose:()=>{r(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,D.jsx)(Bt.A,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,D.jsx)(Ht.A,{children:(0,D.jsx)(Nn.A,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,D.jsxs)(Ft.A,{sx:{justifyContent:"end"},children:[(0,D.jsx)(Me.A,{onClick:()=>{r(!1)},sx:{color:o.palette.text.secondary},children:"Cancel"}),(0,D.jsx)(Me.A,{onClick:()=>{t(),r(!1)},children:"Delete"})]})]})]})}const qn={[xn]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[mn]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[An]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}};var Kn=n(39423),Qn=n(20389),Gn=n(69413),Xn=n(74605);const $n=e=>{const{label:t="Optional Message",value:n,handleChange:a,maxLength:r,showTip:o=!0,disabled:s}=e,i=n?n.length:0;return(0,D.jsxs)(d.A,{direction:"column",children:[(0,D.jsx)(Zt.A,{label:t,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:r},value:n||"",onChange:e=>{a(e)},disabled:s}),(0,D.jsxs)(d.A,{direction:"row",gap:1,justifyContent:"space-between",sx:{mx:1,my:.5},children:[o?(0,D.jsx)(h.A,{color:"text.secondary",variant:"caption",children:"Optional message that will appear in the alert"}):(0,D.jsx)(l.A,{}),(0,D.jsxs)(h.A,{color:"text.secondary",variant:"caption",textAlign:"right",children:[i,"/",r]})]})]})},Jn=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];var Zn=n(60446),ea=n.n(Zn),ta=n(34576),na=n(58390),aa=n(77857),ra=n(64021);const oa=["day","selectedDates"],la=(0,o.Ay)(aa.a,{shouldForwardProp:e=>"selected"!==e})(e=>{let{theme:t,selected:n}=e;return(0,r.A)({},n&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"})}),sa=e=>{const{day:t,selectedDates:n}=e,a=(0,Ne.A)(e,oa),o=n.includes(ea()(t).format("YYYY-MM-DD"));return(0,D.jsx)(la,(0,r.A)((0,r.A)({},a),{},{day:t,selected:o}))};function ia(e){const{selectedDates:t,handleChange:n,disabled:a}=e,o=t.map(e=>ea()(e).format("YYYY-MM-DD")),l=t.length,s=l>0?"Excluded Dates (".concat(l," Days)"):"Excluded Dates";return(0,D.jsxs)(Ut,{dialogTitle:s,buttonLabel:s,buttonVariant:"text",disabled:a,maxWidth:"xs",displaySchoolID:!1,children:[(0,D.jsxs)(h.A,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,D.jsx)("b",{children:"NOT"})," want to receive alerts.",(0,D.jsx)("br",{}),"Useful for holidays or school breaks."]}),(0,D.jsx)(kt.A,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),n(t)},children:"Clear All"}),(0,D.jsx)(na.$,{dateAdapter:ta.R,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,D.jsx)(ra.x,{displayWeekNumber:!0,slots:{day:e=>(0,D.jsx)(sa,(0,r.A)((0,r.A)({},e),{},{selectedDates:o}))},onChange:(e,t)=>{"finish"===t&&n([ea()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:ea()().startOf("month")})})]})}function da(e){const{daysOfWeek:t,excludedDates:n,handleDaysOfWeekChange:a,handleExcludedDatesChange:r,disabled:o}=e,s=(0,v.A)();return(0,D.jsxs)(g.Ay,{container:!0,rowSpacing:.5,columnSpacing:2,alignItems:"center",justifyContent:"stretch",children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,D.jsxs)(d.A,{direction:"row",gap:1,alignItems:"start",children:[(0,D.jsx)(l.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:o?s.palette.text.secondary:s.palette.primary.main,verticalAlign:"middle"}},children:(0,D.jsx)(cn.A,{sx:{mt:.75}})}),(0,D.jsx)(he.A,{value:t||Bn()[Tn],onChange:a,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:o,color:o?"standard":"primary",children:Jn.map(e=>(0,D.jsx)(zt.A,{title:e.label,arrow:!0,children:(0,D.jsx)(pe.A,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value))})]})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,md:6,ml:{xs:3,sm:0},children:(0,D.jsx)(ia,{selectedDates:n,disabled:o,handleChange:r})})]})}var ca=n(74681),ua=n(3147),ha=n(84834);const pa=e=>{const{min:t=0,max:n=100,value:o,defaultValue:l,stepsForThreshold:s=1,marks:i=null,handleChange:d,disabled:c,backgroundCssGradient:u,invertSelection:p=!1,showInput:x=!0,inputUnit:m,valueLabelDisplay:A="on",showTip:y=!0}=e,f=(0,v.A)(),[b,j]=(0,a.useState)(p?o||l:t),[w,S]=(0,a.useState)(p?n:o||l),[C,T]=(0,a.useState)(-1),[k,I]=(0,a.useState)(!1),[E,M]=(0,a.useState)(""),P=(0,a.useCallback)(e=>{if(!i)return-1;const t=i.filter(t=>t.value>=e);if(0===t.length)return-1;const n=t.reduce((t,n)=>n.value-e<t.value-e?n:t),a=i.indexOf(n);return p?a-1:a},[i,p]);(0,a.useEffect)(()=>{const e=p?o:t,a=p?n:o;j(e),S(a),T(P(p?e:a))},[P,p,o,n,t]);const O="repeating-linear-gradient(-45deg, ".concat(ca.A[800],", ").concat(ca.A[800]," 4px, ").concat(ua.A.white," 4px, ").concat(ua.A.white," 8px)"),R={height:"20vh",minHeight:"250px",maxHeight:"500px",cursor:c?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:ua.A.black},['& .MuiSlider-thumb[data-index="'.concat(p?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:f.palette.background.paper,backgroundImage:f.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:c?ca.A[400]:u},"& .MuiSlider-track":(0,r.A)({background:O},p?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}),['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(C,'"]')]:{color:f.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:f.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(g.Ay,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,D.jsx)(g.Ay,{item:!0,xs:"auto",minWidth:"4.5rem",children:x?(0,D.jsx)(Zt.A,{variant:"standard",type:"number",label:"Threshold",value:p?b:w,onChange:e=>{const a=""===e.target.value?"":Number(e.target.value);a&&""!==a||d(a),""!==a&&a>=t&&a<=n?(j(p?a:t),S(p?n:a),d(a),T(P(a)),I(!1),M("")):(I(!0),M("Threshold must be between ".concat(t," and ").concat(n)))},error:k,helperText:E,size:"small",fullWidth:!0,disabled:c,inputProps:{step:s,min:t,max:n,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),m?(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(h.A,{variant:"body2",children:m})}):null]}),(0,D.jsx)(g.Ay,{item:!0,xs:12,sx:{mt:2,ml:7.5},children:(0,D.jsx)(ha.Ay,{getAriaLabel:()=>"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[b,w],step:null===i?s:null,marks:i,disabled:c,min:t,max:n,onChange:(e,a)=>{const r=a[p?0:1];j(p?r:t),S(p?n:r),d(r),T(P(r))},valueLabelDisplay:A,orientation:"vertical",sx:R})}),(0,D.jsx)(g.Ay,{item:!0,sx:{mt:1,ml:1,visibility:!0===y?"visible":"hidden"},children:(0,D.jsx)(h.A,{color:"text.secondary",variant:"caption",display:"block",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})},xa=(0,a.createContext)();function ma(e){let{children:t}=e;const{data:n}=(0,Dt.A)(),[o,l]=(0,a.useState)(Bn()),[s,i]=(0,a.useState)(o),[d,c]=(0,a.useState)([]),u=(0,a.useCallback)(e=>{if(!n)return[];const{sensors:t}=n;if(!(0,_.OP)(t))return[];const a=t.find(t=>t.sensor_id===e),r=null===a||void 0===a?void 0:a.allowedDataTypes;return r?r.map(e=>({value:e,label:x.Uy[e].name_title})):[]},[n]);(0,a.useEffect)(()=>{i((0,r.A)({},o))},[o]),(0,a.useEffect)(()=>{const e=s[wn];e&&""!==e&&c(u(e))},[s,u]);const h=(0,a.useMemo)(()=>({selectedAlert:o,setSelectedAlert:l,editingAlert:s,setEditingAlert:i,allowedDataTypesForSensor:d,setAllowedDataTypesForSensor:c}),[o,s,d]);return(0,D.jsx)(xa.Provider,{value:h,children:t})}const Aa=e=>{const{value:t,invertSelection:n,handleValueChange:r,placeholderValueBeforeDataTypeSelection:o=.5,disabledSlider:l,showTip:s=!0}=e,{editingAlert:i}=(0,a.useContext)(xa),{language:d}=(0,a.useContext)(bt.j),c=(0,v.A)();let u=null;const h=i[Cn];if(h&&x.Uy[h]){const e=x.Uy[h],a=c.palette.chart.colorAxes[e.color_axis],{colors:o,minValue:p,maxValue:m,defaultValueForAlert:A,stepsForThreshold:g}=a,v=B({gradientDirection:"to top",colors:o});let y,f;switch(h){case x.vV.voc:f=ge.ZS;break;case x.vV.aqi:case x.vV.pm2_5:case x.vV.pm10_raw:case x.vV.co2:f=ge.m7;break;case x.vV.heat_index_C:f=ge.RZ;break;default:f=null}f&&(y=f.filter((e,t)=>0!==t).map(t=>({value:t[e.threshold_mapping_name].low,label:(0,_.sC)(t.category,d)})));const b=Object.keys(x.Uy).filter(e=>e===i[Cn]).map(e=>x.Uy[e].unit)[0];u=(0,D.jsx)(pa,{min:p,max:m,marks:y,defaultValue:A,value:t,stepsForThreshold:g,disabled:l,backgroundCssGradient:v,invertSelection:n,handleChange:r,inputUnit:b,showTip:s})}else u=(0,D.jsx)(pa,{min:0,max:1,value:o,disabled:!0,showInput:!1,invertSelection:n,valueLabelDisplay:"off",showTip:s});return u};var ga=n(81673);const va=e=>{let{value:t,handleChange:n,disabled:a}=e;return(0,D.jsxs)(y.A,{component:"fieldset",variant:"standard",sx:{mt:{md:-1}},disabled:a,children:[(0,D.jsx)(Gn.A,{children:(0,D.jsx)(Xn.A,{control:(0,D.jsx)(b.A,{checked:t,onChange:n,size:"small"}),label:(0,D.jsx)(h.A,{color:"text.secondary",fontWeight:500,children:"Max Once a Day"}),color:"text.secondary"})}),(0,D.jsx)(ga.A,{sx:{mt:-.5},children:!0===t?(0,D.jsxs)(D.Fragment,{children:["Send alert ",(0,D.jsx)("strong",{children:"at most once a day"})," when the threshold is breached"]}):(0,D.jsxs)(D.Fragment,{children:["Send alert ",(0,D.jsx)("strong",{children:"every hour"})," for as long as the threshold is breached"]})})]})},ya=["currentAlertType","handleChange","disabled"],fa=["currentAlertType"],ba=e=>{let{currentAlertType:t,handleChange:n,disabled:a}=e,o=(0,Ne.A)(e,ya);return(0,D.jsx)(he.A,(0,r.A)((0,r.A)({color:a?"standard":"primary",disabled:a,defaultValue:hn.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:n},o),{},{children:Object.keys(hn).map(e=>{const t=hn[e];return(0,D.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)})}))},ja=e=>{let{currentAlertType:t}=e,n=(0,Ne.A)(e,fa);return(0,D.jsx)(he.A,(0,r.A)((0,r.A)({color:"standard",disabled:!0,defaultValue:hn.below_threshold.id,value:t,exclusive:!0,"aria-label":"non-interactive button displaying threshold type",size:"small"},n),{},{children:Object.keys(hn).map(e=>{const n=hn[e];return n.id!==t?null:(0,D.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:n.id,"aria-label":n.id,children:[n.sign,"\xa0",n.name]},n.id)})}))},wa=e=>{const t=e[En]?"enabled":"disabled",n=e[bn]?"is":"will be";return"This alert ".concat(n," ").concat(t)},Sa=e=>{var t,n,o,l;let{alertTypeKey:s,crudType:i}=e;const{data:c}=(0,Dt.A)(),{editingAlert:u,allowedDataTypesForSensor:p,setEditingAlert:m}=(0,a.useContext)(xa),A=(0,v.A)(),y=null===c||void 0===c||null===(t=c.sensors)||void 0===t?void 0:t.map(e=>({value:e.sensor_id,label:(0,_.Cn)(e.location_short)})),f=e=>{switch(e){case wn:case En:return!1;case Cn:return u[wn]===Bn(s)[wn];case Ln:return!0!==u[Fn];default:return u[Cn]===Bn(s)[Cn]}};return(0,D.jsxs)(d.A,{direction:"column",gap:2,mt:1,width:"100%",children:[null!==(n=qn[i])&&void 0!==n&&n.contentText?(0,D.jsx)(Nn.A,{fontWeight:"500",children:qn[i].contentText}):null,(0,D.jsxs)(d.A,{direction:"row",gap:1,alignItems:"center",mb:2,children:[(0,D.jsx)(w.A,{size:"small",checked:u[En],onChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[En]:e.target.checked}))},disabled:f(En)}),(0,D.jsx)(h.A,{fontWeight:500,color:"text.secondary",children:wa(u)})]}),(0,D.jsxs)(g.Ay,{container:!0,columnSpacing:2,alignItems:"center",children:[(0,D.jsx)(g.Ay,{item:!0,xs:6,children:(0,D.jsx)(qe,{icon:(0,D.jsx)(Qn.A,{}),label:gn,value:u[wn],options:y,disabled:f(wn),handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[wn]:e.target.value,[Cn]:""}))}})}),(0,D.jsx)(g.Ay,{item:!0,xs:6,children:(0,D.jsx)(qe,{label:vn,value:u[Cn],options:p,disabled:f(Cn),handleChange:e=>{var t,n;const a=e.target.value,o=x.Uy[a];m((0,r.A)((0,r.A)({},u),{},{[Cn]:a,[Dn]:null===(t=A.palette.chart.colorAxes[o.color_axis])||void 0===t?void 0:t.defaultValueForAlert,[Ln]:(0,r.A)((0,r.A)({},u[Ln]),{},{[Dn]:null===(n=A.palette.chart.colorAxes[o.color_axis])||void 0===n?void 0:n.defaultValueForChildAlert})}))},flex:1})})]}),(0,D.jsx)(da,{daysOfWeek:u[Tn],excludedDates:u[Mn]||[],disabled:f(Tn),handleDaysOfWeekChange:(e,t)=>{const n=Array.isArray(t)?t:[];m((0,r.A)((0,r.A)({},u),{},{[Tn]:n.sort()}))},handleExcludedDatesChange:e=>{const t=u[Mn]||[],n=e.reduce((e,t)=>e.includes(t)?e.filter(e=>e!==t):[...e,t],t);m((0,r.A)((0,r.A)({},u),{},{[Mn]:n}))}}),(()=>{switch(s){case pn.daily.id:return(0,D.jsx)(qe,{icon:(0,D.jsx)(Kn.A,{}),label:pn.daily.tableColumnHeader,value:u[kn],options:He,disabled:f(kn),handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[kn]:e.target.value}))}});case pn.threshold.id:return(0,D.jsxs)(g.Ay,{container:!0,columnSpacing:2,rowSpacing:.5,children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,D.jsx)(Ke,{timeRange:u[In],defaultTimeRange:Bn(pn.threshold.id)[In],disabled:f(In),handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[In]:e}))}})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,D.jsx)(va,{value:u[zn],handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[zn]:e.target.checked}))},disabled:f(zn)})})]});default:return null}})(),s===pn.threshold.id?(0,D.jsxs)(g.Ay,{container:!0,alignItems:"start",spacing:2,children:[(0,D.jsxs)(g.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,children:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mt:"2px",mb:"12px"},children:"1. Alert if it is:"})}),(0,D.jsx)(g.Ay,{item:!0,sx:{mr:2},children:(0,D.jsx)(ba,{currentAlertType:u[jn],handleChange:e=>{const t=e.target.value,n=t===hn.above_threshold.id?hn.below_threshold.id:hn.above_threshold.id;m((0,r.A)((0,r.A)({},u),{},{[jn]:t,[Ln]:(0,r.A)((0,r.A)({},u[Ln]),{},{[jn]:n})}))},disabled:f(jn),sx:{height:"100%"}})}),(0,D.jsx)(Aa,{value:u[Dn],invertSelection:u[jn]===hn.below_threshold.id,handleValueChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[Dn]:e}))},disabledToggle:f(jn),disabledSlider:f(Dn),placeholderValueBeforeDataTypeSelection:2/3}),(0,D.jsx)(g.Ay,{item:!0,xs:12,mt:2,children:(0,D.jsx)($n,{value:u[_n],handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[_n]:e.target.value}))},maxLength:200,label:"Optional Message for Main Alert",disabled:f(_n)})})]}),(0,D.jsxs)(g.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,children:(0,D.jsx)(Gn.A,{children:(0,D.jsx)(Xn.A,{disabled:f(Fn),control:(0,D.jsx)(b.A,{checked:!!u[Fn],onChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[Fn]:e.target.checked}))},size:"small"}),label:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",children:"2. [Optional] Follow-up alert if it changes to:"}),color:"text.secondary"})})}),u[Ln]&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(g.Ay,{item:!0,sx:{mr:2},children:(0,D.jsx)(ja,{currentAlertType:null===(o=u[Ln])||void 0===o?void 0:o[jn],sx:{height:"100%"}})}),(0,D.jsx)(Aa,{value:u[Ln][Dn],invertSelection:(null===(l=u[Ln])||void 0===l?void 0:l[jn])===hn.below_threshold.id||!0,handleValueChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[Ln]:(0,r.A)((0,r.A)({},u[Ln]),{},{[Dn]:e})}))},disabledToggle:f(Ln),disabledSlider:f(Ln),showTip:!1,placeholderValueBeforeDataTypeSelection:1/3}),(0,D.jsx)(g.Ay,{item:!0,xs:12,mt:2,children:(0,D.jsx)($n,{value:u[Ln][_n],handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[Ln]:(0,r.A)((0,r.A)({},u[Ln]),{},{[_n]:e.target.value})}))},maxLength:200,label:"Optional Message for Follow-up Alert",showTip:!1,disabled:f(Ln)})})]})]})]}):(0,D.jsx)($n,{value:u[_n],handleChange:e=>{m((0,r.A)((0,r.A)({},u),{},{[_n]:e.target.value}))},maxLength:200,disabled:f(_n)})]})},Ca=()=>{const e=(0,tn.jE)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{user:n}=(0,a.useContext)(Nt.R);return(0,nn.n)({mutationFn:async e=>{let{alertId:n,alertToEdit:a}=e;const r=(0,De.BW)({endpoint:Te.tK.alerts,school_id:t,alert_id:n});return(0,Ce.i)({url:r,restMethod:Te.Xo.PUT,body:a})},onSuccess:(a,r)=>{let{alertId:o}=r;e.setQueryData([Te.tK.alerts,t,n.username||n.email],function(){return Hn((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(e=>e[bn]===o?a:e))})}})},Da=e=>{var t;const{alertTypeKey:n,openAlertModificationDialog:o,crudType:l,handleClose:s}=e,{selectedAlert:c,setSelectedAlert:u,editingAlert:h,setEditingAlert:p}=(0,a.useContext)(xa),[x,A]=(0,a.useState)(!1),{enqueueSnackbar:g}=(0,je.dh)(),y=(0,v.A)(),f=e=>{const t=(0,r.A)({},e);return delete t[Ln],delete t[Fn],t},b=(e,t)=>{const n=(0,r.A)((0,r.A)((0,r.A)({},e),e[Ln]),{},{[Wn]:t,[bn]:null});return delete n[Ln],delete n[Fn],n},j=e=>{g(qn[e].successMessage,we.n.success),s()},w=e=>{g(qn[e].errorMessage,we.n.error)},S=e=>{let{passedCrudType:t}=e;const a=(()=>{var e;if(n===pn.daily.id)return{valid:!0};if(!h[Fn])return{valid:!0};const t=h[jn]===hn.above_threshold.id,a=h[Dn],r=null===(e=h[Ln])||void 0===e?void 0:e[Dn];return void 0===r?{valid:!0}:t&&a<=r||!t&&a>=r?{valid:!1,message:"The follow-up alert must have a ".concat(t?"lower":"higher"," threshold than the first alert")}:{valid:!0}})();if(a.valid)switch(t){case xn:T.mutate({alertToCreate:f(h)},{onSuccess:e=>{j(t);const a=Bn(n);if(u(a),p(a),!h[Fn])return;const r=e[bn];null!==r&&void 0!==r&&T.mutate({alertToCreate:b(h,r)},{onError:()=>w(t)})}});break;case mn:{const e=c[bn];k.mutate({alertId:e,alertToEdit:f(h)},{onSuccess:()=>{var n;j(t);const a=null===(n=h[Ln])||void 0===n?void 0:n[bn];if(h[Fn]||null===a||void 0===a){const t=b(h,e);null===a||void 0===a?T.mutate({alertId:e,alertToCreate:t}):k.mutate({alertId:a,alertToEdit:t})}else I.mutate({alertId:a},{onSuccess:()=>j(An),onError:()=>w(An)})}});break}}else g(a.message,we.n.error)};(0,a.useEffect)(()=>{var e,t;if((null===(e=h[In])||void 0===e?void 0:e[0])>(null===(t=h[In])||void 0===t?void 0:t[1]))A(!0);else switch(l){case xn:const e=Bn(n);h[wn]===e[wn]||h[Cn]===e[Cn]?n===pn.daily.id?A(h[kn]===e[kn]):A(!0):n===pn.daily.id?A(h[kn]===e[kn]):A(!1);break;case mn:let t;t=n===pn.daily.id?h[kn]:h[Dn];const a=h[Cn];if(!t||""===t||!a||""===a){A(!0);break}A(Un()(c,h));break;default:A(!1)}},[l,c,h,n]);const C=(0,i.A)(e=>e.breakpoints.down("md")),T=(()=>{const e=(0,tn.jE)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{user:n}=(0,a.useContext)(Nt.R);return(0,nn.n)({mutationFn:async e=>{let{alertToCreate:n}=e;const a=(0,De.BW)({endpoint:Te.tK.alerts,school_id:t});return(0,Ce.i)({url:a,restMethod:Te.Xo.POST,body:n})},onSuccess:a=>{e.setQueryData([Te.tK.alerts,t,n.username||n.email],function(){return Hn([...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a])})}})})(),k=Ca(),I=(()=>{const e=(0,tn.jE)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{user:n}=(0,a.useContext)(Nt.R);return(0,nn.n)({mutationFn:async e=>{let{alertId:n}=e;const a=(0,De.BW)({endpoint:Te.tK.alerts,school_id:t,alert_id:n});return(0,Ce.i)({url:a,restMethod:Te.Xo.DELETE})},onSuccess:(a,r)=>{let{alertId:o}=r;e.setQueryData([Te.tK.alerts,t,n.username||n.email],function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(e=>e[bn]!==o);return Hn(e)})}})})();return(0,D.jsxs)(Lt.A,{open:o,onClose:s,"aria-labelledby":"alert-modification-dialog",maxWidth:"md",fullWidth:!0,fullScreen:C,children:[(0,D.jsx)(Bt.A,{id:"alert-modification-dialog",children:null===(t=qn[l])||void 0===t?void 0:t.title}),(0,D.jsx)(Ht.A,{children:(0,D.jsx)(Sa,{alertTypeKey:n,crudType:l})}),(0,D.jsxs)(Ft.A,{sx:{justifyContent:"space-between"},children:[l===mn?(0,D.jsx)(Yn,{onConfirmedDelete:()=>{I.mutate({alertId:c.id},{onSuccess:()=>j(An),onError:()=>w(An)})}}):null,(0,D.jsxs)(d.A,{direction:"row",width:"100%",justifyContent:"end",children:[(0,D.jsx)(Me.A,{onClick:s,sx:{color:y.palette.text.secondary},children:"Cancel"}),(0,D.jsx)(Me.A,{onClick:()=>{S({passedCrudType:l})},color:"primary",disabled:x,children:"Save Edit"})]})]})]})};var Ta=n(73523),ka=n(63572);const Ia=e=>{if(!e||!(0,_.OP)(e))return"N/A";if(e.length===Jn.length)return"Everyday";const t=Jn.filter(t=>!e.includes(t.value));return 2===t.length&&t.every(e=>[5,6].includes(e.value))?"Only weekdays":e.map(e=>{var t;return null===(t=Jn.find(t=>t.value===e))||void 0===t?void 0:t.label.slice(0,2)}).join(", ")},Ea=(e,t)=>t?"":e&&ka.fo[e]?"".concat(ka.fo[e].name," added your email to this school-wide alert. For edit or removal, please reach out to ").concat(ka.fo[e].name,"."):void 0,Ma=e=>{var t;const{selectedAlert:n,setSelectedAlert:o}=(0,a.useContext)(xa),{enqueueSnackbar:s}=(0,je.dh)(),{alertTypeKey:i,alertsForTable:c}=e,u=(0,v.A)(),[h,p]=(0,a.useState)(!1),[m,A]=(0,a.useState)(null),g=e=>{let{alert:t,crudType:n}=e;o(t),A(n),p(!0)},y=Ca();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(d.A,{spacing:2,alignItems:"center",children:[(0,D.jsx)(l.A,{sx:{width:"100%",overflowX:"auto"},children:(0,_.OP)(c)?(0,D.jsxs)(It.A,{size:"small",sx:{my:1},children:[(0,D.jsx)(Et.A,{children:(0,D.jsxs)(Mt.A,{children:[(0,D.jsx)(Pt.A,{sx:{px:0}}),(0,D.jsx)(Pt.A,{children:gn}),(0,D.jsx)(Pt.A,{children:vn}),(0,D.jsx)(Pt.A,{children:yn}),(0,D.jsx)(Pt.A,{children:(null===(t=pn[i])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,D.jsx)(Pt.A,{children:fn})]})}),(0,D.jsx)(Ta.A,{component:Ot.A,children:(0,_.OP)(c)?c.map((e,t)=>{return(0,D.jsx)(on.A,{children:(0,D.jsxs)(Mt.A,{sx:{background:e[bn]===n[bn]&&u.palette.background.NYUpurpleLight,textDecoration:!1===e[En]?"line-through":"none"},children:[(0,D.jsxs)(Pt.A,{sx:{px:0},children:[(0,D.jsx)(zt.A,{title:!1===e[Rn]?Ea(e[Pn],e[Rn]):"Click to ".concat(e[En]?"disable":"enable"," alert"),children:(0,D.jsx)("span",{onClick:()=>{(e=>{if(!1===e[Rn])return void s(Ea(e[Pn],e[Rn]),we.n.warning);const t=!e[En];y.mutate({alertId:e[bn],alertToEdit:(0,r.A)((0,r.A)({},e),{},{[En]:t})},{onSuccess:()=>s("This alert is now ".concat(t?"enabled":"disabled"),we.n.success),onError:e=>s((null===e||void 0===e?void 0:e.message)||"There was an error ".concat(t?"enabling":"disabling"," this alert, try again!"),we.n.error)})})(e)},style:{display:"inline-block"},children:(0,D.jsx)(w.A,{size:"small",disabled:!1===e[Rn],checked:e[En]})})}),(0,D.jsx)(zt.A,{title:!1===e[Rn]?Ea(e[Pn],e[Rn]):"Edit alert",children:(0,D.jsx)("span",{onClick:()=>{!1!==e[Rn]?g({alert:e,crudType:mn}):s(Ea(e[Pn],e[Rn]),we.n.warning)},style:{display:"inline-block"},children:(0,D.jsx)(Wt.A,{"aria-label":"edit",size:"small",disabled:!1===e[Rn],sx:{"&:hover,:focus":{color:u.palette.primary.main}},children:(0,D.jsx)(ln.A,{})})})})]}),(0,D.jsx)(Pt.A,{sx:{textTransform:"capitalize"},children:e[Sn]}),(0,D.jsx)(Pt.A,{children:Object.keys(x.Uy).filter(t=>t===e[Cn]).map(e=>x.Uy[e].name_title)[0]}),(0,D.jsx)(Pt.A,{children:Ia(e[Tn])}),i===pn.threshold.id?(0,D.jsxs)(Pt.A,{children:[hn[e[jn]].sign," ",e[Dn],"\xa0",Object.keys(x.Uy).filter(t=>t===e[Cn]).map(e=>x.Uy[e].unit)[0]]}):null,i===pn.daily.id?(0,D.jsx)(Pt.A,{children:Be(e[kn])}):null,(0,D.jsx)(Pt.A,{children:(0,D.jsx)(S.A,{label:(a=e[Pn],o=e[On],!0===o?"You":a?ka.fo[a].name:"N/A"),size:"small"})})]})},t);var a,o}):null})]}):(0,D.jsxs)(Le.A,{severity:"warning",sx:{mt:2},children:["No ",pn[i].name.toLowerCase()," alert has been set up"]})}),(0,D.jsx)(Me.A,{variant:"outlined",startIcon:(0,D.jsx)(sn.A,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>g({alert:Bn(i),crudType:xn}),children:"Add Alert"})]}),(0,D.jsx)(Da,{alertTypeKey:i,crudType:m,openAlertModificationDialog:h,handleClose:()=>{p(!1),o(Bn(i))}})]})},Pa=["children","value","index","alertType","alertsArray"];function Oa(e){const{children:t,value:n,index:a,alertType:o,alertsArray:s}=e,i=(0,Ne.A)(e,Pa);return(0,D.jsx)(l.A,(0,r.A)((0,r.A)({role:"tabpanel",hidden:n!==a,id:"alert-tabpanel-".concat(o.id),"aria-labelledby":"alert-tab-".concat(o.id),width:"100%"},i),{},{children:(0,D.jsx)(Ma,{alertTypeKey:o.id,alertsForTable:s})}))}function Ra(){const{setSelectedAlert:e}=(0,a.useContext)(xa),{data:t}=(()=>{var e;const{currentSchoolID:t}=(0,a.useContext)(m.C),{authenticationState:n,user:o}=(0,a.useContext)(Nt.R),l=(0,Se.I)({queryKey:[Te.tK.alerts,t,o.username||o.email],queryFn:async()=>{const e=await(0,Ce.i)({url:(0,De.BW)({endpoint:Te.tK.alerts,school_id:t})});return(0,_.OP)(e)?Hn(e):[]},enabled:!!t&&!!n.authenticated,staleTime:0,retry:!1,refetchOnWindowFocus:!1});return(0,r.A)((0,r.A)({},l),{},{data:null!==(e=l.data)&&void 0!==e?e:[]})})(),n=(0,i.A)(e=>e.breakpoints.down("sm")),[o,s]=(0,a.useState)(0),d=e=>{const n=t.filter(t=>{var n;if(!t)return null;const a=null===(n=t[jn])||void 0===n?void 0:n.toLowerCase(),r=t[Wn];return!a.includes(e)||null!==r&&void 0!==r?null:t});return{array:n,alertsLength:(0,_.OP)(n)?n.length:"0"}};return(0,D.jsxs)(l.A,{children:[(0,D.jsx)(tt,{value:o,onChange:(t,n)=>{var a,r;s(n),e(Bn(null===(a=pn[null===(r=Object.keys(pn))||void 0===r?void 0:r[n]])||void 0===a?void 0:a.id))},variant:n?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(pn).map(e=>{const t=d(e.id);return(0,D.jsx)(c.A,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)})}),Object.values(pn).map(e=>{const t=d(e.id);return(0,D.jsx)(Oa,{alertType:e,value:o,index:e.index,alertsArray:t.array},e.id)})]})}function _a(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Yt(t),{user:r}=(0,a.useContext)(Nt.R),o=[ka.fo.admin.id,ka.fo.school.id].includes(null===r||void 0===r?void 0:r.user_role);return(0,D.jsx)(Ut,{buttonIcon:(0,D.jsx)(Jt.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:n,children:(0,D.jsxs)(d.A,{width:"100%",spacing:o?5:2,children:[(0,D.jsx)(ma,{children:(0,D.jsx)(Ra,{})}),o?(0,D.jsx)(rn,{}):(0,D.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,D.jsx)("b",{children:null===r||void 0===r?void 0:r.email})]})]})})}var za=n(50269),Wa=n(21122);const La=e=>{let{onLoginSuccess:t,children:n}=e;const r=(0,a.useRef)(null),{enqueueSnackbar:o}=(0,je.dh)(),{setAuthenticationState:l,setUser:s}=(0,a.useContext)(Nt.R),[i,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),h=(0,a.useCallback)(()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,n=window.open(za.S.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(n){n.focus(),r.current=n;const e=setInterval(()=>{n.closed&&(clearInterval(e),window.removeEventListener("message",p),r.current=null)},500)}else alert("Popup blocked. Please enable popups for login.")},[]),p=(0,a.useCallback)(e=>{if(e.origin===window.location.origin&&e.data.type===ka.$_.password&&e.data.success){const n=e.data.user;l({checkedAuthentication:!0,authenticated:!0}),s(n),n.message&&o(n.message,we.n.success),!1===n.is_verified&&(d(!0),u(n.email)),null===t||void 0===t||t()}},[t]);return(0,a.useEffect)(()=>(window.addEventListener("message",p),()=>{window.removeEventListener("message",p)}),[p]),(0,D.jsxs)(D.Fragment,{children:[n({openLoginPopup:h}),(0,D.jsx)(Wa.A,{open:i,email:c})]})},Fa=()=>{const{loggedIn:e}=Yt(),{enqueueSnackbar:t}=(0,je.dh)();return(0,D.jsx)(La,{onLoginSuccess:()=>{t("You can now access Dataset and Alerts.",{variant:we.n.success.variant,duration:2*we.n.success.duration})},children:t=>{let{openLoginPopup:n}=t;return(0,D.jsxs)(g.Ay,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(Tt,{onButtonClick:null})}),(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(Kt,{onButtonClick:e?null:n})}),(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(ma,{children:(0,D.jsx)(_a,{onButtonClick:e?null:n})})})]})}})};var Ba=n(30922),Ha=n(78185);const Va=["tooltipTitle","label"],Ua=e=>{const{tooltipTitle:t,label:n}=e,a=(0,Ne.A)(e,Va),o=(0,D.jsx)(S.A,(0,r.A)({size:"small",label:n||(0,D.jsx)(Ha.A,{variant:"text",sx:{minWidth:"5rem"}}),sx:{userSelect:"text","& .MuiChip-label":{userSelect:"text"}}},a));return t?(0,D.jsx)(zt.A,{title:t,enterDelay:0,leaveDelay:200,children:o}):o};var Na=n(84392),Ya=n(39983);const qa=(e,t)=>(0,D.jsxs)(l.A,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[e||"Loading...",t?(0,D.jsx)(Ya.A,{}):(0,D.jsx)(Je.A,{})]}),Ka=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C),{data:t}=(0,Dt.A)(),{user:n}=(0,a.useContext)(Nt.R),r=(0,Ct.Zp)(),[o,l]=(0,a.useState)(null),i=Boolean(o),d=()=>{l(null)};if(t)return!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1?(0,D.jsx)(Ua,{icon:(0,D.jsx)(Qn.A,{}),label:t.name||"No School Name Given",tooltipTitle:"School"}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Ua,{icon:(0,D.jsx)(Qn.A,{}),label:qa(t.name,i),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{l(e.currentTarget)},"aria-controls":i?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0}),(0,D.jsx)(u.A,{anchorEl:o,open:i,onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,D.jsx)(Ba.A,{dense:!0,children:n.allowedSchools.map((t,n)=>{return(0,D.jsx)(s.A,{onClick:(a=t.school_id,()=>{e!==a&&(localStorage.setItem(Na.D.schoolID,a),mt.n(mt.s.internalNavigation,{origin_school:e,destination_school_id:a,origin_id:"school_selector"}),r("".concat(za.S.dashboard,"/").concat(a))),d()}),children:t.name},n);var a})})})]})};var Qa=n(52177);const Ga=()=>{const{data:e}=(0,Dt.A)();if(e)return(0,D.jsxs)(g.Ay,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(Ka,{})}),(0,D.jsx)(g.Ay,{item:!0,children:(0,D.jsx)(Ua,{icon:(0,D.jsx)(Qa.A,{}),label:"".concat(e.contactPerson," <").concat(e.contactEmail,">"),tooltipTitle:"Main Contact",component:"a",href:"mailto:".concat(null===e||void 0===e?void 0:e.contactEmail),clickable:!0})})]})},Xa=()=>{const e=(0,v.A)(),{data:t}=(0,Dt.A)();return t?(0,D.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,U.Ay)(t.description||"",{replace:_.H$})}):Array.from({length:3}).map((e,t)=>(0,D.jsx)(Ha.A,{variant:"text"},t))};var $a=n(54536);const Ja=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,a.useContext)(m.C);return!1===e?(0,D.jsx)(d.A,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,D.jsxs)(Me.A,{variant:"contained",onClick:()=>{t(!0)},children:[(0,D.jsx)($a.A,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null};var Za=n(61413);const er=()=>{const{currentSchoolID:e,loadMoreCharts:t}=(0,a.useContext)(m.C),{data:n}=(0,qt.A)(),{data:r}=(0,Dt.A)(),o=t?Te.HG.length:wt.JO,{themePreference:s,temperatureUnitPreference:i}=(0,a.useContext)(bt.j);return(0,D.jsxs)(l.A,{width:"100%",children:[(0,D.jsx)(gt,{}),(0,D.jsx)(yt.A,{backgroundColor:"customAlternateBackground",children:(0,D.jsxs)(lt.A,{sx:{pt:2,pb:2},children:[(0,D.jsxs)(g.Ay,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,D.jsx)(g.Ay,{item:!0,xs:12,children:(0,D.jsx)(ot.A,{text:(()=>{if(null!==r&&void 0!==r&&r.school_id)return"Air Quality | ".concat(null===r||void 0===r?void 0:r.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,children:(0,D.jsx)(Ga,{})}),(0,D.jsx)(g.Ay,{item:!0,xs:12,children:(0,D.jsx)(Fa,{})})]}),!0===(null===r||void 0===r?void 0:r.has_map)?(0,D.jsx)(Za.A,{currentSensorsData:n,schoolID:e,isOnBannerPage:!1,minMapHeight:"250px"}):(0,D.jsx)(l.A,{textAlign:"center",sx:{mb:2},children:(0,D.jsx)(ft.A,{currentSensorsData:n,isScreen:!1,temperatureUnitPreference:i})}),(0,D.jsx)(Xa,{}),(0,D.jsx)(jt.A,{})]})}),(0,D.jsx)(l.A,{id:vt.charts.id,children:Te.HG.slice(0,o).map((e,n)=>(0,D.jsx)(yt.A,{backgroundColor:n%2!==0?"customAlternateBackground":"",children:(0,D.jsxs)(lt.A,{sx:{pt:4,pb:4},height:"auto",className:s===it.A.dark?"dark":"",id:"chart-".concat(n+1),children:[(0,D.jsx)(Oe,{children:(0,D.jsx)(rt,{chartID:n})}),n===o-1&&!t&&(0,D.jsx)(Ja,{})]})},n))}),(0,D.jsx)(st.A,{})]})};var tr=n(25282);const nr=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C);(0,a.useEffect)(()=>{e&&(document.title="".concat(wt.sG," | ").concat(e.toUpperCase()))},[e]);const{setCurrentPage:t}=(0,a.useContext)(tr.B);return(0,a.useEffect)(()=>{t(za.S.dashboard)},[t]),(0,D.jsx)(er,{})}},35197:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(22555),r=n(80045),o=n(85865),l=n(78185),s=n(70579);const i=["text","sx"];function d(e){let{text:t,sx:n}=e,d=(0,r.A)(e,i);return(0,s.jsx)(o.A,(0,a.A)((0,a.A)({variant:"h4",color:"text.primary",sx:(0,a.A)({fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1},n)},d),{},{children:t||(0,s.jsx)(l.A,{variant:"text"})}))}},47298:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(71806),r=n(96446),o=n(84882),l=n(28076),s=n(10039),i=n(73460),d=n(34535),c=n(85721),u=n(8011),h=n(52687),p=n(65043),x=n(65290),m=n(94922),A=n(70579);const g=(0,d.Ay)(a.A,{shouldForwardProp:e=>"tiny"!==e})(e=>{let{theme:t,tiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}});const v=function(e){const{themePreference:t,language:n}=(0,p.useContext)(x.j),{tiny:a,hideAQIDescription:d}=e,v=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(r.A,{overflow:"auto",children:(0,A.jsxs)(g,{size:"small",tiny:a,children:[(0,A.jsx)(o.A,{children:(0,A.jsxs)(l.A,{children:[(0,A.jsx)(s.A,{sx:{pr:0},children:(0,A.jsx)(r.A,{sx:{width:"1em",height:"1em"}})}),(0,A.jsx)(s.A,{sx:{pl:1},children:"Category"}),(0,A.jsx)(s.A,{align:"right",children:"US AQI"}),(0,A.jsxs)(s.A,{align:"right",children:["PM2.5 (\xb5g/m",(0,A.jsx)("sup",{children:"3"}),")"]}),!d&&(0,A.jsx)(s.A,{align:"left",children:"Description"}),!d&&(0,A.jsxs)(s.A,{align:"left",children:[m.sG,"' Suggested Actions"]})]})}),(0,A.jsx)(i.A,{children:h.m7.map((e,a)=>(0,A.jsxs)(l.A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,A.jsx)(s.A,{sx:{pr:0},children:(0,A.jsx)(r.A,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,A.jsx)(s.A,{sx:{pl:1},children:(0,u.sC)(e.category,n)}),(0,A.jsx)(s.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.aqiUS.low,e.aqiUS.high)}),(0,A.jsx)(s.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.rawPM2_5.low,e.rawPM2_5.high)}),!d&&(0,A.jsx)(s.A,{align:"left",children:e.description}),!d&&(0,A.jsx)(s.A,{align:"left",children:(0,c.Ay)((0,u.sC)(e.healthSuggestions.outdoors,n),{replace:u.H$})})]},a))})]})})})}},51210:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(65043),r=n(34535),o=n(13766),l=n(86605),s=n(40710),i=n(96446),d=n(77739),c=n(85865),u=n(40430),h=n(97847),p=n(70579);const x=(0,r.Ay)(o.A)(e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}}),m=(0,r.Ay)(l.A)(e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(1):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(1),marginBottom:t.spacing(1)}}}),A="Click to expand section",g="Click to collapse section",v=e=>{const{title:t,content:n,icon:r,disabled:o}=e,[l,v]=(0,a.useState)(void 0);return(0,p.jsx)(i.A,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,p.jsxs)(x,{expanded:"panel1"===l,onChange:(y="panel1",(e,n)=>{v(n?y:void 0),h.n(n?h.s.expandSection:h.s.collapseSection,{section:t})}),disabled:o,children:[(0,p.jsx)(m,{expanded:l,expandIcon:(0,p.jsx)(u.A,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,p.jsx)(d.A,{title:l?g:A,enterDelay:0,leaveDelay:200,children:(0,p.jsxs)(c.A,{component:"a",variant:"body1",children:[t,(0,p.jsx)(i.A,{component:"span",sx:{ml:.25},children:r})]})})}),(0,p.jsx)(s.A,{sx:{pt:0},children:n})]})});var y}},73605:(e,t,n)=>{n.d(t,{A:()=>A});var a=n(65043),r=n(96446),o=n(85865),l=n(85721),s=n(8011),i=n(47298),d=n(51210),c=n(65290),u=n(98348),h=n(70579);const p="Explanation of the US Air Quality Index (AQI) for PM2.5",x="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',A=()=>{const{themePreference:e}=(0,a.useContext)(c.j);return(0,h.jsx)(d.A,{title:p,icon:(0,h.jsx)(u.A,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(r.A,{children:[(0,h.jsx)(i.A,{themePreference:e}),(0,h.jsx)(o.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,l.Ay)(x,{replace:s.H$})}),(0,h.jsx)(d.A,{title:"Reference",content:(0,h.jsx)(o.A,{variant:"caption",color:"text.secondary",children:(0,l.Ay)(m,{replace:s.H$})})})]})})}}}]);
//# sourceMappingURL=585.f0f5fc2d.chunk.js.map