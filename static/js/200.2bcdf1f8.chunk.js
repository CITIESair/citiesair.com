"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[200],{4967:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(92535),r=n(65043),l=n(9209),o=n(96157),s=n(38119),i=n(22126);const d=()=>{const{currentSchoolID:e}=(0,r.useContext)(o.C);return(0,a.I)({queryKey:["schoolMetadata",e],queryFn:async()=>{const t=(0,s.e9)({endpoint:i.tK.schoolmetadata,school_id:e});return(0,l.i)({url:t})},enabled:!!e,staleTime:36e5,placeholderData:e=>e})}},31209:(e,t,n)=>{n.r(t),n.d(t,{default:()=>tr});var a=n(65043),r=n(22555),l=n(34535),o=n(96446),s=n(91449),i=n(30344),d=n(88911),c=n(24056),u=n(72437),h=n(85865),x=n(21337),p=n(49881),m=n(96157),A=n(33656),g=n(68903),v=n(26240),y=n(53193),b=n(69285),f=n(51962),j=n(36694),w=n(4598),S=n(43845),D=n(47260),C=n(70579);const T="Show All Sensors";function k(e){const{items:t,selectorID:n,allowMultiple:l,seriesLabel:o,onSeriesSelection:c,displayChip:u=!0}=e,x=(0,v.A)(),p=(0,i.A)(e=>e.breakpoints.up("lg")),m={PaperProps:{style:{maxHeight:274.4,overflow:"visible !important",background:x.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[A,k]=(0,a.useState)(t),[I,M]=(0,a.useState)(l);(0,a.useEffect)(()=>{k(e=>{const n=new Map(e.map(e=>[e.label,e.selected]));return t.map(e=>"boolean"===typeof e.selected?(0,r.A)({},e):(0,r.A)((0,r.A)({},e),{},{selected:n.has(e.label)?n.get(e.label):!!e.selected}))})},[t]),(0,a.useEffect)(()=>{M(A.every(e=>e.selected))},[A]);const E=e=>{const{target:{value:t}}=e;if(t.includes(T)){const e=A.map((e,t)=>(0,r.A)((0,r.A)({},e),{},{selected:0==t||!I}));c({newDataColumns:e}),M(!I)}else{const e=A.filter(e=>t.includes(e.label)),n=A.map(t=>(0,r.A)((0,r.A)({},t),{},{selected:e.some(e=>e.label===t.label)}));c({newDataColumns:n}),M(!1)}},P=e=>{const t=A.map(t=>t.label===e.label?(0,r.A)((0,r.A)({},t),{},{selected:!t.selected}):t);c({newDataColumns:t})};return(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[p?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Show/Hide"}):null,(0,C.jsxs)(d.A,{spacing:1,direction:"row",alignItems:"center",children:[(0,C.jsx)(y.A,{sx:{width:"100%",minWidth:"10rem","& .MuiInputBase-root":{borderRadius:"".concat(x.shape.borderRadius,"px")}},size:"small",children:(0,C.jsxs)(b.A,{labelId:"".concat(n,"-label"),id:n,multiple:l,value:A.filter(e=>e.selected).map(e=>e.label),onChange:E,MenuProps:m,renderValue:e=>(e=>(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:.5,children:[(0,C.jsx)(D.A,{fontSize:"1.5rem",sx:{color:x.palette.text.secondary}}),(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:l?"".concat(e.length,"/").concat(A.length," ").concat(o||""," shown"):e})]}))(e),sx:{fontSize:"0.75em","& .MuiSelect-select":{py:"6.5px"},"& .MuiSvgIcon-root":{color:"text.secondary"}},children:[A.map(e=>(0,C.jsxs)(s.A,{disabled:!(1!==A.filter(e=>e.selected).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[l?(0,C.jsx)(f.A,{checked:e.selected,onClick:()=>P(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,C.jsx)(j.A,{checked:e.selected,onChange:()=>E(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,C.jsx)(h.A,{variant:"caption",children:e.label})]},e.label)),l?(0,C.jsx)(s.A,{value:T,sx:{borderTop:"solid 0.5px",borderColor:x.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:x.spacing(-1),background:x.palette.customAlternateBackground,"&:hover":{background:x.palette.customAlternateBackground}},children:(0,C.jsxs)(d.A,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,C.jsx)(h.A,{fontWeight:500,variant:"caption",sx:{pl:1},children:T}),(0,C.jsx)(w.A,{checked:I,onClick:()=>P(T),sx:{transform:"scale(0.8)"}})]})},T):null]})}),u&&l&&(0,C.jsx)(g.Ay,{container:!0,spacing:1,sx:{[x.breakpoints.down("sm")]:{display:"none"}},children:A.filter(e=>e.selected).map(e=>(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(S.A,(0,r.A)({label:(0,C.jsx)(h.A,{variant:"caption",children:e.label}),size:"small"},1!==A.filter(e=>e.selected).length&&{onDelete:()=>P(e)}))},e.label))})]})]})}const I={stem:{length:0},textStyle:{opacity:0},boxStyle:null},M=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},E=e=>{var t;const{chartControl:n,mainChartData:a,mainChartOptions:l,subchartIndex:o,theme:s,isPortrait:i}=e;let d=(0,r.A)((0,r.A)({},null===(t=n.options)||void 0===t?void 0:t.ui),{},{snapToData:!0});return"ChartRangeFilter"===n.controlType&&(d=(0,r.A)((0,r.A)({},d),{},{chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[o].columns||null},chartOptions:(0,r.A)((0,r.A)({},l),{},{hAxis:(0,r.A)((0,r.A)({},l.hAxis),{},{textPosition:"out",textStyle:{color:s.palette.chart.axisText,fontSize:M({isPortrait:i,isSmaller:!0})},title:null}),vAxis:(0,r.A)((0,r.A)({},l.vAxis),{},{title:null}),annotations:I,legend:null,pointSize:0})})),d};var P=n(5362),O=n(66477),_=n(17535),R=n(8011);const W=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;if(!(0,R.OP)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map((t,n)=>({color:t,offset:n/(e-1)}))}{let e=t;n&&(e=t.filter(e=>e.offset>=n)),a&&(e=t.filter(e=>e.offset<=a));const r=e.map(e=>e.offset),l=(e=>{let{offsets:t,minOffset:n,maxOffset:a}=e;return t.map(e=>(e-n)/(a-n))})({offsets:r,minOffset:n||Math.min(...r),maxOffset:a||Math.max(...r)});return e.map((e,t)=>({color:e.color,offset:l[t]}))}};function z(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}function L(e,t,n){if(e.every((e,n)=>e===t[n]))return e;let a=e.slice();for(let r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a}const F=e=>{let{colors:t,numSteps:n=100}=e;const a=W({colors:t});a.forEach(e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,a){return t+t+n+n+a+a});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)});let r=[];const l=Array.from({length:n},(e,t)=>t/(n-1));for(let o=0;o<l.length;o++){const e=l[o];let t,n,s,i;for(let r=0;r<a.length-1;r++)if(e>=a[r].offset&&e<=a[r+1].offset){t=a[r].color,n=a[r+1].color,s=a[r].offset,i=a[r+1].offset;break}const d=L(t,n,(e-s)/(i-s));r.push(z(...d))}return r},B=e=>{let{gradientDirection:t,colors:n,optionalMinValue:a,optionalMaxValue:r}=e;const l=W({colors:n,optionalMinValue:a,optionalMaxValue:r});return"linear-gradient(".concat(t,", ").concat(l.map(e=>"".concat(e.color," ").concat(100*e.offset,"%")).join(", "),")")},H=e=>{let{id:t,colors:n}=e;return(0,C.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,C.jsx)("defs",{children:(0,C.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map((e,t)=>(0,C.jsx)("stop",{offset:e.offset,stopColor:e.color},t))})})})},V=e=>{let{title:t,valueRange:n,colorAxis:a,isPortrait:l}=e;const s=(0,v.A)();if(null===(null===n||void 0===n?void 0:n.min)||null===(null===n||void 0===n?void 0:n.max))return null;const{colors:i,minValue:d,maxValue:c}=a;let u=d,x=c;void 0===d&&(u=n.min),void 0===c&&(x=n.max),n.min<u&&(u=n.min),n.max>x&&(x=n.max);const p=e=>"".concat((e-u)/(x-u)*100,"%"),m={position:"absolute",fontSize:"0.75rem",color:s.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},A={bottom:"-1.25rem",transform:l?"translateX(-100%)":"translateX(-50%)"},g={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},y={top:"-0.5rem",borderTop:"0.25rem solid ".concat(s.palette.text.secondary)},b={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(s.palette.text.secondary)};return(0,C.jsxs)(o.A,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:l?"0":"50px"},children:[(0,C.jsx)(h.A,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,C.jsxs)(o.A,{sx:{background:B({gradientDirection:"to right",colors:i,optionalMaxValue:x}),color:s.palette.text.secondary,border:"1px solid ".concat(s.palette.text.secondary),width:l?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,C.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),{top:"-1.5rem",transform:"translateX(-50%)"}),{},{left:p(n.min)}),children:["min: ",Math.round(n.min)]}),(0,C.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),A),{},{left:p(n.max)}),children:["max: ",Math.round(n.max)]}),(0,C.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},g),y),{},{left:p(n.min)})}),(0,C.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},g),b),{},{left:p(n.max)})})]})]})};var U=n(85721);const N=e=>{let{day:t,color:n,tooltipText:r,dateRange:l,inFirstTwoRowsOfChart:s}=e;const i=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(i.current&&s(t,l)){const e=i.current.parentElement;e&&(e.style.top="11vh")}},[i,s]),(0,C.jsxs)(o.A,{ref:i,className:"nivo-tooltip",children:[(0,C.jsx)(S.A,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,U.Ay)(r,{replace:R.H$})]})},Y=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},q=e=>{var t,n,r,l,s;const{dataArray:i,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[x,p]=(0,a.useState)({min:null,max:null}),[m,A]=(0,a.useState)({min:null,max:null}),[g,y]=(0,a.useState)(400);(0,a.useEffect)(()=>{if(!(0,R.OP)(i))return;const e=(e=>({min:e.reduce((e,t)=>t<e?t:e),max:e.reduce((e,t)=>t>e?t:e)}))(i.map(e=>e.day));p(e);const t=i.map(e=>e.value);A((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const n=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,a=Y(c),r=n*(7*Math.min(h[0]/60,20)+40)+a.top+a.bottom;y(r)},[i,h]);const b=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,f=Y(c),j=(0,v.A)(),w=(e,t)=>{const n=new Date(e),a=n.getDay(),r=0===a||1===a,l=new Date(t.min).getFullYear(),o=n.getFullYear()===l;return r&&o},S=F({colors:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.colors,numSteps:null===u||void 0===u||null===(r=u.colorAxis)||void 0===r?void 0:r.gradientSteps});return(0,C.jsxs)(P.A,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[b?(0,C.jsx)(V,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,C.jsx)(o.A,{sx:{height:"".concat(g,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,C.jsx)(o.A,{sx:{height:"".concat(g,"px"),position:"absolute",width:"100%"},children:(0,C.jsx)(_.Zm,{data:i,from:x.min,to:x.max,emptyColor:"transparent",align:"top",theme:{text:{fill:j.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(l=u.colorAxis)||void 0===l?void 0:l.minValue,maxValue:null===u||void 0===u||null===(s=u.colorAxis)||void 0===s?void 0:s.maxValue,margin:f,yearSpacing:40,monthBorderColor:j.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:a}=e;const r=i.find(e=>e.day===t),l=r?(o=r.tooltip,(new DOMParser).parseFromString(o,"text/html").body.innerHTML):"";var o;return(0,C.jsx)(N,{day:t,color:a,tooltipText:l,dateRange:x,inFirstTwoRowsOfChart:w})}})})})]})};var Q=n(86347),G=(n(87151),n(74864),n(63336)),K=n(76859),X=n(93043),$=n(56036),J=n(36870),Z=n(4006),ee=n(73561);const te=new Date,ne={label:"Yesterday",range:()=>({startDate:(0,K.o)((0,X.L)(te,-48)),endDate:te})},ae={label:"Last 14d",range:()=>({startDate:(0,K.o)((0,$.f)(te,-14)),endDate:(0,J.D)(te)})},re={label:"Last 30d",range:()=>({startDate:(0,K.o)((0,$.f)(te,-30)),endDate:(0,J.D)(te)})},le={label:"Last 365d",range:()=>({startDate:(0,K.o)((0,$.f)(te,-365)),endDate:(0,J.D)(te)})},oe=e=>{let{minDateOfDataset:t}=e;const n=(0,Z.GP)(t,"MMM yyyy");return{label:"All Time (".concat(n," - Now)"),range:()=>({startDate:t,endDate:(0,J.D)(te)})}},se=e=>{let{minDateOfDataset:t,aggregationType:n}=e;switch(n){case ee.A.minute:return[ne];case ee.A.day:return[re,le];case ee.A.month:case ee.A.year:return[oe({minDateOfDataset:t})];default:return[ae,re]}},ie={[ee.A.minute]:{maxDays:2,label:"Real-time"},[ee.A.hour]:{maxDays:30,label:"Hourly"},[ee.A.day]:{maxDays:365,label:"Daily"},[ee.A.month]:{maxDays:1/0,label:"Monthly"},[ee.A.year]:{maxDays:1/0,label:"Yearly"}},de=(0,l.Ay)(G.A,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})(e=>{let{theme:t,showPickerPanel:n,smallScreen:a}=e;return{zIndex:!0===n&&1,position:"relative",padding:n?t.spacing(1):0,margin:n&&!a?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDateInput::before":{display:"none !important"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none",padding:0},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"10rem",display:"flex",justifyContent:"center",alignItems:"center",height:"2rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"9rem",height:"2rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"10.5rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}});var ce,ue=n(57528),he=n(1119),xe=n(84511),pe=n(83290),me=n(94922),Ae=n(69369),ge=n(87332),ve=n(52687);const ye=(0,pe.i7)(ce||(ce=(0,ue.A)(["\n  0% { opacity: 1; }\n  50% { opacity: 0.6; }\n  100% { opacity: 1; }\n"])));function be(e){let{aggregationType:t,setAggregationType:n}=e;const{currentSchoolID:l}=(0,a.useContext)(m.C),o=(0,Ae.u)(),s=(0,i.A)(e=>e.breakpoints.up("lg")),d=(0,i.A)(e=>e.breakpoints.down("sm")),c=Object.values(ee.A).filter(e=>l!==me.iC||e!==ee.A.minute);return(0,C.jsx)(he.A,{fullWidth:d,color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",sx:{height:"100%",[o.breakpoints.down("sm")]:{width:"100%"}},orientation:s?"vertical":"horizontal",children:Object.values(c).map(e=>{var t;return(0,C.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5,color:"text.secondary"},value:e,"aria-label":e,children:[e===ee.A.minute&&(0,C.jsx)(ge.A,{sx:(0,r.A)((0,r.A)({},s?{position:"absolute",left:"50%",transform:"translateX(calc(-50% - 2.5rem))"}:{mr:.3}),{},{color:ve.m7[3].color.Light,fontSize:"0.75rem",animation:"".concat(ye," 2s infinite ease-in-out")})}),(null===(t=ie[e])||void 0===t?void 0:t.label)||""]},e)})})}var fe=n(46560),je=n(31021),we=n(46987),Se=n(79958),De=n(92535),Ce=n(9209),Te=n(38119);const ke=e=>{const{allChartsConfigs:t,currentSchoolID:n}=(0,a.useContext)(m.C),r=t[e];return(0,De.I)({queryKey:["chartData",e,r,n],queryFn:async()=>{const e=(0,Te.ML)({endpoint:r.endpoint,school_id:n,queryParams:r.queryParams});return(0,Ce.i)({url:e})},enabled:!!n&&!(null===r||void 0===r||!r.endpoint),staleTime:6e5,placeholderData:e=>e})},Ie=e=>{const{minDateOfDataset:t,chartIndex:n}=e,[l,s]=(0,a.useState)(!0),{enqueueSnackbar:c}=(0,we.dh)(),{isFetching:u}=ke(n),{allChartsConfigs:x,updateIndividualChartConfigQueryParams:p}=(0,a.useContext)(m.C),A=(x[n]||{}).queryParams||{},[y,b]=(0,a.useState)(A.aggregationType||ee.A.hour),[f,j]=(0,a.useState)(()=>{const{startDate:e,endDate:t}=A;return e&&t?{startDate:new Date(e),endDate:new Date(t),key:"selection"}:{startDate:null,endDate:null,key:"selection"}}),w=new Date,S=(0,v.A)(),D=(0,i.A)(S.breakpoints.down("sm")),T=(0,i.A)(e=>e.breakpoints.up("lg"));(0,a.useEffect)(()=>{const e=(0,r.A)((0,r.A)({},se({aggregationType:y||ee.A.hour,minDateOfDataset:t})[0].range()),{},{key:"selection"});j(e)},[y]),(0,a.useEffect)(()=>{var e;if(l)return void s(!1);const{startDate:t,endDate:a}=f||{};if(!t||!a)return;if((0,fe.r)(t,a))return;const r=null===(e=ie[y])||void 0===e?void 0:e.maxDays;if((0,je.c)(a,t)>r)return void c("".concat(ie[y].label," data is limited to maximum ").concat(r," day").concat(r>1?"s":""),Se.n.error);const o=(e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,Z.GP)(t,"yyyy-MM-dd"),endDate:(0,Z.GP)(n,"yyyy-MM-dd")}})({startDateObject:t,endDateObject:a});p(n,{aggregationType:y,startDate:o.startDate,endDate:o.endDate})},[f]);const[k,I]=(0,a.useState)(!1),M=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[M]),(0,a.useEffect)(()=>{!u&&k&&I(!1)},[u]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(g.Ay,{item:!0,alignItems:k?"start":"stretch",xs:!0,sm:"auto",lg:!0,children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[T?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Averaging Period"}):null,(0,C.jsx)(be,{aggregationType:y,setAggregationType:b,smallScreen:D})]})}),(0,C.jsx)(g.Ay,{item:!0,sx:{height:"2rem",flex:1,[S.breakpoints.up("lg")]:{minHeight:"4rem"}},children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,children:[T?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Date Range"}):null,(0,C.jsx)(de,{showPickerPanel:k,smallScreen:D,ref:M,elevation:8,onClick:()=>I(!0),sx:{position:"relative"},children:(0,C.jsx)(o.A,{sx:{transition:"filter 0.2s ease-in-out"},children:(0,C.jsx)(Q.Ur,{ranges:[f],onChange:e=>{e&&j(e.selection)},staticRanges:(0,Q.hs)(se({minDateOfDataset:t,aggregationType:y})),inputRanges:[],rangeColors:[S.palette.primary.main,S.palette.secondary.main,S.palette.text.secondary],minDate:t,maxDate:w,months:1,showMonthAndYearPickers:!0,direction:"vertical",fixedHeight:!0,preventSnapRefocus:!0,startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0,weekStartsOn:1})})})]})})]})};var Me=n(79190),Ee=n(11906);const Pe=(0,a.createContext)();function Oe(e){let{children:t}=e;const[n,r]=(0,a.useState)(),[l,o]=(0,a.useState)(),s=(0,a.useMemo)(()=>({hAxis:n,setHAxis:r,vAxis:l,setVAxis:o}),[n,l]);return(0,C.jsx)(Pe.Provider,{value:s,children:t})}var _e=n(22126);const Re="150px",We=(0,l.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Re,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"}},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}}),ze=(0,l.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Re,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderLeft:"none"}}}}),Le=e=>{const{currentSchoolID:t,setIndividualChartConfig:n}=(0,a.useContext)(m.C),{chartID:r,allowedAxes:l,selectedAxes:o,dataType:c}=e,{hAxis:u,vAxis:x,setHAxis:p,setVAxis:A}=(0,a.useContext)(Pe),{isFetching:v}=ke(r),[y,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=o||{};e&&t?(p(e),A(t)):f(!0)},[o,p,A]),(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=o;e&&t&&f(u===e&&x===t)},[u,x,o]);const j=e=>!e.allowedDataTypes.includes(c),w=(0,i.A)(e=>e.breakpoints.up("lg"));return(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:1.5,width:"100%",children:[w?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Sensor Pair Selection"}):null,(0,C.jsxs)(g.Ay,{container:!0,item:!0,rowGap:1.5,columnGap:1,alignItems:"center",children:[(0,C.jsxs)(g.Ay,{container:!0,item:!0,rowGap:1.5,children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,C.jsxs)(We,{fullWidth:!0,size:"small",children:[(0,C.jsx)(Me.A,{id:"x-axis-select-label",children:"Horizontal Axis"}),(0,C.jsx)(b.A,{labelId:"x-axis-select-label",value:u||(null===o||void 0===o?void 0:o.hAxis)||null,label:"Horizontal Axis",onChange:e=>{p(e.target.value)},autoWidth:!0,children:null===l||void 0===l?void 0:l.map(e=>(0,C.jsxs)(s.A,{value:e.sensor,disabled:e.sensor===x||j(e),sx:{textTransform:"capitalize"},children:[e.sensor,j(e)&&" (No Data)"]},e.sensor))})]})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,C.jsxs)(ze,{fullWidth:!0,size:"small",children:[(0,C.jsx)(Me.A,{id:"y-axis-select-label",children:"Vertical Axis"}),(0,C.jsx)(b.A,{labelId:"y-axis-select-label",value:x||(null===o||void 0===o?void 0:o.vAxis)||null,label:"Vertical Axis",onChange:e=>{A(e.target.value)},autoWidth:!0,children:null===l||void 0===l?void 0:l.map(e=>(0,C.jsxs)(s.A,{value:e.sensor,disabled:e.sensor===u||j(e),sx:{textTransform:"capitalize"},children:[e.sensor,j(e)&&" (No Data)"]},e.sensor))})]})})]}),(0,C.jsx)(g.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,C.jsx)(Ee.A,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{x&&u&&n(r,{endpoint:_e.HG[r],school_id:t,queryParams:{dataType:c,sensorX:u,sensorY:x}})},disabled:y||v,children:"APPLY"})})]})]})};var Fe=n(14194);const Be=e=>{let{customMessage:t,dataType:n,height:a,selectableAxes:r}=e,l="This sensor ",s=" data. Choose a different sensor or data type.";return r&&(l="This pair of sensors ",s=" correlation data. Choose another pair or a different data type."),(0,C.jsx)(o.A,{height:a,children:(0,C.jsx)(Fe.A,{severity:"error",sx:{my:2},children:t||(0,C.jsxs)(C.Fragment,{children:[l,"does not have\xa0",(0,C.jsx)(o.A,{component:"span",textTransform:"capitalize",children:n}),s]})})})},He=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",Ve=Array.from({length:24},(e,t)=>{const n=60*t;return{label:He(n),value:n}}),Ue={allday:{id:"allday",label:"All Day",start:Ve[0].value,end:Ve[Ve.length-1].value,timeRangeLabel:"0-23h"},schoolHour:{id:"schoolHour",label:"School Hour",start:Ve[7].value,end:Ve[17].value,timeRangeLabel:"7-17h"},custom:{id:"custom",label:"Custom"}};var Ne=n(51715),Ye=n(80045);const qe=["icon","label","value","options","handleChange","disabled","isExtraSmall"],Qe=e=>{const{icon:t,label:n,value:a,options:l,handleChange:i,disabled:c,isExtraSmall:u}=e,h=(0,Ye.A)(e,qe),x=(0,v.A)();return(0,C.jsxs)(d.A,(0,r.A)((0,r.A)({direction:"row",gap:t?1:0,alignItems:"center"},h),{},{children:[(0,C.jsx)(o.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:c?x.palette.text.secondary:x.palette.primary.main,verticalAlign:"middle"}},children:t}),(0,C.jsxs)(y.A,{fullWidth:!0,size:"small",disabled:c,sx:{minWidth:"5rem",marginLeft:"0 !important","& .MuiInputBase-root":{[x.breakpoints.down("sm")]:{fontSize:null!==u&&void 0!==u?u:"0.75rem"}}},children:[(0,C.jsx)(Me.A,{id:"".concat(n,"-picker-label"),children:n}),(0,C.jsx)(b.A,{labelId:"".concat(n,"-picker-label"),id:"".concat(n,"-picker"),value:a,label:n,onChange:i,children:(0,R.OP)(l)&&l.map(e=>(0,C.jsx)(s.A,{value:e.value,is:!0,children:e.label},e.value))})]})]}))},Ge=e=>{const{timeRange:t,defaultTimeRange:n,disabled:r,handleChange:l,isResponsive:s=!1,hasTitle:c=!1}=e,u=(0,v.A)(),x=(0,i.A)(e=>e.breakpoints.up("lg")),[p,m]=(0,a.useState)(!1),[A,g]=(0,R.OP)(t)?t:n,[y,b]=(0,a.useState)(()=>{const e=Object.values(Ue).find(e=>e.start===A&&e.end===g);return e?e.id:Ue.custom.id});(0,a.useEffect)(()=>{const e=Object.values(Ue).find(e=>e.start===A&&e.end===g);b(e?e.id:Ue.custom.id)},[A,g]);const f=(0,a.useCallback)((e,t)=>{if(!t)return;b(t);const n=Ue[t];null!=n.start&&null!=n.end&&l([n.start,n.end]),m(t===Ue.custom.id)},[l]),j=(0,i.A)(e=>e.breakpoints.down("sm"));return(0,C.jsxs)(d.A,{direction:c?"column":"row",alignItems:"start",gap:.5,width:"100%",children:[c?x&&s?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Time Range"}):null:(0,C.jsx)(o.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:r?u.palette.text.secondary:u.palette.primary.main,verticalAlign:"-webkit-baseline-middle"}},children:(0,C.jsx)(Ne.A,{sx:{mt:.75}})}),(0,C.jsxs)(d.A,{direction:"column",width:"100%",gap:1.5,children:[(0,C.jsx)(he.A,{fullWidth:j,color:r?"standard":"primary",value:y,exclusive:!0,onChange:f,size:"small",disabled:r,orientation:s&&x?"vertical":"horizontal",children:Object.values(Ue).map((e,t,n)=>(0,C.jsxs)(xe.A,{value:e.id,"aria-label":e.label,sx:{color:"text.secondary",textTransform:"none",px:t===n.length-1?2:1,py:.5,flex:t===n.length-1?1:void 0},size:"small",children:[e.label,e.timeRangeLabel&&(0,C.jsxs)(C.Fragment,{children:["\xa0(",e.timeRangeLabel,")"]})]},e.id))}),p?(0,C.jsxs)(d.A,{direction:"row",flex:1,gap:1,children:[(0,C.jsx)(Qe,{label:"From",value:A,options:Ve,disabled:r||"custom"!==y,handleChange:e=>{e.target.value>g?l([e.target.value,null]):l([e.target.value,g])},flex:1}),(0,C.jsx)(Qe,{label:"To",value:g,options:Ve.filter(e=>e.value>A),disabled:r||"custom"!==y,handleChange:e=>l([A,e.target.value]),flex:1})]}):null]})]})},Ke=e=>{const{defaultTimeRange:t,isResponsive:n,hasTitle:r,chartIndex:l}=e,{allChartsConfigs:o,updateIndividualChartConfigQueryParams:s}=(0,a.useContext)(m.C),i=(o[l]||{}).queryParams||{},{startTime:d,endTime:c}=i,[u,h]=(0,a.useState)([null!==d&&void 0!==d?d:t.startTime,null!==c&&void 0!==c?c:t.endTime]);return(0,C.jsx)(Ge,{timeRange:u,defaultTimeRange:t,handleChange:e=>{h(e);const[t,n]=e||[];null===t||null===n||t>n||(t===Ue.allday.start&&n===Ue.allday.end?s(l,{startTime:null,endTime:null}):s(l,{startTime:t,endTime:n}))},isResponsive:n,hasTitle:r})};function Xe(e){var t;const{chartData:n,subchartIndex:l,windowSize:s,isPortrait:i,height:c,maxHeight:u,selectedDataType:h,allowedDataTypes:x}=e,m=(0,a.useContext)(A.d),[y,b]=(0,a.useState)(),[f,j]=(0,a.useState)(),[w,S]=(0,a.useState)(),[D,T]=(0,a.useState)(),I=(0,v.A)(),[_,z]=(0,a.useState)(!0),[L,F]=(0,a.useState)(!0),[B,V]=(0,a.useState)(!1),[U,N]=(0,a.useState)(),[Y,Q]=(0,a.useState)(),[G,K]=(0,a.useState)(),[X,$]=(0,a.useState)(Math.random().toString(36).substr(2,9)),J=(0,a.useMemo)(()=>(e=>{var t,n,a,l,o,s,i,d,c,u,h,x,p,m,A,g,v,y,b,f,j,w,S,D,C,T,k,I,E,P,O,_,R,W,z,L,F,B,H,V,U,N,Y,q,Q,G,K,X,$,J;const{chartData:Z,subchartIndex:ee,isPortrait:te,theme:ne}=e,ae={italic:!1,bold:!0,color:ne.palette.chart.axisTitle,fontSize:M({isPortrait:te})},re={color:ne.palette.chart.axisText,fontSize:M({isPortrait:te})};let le=null!==(t=Z.subcharts)&&void 0!==t&&null!==(n=t[ee])&&void 0!==n&&n.options?(0,r.A)({},Z.subcharts[ee].options):{};if(le=(0,r.A)((0,r.A)((0,r.A)({},le),Z.options),{},{theme:"material",curveType:le.curveType||(null===(a=Z.options)||void 0===a?void 0:a.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(l=Z.options)||void 0===l||null===(o=l.backgroundColor)||void 0===o?void 0:o.fill)||"transparent"},chartArea:(0,r.A)((0,r.A)({},null===(s=Z.options)||void 0===s?void 0:s.chartArea),{},{width:te?(null===(i=Z.options)||void 0===i||null===(d=i.chartArea)||void 0===d||null===(c=d.width)||void 0===c?void 0:c.portrait)||"80%":(null===(u=Z.options)||void 0===u||null===(h=u.chartArea)||void 0===h||null===(x=h.width)||void 0===x?void 0:x.landscape)||"80%",height:te?(null===(p=Z.options)||void 0===p||null===(m=p.chartArea)||void 0===m||null===(A=m.height)||void 0===A?void 0:A.portrait)||"60%":(null===(g=Z.options)||void 0===g||null===(v=g.chartArea)||void 0===v||null===(y=v.height)||void 0===y?void 0:y.landscape)||"80%",top:!te&&20}),width:te?(null===(b=Z.options)||void 0===b||null===(f=b.width)||void 0===f?void 0:f.portrait)||"100%":(null===(j=Z.options)||void 0===j||null===(w=j.width)||void 0===w?void 0:w.landscape)||"100%",height:Z.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:te?"center":"start",position:null!==(S=null===(D=Z.options)||void 0===D||null===(C=D.legend)||void 0===C?void 0:C.position)&&void 0!==S?S:te?"top":"right",scrollArrows:{activeColor:ne.palette.chart.axisTitle,inactiveColor:ne.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ne.palette.chart.axisTitle,bold:!0}}}),le.vAxis=(0,r.A)((0,r.A)({},le.vAxis),{},{format:null!==(T=null===(k=le.vAxis)||void 0===k?void 0:k.format)&&void 0!==T?T:"decimal",title:null!==(I=null===(E=le.vAxis)||void 0===E?void 0:E.title)&&void 0!==I?I:"",viewWindow:{min:null!==(P=null===(O=le.vAxis)||void 0===O||null===(_=O.viewWindow)||void 0===_?void 0:_.min)&&void 0!==P?P:0,max:null!==(R=null===(W=le.vAxis)||void 0===W||null===(z=W.viewWindow)||void 0===z?void 0:z.max)&&void 0!==R?R:null,max:null!==(L=null===(F=le.vAxis)||void 0===F||null===(B=F.viewWindow)||void 0===B?void 0:B.max)&&void 0!==L?L:null}}),le.hAxis=(0,r.A)((0,r.A)({},le.hAxis),{},{title:null!==(H=null===(V=le.hAxis)||void 0===V?void 0:V.title)&&void 0!==H?H:""}),te&&(le.hAxis=(0,r.A)((0,r.A)({},le.hAxis),{},{slantedText:!0,slantedTextAngle:30})),"string"!==typeof le.colors&&le.colors||(le.colors=ne.palette.chart.optionsColors[le.colors||"multiColor"]),le.series&&Object.values(le.series).forEach(e=>{const t=e;"default"===t.color&&(t.color=ne.palette.primary.main)}),le.trendlines&&le.trendlines.forEach(e=>{e.color=ne.palette.primary.main}),le.colorAxis)switch(le.colorAxis.colors){case"matchingColor":le.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.chart.optionsColors.multiColor[le.colorAxis.colorIndex]];break;case"default":le.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.NYUpurple];break;default:try{le.colorAxis=ne.palette.chart.colorAxes[le.colorAxis.colors]}catch(oe){le.colorAxis=[]}}return le.vAxis=(0,r.A)((0,r.A)({},le.vAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(U=le.vAxis)||void 0===U?void 0:U.gridlines),{},{color:(null===(N=le.vAxis)||void 0===N||null===(Y=N.gridlines)||void 0===Y?void 0:Y.color)||ne.palette.chart.gridlines}),minorGridlines:{count:0}}),le.hAxis=(0,r.A)((0,r.A)({},le.hAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(q=le.hAxis)||void 0===q?void 0:q.gridlines),{},{color:(null===(Q=le.hAxis)||void 0===Q||null===(G=Q.gridlines)||void 0===G?void 0:G.color)||ne.palette.chart.gridlines}),minorGridlines:(0,r.A)((0,r.A)({},null===(K=le.hAxis)||void 0===K?void 0:K.minorGridlines),{},{color:(null===(X=le.hAxis)||void 0===X||null===($=X.gridlines)||void 0===$?void 0:$.color)||ne.palette.chart.gridlines})}),le.legend=(0,r.A)((0,r.A)({},le.legend),{},{textStyle:re}),le.annotations=(0,r.A)((0,r.A)({},le.annotations),{},{highContrast:!0,textStyle:{color:ne.palette.primary.contrastText,fontSize:M({isPortrait:te,isSmaller:!0}),opacity:.8},stem:(0,r.A)((0,r.A)({},null===(J=le.annotations)||void 0===J?void 0:J.stem),{},{color:ne.palette.chart.axisTitle,thickness:2}),boxStyle:{rx:ne.shape.borderRadius,ry:ne.shape.borderRadius,fill:ne.palette.chart.annotationBoxFill,fillOpacity:.5}}),te&&"LineChart"===(null===Z||void 0===Z?void 0:Z.chartType)&&(le.pointSize=0),le})((0,r.A)((0,r.A)({},e),{},{theme:I})),[e,I,n.chartType]),[Z,ee]=(0,a.useState)(null);if("Calendar"===n.chartType)return(0,a.useEffect)(()=>{const e=n.dataArray||n.subcharts&&n.subcharts[l].dataArray||null;(0,R.OP)(e)?(ee(e),F(!0)):F(!1)},[n]),Z?L?(0,C.jsx)(q,{dataArray:Z,valueRangeBoxTitle:(0,p.MU)({dataTypeKey:h,dataTypes:x,showUnit:!0}),isPortrait:i,options:J,windowSize:s}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Be,{dataType:(0,p.MU)({dataTypeKey:h,dataTypes:x})}),(0,C.jsx)(q,{dataArray:[],valueRangeBoxTitle:(0,p.MU)({dataTypeKey:h,dataTypes:x,showUnit:!0}),isPortrait:i,options:J,windowSize:s})]}):(0,C.jsx)(o.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(O.A,{})});let te,ne=!1,ae=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[l].control);ae&&(ne=!0,te=(0,r.A)((0,r.A)({},ae.options),{},{ui:E({chartControl:ae,mainChartData:n,mainChartOptions:J,subchartIndex:l,theme:I,isPortrait:i})}),"ChartRangeFilter"===ae.controlType&&(0,a.useEffect)(()=>{const e=(e=>{let{controlWrapper:t,chartID:n}=e;const a=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var a=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let r=!0;if(!t)return;const l=document.querySelector("#control-".concat(n));return l?(["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{l.addEventListener(e,a,{capture:!0})}),()=>{r=!1,["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{l.removeEventListener(e,a,{capture:!0})})}):void 0})({controlWrapper:w,chartID:X});return e},[w]));const re=J.seriesSelector||!1,le=J.dateRangePicker||null,oe=J.timeRangeSelector||null,se=J.formatters||null;let ie=n.selectableAxes||null;ie&&(0,R.OP)(ie.allowedAxes)&&ie.allowedAxes.length<=2&&(ie=null);const de=re||le||ie||oe;(0,a.useEffect)(()=>{re?he({newDataColumns:Y}):(null===f||void 0===f||f.setOptions((0,r.A)({},J)),null===f||void 0===f||f.draw(),ne&&(null===w||void 0===w||w.setOptions(te),null===w||void 0===w||w.draw()))},[I,i,s]),(0,a.useEffect)(()=>{Y&&re&&"setViewColumn"==re.method&&(ce({dataColumns:Y}),he({newDataColumns:Y}))},[I]);const ce=e=>{let{dataColumns:t}=e;t.forEach(e=>{var t;e.color=J.colors[e.seriesIndex%J.colors.length],e.serieAttribute=null===(t=J.series)||void 0===t?void 0:t[e.seriesIndex]})},ue=e=>{let t,n,{dataTable:a,allInitialColumns:r}=e;return r.forEach((e,r)=>{if(0===r)return;const l=a.getColumnRange(e.sourceColumn);!isNaN(l.min)&&l.min&&(t=t?Math.min(t,l.min):l.min),!isNaN(l.max)&&l.max&&(n=n?Math.max(n,l.max):l.max)}),{min:t,max:n}},he=(0,a.useCallback)(e=>{let{newDataColumns:t,_allInitialColumns:n=U,_chartWrapper:a=f,_controlWrapper:l=w}=e;if(n){if(Q(t),"toggleVisibility"===re.method||null===re.method){const e={};if(t.forEach(t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})}),null===a||void 0===a||a.setOptions((0,r.A)((0,r.A)({},J),{},{series:(0,r.A)((0,r.A)({},J.series),e)})),ne){const t=null===l||void 0===l?void 0:l.getOptions();null===l||void 0===l||l.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{series:(0,r.A)((0,r.A)({},J.series),e)})})}))}}else if("setViewColumn"===re.method){let e=[];e.push(0),t.forEach(t=>{if(t.selected&&(e.push(t),(0,R.OP)(n)))for(let a=t.indexIn_+1;a<n.length&&"data"!==n[a].role;a++)e.push(n[a])}),null===a||void 0===a||a.setView({columns:e});const o=(0,r.A)({},J);o.colors=t.filter(e=>e.selected).map(e=>e.color);const s={};let i=0;if(t.forEach(e=>{e.selected&&(null!=e.serieAttribute&&(s[i]=e.serieAttribute),i++)}),o.series=s,null===a||void 0===a||a.setOptions(o),ne){const t=null===l||void 0===l?void 0:l.getOptions();null===l||void 0===l||l.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{colors:o.colors,series:o.series}),chartView:{columns:e}})}))}}null===a||void 0===a||a.draw(),ne&&(null===l||void 0===l||l.draw())}},[U,J,re,f,w,G,ne]);(0,a.useEffect)(()=>{if(m&&n){if(JSON.stringify(n)===JSON.stringify(D))return;T(n);const e=n.dataArray||n.subcharts&&n.subcharts[l].dataArray||null,t=(0,R.OP)(e);if(F(t),!0===t){V(!0);const t=m.visualization.arrayToDataTable(e);if(se&&"object"===typeof se&&se.hasOwnProperty("numberFormatter")){const e=new m.visualization.NumberFormat(se.numberFormatter.numberFormat);se.numberFormatter.columns.forEach(n=>e.format(t,n))}b(t)}}},[m,n]),(0,a.useEffect)(()=>{if(!0===B){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push((0,r.A)((0,r.A)({},n),{},{calc:e}))}else t.push(n);return t})(n.columns||n.subcharts&&n.subcharts[l].columns||null),t=new m.visualization.ChartWrapper({chartType:n.chartType,dataTable:ne?void 0:y,options:J,view:{columns:e},containerId:X});let a;if(j(t),ne){const e=new m.visualization.Dashboard(document.getElementById("dashboard-".concat(X)));m.visualization.events.addListener(e,"ready",be),a=new m.visualization.ControlWrapper({controlType:ae.controlType,options:te,containerId:"".concat("CategoryFilter"===ae.controlType?"CategoryFilter":"other-chart-control","-").concat(X)}),S(a),e.bind(a,t),e.draw(y)}else m.visualization.events.addListener(t,"ready",be),t.draw();if(re){const{initAllInitialColumns:e,initDataColumns:n}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:a}=e;const r=(null===Y||void 0===Y?void 0:Y.map(e=>({label:e.label,selected:e.selected})))||[];let l=t.getView();if(null==l.columns){const e=new m.visualization.DataView(n);t.setView({columns:e.columns}),l=t.getView()}let o=!0,s=0;const i=l.columns.map((e,t)=>{if("number"===typeof e&&(e={role:o?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,o=!1,"data"===e.role){const n=r.find(t=>t.label===e.label);n?e.selected=n.selected:a.defaultSeriesToDisplayInitially?e.selected=a.defaultSeriesToDisplayInitially.includes(t):a.allowMultiple?e.selected=!0:e.selected=0===s,e.seriesIndex=s,s++}return e});N(i);const d=ue({dataTable:n,allInitialColumns:i});K(d);const c=i.filter(e=>{var t,n;return"data"===e.role&&!1!==(null===(t=J.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)});return"setViewColumn"===a.method&&ce({dataColumns:c}),Q(c),{initAllInitialColumns:i,initDataColumns:c}})({chartWrapper:t,dataTable:y,seriesSelector:re});he({_allInitialColumns:e,newDataColumns:n,_chartWrapper:t,_controlWrapper:a})}V(!1)}},[B]);const xe=J.gradientBackgroundColor;let pe,me;var Ae,ge,ve,ye;xe&&(pe="".concat(X,"-backgroundGradient"),me=(e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;return W({colors:t,optionalMinValue:n,optionalMaxValue:a}).map(e=>({color:e.color,offset:100*e.offset+"%"}))})({colors:I.palette.chart.colorAxes[xe].colors,optionalMinValue:null===(Ae=J.vAxis)||void 0===Ae||null===(ge=Ae.viewWindow)||void 0===ge?void 0:ge.min,optionalMaxValue:null===(ve=J.vAxis)||void 0===ve||null===(ye=ve.viewWindow)||void 0===ye?void 0:ye.max}));const be=()=>{_&&z(!1)};return L?(0,C.jsxs)(P.A,{isPortrait:i,gradientBackgroundId:pe,className:n.chartType,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[_&&(0,C.jsx)(o.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(O.A,{})}),(0,C.jsxs)(g.Ay,{id:"dashboard-".concat(X),container:!0,alignItems:"start",children:[de&&(0,C.jsxs)(g.Ay,{lg:2,container:!0,item:!0,sx:{mt:1,ml:2,gap:2,[I.breakpoints.down("lg")]:{gap:1,ml:0}},children:[!1===_&&(0,C.jsxs)(C.Fragment,{children:[re&&(0,C.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(k,{items:Y,allowMultiple:re.allowMultiple,seriesLabel:re.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),le&&(0,C.jsx)(Ie,{minDateOfDataset:new Date(le.minDate),chartIndex:n.id}),ie&&(0,C.jsx)(Le,{chartID:n.id,allowedAxes:ie.allowedAxes,selectedAxes:ie.selectedAxes,dataType:h}),oe&&(0,C.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(Ke,{defaultTimeRange:[Ue.allday.start,Ue.allday.end],handleChange:()=>null,isResponsive:!0,hasTitle:!0,chartIndex:n.id})})]}),(0,C.jsx)(g.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(o.A,{id:"CategoryFilter-".concat(X),sx:{display:ne&&"CategoryFilter"===ae.controlType?"block":"none"}})})]}),(0,C.jsx)(g.Ay,{item:!0,xs:!0,children:(0,C.jsxs)(d.A,{children:[(0,C.jsx)(o.A,{id:X,sx:{height:c,maxHeight:u}}),(0,C.jsx)(o.A,{id:"other-chart-control-".concat(X),sx:{display:ne&&"CategoryFilter"!==ae.controlType?"block":"none",height:"calc(".concat(c," / 8)"),filter:"saturate(0.3)",opacity:.7}})]})})]}),xe?(0,C.jsx)(H,{id:pe,colors:me}):null]}):(0,C.jsx)(Be,{dataType:(0,p.MU)({dataTypeKey:h,dataTypes:x}),selectableAxes:ie,height:re||ne?1.2*parseFloat(c)+"vw":c})}var $e=n(20036);const Je=function(e){let{text:t,wordLimit:n=40,reference:r}=e;const[l,s]=(0,a.useState)(!1),d=(0,v.A)(),c=(0,i.A)(d.breakpoints.down("sm")),u=(0,a.useRef)(null),x=t.split(" ");if(!c||x.length/n<=1.4)return(0,C.jsxs)(o.A,{children:[(0,C.jsx)(h.A,{children:(0,U.Ay)(t,{replace:R.H$})}),r&&(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,U.Ay)(r,{replace:R.H$})})]});let p=x.slice(0,n).join(" ");const m=p.lastIndexOf(".");return-1!==m&&(p=p.slice(0,m+1)),(0,C.jsx)($e.x,{onClickAway:e=>{(e=>{let{target:t}=e;const n=u.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){var r;if(a.has(null===(r=t)||void 0===r?void 0:r.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||s(!1)},children:(0,C.jsx)(o.A,{ref:u,onClick:()=>s(!l),style:{cursor:"pointer"},children:l?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.A,{children:(0,U.Ay)(t,{replace:R.H$})}),r&&(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,U.Ay)(r,{replace:R.H$})})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(h.A,{display:"inline",children:[(0,U.Ay)(p,{replace:R.H$}),"..."]}),(0,C.jsx)(h.A,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Ze=n(40430);const et=e=>{let{selectedDataType:t,dataTypes:n,chartID:r}=e;const{updateIndividualChartConfigQueryParams:l}=(0,a.useContext)(m.C),[o,i]=(0,a.useState)(null);if(!(0,R.OP)(n))return null;if(n.length<=1)return(0,C.jsx)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const d=Boolean(o),c=()=>{i(null)};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(Ee.A,{id:"data-type-drop-down-menu-button","aria-controls":d?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,C.jsx)(h.A,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,p.MU)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,C.jsx)(Ze.A,{})]}),(0,C.jsx)(u.A,{id:"data-type-drop-down-menu",anchorEl:o,open:d,onClose:c,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map((e,t)=>(0,C.jsx)(s.A,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{l(r,{dataType:e}),c()})(e.key),children:e.name_title},t))})]})};var tt=n(14912);const nt=(0,l.Ay)(tt.A,{shouldForwardProp:e=>"smallFontSize"!==e})(e=>{let{theme:t,smallFontSize:n="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:n,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}}),at=(0,l.Ay)(o.A)(e=>{let{theme:t}=e;return(0,r.A)((0,r.A)({},"dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}}),{},{"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}})}),rt=(0,l.Ay)(s.A)(e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}});const lt=function(e){let{chartID:t}=e;const{data:n,isLoading:r,isFetching:l,error:s}=ke(t),{currentSchoolID:A}=(0,a.useContext)(m.C),g=(0,i.A)(e=>e.breakpoints.down("sm")),[v,y]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[b,f]=(0,a.useState)([window.innerWidth,window.innerHeight]),[j,w]=(0,a.useState)(0),[S,T]=(0,a.useState)(0),[k,I]=(0,a.useState)(-1),[M,E]=(0,a.useState)(),[P,_]=(0,a.useState)(null),[W,z]=(0,a.useState)([]),[L,F]=(0,a.useState)(null);let B,H;if((0,a.useEffect)(()=>{if(!n)return;((e,t,n)=>{if(null===e||void 0===e||!e.allowedDataTypes)return;t(e.allowedDataTypes.map(e=>{const{name_title:t,name_short:n,unit:a}=p.Uy[e];return{key:e,name_title:t,name_short:n,unit:a}})),n(e.selectedDataType)})(n,z,F);const e=((e,t,n)=>{let a=null;const r=()=>{clearTimeout(a),a=setTimeout(()=>{t(window.matchMedia("(orientation: portrait)").matches),e([window.innerWidth,window.innerHeight])},n)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}})(f,y,100);return e},[n]),(0,a.useEffect)(()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout(()=>{y(window.matchMedia("(orientation: portrait)").matches),f([window.innerWidth,window.innerHeight])},100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[n]),(0,a.useEffect)(()=>{T(j),w(0)},[A]),"Calendar"!==(null===n||void 0===n?void 0:n.chartType)&&(B=v?"80vw":"35vw",H=v?"800px":"450px"),n)return r?(0,C.jsx)(O.A,{optionalText:"Loading chart ".concat(t+1,"...")}):s?(0,C.jsx)(Be,{customMessage:"Error loading chart ".concat(t+1,", please try later")}):(0,C.jsxs)(o.A,{position:"relative",children:[(0,C.jsxs)(o.A,{children:[(0,C.jsxs)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:[t+1,". ",n.title,"\xa0"]}),(0,C.jsx)(o.A,{display:"inline",children:(0,C.jsx)(et,{selectedDataType:L,dataTypes:W,chartID:t})})]}),(0,C.jsxs)(at,{height:"100%",sx:{filter:l?"blur(1px)":"none",transition:"filter 0.2s",pointerEvents:l?"none":"auto"},children:[(0,R.OP)(n.subcharts)?(()=>{const e=n.subcharts.length>4,t=e?n.subcharts.slice(0,3):n.subcharts,a=e?n.subcharts.slice(3):null,r=e=>-1===j?S===e:j===e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(nt,{value:j,onChange:(t,n)=>{T(j),w(n),e&&n<3&&n!==k&&(E(),I(-1))},variant:g?"fullWidth":"standard",children:[t.map((e,t)=>(0,C.jsx)(c.A,{value:t,label:n.subcharts[t].subchartTitle,sx:{textDecoration:!(0,R.OP)(n.subcharts[t].dataArray)&&"line-through"}},t)),e&&(0,C.jsx)(c.A,{value:k,label:(0,C.jsxs)(d.A,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,C.jsxs)(o.A,{flex:1,children:["Other sensors",M&&" (".concat(M,")"),"\xa0"]}),(0,C.jsx)(x.A,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>_(e.currentTarget)})]}),e&&(0,C.jsx)(u.A,{id:"submenu",anchorEl:P,open:Boolean(P),onClose:()=>{-1===j&&(T(j),w(S)),_(null)},children:a.map((e,t)=>(0,C.jsx)(rt,{selected:t===j-3,onClick:()=>(e=>{T(j),w(3+e),I(3+e),E(a[e].subchartTitleShort),_(null)})(t),sx:{textDecoration:!(0,R.OP)(n.subcharts[t+3].dataArray)&&"line-through"},children:(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",gap:1,children:[(0,C.jsx)(o.A,{children:a[t].subchartTitle}),t===j-3&&(0,C.jsx)(D.A,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t))}),(0,C.jsx)(o.A,{position:"relative",sx:{overflowX:v&&"auto",WebkitOverflowScrolling:v&&"touch",overflowY:"hidden"},children:n.subcharts.map((e,t)=>(0,C.jsx)(o.A,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:r(t)?"1":"0",pointerEvents:r(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,C.jsx)(Xe,{selectedDataType:L,allowedDataTypes:W,chartData:n,subchartIndex:t,isPortrait:v,windowSize:b,height:n.height?n.height:B,maxHeight:["Calendar"].includes(n.chartType)?"":H,currentSubchart:j})},t))})]})})():(0,R.OP)(n.dataArray)?(0,C.jsx)(Xe,{selectedDataType:L,allowedDataTypes:W,chartData:n,isPortrait:v,windowSize:b,height:n.height?n.height:B}):(0,C.jsx)(Be,{customMessage:"Not enough historical data to display this chart"}),(0,C.jsx)(o.A,{sx:{my:3},children:(0,C.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,C.jsx)(Je,{text:(()=>{var e;let t=n.subtitle||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=n.subcharts[j].subchartSubtitle),t})(),reference:(()=>{var e;let t=n.reference||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.reference&&(t+="<br/>",t+=n.subcharts[j].reference),t})()})})})]}),l&&(0,C.jsx)(o.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255,255,255,0.3)",zIndex:10},children:(0,C.jsx)(O.A,{})})]})};var ot=n(35197),st=n(19252),it=n(39336),dt=n(11530),ct=n(8738),ut=n(24010),ht=n(95953),xt=n(56258),pt=n(4710),mt=n(38198),At=n(97847),gt=n(47298);function vt(e){const[t,n]=(0,a.useState)(null),l=e=>{n(e.currentTarget),At.n(At.s.airQualityIndexLegendQuickGlance)},o=()=>{n(null)},s=Boolean(t);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(mt.An,(0,r.A)((0,r.A)({},e),{},{distanceFromBottomOfWindow:"5.5rem",children:(0,C.jsx)(ut.A,{sx:{mt:1},"aria-owns":s?At.s.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:l,onMouseLeave:o,onClick:e=>ct.Fr&&(s?o():l(e)),"aria-label":At.s.airQualityIndexLegendQuickGlance,color:"primary",children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"center",children:[(0,C.jsx)(pt.A,{fontSize:"1rem"}),(0,C.jsx)(h.A,{variant:"body2",fontWeight:"500",children:"AQI"})]})})})),(0,C.jsx)(ht.A,{id:At.s.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:s,anchorEl:t,placement:"top-end",onClose:o,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,C.jsx)(xt.A,(0,r.A)((0,r.A)({},t),{},{timeout:350,children:(0,C.jsxs)(G.A,{elevation:8,sx:{py:.5,mb:1},children:[(0,C.jsx)(h.A,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,C.jsx)(gt.A,{tiny:!0,hideAQIDescription:!0})]})}))}})]})}var yt=n(74033),bt=n(8051),ft=n(89521),jt=n(65290),wt=n(73605),St=n(83250),Dt=n(73216),Ct=n(93332);const Tt=e=>{const{authenticationState:t,user:n}=(0,a.useContext)(Ct.R),r=t.authenticated&&t.checkedAuthentication,{currentSchoolID:l}=(0,a.useContext)(m.C),{enqueueSnackbar:o}=(0,we.dh)(),s=(0,a.useCallback)(t=>r?null!==n&&void 0!==n&&n.allowedSchools.some(e=>e.school_id===l)?(null===t||void 0===t||t(),!0):(o("Your account does not have access to ".concat(l.toUpperCase()," Alerts"),Se.n.error),!1):(null===e||void 0===e||e(),!1),[r,e,l,n,o]);return{loggedIn:r,handleRestrictedAccess:s}};var kt=n(4967);const It=e=>{let{onButtonClick:t}=e;const{currentSchoolID:n}=(0,a.useContext)(m.C),{data:r}=(0,kt.A)(),{handleRestrictedAccess:l}=Tt(t),[o,i]=(0,a.useState)(null),d=(0,Dt.Zp)();if(!r)return null;const c=r.screens;if(!(0,R.OP)(c))return null;const h=()=>{l(()=>{var e;const t=c&&(null===(e=c[0])||void 0===e?void 0:e.screen_name);d("screen"===t?"/screen/".concat(n):"/screen/".concat(n,"/").concat(t))})};if(c.length<=1)return(0,C.jsxs)(Ee.A,{variant:"contained",size:"small",onClick:h,children:[(0,C.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const x=Boolean(o);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(Ee.A,{id:"basic-button","aria-controls":x?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":x?"true":void 0,onClick:e=>{l(()=>i(e.currentTarget))},variant:"contained",size:"small",children:[(0,C.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,C.jsx)(u.A,{id:"tv-screen-list-menu",anchorEl:o,open:x,onClose:()=>{i(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:c.map((e,t)=>(0,C.jsx)(s.A,{onClick:()=>{return t=e.screen_name,void l(()=>{i(null),d("/screen/".concat(n,"/").concat(t))});var t},sx:{fontSize:"0.8rem"},children:e.location_long},t))})]})};var Mt=n(88446),Et=n(71806),Pt=n(84882),Ot=n(28076),_t=n(10039),Rt=n(73460),Wt=n(41132),zt=n(6519),Lt=n(77739),Ft=n(17392),Bt=n(90035),Ht=n(29347),Vt=n(26600),Ut=n(35316),Nt=n(55896);const Yt=e=>{const{buttonIcon:t,buttonIconAria:n,buttonLabel:r,buttonVariant:l="contained",trackingEvent:o,dialogTitle:s,dialogOpenHandler:d=null,dialogCloseHandler:c=null,displaySchoolID:u=!0,maxWidth:h="lg",children:x,disabled:p}=e;let A;A=!(!t||r);const{currentSchoolID:g}=(0,a.useContext)(m.C),y=(0,i.A)(e=>e.breakpoints.down("sm")),[b,f]=(0,a.useState)(!1),j=()=>{d?d(()=>{f(!0),o&&At.n(o)}):(f(!0),o&&At.n(o))},w=()=>{f(!1),c&&c()},D=(0,v.A)();return(0,C.jsxs)(C.Fragment,{children:[A?(0,C.jsx)(Lt.A,{title:n,children:(0,C.jsx)(Ft.A,{onClick:j,"aria-label":n,size:"small",sx:{"&:hover,:focus":{color:D.palette.primary.main}},disabled:p,children:t})}):(0,C.jsxs)(Ee.A,{onClick:j,variant:l,disabled:p,size:"small",children:[t,"\xa0",r]}),(0,C.jsxs)(Bt.A,{open:b,onClose:w,maxWidth:h,fullWidth:!0,fullScreen:y,keepMounted:!0,children:[(0,C.jsx)(Ht.A,{sx:{justifyContent:"start"},children:(0,C.jsxs)(Ee.A,{onClick:w,children:[(0,C.jsx)(Nt.A,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,C.jsxs)(Vt.A,{children:[!0===u?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.A,{label:g?"School: ".concat(g.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,C.jsx)("br",{})]}):null,s]}),(0,C.jsx)(Ut.A,{children:x})]})]})};var qt=n(41e3);function Qt(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Tt(t),{currentSchoolID:r}=(0,a.useContext)(m.C),{data:l}=(0,qt.A)(),[o,s]=(0,a.useState)({}),[i,d]=(0,a.useState)("placeholder");return(0,a.useEffect)(()=>{if(!l)return;const e=l.filter(e=>e&&e.sensor).reduce((e,t)=>{var n;return e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:null===(n=t.sensor.last_seen)||void 0===n?void 0:n.split("T")[0],rawDatasets:Object.keys(ee.A).reverse().reduce((e,t)=>(e[ee.A[t]]={sample:null,full:null},e),{})},e},{});s(e)},[l]),(0,C.jsxs)(Yt,{buttonIcon:(0,C.jsx)(zt.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:At.s.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),n(e)},children:[(0,C.jsx)(Gt,{sensorsDatasets:o,updateSensorsDatasets:s,previewingDataset:i,setPreviewingDataset:d,schoolID:r}),o&&(0,C.jsxs)(h.A,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["These datasets are provided by ",me.sG," from sensors operated by ",me.sG,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,C.jsx)(Mt.A,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Gt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:l,setPreviewingDataset:o,schoolID:s}=e,d=(0,v.A)(),c=(0,i.A)(d.breakpoints.down("sm"));return(0,a.useEffect)(()=>{if(Object.keys(t).length>0&&!l){const e=Object.keys(t)[0],a=ee.A.hour;if(o({sensor:e,datasetType:a}),t[e].rawDatasets[a].sample)return;const l=(0,Te.A4)({school_id:s,sensor_location_short:e,aggregationType:a,isSample:!0});(0,Ce.i)({url:l,extension:_e.Fc.csv,needsAuthorization:!0}).then(l=>{const o=(0,r.A)({},t);o[e].rawDatasets[a].sample=l,n(o)}).catch(e=>console.log(e))}},[t,l]),(0,C.jsxs)(g.Ay,{container:!0,justifyContent:"center",alignItems:"start",spacing:c?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,C.jsx)(g.Ay,{item:!0,sm:12,md:6,children:(0,C.jsx)(Kt,{schoolID:s,sensorsDatasets:t,updateSensorsDatasets:n,smallScreen:c,previewingDataset:l,setPreviewingDataset:o})}),(0,C.jsx)(g.Ay,{item:!0,sm:12,md:6,maxWidth:c?"100%":"unset",sx:{mt:1},children:(0,C.jsx)($t,{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:l,schoolID:s,smallScreen:c})})]})},Kt=e=>{const{schoolID:t,sensorsDatasets:n,smallScreen:a,previewingDataset:r,setPreviewingDataset:l,updateSensorsDatasets:o}=e;return(0,C.jsxs)(Et.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,C.jsx)(Pt.A,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(_t.A,{sx:{pl:1},children:"Sensor Location"}),(0,C.jsx)(_t.A,{sx:{width:a?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,C.jsx)(Rt.A,{children:n&&Object.keys(n).map(e=>(0,C.jsx)(Xt,{schoolID:t,smallScreen:a,sensor:e,sensorsDatasets:n,previewingDataset:r,setPreviewingDataset:l,isPreviewing:e===(null===r||void 0===r?void 0:r.sensor),updateSensorsDatasets:o},e))})]})},Xt=e=>{const{schoolID:t,sensorsDatasets:n,sensor:l,previewingDataset:o,setPreviewingDataset:i,isPreviewing:c,updateSensorsDatasets:u}=e,[h,x]=(0,a.useState)(ee.A.hour);(0,a.useEffect)(()=>{h!==ee.A.hour&&x(ee.A.hour)},[t]);const p=e=>{if(!n[l].rawDatasets[e].sample){const a=(0,Te.A4)({school_id:t,sensor_location_short:n[l].location_short,aggregationType:e,isSample:!0});(0,Ce.i)({url:a,extension:_e.Fc.csv,needsAuthorization:!0}).then(t=>{const a=(0,r.A)({},n);a[l].rawDatasets[e].sample=t,u(a)})}},m=(0,v.A)();return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(_t.A,{sx:{pl:1,cursor:"pointer",background:c&&m.palette.background.NYUpurpleLight},onClick:()=>{(null===o||void 0===o?void 0:o.sensor)!==l&&(i({datasetType:h,sensor:l}),p(h))},children:n[l].location_long}),(0,C.jsx)(_t.A,{sx:{position:"relative",background:c&&m.palette.background.NYUpurpleLight},children:(0,C.jsx)(y.A,{size:"small",children:(0,C.jsx)(b.A,{value:h,onChange:e=>{const t=e.target.value;x(t),i({datasetType:t,sensor:l}),p(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(n[l].rawDatasets).reverse().map((e,t)=>(0,C.jsx)(s.A,{value:e,children:(0,C.jsx)(d.A,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t))})})})]},l)})},$t=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:l,schoolID:s,smallScreen:i}=e,c=(0,v.A)(),[u,x]=(0,a.useState)("Not previewing any dataset"),[p,m]=(0,a.useState)("No dataset"),[A,g]=(0,a.useState)(!1),y=e=>{const t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=p,document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a)},[b,f]=(0,a.useState)(""),[j,w]=(0,a.useState)("");return(0,a.useEffect)(()=>{var e,n;if(!l)return;x("Previewing: ".concat(l.sensor," (").concat(l.datasetType,")"));const a=null===(e=t[l.sensor])||void 0===e||null===(n=e.rawDatasets[l.datasetType])||void 0===n?void 0:n.sample;if(!a)return w(null),f(null),m("Loading..."),void g(!0);A&&g(!1);const r=a.split("\n"),o=r[0].split(","),i=r.slice(1);let d;if(w(["",...i.map(e=>e.split(",")[0])].join("\n")),f([o.slice(1).join(","),...i.map(e=>e.split(",").slice(1).join(","))].join("\n")),i.length>0){const e=i[i.length-1].split(",");if(e.length>=2){d=e[1].split("T")[0]}}const c="".concat(s,"-").concat(l.sensor,"-").concat(l.datasetType,"-").concat(d,".csv");m(c)},[l,t]),(0,C.jsxs)(d.A,{spacing:1,children:[(0,C.jsxs)(o.A,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,C.jsx)(d.A,{direction:"row",children:(0,C.jsx)(h.A,{variant:"body2",gutterBottom:!0,fontWeight:500,children:u})}),(0,C.jsx)(o.A,{component:"pre",sx:{overflowX:"auto",color:c.palette.text.secondary,backgroundColor:c.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:i?"11.8rem":"14rem",width:i?"100%":"unset",marginTop:0},children:(0,C.jsx)(d.A,{direction:"row",sx:{fontSize:"0.75rem"},children:b?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(o.A,{sx:{mr:2,userSelect:"none"},children:j}),(0,C.jsx)(o.A,{children:b})]}):(0,C.jsx)(O.A,{optionalText:"Loading"})})})]}),(0,C.jsx)(o.A,{textAlign:"center",children:(0,C.jsxs)(Ee.A,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!l)return;const e=t[l.sensor].rawDatasets[l.datasetType].full;if(e)y(e);else{const e=(0,Te.A4)({school_id:s,sensor_location_short:l.sensor,aggregationType:l.datasetType,isSample:!1});(0,Ce.i)({url:e,extension:_e.Fc.csv,needsAuthorization:!0}).then(e=>{const a=(0,r.A)({},t);a[l.sensor].rawDatasets[l.datasetType].full=e,n(a),y(e)})}})(),At.n(At.s.rawDatasetDownloaded,{dataset_type:null===l||void 0===l?void 0:l.datasetType,sensor:null===l||void 0===l?void 0:l.sensor})},disabled:A,children:[(0,C.jsx)(Wt.A,{sx:{fontSize:"1.25rem",mr:.5}}),p]})})]})};var Jt=n(23621),Zt=n(67784),en=n(81637),tn=n(63248),nn=n(47097);const an=(e,t)=>JSON.stringify(e)===JSON.stringify(t),rn=()=>{const{enqueueSnackbar:e}=(0,we.dh)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{data:n=[]}=(0,De.I)({queryKey:["alertEmails",t],queryFn:async()=>{const e=(0,Te.e9)({endpoint:_e.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:e,extension:"json",needsAuthorization:!0})},enabled:!!t,staleTime:0}),r=(0,tn.jE)(),l=(0,nn.n)({mutationFn:async e=>{const n=(0,Te.e9)({endpoint:_e.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:n,restMethod:_e.Xo.POST,body:e})},onSuccess:n=>{r.setQueryData(["alertEmails",t],n),e("Email recipients saved successfully.",Se.n.success)},onError:()=>{e("There was an error saving email recipients. Please try again.",Se.n.error)}}),c=(0,i.A)(e=>e.breakpoints.down("sm")),[x,p]=(0,a.useState)([]),[A,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(""),[f,j]=(0,a.useState)(null),[w,D]=(0,a.useState)("");(0,a.useEffect)(()=>{p(n)},[n]),(0,a.useEffect)(()=>{v(!an(x,n))},[x]),(0,a.useEffect)(()=>{D(A?"Click to save new changes on server":"No changes detected to save")},[A]);const T=t=>{const n=t.trim().toLowerCase();if((0,R.DT)(n)){const t=[...x,n];if(x.includes(n))return e("Already added: ".concat(n),Se.n.error),void b("");150===t.length&&e("Maximum number of recipients reached",Se.n.warning),p(t),b("")}else e("Invalid email address. Valid format: abc@def.xyz",Se.n.error)},k=e=>{const t=x.filter((t,n)=>n!==e);p(t)},I=()=>{j(null)};return(0,a.useEffect)(()=>{const e=e=>{an(x,n)||(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[x,n]),(0,C.jsxs)(o.A,{children:[(0,C.jsxs)(g.Ay,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,sx:{p:0,mb:c&&1,mr:!c&&2},children:"Email Recipients:"})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,C.jsxs)(g.Ay,{container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%"},children:[x.map((e,t)=>(0,C.jsx)(g.Ay,{item:!0,sx:{m:.5},children:(0,C.jsx)(S.A,{label:e,onDelete:()=>k(t),onClick:e=>((e,t)=>{j({index:t,element:e.currentTarget})})(e,t)})},t)),x.length<150?(0,C.jsx)(g.Ay,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,C.jsx)(Zt.A,{fullWidth:!0,variant:"standard",value:y,onChange:e=>{const t=e.target.value;b(t),""!==t&&D("Finalize currently edited email by pressing Enter/Return")},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&T(y)},onPaste:e=>{const t=e.clipboardData.getData("text");b(t),T(t),e.preventDefault()},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,C.jsxs)(d.A,{sx:{mt:1},spacing:1,alignItems:c?"stretch":"end",children:[(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,C.jsxs)(h.A,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[x.length," / ",150," recipient",x.length>1?"s":null," added"]}),(0,C.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),b(""),p([])},children:"Clear All"})]}),0===n.length?(0,C.jsx)(Fe.A,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,C.jsx)(Lt.A,{title:w,enterTouchDelay:0,children:(0,C.jsx)("span",{children:(0,C.jsx)(Ee.A,{onClick:e=>{const t=(0,R.OP)(e)?e:(0,R.OP)(x)?x:[];l.mutate(t)},variant:"contained",sx:{width:c?"100%":"fit-content"},disabled:!A||l.isPending,children:l.isPending?(0,C.jsx)(en.A,{disableShrink:!0,color:"inherit",size:"1.5rem"}):"SAVE EMAIL LIST"})})})]}),(0,C.jsx)(u.A,{anchorEl:null===f||void 0===f?void 0:f.element,open:Boolean(f),onClose:I,children:(0,C.jsx)(s.A,{onClick:()=>{var e;e=f.index,b(x[e]),k(e),I()},children:"Edit"})})]})};var ln=n(86328),on=n(95540),sn=n(25776),dn=n(38409),cn=n(55722);const un={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,C.jsx)(dn.A,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,C.jsx)(cn.A,{})}},hn={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:"\u2265",name:"above"}},xn=un,pn=(0,a.createContext)(),mn="id",An="alert_type",gn="sensor_id",vn="location_short",yn="datatypekey",bn="threshold_value",fn="days_of_week",jn="minutespastmidnight",wn="time_range",Sn="is_enabled",Dn="excluded_dates",Cn="owner_role",Tn="self_is_owner",kn="is_allowed_to_modify",In="message",Mn="max_once_a_day",En="parent_alert_id",Pn="child_alert",On="has_child_alert",_n=function(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xn.daily.id;return n===xn.threshold.id&&(e=hn.above_threshold.id,t=hn.below_threshold.id),{[mn]:"",[An]:e||n,[gn]:"",[yn]:"",[fn]:[0,1,2,3,4],[wn]:n===xn.threshold.id?[Ue.schoolHour.start,Ue.schoolHour.end]:null,[bn]:-1,[jn]:"",[Sn]:!0,[Dn]:[],[In]:"",[Mn]:!0,[En]:null,[On]:!1,[Pn]:n===xn.threshold.id?{[An]:t||n,[bn]:-1,[In]:""}:null}};function Rn(e){let{children:t}=e;const{currentSchoolID:n}=(0,a.useContext)(m.C),{data:l}=(0,kt.A)(),[o,s]=(0,a.useState)(_n()),[i,d]=(0,a.useState)(o),[c,u]=(0,a.useState)([]),[h,x]=(0,a.useState)([]),[A,g]=(0,a.useState)(),v=(0,a.useCallback)(e=>{if(!l)return[];const{sensors:t}=l;if(!(0,R.OP)(t))return[];const n=t.find(t=>t.sensor_id===e),a=null===n||void 0===n?void 0:n.allowedDataTypes;return a?a.map(e=>({value:e,label:p.Uy[e].name_title})):[]},[l]);(0,a.useEffect)(()=>{d((0,r.A)({},o))},[o]),(0,a.useEffect)(()=>{const e=i[gn];e&&""!==e&&u(v(e))},[i,v]);const y=(0,a.useCallback)(function(){const e=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];return e.forEach(t=>{if(!t)return;if(!!t[En]){const n=e.find(e=>e[mn]===t[En]);n&&(n[On]=!0,n[Pn]={[mn]:t[mn],[An]:t[An],[bn]:t[bn],[In]:t[In]})}else{if(t[An]===xn.daily.id)return;t[On]=!1,t[Pn]={[An]:t[An]===hn.above_threshold.id?hn.below_threshold.id:hn.above_threshold.id,[bn]:t[bn],[In]:""}}}),e},[]),b=(0,a.useCallback)(()=>{n&&(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:n})}).then(e=>{(0,R.OP)(e)&&x(y(e))}).catch(e=>{console.log(e)})},[n,y]);(0,a.useEffect)(()=>{n&&g(!1)},[n,b]);const f=(0,a.useMemo)(()=>({selectedAlert:o,setSelectedAlert:s,editingAlert:i,setEditingAlert:d,allowedDataTypesForSensor:c,setAllowedDataTypesForSensor:u,alerts:h,setAlerts:x,fetchAlerts:b,hasFetchedAlerts:A,setHasFetchedAlerts:g,addChildToAlerts:y}),[o,i,c,h,b,A,g,y]);return(0,C.jsx)(pn.Provider,{value:f,children:t})}const Wn=()=>(0,a.useContext)(pn),zn="ADD",Ln="EDIT",Fn="DELETE",Bn="Location",Hn="Data Type",Vn="Days",Un="Created By";var Nn=n(20067),Yn=n.n(Nn),qn=n(98533);function Qn(e){const{onConfirmedDelete:t}=e,[n,r]=(0,a.useState)(!1),l=(0,v.A)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Ee.A,{variant:"text",color:"error",onClick:()=>{r(!0)},children:"Delete"}),(0,C.jsxs)(Bt.A,{open:n,onClose:()=>{r(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,C.jsx)(Vt.A,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,C.jsx)(Ut.A,{children:(0,C.jsx)(qn.A,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,C.jsxs)(Ht.A,{sx:{justifyContent:"end"},children:[(0,C.jsx)(Ee.A,{onClick:()=>{r(!1)},sx:{color:l.palette.text.secondary},children:"Cancel"}),(0,C.jsx)(Ee.A,{onClick:()=>{t(),r(!1)},children:"Delete"})]})]})]})}const Gn={[zn]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[Ln]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[Fn]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}};var Kn=n(39423),Xn=n(20389),$n=n(69413),Jn=n(74605);const Zn=e=>{const{label:t="Optional Message",value:n,handleChange:a,maxLength:r,showTip:l=!0,disabled:s}=e,i=n?n.length:0;return(0,C.jsxs)(d.A,{direction:"column",children:[(0,C.jsx)(Zt.A,{label:t,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:r},value:n||"",onChange:e=>{a(e)},disabled:s}),(0,C.jsxs)(d.A,{direction:"row",gap:1,justifyContent:"space-between",sx:{mx:1,my:.5},children:[l?(0,C.jsx)(h.A,{color:"text.secondary",variant:"caption",children:"Optional message that will appear in the alert"}):(0,C.jsx)(o.A,{}),(0,C.jsxs)(h.A,{color:"text.secondary",variant:"caption",textAlign:"right",children:[i,"/",r]})]})]})},ea=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];var ta=n(60446),na=n.n(ta),aa=n(34576),ra=n(58390),la=n(77857),oa=n(64021);const sa=["day","selectedDates"],ia=(0,l.Ay)(la.a,{shouldForwardProp:e=>"selected"!==e})(e=>{let{theme:t,selected:n}=e;return(0,r.A)({},n&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"})}),da=e=>{const{day:t,selectedDates:n}=e,a=(0,Ye.A)(e,sa),l=n.includes(na()(t).format("YYYY-MM-DD"));return(0,C.jsx)(ia,(0,r.A)((0,r.A)({},a),{},{day:t,selected:l}))};function ca(e){const{selectedDates:t,handleChange:n,disabled:a}=e,l=t.map(e=>na()(e).format("YYYY-MM-DD")),o=t.length,s=o>0?"Excluded Dates (".concat(o," Days)"):"Excluded Dates";return(0,C.jsxs)(Yt,{dialogTitle:s,buttonLabel:s,buttonVariant:"text",disabled:a,maxWidth:"xs",displaySchoolID:!1,children:[(0,C.jsxs)(h.A,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,C.jsx)("b",{children:"NOT"})," want to receive alerts.",(0,C.jsx)("br",{}),"Useful for holidays or school breaks."]}),(0,C.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),n(t)},children:"Clear All"}),(0,C.jsx)(ra.$,{dateAdapter:aa.R,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,C.jsx)(oa.x,{displayWeekNumber:!0,slots:{day:e=>(0,C.jsx)(da,(0,r.A)((0,r.A)({},e),{},{selectedDates:l}))},onChange:(e,t)=>{"finish"===t&&n([na()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:na()().startOf("month")})})]})}function ua(e){const{daysOfWeek:t,excludedDates:n,handleDaysOfWeekChange:a,handleExcludedDatesChange:r,disabled:l}=e,s=(0,v.A)();return(0,C.jsxs)(g.Ay,{container:!0,rowSpacing:.5,columnSpacing:2,alignItems:"center",justifyContent:"stretch",children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,C.jsxs)(d.A,{direction:"row",gap:1,alignItems:"start",children:[(0,C.jsx)(o.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:l?s.palette.text.secondary:s.palette.primary.main,verticalAlign:"middle"}},children:(0,C.jsx)(cn.A,{sx:{mt:.75}})}),(0,C.jsx)(he.A,{value:t||_n()[fn],onChange:a,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:l,color:l?"standard":"primary",children:ea.map(e=>(0,C.jsx)(Lt.A,{title:e.label,arrow:!0,children:(0,C.jsx)(xe.A,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value))})]})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,md:6,ml:{xs:3,sm:0},children:(0,C.jsx)(ca,{selectedDates:n,disabled:l,handleChange:r})})]})}var ha=n(74681),xa=n(3147),pa=n(84834);const ma=e=>{const{min:t=0,max:n=100,value:l,defaultValue:o,stepsForThreshold:s=1,marks:i=null,handleChange:d,disabled:c,backgroundCssGradient:u,invertSelection:x=!1,showInput:p=!0,inputUnit:m,valueLabelDisplay:A="on",showTip:y=!0}=e,b=(0,v.A)(),[f,j]=(0,a.useState)(x?l||o:t),[w,S]=(0,a.useState)(x?n:l||o),[D,T]=(0,a.useState)(-1),[k,I]=(0,a.useState)(!1),[M,E]=(0,a.useState)(""),P=(0,a.useCallback)(e=>{if(!i)return-1;const t=i.filter(t=>t.value>=e);if(0===t.length)return-1;const n=t.reduce((t,n)=>n.value-e<t.value-e?n:t),a=i.indexOf(n);return x?a-1:a},[i,x]);(0,a.useEffect)(()=>{const e=x?l:t,a=x?n:l;j(e),S(a),T(P(x?e:a))},[P,x,l,n,t]);const O="repeating-linear-gradient(-45deg, ".concat(ha.A[800],", ").concat(ha.A[800]," 4px, ").concat(xa.A.white," 4px, ").concat(xa.A.white," 8px)"),_={height:"20vh",minHeight:"250px",maxHeight:"500px",cursor:c?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:xa.A.black},['& .MuiSlider-thumb[data-index="'.concat(x?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:b.palette.background.paper,backgroundImage:b.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:c?ha.A[400]:u},"& .MuiSlider-track":(0,r.A)({background:O},x?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}),['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(D,'"]')]:{color:b.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:b.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(g.Ay,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,C.jsx)(g.Ay,{item:!0,xs:"auto",minWidth:"4.5rem",children:p?(0,C.jsx)(Zt.A,{variant:"standard",type:"number",label:"Threshold",value:x?f:w,onChange:e=>{const a=""===e.target.value?"":Number(e.target.value);a&&""!==a||d(a),""!==a&&a>=t&&a<=n?(j(x?a:t),S(x?n:a),d(a),T(P(a)),I(!1),E("")):(I(!0),E("Threshold must be between ".concat(t," and ").concat(n)))},error:k,helperText:M,size:"small",fullWidth:!0,disabled:c,inputProps:{step:s,min:t,max:n,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),m?(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(h.A,{variant:"body2",children:m})}):null]}),(0,C.jsx)(g.Ay,{item:!0,xs:12,sx:{mt:2,ml:7.5},children:(0,C.jsx)(pa.Ay,{getAriaLabel:()=>"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[f,w],step:null===i?s:null,marks:i,disabled:c,min:t,max:n,onChange:(e,a)=>{const r=a[x?0:1];j(x?r:t),S(x?n:r),d(r),T(P(r))},valueLabelDisplay:A,orientation:"vertical",sx:_})}),(0,C.jsx)(g.Ay,{item:!0,sx:{mt:1,ml:1,visibility:!0===y?"visible":"hidden"},children:(0,C.jsx)(h.A,{color:"text.secondary",variant:"caption",display:"block",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})},Aa=e=>{const{value:t,invertSelection:n,handleValueChange:r,placeholderValueBeforeDataTypeSelection:l=.5,disabledSlider:o,showTip:s=!0}=e,{editingAlert:i}=Wn(),d=(0,v.A)(),{language:c}=(0,a.useContext)(jt.j);let u=null;const h=i[yn];if(h&&p.Uy[h]){const e=p.Uy[h],a=d.palette.chart.colorAxes[e.color_axis],{colors:l,minValue:x,maxValue:m,defaultValueForAlert:A,stepsForThreshold:g}=a,v=B({gradientDirection:"to top",colors:l});let y,b;switch(h){case p.vV.voc:b=ve.ZS;break;case p.vV.aqi:case p.vV.pm2_5:case p.vV.pm10_raw:case p.vV.co2:b=ve.m7;break;case p.vV.heat_index_C:b=ve.RZ;break;default:b=null}b&&(y=b.filter((e,t)=>0!==t).map(t=>({value:t[e.threshold_mapping_name].low,label:(0,R.sC)(t.category,c)})));const f=Object.keys(p.Uy).filter(e=>e===i[yn]).map(e=>p.Uy[e].unit)[0];u=(0,C.jsx)(ma,{min:x,max:m,marks:y,defaultValue:A,value:t,stepsForThreshold:g,disabled:o,backgroundCssGradient:v,invertSelection:n,handleChange:r,inputUnit:f,showTip:s})}else u=(0,C.jsx)(ma,{min:0,max:1,value:l,disabled:!0,showInput:!1,invertSelection:n,valueLabelDisplay:"off",showTip:s});return u};var ga=n(81673);const va=e=>{let{value:t,handleChange:n,disabled:a}=e;return(0,C.jsxs)(y.A,{component:"fieldset",variant:"standard",sx:{mt:{md:-1}},disabled:a,children:[(0,C.jsx)($n.A,{children:(0,C.jsx)(Jn.A,{control:(0,C.jsx)(f.A,{checked:t,onChange:n,size:"small"}),label:(0,C.jsx)(h.A,{color:"text.secondary",fontWeight:500,children:"Max Once a Day"}),color:"text.secondary"})}),(0,C.jsx)(ga.A,{sx:{mt:-.5},children:!0===t?(0,C.jsxs)(C.Fragment,{children:["Send alert ",(0,C.jsx)("strong",{children:"at most once a day"})," when the threshold is breached"]}):(0,C.jsxs)(C.Fragment,{children:["Send alert ",(0,C.jsx)("strong",{children:"every hour"})," for as long as the threshold is breached"]})})]})},ya=["currentAlertType","handleChange","disabled"],ba=["currentAlertType"],fa=e=>{let{currentAlertType:t,handleChange:n,disabled:a}=e,l=(0,Ye.A)(e,ya);return(0,C.jsx)(he.A,(0,r.A)((0,r.A)({color:a?"standard":"primary",disabled:a,defaultValue:hn.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:n},l),{},{children:Object.keys(hn).map(e=>{const t=hn[e];return(0,C.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)})}))},ja=e=>{let{currentAlertType:t}=e,n=(0,Ye.A)(e,ba);return(0,C.jsx)(he.A,(0,r.A)((0,r.A)({color:"standard",disabled:!0,defaultValue:hn.below_threshold.id,value:t,exclusive:!0,"aria-label":"non-interactive button displaying threshold type",size:"small"},n),{},{children:Object.keys(hn).map(e=>{const n=hn[e];return n.id!==t?null:(0,C.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:n.id,"aria-label":n.id,children:[n.sign,"\xa0",n.name]},n.id)})}))},wa=e=>{const t=e[Sn]?"enabled":"disabled",n=e[mn]?"is":"will be";return"This alert ".concat(n," ").concat(t)},Sa=e=>{var t,n,a,l;let{alertTypeKey:o,crudType:s}=e;const{data:i}=(0,kt.A)(),{editingAlert:c,allowedDataTypesForSensor:u,setEditingAlert:x}=Wn(),m=(0,v.A)(),A=null===i||void 0===i||null===(t=i.sensors)||void 0===t?void 0:t.map(e=>({value:e.sensor_id,label:(0,R.Cn)(e.location_short)})),y=e=>{switch(e){case gn:case Sn:return!1;case yn:return c[gn]===_n(o)[gn];case Pn:return!0!==c[On];default:return c[yn]===_n(o)[yn]}};return(0,C.jsxs)(d.A,{direction:"column",gap:2,mt:1,width:"100%",children:[null!==(n=Gn[s])&&void 0!==n&&n.contentText?(0,C.jsx)(qn.A,{fontWeight:"500",children:Gn[s].contentText}):null,(0,C.jsxs)(d.A,{direction:"row",gap:1,alignItems:"center",mb:2,children:[(0,C.jsx)(w.A,{size:"small",checked:c[Sn],onChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[Sn]:e.target.checked}))},disabled:y(Sn)}),(0,C.jsx)(h.A,{fontWeight:500,color:"text.secondary",children:wa(c)})]}),(0,C.jsxs)(g.Ay,{container:!0,columnSpacing:2,alignItems:"center",children:[(0,C.jsx)(g.Ay,{item:!0,xs:6,children:(0,C.jsx)(Qe,{icon:(0,C.jsx)(Xn.A,{}),label:Bn,value:c[gn],options:A,disabled:y(gn),handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[gn]:e.target.value,[yn]:""}))}})}),(0,C.jsx)(g.Ay,{item:!0,xs:6,children:(0,C.jsx)(Qe,{label:Hn,value:c[yn],options:u,disabled:y(yn),handleChange:e=>{var t,n;const a=e.target.value,l=p.Uy[a];x((0,r.A)((0,r.A)({},c),{},{[yn]:a,[bn]:null===(t=m.palette.chart.colorAxes[l.color_axis])||void 0===t?void 0:t.defaultValueForAlert,[Pn]:(0,r.A)((0,r.A)({},c[Pn]),{},{[bn]:null===(n=m.palette.chart.colorAxes[l.color_axis])||void 0===n?void 0:n.defaultValueForChildAlert})}))},flex:1})})]}),(0,C.jsx)(ua,{daysOfWeek:c[fn],excludedDates:c[Dn]||[],disabled:y(fn),handleDaysOfWeekChange:(e,t)=>{const n=Array.isArray(t)?t:[];x((0,r.A)((0,r.A)({},c),{},{[fn]:n.sort()}))},handleExcludedDatesChange:e=>{const t=c[Dn]||[],n=e.reduce((e,t)=>e.includes(t)?e.filter(e=>e!==t):[...e,t],t);x((0,r.A)((0,r.A)({},c),{},{[Dn]:n}))}}),(()=>{switch(o){case xn.daily.id:return(0,C.jsx)(Qe,{icon:(0,C.jsx)(Kn.A,{}),label:xn.daily.tableColumnHeader,value:c[jn],options:Ve,disabled:y(jn),handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[jn]:e.target.value}))}});case xn.threshold.id:return(0,C.jsxs)(g.Ay,{container:!0,columnSpacing:2,rowSpacing:.5,children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,C.jsx)(Ge,{timeRange:c[wn],defaultTimeRange:_n(xn.threshold.id)[wn],disabled:y(wn),handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[wn]:e}))}})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,md:6,children:(0,C.jsx)(va,{value:c[Mn],handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[Mn]:e.target.checked}))},disabled:y(Mn)})})]});default:return null}})(),o===xn.threshold.id?(0,C.jsxs)(g.Ay,{container:!0,alignItems:"start",spacing:2,children:[(0,C.jsxs)(g.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,children:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mt:"2px",mb:"12px"},children:"1. Alert if it is:"})}),(0,C.jsx)(g.Ay,{item:!0,sx:{mr:2},children:(0,C.jsx)(fa,{currentAlertType:c[An],handleChange:e=>{const t=e.target.value,n=t===hn.above_threshold.id?hn.below_threshold.id:hn.above_threshold.id;x((0,r.A)((0,r.A)({},c),{},{[An]:t,[Pn]:(0,r.A)((0,r.A)({},c[Pn]),{},{[An]:n})}))},disabled:y(An),sx:{height:"100%"}})}),(0,C.jsx)(Aa,{value:c[bn],invertSelection:c[An]===hn.below_threshold.id,handleValueChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[bn]:e}))},disabledToggle:y(An),disabledSlider:y(bn),placeholderValueBeforeDataTypeSelection:2/3}),(0,C.jsx)(g.Ay,{item:!0,xs:12,mt:2,children:(0,C.jsx)(Zn,{value:c[In],handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[In]:e.target.value}))},maxLength:200,label:"Optional Message for Main Alert",disabled:y(In)})})]}),(0,C.jsxs)(g.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,children:(0,C.jsx)($n.A,{children:(0,C.jsx)(Jn.A,{disabled:y(On),control:(0,C.jsx)(f.A,{checked:!!c[On],onChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[On]:e.target.checked}))},size:"small"}),label:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",children:"2. [Optional] Follow-up alert if it changes to:"}),color:"text.secondary"})})}),c[Pn]&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(g.Ay,{item:!0,sx:{mr:2},children:(0,C.jsx)(ja,{currentAlertType:null===(a=c[Pn])||void 0===a?void 0:a[An],sx:{height:"100%"}})}),(0,C.jsx)(Aa,{value:c[Pn][bn],invertSelection:(null===(l=c[Pn])||void 0===l?void 0:l[An])===hn.below_threshold.id||!0,handleValueChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[Pn]:(0,r.A)((0,r.A)({},c[Pn]),{},{[bn]:e})}))},disabledToggle:y(Pn),disabledSlider:y(Pn),showTip:!1,placeholderValueBeforeDataTypeSelection:1/3}),(0,C.jsx)(g.Ay,{item:!0,xs:12,mt:2,children:(0,C.jsx)(Zn,{value:c[Pn][In],handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[Pn]:(0,r.A)((0,r.A)({},c[Pn]),{},{[In]:e.target.value})}))},maxLength:200,label:"Optional Message for Follow-up Alert",showTip:!1,disabled:y(Pn)})})]})]})]}):(0,C.jsx)(Zn,{value:c[In],handleChange:e=>{x((0,r.A)((0,r.A)({},c),{},{[In]:e.target.value}))},maxLength:200,disabled:y(In)})]})},Da=e=>{var t;const{alertTypeKey:n,openAlertModificationDialog:l,crudType:o,handleClose:s}=e,{currentSchoolID:c}=(0,a.useContext)(m.C),{selectedAlert:u,setSelectedAlert:h,editingAlert:x,setEditingAlert:p,setAlerts:A,addChildToAlerts:g}=Wn(),[y,b]=(0,a.useState)(!1),{enqueueSnackbar:f}=(0,we.dh)(),j=(0,v.A)(),w=()=>{var e;if(n===xn.daily.id)return{valid:!0};if(!x[On])return{valid:!0};const t=x[An]===hn.above_threshold.id,a=x[bn],r=null===(e=x[Pn])||void 0===e?void 0:e[bn];return void 0===r?{valid:!0}:t&&a<=r||!t&&a>=r?{valid:!1,message:"The follow-up alert must have a ".concat(t?"lower":"higher"," threshold than the first alert")}:{valid:!0}},S=e=>{const t=(0,r.A)({},e);return delete t[Pn],delete t[On],t},D=(e,t)=>{const n=(0,r.A)((0,r.A)((0,r.A)({},e),e[Pn]),{},{[En]:t,[mn]:null});return delete n[Pn],delete n[On],n},T=e=>{let{passedCrudType:t}=e;const a=e=>{f(Gn[t].errorMessage,Se.n.error)},r=()=>{f(Gn[t].successMessage,Se.n.success),s()};switch(t){case zn:{const e=w();if(!e.valid)return void f(e.message,Se.n.error);(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c}),restMethod:_e.Xo.POST,body:S(x)}).then(e=>{A(t=>{const n=[...t,e];return g(n)}),r();const t=_n(n);if(h(t),p(t),!x[On])return;const l=e[mn];null!==l&&void 0!==l&&(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c}),restMethod:_e.Xo.POST,body:D(x,l)}).then(e=>{A(t=>{const n=[...t,e];return g(n)})}).catch(e=>a())}).catch(e=>a());break}case Ln:{const e=w();if(!e.valid)return void f(e.message,Se.n.error);const t=u[mn];(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c,alert_id:t}),restMethod:_e.Xo.PUT,body:S(x)}).then(e=>{var n;A(n=>{const a=n.map(n=>n.id===t?e:n);return g(a)}),r();const l=null===(n=x[Pn])||void 0===n?void 0:n[mn];x[On]?null===l||void 0===l?(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c}),restMethod:_e.Xo.POST,body:D(x,t)}).then(e=>{A(t=>{const n=[...t,e];return g(n)})}).catch(e=>a()):(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c,alert_id:l}),restMethod:_e.Xo.PUT,body:D(x,t)}).then(e=>{A(t=>{const n=t.map(t=>t.id===l?e:t);return g(n)})}).catch(e=>a()):null!==l&&void 0!==l&&(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c,alert_id:l}),restMethod:_e.Xo.DELETE}).then(()=>{A(e=>{const t=e.filter(e=>e.id!==l);return g(t)}),r()}).catch(e=>a())}).catch(e=>a());break}case Fn:(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c,alert_id:u.id}),restMethod:_e.Xo.DELETE}).then(()=>{A(e=>e.filter(e=>e.id!==u.id)),r()}).catch(e=>a())}};(0,a.useEffect)(()=>{var e,t;if((null===(e=x[wn])||void 0===e?void 0:e[0])>(null===(t=x[wn])||void 0===t?void 0:t[1]))b(!0);else switch(o){case zn:const e=_n(n);x[gn]===e[gn]||x[yn]===e[yn]?n===xn.daily.id?b(x[jn]===e[jn]):b(!0):n===xn.daily.id?b(x[jn]===e[jn]):b(!1);break;case Ln:let t;t=n===xn.daily.id?x[jn]:x[bn];const a=x[yn];if(!t||""===t||!a||""===a){b(!0);break}b(Yn()(u,x));break;default:b(!1)}},[o,u,x,n]);const k=(0,i.A)(e=>e.breakpoints.down("md"));return(0,C.jsxs)(Bt.A,{open:l,onClose:s,"aria-labelledby":"alert-modification-dialog",maxWidth:"md",fullWidth:!0,fullScreen:k,children:[(0,C.jsx)(Vt.A,{id:"alert-modification-dialog",children:null===(t=Gn[o])||void 0===t?void 0:t.title}),(0,C.jsx)(Ut.A,{children:(0,C.jsx)(Sa,{alertTypeKey:n,crudType:o})}),(0,C.jsxs)(Ht.A,{sx:{justifyContent:"space-between"},children:[o===Ln?(0,C.jsx)(Qn,{onConfirmedDelete:()=>{T({passedCrudType:Fn})}}):null,(0,C.jsxs)(d.A,{direction:"row",width:"100%",justifyContent:"end",children:[(0,C.jsx)(Ee.A,{onClick:s,sx:{color:j.palette.text.secondary},children:"Cancel"}),(0,C.jsx)(Ee.A,{onClick:()=>{T({passedCrudType:o})},color:"primary",disabled:y,children:"Save Edit"})]})]})]})};var Ca=n(73523),Ta=n(63572);const ka=e=>{if(!e||!(0,R.OP)(e))return"N/A";if(e.length===ea.length)return"Everyday";const t=ea.filter(t=>!e.includes(t.value));return 2===t.length&&t.every(e=>[5,6].includes(e.value))?"Only weekdays":e.map(e=>{var t;return null===(t=ea.find(t=>t.value===e))||void 0===t?void 0:t.label.slice(0,2)}).join(", ")},Ia=(e,t)=>t?"":e&&Ta.fo[e]?"".concat(Ta.fo[e].name," added your email to this school-wide alert. For edit or removal, please reach out to ").concat(Ta.fo[e].name,"."):void 0,Ma=e=>{var t;const{selectedAlert:n,setSelectedAlert:l,setAlerts:s,addChildToAlerts:i}=Wn(),{currentSchoolID:c}=(0,a.useContext)(m.C),{enqueueSnackbar:u}=(0,we.dh)(),{alertTypeKey:h,alertsForTable:x}=e,A=(0,v.A)(),[g,y]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),j=e=>{let{alert:t,crudType:n}=e;l(t),f(n),y(!0)};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(d.A,{spacing:2,alignItems:"center",children:[(0,C.jsx)(o.A,{sx:{width:"100%",overflowX:"auto"},children:(0,R.OP)(x)?(0,C.jsxs)(Et.A,{size:"small",sx:{my:1},children:[(0,C.jsx)(Pt.A,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(_t.A,{sx:{px:0}}),(0,C.jsx)(_t.A,{children:Bn}),(0,C.jsx)(_t.A,{children:Hn}),(0,C.jsx)(_t.A,{children:Vn}),(0,C.jsx)(_t.A,{children:(null===(t=xn[h])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,C.jsx)(_t.A,{children:Un})]})}),(0,C.jsx)(Ca.A,{component:Rt.A,children:(0,R.OP)(x)?x.map((e,t)=>{return(0,C.jsx)(ln.A,{children:(0,C.jsxs)(Ot.A,{sx:{background:e[mn]===n[mn]&&A.palette.background.NYUpurpleLight,textDecoration:!1===e[Sn]?"line-through":"none"},children:[(0,C.jsxs)(_t.A,{sx:{px:0},children:[(0,C.jsx)(Lt.A,{title:!1===e[kn]?Ia(e[Cn],e[kn]):"Click to ".concat(e[Sn]?"disable":"enable"," alert"),children:(0,C.jsx)("span",{onClick:()=>{!1!==e[kn]?(e=>{let{alert:t}=e;const n=!t[Sn];(0,Ce.i)({url:(0,Te.BW)({endpoint:_e.tK.alerts,school_id:c,alert_id:t[mn]}),restMethod:_e.Xo.PUT,body:(0,r.A)((0,r.A)({},t),{},{[Sn]:n})}).then(e=>{s(n=>{const a=n.map(n=>n[mn]===t[mn]?e:n);return i(a)}),u("This alert will be ".concat(n?"enabled":"disabled"),Se.n.success)}).catch(e=>{u(e.message||"There was an error ".concat(n?"enabling":"disabling"," this alert, try again!"),Se.n.error)})})({alert:e}):u(Ia(e[Cn],e[kn]),Se.n.warning)},style:{display:"inline-block"},children:(0,C.jsx)(w.A,{size:"small",disabled:!1===e[kn],checked:e[Sn]})})}),(0,C.jsx)(Lt.A,{title:!1===e[kn]?Ia(e[Cn],e[kn]):"Edit alert",children:(0,C.jsx)("span",{onClick:()=>{!1!==e[kn]?j({alert:e,crudType:Ln}):u(Ia(e[Cn],e[kn]),Se.n.warning)},style:{display:"inline-block"},children:(0,C.jsx)(Ft.A,{"aria-label":"edit",size:"small",disabled:!1===e[kn],sx:{"&:hover,:focus":{color:A.palette.primary.main}},children:(0,C.jsx)(on.A,{})})})})]}),(0,C.jsx)(_t.A,{sx:{textTransform:"capitalize"},children:e[vn]}),(0,C.jsx)(_t.A,{children:Object.keys(p.Uy).filter(t=>t===e[yn]).map(e=>p.Uy[e].name_title)[0]}),(0,C.jsx)(_t.A,{children:ka(e[fn])}),h===xn.threshold.id?(0,C.jsxs)(_t.A,{children:[hn[e[An]].sign," ",e[bn],"\xa0",Object.keys(p.Uy).filter(t=>t===e[yn]).map(e=>p.Uy[e].unit)[0]]}):null,h===xn.daily.id?(0,C.jsx)(_t.A,{children:He(e[jn])}):null,(0,C.jsx)(_t.A,{children:(0,C.jsx)(S.A,{label:(a=e[Cn],l=e[Tn],!0===l?"You":a?Ta.fo[a].name:"N/A"),size:"small"})})]})},t);var a,l}):null})]}):(0,C.jsxs)(Fe.A,{severity:"warning",sx:{mt:2},children:["No ",xn[h].name.toLowerCase()," alert has been set up"]})}),(0,C.jsx)(Ee.A,{variant:"outlined",startIcon:(0,C.jsx)(sn.A,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>j({alert:_n(h),crudType:zn}),children:"Add Alert"})]}),(0,C.jsx)(Da,{alertTypeKey:h,crudType:b,openAlertModificationDialog:g,handleClose:()=>{y(!1),l(_n(h))}})]})},Ea=["children","value","index","alertType","alertsArray"];function Pa(e){const{children:t,value:n,index:a,alertType:l,alertsArray:s}=e,i=(0,Ye.A)(e,Ea);return(0,C.jsx)(o.A,(0,r.A)((0,r.A)({role:"tabpanel",hidden:n!==a,id:"alert-tabpanel-".concat(l.id),"aria-labelledby":"alert-tab-".concat(l.id),width:"100%"},i),{},{children:(0,C.jsx)(Ma,{alertTypeKey:l.id,alertsForTable:s})}))}function Oa(){const e=(0,i.A)(e=>e.breakpoints.down("sm")),[t,n]=(0,a.useState)(0),{setSelectedAlert:r}=Wn(),{alerts:l}=Wn(),s=e=>{const t=l.filter(t=>{var n;if(!t)return null;const a=null===(n=t[An])||void 0===n?void 0:n.toLowerCase(),r=t[En];return!a.includes(e)||null!==r&&void 0!==r?null:t});return{array:t,alertsLength:(0,R.OP)(t)?t.length:"0"}};return(0,C.jsxs)(o.A,{children:[(0,C.jsx)(nt,{value:t,onChange:(e,t)=>{var a,l;n(t),r(_n(null===(a=xn[null===(l=Object.keys(xn))||void 0===l?void 0:l[t]])||void 0===a?void 0:a.id))},variant:e?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(xn).map(e=>{const t=s(e.id);return(0,C.jsx)(c.A,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)})}),Object.values(xn).map(e=>{const n=s(e.id);return(0,C.jsx)(Pa,{alertType:e,value:t,index:e.index,alertsArray:n.array},e.id)})]})}function _a(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Tt(t),{fetchAlerts:r,hasFetchedAlerts:l,setHasFetchedAlerts:o}=Wn(),{user:s}=(0,a.useContext)(Ct.R),i=[Ta.fo.admin.id,Ta.fo.school.id].includes(null===s||void 0===s?void 0:s.user_role);return(0,C.jsx)(Yt,{buttonIcon:(0,C.jsx)(Jt.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:e=>{n(e)&&!l&&(r(),o(!0))},children:(0,C.jsxs)(d.A,{width:"100%",spacing:i?5:2,children:[(0,C.jsx)(Oa,{}),i?(0,C.jsx)(rn,{}):(0,C.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,C.jsx)("b",{children:null===s||void 0===s?void 0:s.email})]})]})})}var Ra=n(50269),Wa=n(21122);const za=e=>{let{onLoginSuccess:t,children:n}=e;const r=(0,a.useRef)(null),{enqueueSnackbar:l}=(0,we.dh)(),{setAuthenticationState:o,setUser:s}=(0,a.useContext)(Ct.R),[i,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),h=(0,a.useCallback)(()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,n=window.open(Ra.S.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(n){n.focus(),r.current=n;const e=setInterval(()=>{n.closed&&(clearInterval(e),window.removeEventListener("message",x),r.current=null)},500)}else alert("Popup blocked. Please enable popups for login.")},[]),x=(0,a.useCallback)(e=>{if(e.origin===window.location.origin&&e.data.type===Ta.$_.password&&e.data.success){const n=e.data.user;o({checkedAuthentication:!0,authenticated:!0}),s(n),n.message&&l(n.message,Se.n.success),!1===n.is_verified&&(d(!0),u(n.email)),null===t||void 0===t||t()}},[t]);return(0,a.useEffect)(()=>(window.addEventListener("message",x),()=>{window.removeEventListener("message",x)}),[x]),(0,C.jsxs)(C.Fragment,{children:[n({openLoginPopup:h}),(0,C.jsx)(Wa.A,{open:i,email:c})]})},La=()=>{const{loggedIn:e}=Tt(),{enqueueSnackbar:t}=(0,we.dh)();return(0,C.jsx)(za,{onLoginSuccess:()=>{t("You can now access TV Screens, Dataset, and Alerts.",{variant:Se.n.success.name,duration:2*Se.n.success.duration})},children:t=>{let{openLoginPopup:n}=t;return(0,C.jsxs)(g.Ay,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(It,{onButtonClick:e?null:n})}),(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(Qt,{onButtonClick:e?null:n})}),(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(Rn,{children:(0,C.jsx)(_a,{onButtonClick:e?null:n})})})]})}})};var Fa=n(30922),Ba=n(78185);const Ha=["tooltipTitle","label"],Va=e=>{const{tooltipTitle:t,label:n}=e,a=(0,Ye.A)(e,Ha),l=(0,C.jsx)(S.A,(0,r.A)({size:"small",label:n||(0,C.jsx)(Ba.A,{variant:"text",sx:{minWidth:"5rem"}}),sx:{userSelect:"text","& .MuiChip-label":{userSelect:"text"}}},a));return t?(0,C.jsx)(Lt.A,{title:t,enterDelay:0,leaveDelay:200,children:l}):l};var Ua=n(84392),Na=n(39983);const Ya=(e,t)=>(0,C.jsxs)(o.A,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[e||"Loading...",t?(0,C.jsx)(Na.A,{}):(0,C.jsx)(Ze.A,{})]}),qa=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C),{data:t}=(0,kt.A)(),{user:n}=(0,a.useContext)(Ct.R),r=(0,Dt.Zp)(),[l,o]=(0,a.useState)(null),i=Boolean(l),d=()=>{o(null)};if(t)return!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1?(0,C.jsx)(Va,{icon:(0,C.jsx)(Xn.A,{}),label:t.name||"No School Name Given",tooltipTitle:"School"}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Va,{icon:(0,C.jsx)(Xn.A,{}),label:Ya(t.name,i),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{o(e.currentTarget)},"aria-controls":i?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0}),(0,C.jsx)(u.A,{anchorEl:l,open:i,onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,C.jsx)(Fa.A,{dense:!0,children:n.allowedSchools.map((t,n)=>{return(0,C.jsx)(s.A,{onClick:(a=t.school_id,()=>{e!==a&&(localStorage.setItem(Ua.D.schoolID,a),At.n(At.s.internalNavigation,{origin_school:e,destination_school_id:a,origin_id:"school_selector"}),r("".concat(Ra.S.dashboard,"/").concat(a))),d()}),children:t.name},n);var a})})})]})};var Qa=n(52177);const Ga=()=>{const{data:e}=(0,kt.A)();if(e)return(0,C.jsxs)(g.Ay,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(qa,{})}),(0,C.jsx)(g.Ay,{item:!0,children:(0,C.jsx)(Va,{icon:(0,C.jsx)(Qa.A,{}),label:"".concat(e.contactPerson," <").concat(e.contactEmail,">"),tooltipTitle:"Main Contact",component:"a",href:"mailto:".concat(null===e||void 0===e?void 0:e.contactEmail),clickable:!0})})]})},Ka=()=>{const e=(0,v.A)(),{data:t}=(0,kt.A)();return t?(0,C.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,U.Ay)(t.description||"",{replace:R.H$})}):Array.from({length:3}).map((e,t)=>(0,C.jsx)(Ba.A,{variant:"text"},t))};var Xa=n(54536);const $a=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,a.useContext)(m.C);return!1===e?(0,C.jsx)(d.A,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,C.jsxs)(Ee.A,{variant:"contained",onClick:()=>{t(!0)},children:[(0,C.jsx)(Xa.A,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null};var Ja=n(61413);const Za=()=>{const{currentSchoolID:e,loadMoreCharts:t}=(0,a.useContext)(m.C),{data:n}=(0,qt.A)(),{data:r}=(0,kt.A)(),l=t?_e.HG.length:me.JO,{themePreference:s,temperatureUnitPreference:i}=(0,a.useContext)(jt.j);return(0,C.jsxs)(o.A,{width:"100%",children:[(0,C.jsx)(vt,{}),(0,C.jsx)(bt.A,{backgroundColor:"customAlternateBackground",children:(0,C.jsxs)(st.A,{sx:{pt:2,pb:2},children:[(0,C.jsxs)(g.Ay,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,C.jsx)(g.Ay,{item:!0,xs:12,children:(0,C.jsx)(ot.A,{text:(()=>{if(null!==r&&void 0!==r&&r.school_id)return"Air Quality | ".concat(null===r||void 0===r?void 0:r.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,children:(0,C.jsx)(Ga,{})}),(0,C.jsx)(g.Ay,{item:!0,xs:12,children:(0,C.jsx)(La,{})})]}),!0===(null===r||void 0===r?void 0:r.has_map)?(0,C.jsx)(Ja.A,{currentSensorsData:n,schoolID:e,isOnBannerPage:!1,minMapHeight:"250px"}):(0,C.jsx)(o.A,{textAlign:"center",sx:{mb:2},children:(0,C.jsx)(ft.A,{currentSensorsData:n,isScreen:!1,temperatureUnitPreference:i,showHeatIndex:e===me.iC&&!1,showWeather:e===me.iC&&!1})}),(0,C.jsx)(Ka,{}),(0,C.jsx)(wt.A,{})]})}),(0,C.jsx)(o.A,{id:yt.charts.id,children:_e.HG.slice(0,l).map((e,n)=>(0,C.jsx)(bt.A,{backgroundColor:n%2!==0?"customAlternateBackground":"",children:(0,C.jsxs)(st.A,{sx:{pt:4,pb:4},height:"auto",className:s===dt.A.dark?"dark":"",id:"chart-".concat(n+1),children:[(0,C.jsx)(Oe,{children:(0,C.jsx)(lt,{chartID:n})}),n===l-1&&!t&&(0,C.jsx)($a,{})]})},n))}),(0,C.jsx)(it.A,{})]})};var er=n(25282);const tr=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C);(0,a.useEffect)(()=>{e&&(document.title="".concat(me.sG," | ").concat(e.toUpperCase()))},[e]);const{setCurrentPage:t}=(0,a.useContext)(er.B);return(0,a.useEffect)(()=>{t(Ra.S.dashboard)},[t]),(0,C.jsx)(Za,{})}},35197:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(22555),r=n(80045),l=n(85865),o=n(78185),s=n(70579);const i=["text","sx"];function d(e){let{text:t,sx:n}=e,d=(0,r.A)(e,i);return(0,s.jsx)(l.A,(0,a.A)((0,a.A)({variant:"h4",color:"text.primary",sx:(0,a.A)({fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1},n)},d),{},{children:t||(0,s.jsx)(o.A,{variant:"text"})}))}},47298:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(71806),r=n(96446),l=n(84882),o=n(28076),s=n(10039),i=n(73460),d=n(34535),c=n(85721),u=n(8011),h=n(52687),x=n(65043),p=n(65290),m=n(94922),A=n(70579);const g=(0,d.Ay)(a.A,{shouldForwardProp:e=>"tiny"!==e})(e=>{let{theme:t,tiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}});const v=function(e){const{themePreference:t,language:n}=(0,x.useContext)(p.j),{tiny:a,hideAQIDescription:d}=e,v=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,A.jsx)(A.Fragment,{children:(0,A.jsx)(r.A,{overflow:"auto",children:(0,A.jsxs)(g,{size:"small",tiny:a,children:[(0,A.jsx)(l.A,{children:(0,A.jsxs)(o.A,{children:[(0,A.jsx)(s.A,{sx:{pr:0},children:(0,A.jsx)(r.A,{sx:{width:"1em",height:"1em"}})}),(0,A.jsx)(s.A,{sx:{pl:1},children:"Category"}),(0,A.jsx)(s.A,{align:"right",children:"US AQI"}),(0,A.jsxs)(s.A,{align:"right",children:["PM2.5 (\xb5g/m",(0,A.jsx)("sup",{children:"3"}),")"]}),!d&&(0,A.jsx)(s.A,{align:"left",children:"Description"}),!d&&(0,A.jsxs)(s.A,{align:"left",children:[m.sG,"' Suggested Actions"]})]})}),(0,A.jsx)(i.A,{children:h.m7.map((e,a)=>(0,A.jsxs)(o.A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,A.jsx)(s.A,{sx:{pr:0},children:(0,A.jsx)(r.A,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,A.jsx)(s.A,{sx:{pl:1},children:(0,u.sC)(e.category,n)}),(0,A.jsx)(s.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.aqiUS.low,e.aqiUS.high)}),(0,A.jsx)(s.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.rawPM2_5.low,e.rawPM2_5.high)}),!d&&(0,A.jsx)(s.A,{align:"left",children:e.description}),!d&&(0,A.jsx)(s.A,{align:"left",children:(0,c.Ay)((0,u.sC)(e.healthSuggestions.outdoors,n),{replace:u.H$})})]},a))})]})})})}},51210:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(65043),r=n(34535),l=n(13766),o=n(86605),s=n(40710),i=n(96446),d=n(77739),c=n(85865),u=n(40430),h=n(97847),x=n(70579);const p=(0,r.Ay)(l.A)(e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}}),m=(0,r.Ay)(o.A)(e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(1):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(1),marginBottom:t.spacing(1)}}}),A="Click to expand section",g="Click to collapse section",v=e=>{const{title:t,content:n,icon:r,disabled:l}=e,[o,v]=(0,a.useState)(void 0);return(0,x.jsx)(i.A,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,x.jsxs)(p,{expanded:"panel1"===o,onChange:(y="panel1",(e,n)=>{v(n?y:void 0),h.n(n?h.s.expandSection:h.s.collapseSection,{section:t})}),disabled:l,children:[(0,x.jsx)(m,{expanded:o,expandIcon:(0,x.jsx)(u.A,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,x.jsx)(d.A,{title:o?g:A,enterDelay:0,leaveDelay:200,children:(0,x.jsxs)(c.A,{component:"a",variant:"body1",children:[t,(0,x.jsx)(i.A,{component:"span",sx:{ml:.25},children:r})]})})}),(0,x.jsx)(s.A,{sx:{pt:0},children:n})]})});var y}},73605:(e,t,n)=>{n.d(t,{A:()=>A});var a=n(65043),r=n(96446),l=n(85865),o=n(85721),s=n(8011),i=n(47298),d=n(51210),c=n(65290),u=n(98348),h=n(70579);const x="Explanation of the US Air Quality Index (AQI) for PM2.5",p="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',A=()=>{const{themePreference:e}=(0,a.useContext)(c.j);return(0,h.jsx)(d.A,{title:x,icon:(0,h.jsx)(u.A,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(r.A,{children:[(0,h.jsx)(i.A,{themePreference:e}),(0,h.jsx)(l.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,o.Ay)(p,{replace:s.H$})}),(0,h.jsx)(d.A,{title:"Reference",content:(0,h.jsx)(l.A,{variant:"caption",color:"text.secondary",children:(0,o.Ay)(m,{replace:s.H$})})})]})})}}}]);
//# sourceMappingURL=200.2bcdf1f8.chunk.js.map