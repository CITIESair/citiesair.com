"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[152],{4967:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(92535),r=n(65043),o=n(9209),i=n(96157),l=n(38119),s=n(22126);const d=()=>{const{currentSchoolID:e}=(0,r.useContext)(i.C);return(0,a.I)({queryKey:["schoolMetadata",e],queryFn:async()=>{const t=(0,l.e9)({endpoint:s.tK.schoolmetadata,school_id:e});return(0,o.i)({url:t})},enabled:!!e,staleTime:36e5,placeholderData:e=>e})}},10969:(e,t,n)=>{n.r(t),n.d(t,{default:()=>er});var a=n(65043),r=n(22555),o=n(34535),i=n(96446),l=n(91449),s=n(30344),d=n(88911),c=n(24056),u=n(72437),h=n(85865),p=n(21337),x=n(49881),m=n(96157),g=n(33656),A=n(68903),v=n(26240),y=n(53193),b=n(69285),f=n(51962),j=n(36694),w=n(4598),S=n(43845),D=n(47260),C=n(70579);const k="Show All Sensors";function T(e){const{items:t,selectorID:n,allowMultiple:o,seriesLabel:i,onSeriesSelection:c,displayChip:u=!0}=e,p=(0,v.A)(),x=(0,s.A)(e=>e.breakpoints.up("lg")),m={PaperProps:{style:{maxHeight:274.4,overflow:"visible !important",background:p.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[g,T]=(0,a.useState)(t),[I,M]=(0,a.useState)(o);(0,a.useEffect)(()=>{T(t)},[t]),(0,a.useEffect)(()=>{M(g.every(e=>e.selected))},[g]);const E=e=>{const{target:{value:t}}=e;if(t.includes(k)){const e=g.map((e,t)=>(0,r.A)((0,r.A)({},e),{},{selected:0==t||!I}));c({newDataColumns:e}),M(!I)}else{const e=g.filter(e=>t.includes(e.label)),n=g.map(t=>(0,r.A)((0,r.A)({},t),{},{selected:e.some(e=>e.label===t.label)}));c({newDataColumns:n}),M(!1)}},P=e=>{const t=g.map(t=>t.label===e.label?(0,r.A)((0,r.A)({},t),{},{selected:!t.selected}):t);c({newDataColumns:t})};return(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[x?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Show/Hide"}):null,(0,C.jsxs)(d.A,{spacing:1,direction:"row",alignItems:"center",children:[(0,C.jsx)(y.A,{sx:{width:"100%",minWidth:"10rem","& .MuiInputBase-root":{borderRadius:"".concat(p.shape.borderRadius,"px")}},size:"small",children:(0,C.jsxs)(b.A,{labelId:"".concat(n,"-label"),id:n,multiple:o,value:g.filter(e=>e.selected).map(e=>e.label),onChange:E,MenuProps:m,renderValue:e=>(e=>(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:.5,children:[(0,C.jsx)(D.A,{fontSize:"1.5rem",sx:{color:p.palette.text.secondary}}),(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:o?"".concat(e.length,"/").concat(g.length," ").concat(i||""," shown"):e})]}))(e),sx:{fontSize:"0.75em","& .MuiSelect-select":{py:"6.5px"},"& .MuiSvgIcon-root":{color:"text.secondary"}},children:[g.map(e=>(0,C.jsxs)(l.A,{disabled:!(1!==g.filter(e=>e.selected).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[o?(0,C.jsx)(f.A,{checked:e.selected,onClick:()=>P(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,C.jsx)(j.A,{checked:e.selected,onChange:()=>E(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,C.jsx)(h.A,{variant:"caption",children:e.label})]},e.label)),o?(0,C.jsx)(l.A,{value:k,sx:{borderTop:"solid 0.5px",borderColor:p.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:p.spacing(-1),background:p.palette.customAlternateBackground,"&:hover":{background:p.palette.customAlternateBackground}},children:(0,C.jsxs)(d.A,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,C.jsx)(h.A,{fontWeight:500,variant:"caption",sx:{pl:1},children:k}),(0,C.jsx)(w.A,{checked:I,onClick:()=>P(k),sx:{transform:"scale(0.8)"}})]})},k):null]})}),u&&o&&(0,C.jsx)(A.Ay,{container:!0,spacing:1,sx:{[p.breakpoints.down("sm")]:{display:"none"}},children:g.filter(e=>e.selected).map(e=>(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(S.A,(0,r.A)({label:(0,C.jsx)(h.A,{variant:"caption",children:e.label}),size:"small"},1!==g.filter(e=>e.selected).length&&{onDelete:()=>P(e)}))},e.label))})]})]})}const I={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},M={stem:{length:0},textStyle:{opacity:0},boxStyle:null},E=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},P=e=>{var t;const{chartControl:n,mainChartData:a,mainChartOptions:o,subchartIndex:i,theme:l,isPortrait:s}=e;let d=(0,r.A)((0,r.A)({},null===(t=n.options)||void 0===t?void 0:t.ui),{},{snapToData:!0});return"ChartRangeFilter"===n.controlType&&(d=(0,r.A)((0,r.A)({},d),{},{chartType:a.chartType,chartView:{columns:a.columns||a.subcharts&&a.subcharts[i].columns||null},chartOptions:(0,r.A)((0,r.A)({},o),{},{hAxis:(0,r.A)((0,r.A)({},o.hAxis),{},{textPosition:"out",textStyle:{color:l.palette.chart.axisText,fontSize:E({isPortrait:s,isSmaller:!0})},title:null}),vAxis:(0,r.A)((0,r.A)({},o.vAxis),{},{title:null}),annotations:M,legend:null,pointSize:0})})),d},O=(0,o.Ay)(i.A,{shouldForwardProp:e=>"gradientBackgroundId"!==e&&"isPortrait"!==e})(e=>{let{theme:t,isPortrait:n,gradientBackgroundId:a}=e;return{'& [id*="google-visualization-errors-all"]':{display:"none !important"},"& svg>g:nth-of-type(2)>rect:first-of-type":{fill:"url(#".concat(a,")"),fillOpacity:1,filter:"contrast(0.4) brightness(1.4)"},"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(n?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(n?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}});var R=n(66477),z=n(17535),W=n(8011);const _=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;if(!(0,W.OP)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map((t,n)=>({color:t,offset:n/(e-1)}))}{let e=t;n&&(e=t.filter(e=>e.offset>=n)),a&&(e=t.filter(e=>e.offset<=a));const r=e.map(e=>e.offset),o=(e=>{let{offsets:t,minOffset:n,maxOffset:a}=e;return t.map(e=>(e-n)/(a-n))})({offsets:r,minOffset:n||Math.min(...r),maxOffset:a||Math.max(...r)});return e.map((e,t)=>({color:e.color,offset:o[t]}))}};function L(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}function F(e,t,n){if(e.every((e,n)=>e===t[n]))return e;let a=e.slice();for(let r=0;r<3;r++)a[r]=Math.round(a[r]+n*(t[r]-e[r]));return a}const B=e=>{let{colors:t,numSteps:n=100}=e;const a=_({colors:t});a.forEach(e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,a){return t+t+n+n+a+a});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)});let r=[];const o=Array.from({length:n},(e,t)=>t/(n-1));for(let i=0;i<o.length;i++){const e=o[i];let t,n,l,s;for(let r=0;r<a.length-1;r++)if(e>=a[r].offset&&e<=a[r+1].offset){t=a[r].color,n=a[r+1].color,l=a[r].offset,s=a[r+1].offset;break}const d=F(t,n,(e-l)/(s-l));r.push(L(...d))}return r},H=e=>{let{gradientDirection:t,colors:n,optionalMinValue:a,optionalMaxValue:r}=e;const o=_({colors:n,optionalMinValue:a,optionalMaxValue:r});return"linear-gradient(".concat(t,", ").concat(o.map(e=>"".concat(e.color," ").concat(100*e.offset,"%")).join(", "),")")},V=e=>{let{id:t,colors:n}=e;return(0,C.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,C.jsx)("defs",{children:(0,C.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map((e,t)=>(0,C.jsx)("stop",{offset:e.offset,stopColor:e.color},t))})})})},U=e=>{let{title:t,valueRange:n,colorAxis:a,isPortrait:o}=e;const l=(0,v.A)();if(null===(null===n||void 0===n?void 0:n.min)||null===(null===n||void 0===n?void 0:n.max))return null;const{colors:s,minValue:d,maxValue:c}=a;let u=d,p=c;void 0===d&&(u=n.min),void 0===c&&(p=n.max),n.min<u&&(u=n.min),n.max>p&&(p=n.max);const x=e=>"".concat((e-u)/(p-u)*100,"%"),m={position:"absolute",fontSize:"0.75rem",color:l.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},g={bottom:"-1.25rem",transform:o?"translateX(-100%)":"translateX(-50%)"},A={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},y={top:"-0.5rem",borderTop:"0.25rem solid ".concat(l.palette.text.secondary)},b={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(l.palette.text.secondary)};return(0,C.jsxs)(i.A,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:o?"0":"50px"},children:[(0,C.jsx)(h.A,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,C.jsxs)(i.A,{sx:{background:H({gradientDirection:"to right",colors:s,optionalMaxValue:p}),color:l.palette.text.secondary,border:"1px solid ".concat(l.palette.text.secondary),width:o?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,C.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),{top:"-1.5rem",transform:"translateX(-50%)"}),{},{left:x(n.min)}),children:["min: ",Math.round(n.min)]}),(0,C.jsxs)("span",{style:(0,r.A)((0,r.A)((0,r.A)({},m),g),{},{left:x(n.max)}),children:["max: ",Math.round(n.max)]}),(0,C.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},A),y),{},{left:x(n.min)})}),(0,C.jsx)("div",{style:(0,r.A)((0,r.A)((0,r.A)({},A),b),{},{left:x(n.max)})})]})]})};var N=n(85721);const Y=e=>{let{day:t,color:n,tooltipText:r,dateRange:o,inFirstTwoRowsOfChart:l}=e;const s=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(s.current&&l(t,o)){const e=s.current.parentElement;e&&(e.style.top="11vh")}},[s,l]),(0,C.jsxs)(i.A,{ref:s,className:"nivo-tooltip",children:[(0,C.jsx)(S.A,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,N.Ay)(r,{replace:W.H$})]})},q=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},Q=e=>{var t,n,r,o,l;const{dataArray:s,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[p,x]=(0,a.useState)({min:null,max:null}),[m,g]=(0,a.useState)({min:null,max:null}),[A,y]=(0,a.useState)(400);(0,a.useEffect)(()=>{if(!(0,W.OP)(s))return;const e=(e=>({min:e.reduce((e,t)=>t<e?t:e),max:e.reduce((e,t)=>t>e?t:e)}))(s.map(e=>e.day));x(e);const t=s.map(e=>e.value);g((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const n=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,a=q(c),r=n*(7*Math.min(h[0]/60,20)+40)+a.top+a.bottom;y(r)},[s,h]);const b=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,f=q(c),j=(0,v.A)(),w=(e,t)=>{const n=new Date(e),a=n.getDay(),r=0===a||1===a,o=new Date(t.min).getFullYear(),i=n.getFullYear()===o;return r&&i},S=B({colors:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.colors,numSteps:null===u||void 0===u||null===(r=u.colorAxis)||void 0===r?void 0:r.gradientSteps});return(0,C.jsxs)(O,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[b?(0,C.jsx)(U,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,C.jsx)(i.A,{sx:{height:"".concat(A,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,C.jsx)(i.A,{sx:{height:"".concat(A,"px"),position:"absolute",width:"100%"},children:(0,C.jsx)(z.Zm,{data:s,from:p.min,to:p.max,emptyColor:"transparent",align:"top",theme:{text:{fill:j.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(o=u.colorAxis)||void 0===o?void 0:o.minValue,maxValue:null===u||void 0===u||null===(l=u.colorAxis)||void 0===l?void 0:l.maxValue,margin:f,yearSpacing:40,monthBorderColor:j.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:a}=e;const r=s.find(e=>e.day===t),o=r?(i=r.tooltip,(new DOMParser).parseFromString(i,"text/html").body.innerHTML):"";var i;return(0,C.jsx)(Y,{day:t,color:a,tooltipText:o,dateRange:p,inFirstTwoRowsOfChart:w})}})})})]})};var X=n(86347),K=(n(87151),n(74864),n(63336)),G=n(76859),$=n(56036),J=n(36870),Z=n(4006),ee=n(73561);const te=new Date,ne={label:"Yesterday",range:()=>({startDate:(0,G.o)((0,$.f)(te,-1)),endDate:(0,J.D)(te)})},ae={label:"Last 14d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-14)),endDate:(0,J.D)(te)})},re={label:"Last 30d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-30)),endDate:(0,J.D)(te)})},oe={label:"Last 365d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-365)),endDate:(0,J.D)(te)})},ie=e=>{let{minDateOfDataset:t}=e;const n=(0,Z.GP)(t,"MMM yyyy");return{label:"All Time (".concat(n," - Now)"),range:()=>({startDate:t,endDate:(0,J.D)(te)})}},le=e=>{let{minDateOfDataset:t,aggregationType:n}=e;switch(n){case ee.A.minute:return[ne];case ee.A.day:return[re,oe];case ee.A.month:case ee.A.year:return[ie({minDateOfDataset:t})];default:return[ae,re]}},se={[ee.A.minute]:{maxDays:1,label:"Live"},[ee.A.hour]:{maxDays:30,label:"Hourly"},[ee.A.day]:{maxDays:365,label:"Daily"},[ee.A.month]:{maxDays:1/0,label:"Monthly"},[ee.A.year]:{maxDays:1/0,label:"Yearly"}},de=(0,o.Ay)(K.A,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})(e=>{let{theme:t,showPickerPanel:n,smallScreen:a}=e;return{zIndex:!0===n&&1,position:"relative",padding:n?t.spacing(1):0,margin:n&&!a?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDateInput::before":{display:"none !important"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none",padding:0},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"10rem",display:"flex",justifyContent:"center",alignItems:"center",height:"2rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"9rem",height:"2rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"10.5rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}});var ce,ue=n(57528),he=n(1119),pe=n(84511),xe=n(83290),me=n(94922),ge=n(69369),Ae=n(87332),ve=n(52687);const ye=(0,xe.i7)(ce||(ce=(0,ue.A)(["\n  0% { opacity: 1; }\n  50% { opacity: 0.6; }\n  100% { opacity: 1; }\n"])));function be(e){let{aggregationType:t,setAggregationType:n}=e;const{currentSchoolID:o}=(0,a.useContext)(m.C),i=(0,ge.u)(),l=(0,s.A)(e=>e.breakpoints.up("lg")),d=(0,s.A)(e=>e.breakpoints.down("sm")),c=Object.values(ee.A).filter(e=>o!==me.iC||e!==ee.A.minute);return(0,C.jsx)(he.A,{fullWidth:d,color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",sx:{height:"100%",[i.breakpoints.down("sm")]:{width:"100%"}},orientation:l?"vertical":"horizontal",children:Object.values(c).map(e=>{var t;return(0,C.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5,color:"text.secondary"},value:e,"aria-label":e,children:[e===ee.A.minute&&(0,C.jsx)(Ae.A,{sx:(0,r.A)((0,r.A)({},l?{position:"absolute",left:"50%",transform:"translateX(calc(-50% - 1.25rem))"}:{mr:.3}),{},{color:ve.m7[3].color.Light,fontSize:"0.75rem",animation:"".concat(ye," 2s infinite ease-in-out")})}),(null===(t=se[e])||void 0===t?void 0:t.label)||""]},e)})})}var fe=n(46560),je=n(31021),we=n(46987),Se=n(79958),De=n(92535),Ce=n(9209),ke=n(38119);const Te=e=>{const{allChartsConfigs:t,currentSchoolID:n}=(0,a.useContext)(m.C),r=t[e];return(0,De.I)({queryKey:["chartData",e,r,n],queryFn:async()=>{const e=(0,ke.ML)({endpoint:r.endpoint,school_id:n,queryParams:r.queryParams});return(0,Ce.i)({url:e})},enabled:!!n&&!(null===r||void 0===r||!r.endpoint),staleTime:6e5,placeholderData:e=>e})},Ie=e=>{const{minDateOfDataset:t,chartIndex:n}=e,[o,l]=(0,a.useState)(!0),{enqueueSnackbar:c}=(0,we.dh)(),{isFetching:u}=Te(n),{allChartsConfigs:p,updateIndividualChartConfigQueryParams:x}=(0,a.useContext)(m.C),g=(p[n]||{}).queryParams||{},[y,b]=(0,a.useState)(g.aggregationType||ee.A.hour),[f,j]=(0,a.useState)(()=>{const{startDate:e,endDate:t}=g;return e&&t?{startDate:new Date(e),endDate:new Date(t),key:"selection"}:{startDate:null,endDate:null,key:"selection"}}),w=new Date,S=(0,v.A)(),D=(0,s.A)(S.breakpoints.down("sm")),k=(0,s.A)(e=>e.breakpoints.up("lg"));(0,a.useEffect)(()=>{const e=(0,r.A)((0,r.A)({},le({aggregationType:y||ee.A.hour,minDateOfDataset:t})[0].range()),{},{key:"selection"});j(e)},[y]),(0,a.useEffect)(()=>{var e;if(o)return void l(!1);const{startDate:t,endDate:a}=f||{};if(!t||!a)return;if((0,fe.r)(t,a))return;const r=null===(e=se[y])||void 0===e?void 0:e.maxDays;if((0,je.c)(a,t)>r)return void c("".concat(se[y]," average is limited to max ").concat(r,"d"),Se.n.error);const i=(e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,Z.GP)(t,"yyyy-MM-dd"),endDate:(0,Z.GP)(n,"yyyy-MM-dd")}})({startDateObject:t,endDateObject:a});x(n,{aggregationType:y,startDate:i.startDate,endDate:i.endDate})},[f]);const[T,I]=(0,a.useState)(!1),M=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[M]),(0,a.useEffect)(()=>{!u&&T&&I(!1)},[u]),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(A.Ay,{item:!0,alignItems:T?"start":"stretch",xs:!0,sm:"auto",lg:!0,children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[k?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Averaging Period"}):null,(0,C.jsx)(be,{aggregationType:y,setAggregationType:b,smallScreen:D})]})}),(0,C.jsx)(A.Ay,{item:!0,sx:{height:"2rem",flex:1,[S.breakpoints.up("lg")]:{minHeight:"4rem"}},children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,children:[k?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Date Range"}):null,(0,C.jsx)(de,{showPickerPanel:T,smallScreen:D,ref:M,elevation:8,onClick:()=>I(!0),sx:{position:"relative"},children:(0,C.jsx)(i.A,{sx:{transition:"filter 0.2s ease-in-out"},children:(0,C.jsx)(X.Ur,{ranges:[f],onChange:e=>{e&&j(e.selection)},staticRanges:(0,X.hs)(le({minDateOfDataset:t,aggregationType:y})),inputRanges:[],rangeColors:[S.palette.primary.main,S.palette.secondary.main,S.palette.text.secondary],minDate:t,maxDate:w,months:1,showMonthAndYearPickers:!0,direction:"vertical",fixedHeight:!0,preventSnapRefocus:!0,startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0,weekStartsOn:1})})})]})})]})};var Me=n(81637),Ee=n(79190),Pe=n(11906);const Oe=(0,a.createContext)();function Re(e){let{children:t}=e;const[n,r]=(0,a.useState)(),[o,i]=(0,a.useState)(),l=(0,a.useMemo)(()=>({hAxis:n,setHAxis:r,vAxis:o,setVAxis:i}),[n,o]);return(0,C.jsx)(Oe.Provider,{value:l,children:t})}var ze=n(22126);const We=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{borderTopRightRadius:0,borderBottomRightRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}}),_e=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{borderTopLeftRadius:0,borderBottomLeftRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0}}}),Le=e=>{const{currentSchoolID:t,setIndividualChartConfig:n}=(0,a.useContext)(m.C),{chartID:r,allowedAxes:o,selectedAxes:i,dataType:s}=e,{hAxis:c,vAxis:u,setHAxis:h,setVAxis:p}=(0,a.useContext)(Oe),[x,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!0);(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=i||{};e&&t?(h(e),p(t)):y(!0)},[i,h,p]),(0,a.useEffect)(()=>{const{hAxis:e,vAxis:t}=i;e&&t&&y(c===e&&u===t)},[c,u,i]);const f=e=>!e.allowedDataTypes.includes(s);return(0,C.jsxs)(A.Ay,{container:!0,item:!0,spacing:1,alignItems:"center",children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,sm:"auto",children:(0,C.jsxs)(d.A,{direction:"row",spacing:0,children:[(0,C.jsxs)(We,{fullWidth:!0,size:"small",children:[(0,C.jsx)(Ee.A,{id:"x-axis-select-label",children:"X Axis"}),(0,C.jsx)(b.A,{labelId:"x-axis-select-label",value:c||(null===i||void 0===i?void 0:i.hAxis)||null,label:"X Axis",onChange:e=>{h(e.target.value)},autoWidth:!0,children:null===o||void 0===o?void 0:o.map(e=>(0,C.jsxs)(l.A,{value:e.sensor,disabled:e.sensor===u||f(e),sx:{textTransform:"capitalize"},children:[e.sensor,f(e)&&" (No Data)"]},e.sensor))})]}),(0,C.jsxs)(_e,{fullWidth:!0,size:"small",children:[(0,C.jsx)(Ee.A,{id:"y-axis-select-label",children:"Y Axis"}),(0,C.jsx)(b.A,{labelId:"y-axis-select-label",value:u||(null===i||void 0===i?void 0:i.vAxis)||null,label:"Y Axis",onChange:e=>{p(e.target.value)},autoWidth:!0,children:null===o||void 0===o?void 0:o.map(e=>(0,C.jsxs)(l.A,{value:e.sensor,disabled:e.sensor===c||f(e),sx:{textTransform:"capitalize"},children:[e.sensor,f(e)&&" (No Data)"]},e.sensor))})]})]})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,sm:"auto",children:(0,C.jsx)(Pe.A,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{u&&c&&n(r,{endpoint:ze.HG[r],school_id:t,queryParams:{dataType:s,sensorX:c,sensorY:u}})},disabled:v||x,children:x?(0,C.jsx)(Me.A,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})})]})};var Fe=n(14194);const Be=e=>{let{customMessage:t,dataType:n,height:a,selectableAxes:r}=e,o="This sensor ",l=" data. Choose a different sensor or data type.";return r&&(o="This pair of sensors ",l=" correlation data. Choose another pair or a different data type."),(0,C.jsx)(i.A,{height:a,children:(0,C.jsx)(Fe.A,{severity:"error",sx:{my:2},children:t||(0,C.jsxs)(C.Fragment,{children:[o,"does not have\xa0",(0,C.jsx)(i.A,{component:"span",textTransform:"capitalize",children:n}),l]})})})},He=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",Ve=Array.from({length:24},(e,t)=>{const n=60*t;return{label:He(n),value:n}}),Ue={allday:{id:"allday",label:"All Day",start:Ve[0].value,end:Ve[Ve.length-1].value,timeRangeLabel:"0-23h"},schoolHour:{id:"schoolHour",label:"School Hour",start:Ve[7].value,end:Ve[17].value,timeRangeLabel:"7-17h"},custom:{id:"custom",label:"Custom"}};var Ne=n(51715),Ye=n(80045);const qe=["icon","label","value","options","handleChange","disabled","isExtraSmall"],Qe=e=>{const{icon:t,label:n,value:a,options:o,handleChange:s,disabled:c,isExtraSmall:u}=e,h=(0,Ye.A)(e,qe),p=(0,v.A)();return(0,C.jsxs)(d.A,(0,r.A)((0,r.A)({direction:"row",gap:t?1:0,alignItems:"center"},h),{},{children:[(0,C.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:c?p.palette.text.secondary:p.palette.primary.main,verticalAlign:"middle"}},children:t}),(0,C.jsxs)(y.A,{fullWidth:!0,size:"small",disabled:c,sx:{minWidth:"5rem",marginLeft:"0 !important","& .MuiInputBase-root":{[p.breakpoints.down("sm")]:{fontSize:null!==u&&void 0!==u?u:"0.75rem"}}},children:[(0,C.jsx)(Ee.A,{id:"".concat(n,"-picker-label"),children:n}),(0,C.jsx)(b.A,{labelId:"".concat(n,"-picker-label"),id:"".concat(n,"-picker"),value:a,label:n,onChange:s,children:(0,W.OP)(o)&&o.map(e=>(0,C.jsx)(l.A,{value:e.value,is:!0,children:e.label},e.value))})]})]}))},Xe=e=>{const{timeRange:t,defaultTimeRange:n,disabled:r,handleChange:o,isResponsive:l=!1,hasTitle:c=!1}=e,u=(0,v.A)(),p=(0,s.A)(e=>e.breakpoints.up("lg")),[x,m]=(0,a.useState)(!1),[g,A]=(0,W.OP)(t)?t:n,[y,b]=(0,a.useState)(()=>{const e=Object.values(Ue).find(e=>e.start===g&&e.end===A);return e?e.id:Ue.custom.id});(0,a.useEffect)(()=>{const e=Object.values(Ue).find(e=>e.start===g&&e.end===A);b(e?e.id:Ue.custom.id)},[g,A]);const f=(0,a.useCallback)((e,t)=>{if(!t)return;b(t);const n=Ue[t];null!=n.start&&null!=n.end&&o([n.start,n.end]),m(t===Ue.custom.id)},[o]),j=(0,s.A)(e=>e.breakpoints.down("sm"));return(0,C.jsxs)(d.A,{direction:c?"column":"row",alignItems:"start",gap:.5,width:"100%",children:[c?p&&l?(0,C.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Time Range"}):null:(0,C.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:r?u.palette.text.secondary:u.palette.primary.main,verticalAlign:"-webkit-baseline-middle"}},children:(0,C.jsx)(Ne.A,{sx:{mt:.75}})}),(0,C.jsxs)(d.A,{direction:"column",width:"100%",gap:1.5,children:[(0,C.jsx)(he.A,{fullWidth:j,color:r?"standard":"primary",value:y,exclusive:!0,onChange:f,size:"small",disabled:r,orientation:l&&p?"vertical":"horizontal",children:Object.values(Ue).map((e,t,n)=>(0,C.jsxs)(pe.A,{value:e.id,"aria-label":e.label,sx:{color:"text.secondary",textTransform:"none",px:t===n.length-1?2:1,py:.5,flex:t===n.length-1?1:void 0},size:"small",children:[e.label,e.timeRangeLabel&&(0,C.jsxs)(C.Fragment,{children:["\xa0(",e.timeRangeLabel,")"]})]},e.id))}),x?(0,C.jsxs)(d.A,{direction:"row",flex:1,gap:1,children:[(0,C.jsx)(Qe,{label:"From",value:g,options:Ve,disabled:r||"custom"!==y,handleChange:e=>{e.target.value>A?o([e.target.value,null]):o([e.target.value,A])},flex:1}),(0,C.jsx)(Qe,{label:"To",value:A,options:Ve.filter(e=>e.value>g),disabled:r||"custom"!==y,handleChange:e=>o([g,e.target.value]),flex:1})]}):null]})]})},Ke=e=>{const{defaultTimeRange:t,isResponsive:n,hasTitle:r,chartIndex:o}=e,{allChartsConfigs:i,updateIndividualChartConfigQueryParams:l}=(0,a.useContext)(m.C),s=(i[o]||{}).queryParams||{},{startTime:d,endTime:c}=s,[u,h]=(0,a.useState)([null!==d&&void 0!==d?d:t.startTime,null!==c&&void 0!==c?c:t.endTime]);return(0,C.jsx)(Xe,{timeRange:u,defaultTimeRange:t,handleChange:e=>{h(e);const[t,n]=e||[];null===t||null===n||t>n||(t===Ue.allday.start&&n===Ue.allday.end?l(o,{startTime:null,endTime:null}):l(o,{startTime:t,endTime:n}))},isResponsive:n,hasTitle:r})};function Ge(e){var t;const{chartData:n,subchartIndex:o,windowSize:l,isPortrait:s,height:c,maxHeight:u,selectedDataType:h,allowedDataTypes:p}=e,m=(0,a.useContext)(g.d),[y,b]=(0,a.useState)(),[f,j]=(0,a.useState)(),[w,S]=(0,a.useState)(),[D,k]=(0,a.useState)(),M=(0,v.A)(),[z,L]=(0,a.useState)(!0),[F,B]=(0,a.useState)(!0),[H,U]=(0,a.useState)(!1),[N,Y]=(0,a.useState)(),[q,X]=(0,a.useState)(),[K,G]=(0,a.useState)(),[$,J]=(0,a.useState)(Math.random().toString(36).substr(2,9)),Z=(0,a.useMemo)(()=>(e=>{var t,n,a,o,i,l,s,d,c,u,h,p,x,m,g,A,v,y,b,f,j,w,S,D,C,k,T,I,M,P,O,R,z,W,_,L,F,B,H,V,U,N,Y,q,Q,X,K,G,$,J;const{chartData:Z,subchartIndex:ee,isPortrait:te,theme:ne}=e,ae={italic:!1,bold:!0,color:ne.palette.chart.axisTitle,fontSize:E({isPortrait:te})},re={color:ne.palette.chart.axisText,fontSize:E({isPortrait:te})};let oe=null!==(t=Z.subcharts)&&void 0!==t&&null!==(n=t[ee])&&void 0!==n&&n.options?(0,r.A)({},Z.subcharts[ee].options):{};if(oe=(0,r.A)((0,r.A)((0,r.A)({},oe),Z.options),{},{theme:"material",curveType:oe.curveType||(null===(a=Z.options)||void 0===a?void 0:a.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(o=Z.options)||void 0===o||null===(i=o.backgroundColor)||void 0===i?void 0:i.fill)||"transparent"},chartArea:(0,r.A)((0,r.A)({},null===(l=Z.options)||void 0===l?void 0:l.chartArea),{},{width:te?(null===(s=Z.options)||void 0===s||null===(d=s.chartArea)||void 0===d||null===(c=d.width)||void 0===c?void 0:c.portrait)||"80%":(null===(u=Z.options)||void 0===u||null===(h=u.chartArea)||void 0===h||null===(p=h.width)||void 0===p?void 0:p.landscape)||"80%",height:te?(null===(x=Z.options)||void 0===x||null===(m=x.chartArea)||void 0===m||null===(g=m.height)||void 0===g?void 0:g.portrait)||"60%":(null===(A=Z.options)||void 0===A||null===(v=A.chartArea)||void 0===v||null===(y=v.height)||void 0===y?void 0:y.landscape)||"80%",top:!te&&10}),width:te?(null===(b=Z.options)||void 0===b||null===(f=b.width)||void 0===f?void 0:f.portrait)||"100%":(null===(j=Z.options)||void 0===j||null===(w=j.width)||void 0===w?void 0:w.landscape)||"100%",height:Z.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:te?"center":"start",position:null!==(S=null===(D=Z.options)||void 0===D||null===(C=D.legend)||void 0===C?void 0:C.position)&&void 0!==S?S:te?"top":"right",scrollArrows:{activeColor:ne.palette.chart.axisTitle,inactiveColor:ne.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ne.palette.chart.axisTitle,bold:!0}}}),oe.vAxis=(0,r.A)((0,r.A)({},oe.vAxis),{},{format:null!==(k=null===(T=oe.vAxis)||void 0===T?void 0:T.format)&&void 0!==k?k:"decimal",title:null!==(I=null===(M=oe.vAxis)||void 0===M?void 0:M.title)&&void 0!==I?I:"",viewWindow:{min:null!==(P=null===(O=oe.vAxis)||void 0===O||null===(R=O.viewWindow)||void 0===R?void 0:R.min)&&void 0!==P?P:0,max:null!==(z=null===(W=oe.vAxis)||void 0===W||null===(_=W.viewWindow)||void 0===_?void 0:_.max)&&void 0!==z?z:null,max:null!==(L=null===(F=oe.vAxis)||void 0===F||null===(B=F.viewWindow)||void 0===B?void 0:B.max)&&void 0!==L?L:null}}),oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{title:null!==(H=null===(V=oe.hAxis)||void 0===V?void 0:V.title)&&void 0!==H?H:""}),te&&(oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{slantedText:!0,slantedTextAngle:30})),"string"!==typeof oe.colors&&oe.colors||(oe.colors=ne.palette.chart.optionsColors[oe.colors||"multiColor"]),oe.series&&Object.values(oe.series).forEach(e=>{const t=e;"default"===t.color&&(t.color=ne.palette.primary.main)}),oe.trendlines&&oe.trendlines.forEach(e=>{e.color=ne.palette.primary.main}),oe.colorAxis)switch(oe.colorAxis.colors){case"matchingColor":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.chart.optionsColors.multiColor[oe.colorAxis.colorIndex]];break;case"default":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.NYUpurple];break;default:try{oe.colorAxis=ne.palette.chart.colorAxes[oe.colorAxis.colors]}catch(ie){oe.colorAxis=[]}}return oe.vAxis=(0,r.A)((0,r.A)({},oe.vAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(U=oe.vAxis)||void 0===U?void 0:U.gridlines),{},{color:(null===(N=oe.vAxis)||void 0===N||null===(Y=N.gridlines)||void 0===Y?void 0:Y.color)||ne.palette.chart.gridlines}),minorGridlines:{count:0}}),oe.hAxis=(0,r.A)((0,r.A)({},oe.hAxis),{},{titleTextStyle:ae,textStyle:re,gridlines:(0,r.A)((0,r.A)({},null===(q=oe.hAxis)||void 0===q?void 0:q.gridlines),{},{color:(null===(Q=oe.hAxis)||void 0===Q||null===(X=Q.gridlines)||void 0===X?void 0:X.color)||ne.palette.chart.gridlines}),minorGridlines:(0,r.A)((0,r.A)({},null===(K=oe.hAxis)||void 0===K?void 0:K.minorGridlines),{},{color:(null===(G=oe.hAxis)||void 0===G||null===($=G.gridlines)||void 0===$?void 0:$.color)||ne.palette.chart.gridlines})}),oe.legend=(0,r.A)((0,r.A)({},oe.legend),{},{textStyle:re}),oe.annotations=(0,r.A)((0,r.A)({},oe.annotations),{},{highContrast:!0,textStyle:{color:ne.palette.primary.contrastText,fontSize:E({isPortrait:te,isSmaller:!0}),opacity:.8},stem:(0,r.A)((0,r.A)({},null===(J=oe.annotations)||void 0===J?void 0:J.stem),{},{color:ne.palette.chart.axisTitle,thickness:2}),boxStyle:{rx:ne.shape.borderRadius,ry:ne.shape.borderRadius,fill:ne.palette.chart.annotationBoxFill,fillOpacity:.5}}),te&&"LineChart"===(null===Z||void 0===Z?void 0:Z.chartType)&&(oe.pointSize=0),oe})((0,r.A)((0,r.A)({},e),{},{theme:M})),[e,M,n.chartType]),[ee,te]=(0,a.useState)(null);if("Calendar"===n.chartType)return(0,a.useEffect)(()=>{const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null;(0,W.OP)(e)?(te(e),B(!0)):B(!1)},[n]),ee?F?(0,C.jsx)(Q,{dataArray:ee,valueRangeBoxTitle:(0,x.MU)({dataTypeKey:h,dataTypes:p,showUnit:!0}),isPortrait:s,options:Z,windowSize:l}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Be,{dataType:(0,x.MU)({dataTypeKey:h,dataTypes:p})}),(0,C.jsx)(Q,{dataArray:[],valueRangeBoxTitle:(0,x.MU)({dataTypeKey:h,dataTypes:p,showUnit:!0}),isPortrait:s,options:Z,windowSize:l})]}):(0,C.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(R.A,{})});let ne,ae=!1,re=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[o].control);re&&(ae=!0,ne=(0,r.A)((0,r.A)({},re.options),{},{ui:P({chartControl:re,mainChartData:n,mainChartOptions:Z,subchartIndex:o,theme:M,isPortrait:s})}),"ChartRangeFilter"===re.controlType&&(0,a.useEffect)(()=>{const e=(e=>{let{controlWrapper:t,chartID:n}=e;const a=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var a=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(a),e.preventDefault()};let r=!0;if(!t)return;const o=document.querySelector("#control-".concat(n));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.addEventListener(e,a,{capture:!0})}),()=>{r=!1,["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.removeEventListener(e,a,{capture:!0})})}):void 0})({controlWrapper:w,chartID:$});return e},[w]));const oe=Z.seriesSelector||!1,ie=Z.dateRangePicker||null,le=Z.timeRangeSelector||null,se=Z.formatters||null;let de=n.selectableAxes||null;de&&(0,W.OP)(de.allowedAxes)&&de.allowedAxes.length<=2&&(de=null),(0,a.useEffect)(()=>{oe?he({newDataColumns:q}):(null===f||void 0===f||f.setOptions((0,r.A)({},Z)),null===f||void 0===f||f.draw(),ae&&(null===w||void 0===w||w.setOptions(ne),null===w||void 0===w||w.draw()))},[M,s,l]),(0,a.useEffect)(()=>{q&&oe&&"setViewColumn"==oe.method&&(ce({dataColumns:q}),he({newDataColumns:q}))},[M]);const ce=e=>{let{dataColumns:t}=e;t.forEach(e=>{var t;e.color=Z.colors[e.seriesIndex%Z.colors.length],e.serieAttribute=null===(t=Z.series)||void 0===t?void 0:t[e.seriesIndex]})},ue=e=>{let t,n,{dataTable:a,allInitialColumns:r}=e;return r.forEach((e,r)=>{if(0===r)return;const o=a.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(n=n?Math.max(n,o.max):o.max)}),{min:t,max:n}},he=(0,a.useCallback)(e=>{let{newDataColumns:t,_allInitialColumns:n=N,_chartWrapper:a=f,_controlWrapper:o=w}=e;if(n){if(X(t),"toggleVisibility"===oe.method||null===oe.method){const e={};if(t.forEach(t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})}),null===a||void 0===a||a.setOptions((0,r.A)((0,r.A)({},Z),{},{series:(0,r.A)((0,r.A)({},Z.series),e)})),ae){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{series:(0,r.A)((0,r.A)({},Z.series),e)})})}))}}else if("setViewColumn"===oe.method){let e=[];e.push(0),t.forEach(t=>{if(t.selected&&(e.push(t),(0,W.OP)(n)))for(let a=t.indexIn_+1;a<n.length&&"data"!==n[a].role;a++)e.push(n[a])}),null===a||void 0===a||a.setView({columns:e});const i=(0,r.A)({},Z);i.colors=t.filter(e=>e.selected).map(e=>e.color);const l={};let s=0;if(t.forEach(e=>{e.selected&&(null!=e.serieAttribute&&(l[s]=e.serieAttribute),s++)}),i.series=l,null===a||void 0===a||a.setOptions(i),ae){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,r.A)((0,r.A)({},t),{},{ui:(0,r.A)((0,r.A)({},t.ui),{},{chartOptions:(0,r.A)((0,r.A)({},t.ui.chartOptions),{},{colors:i.colors,series:i.series}),chartView:{columns:e}})}))}}null===a||void 0===a||a.draw(),ae&&(null===o||void 0===o||o.draw())}},[N,Z,oe,f,w,K,ae]);(0,a.useEffect)(()=>{if(m&&n){if(JSON.stringify(n)===JSON.stringify(D))return;k(n);const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null,t=(0,W.OP)(e);if(B(t),!0===t){U(!0);const t=m.visualization.arrayToDataTable(e);if(se&&"object"===typeof se&&se.hasOwnProperty("numberFormatter")){const e=new m.visualization.NumberFormat(se.numberFormatter.numberFormat);se.numberFormatter.columns.forEach(n=>e.format(t,n))}b(t)}}},[m,n]),(0,a.useEffect)(()=>{if(!0===H){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push((0,r.A)((0,r.A)({},n),{},{calc:e}))}else t.push(n);return t})(n.columns||n.subcharts&&n.subcharts[o].columns||null),t=new m.visualization.ChartWrapper({chartType:n.chartType,dataTable:ae?void 0:y,options:Z,view:{columns:e},containerId:$});let a;if(j(t),ae){const e=new m.visualization.Dashboard(document.getElementById("dashboard-".concat($)));m.visualization.events.addListener(e,"ready",be),a=new m.visualization.ControlWrapper({controlType:re.controlType,options:ne,containerId:"control-".concat($)}),S(a),e.bind(a,t),e.draw(y)}else m.visualization.events.addListener(t,"ready",be),t.draw();if(oe){const{initAllInitialColumns:e,initDataColumns:n}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:a}=e;var r=t.getView();if(null==r.columns){const e=new m.visualization.DataView(n);t.setView({columns:e.columns}),r=t.getView()}let o=!0,i=0;const l=r.columns.map((e,t)=>("number"===typeof e&&(e={role:o?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,o=o&&!1,"data"===e.role&&(a.defaultSeriesToDisplayInitially?a.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:a.allowMultiple?e.selected=!0:e.selected=0===i,e.seriesIndex=i,i++),e));Y(l);const s=ue({dataTable:n,allInitialColumns:l});G(s);const d=l.filter(e=>{var t,n;return"data"===e.role&&!1!==(null===(t=Z.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)});return"setViewColumn"===a.method&&ce({dataColumns:d}),X(d),{initAllInitialColumns:l,initDataColumns:d}})({chartWrapper:t,dataTable:y,seriesSelector:oe});he({_allInitialColumns:e,newDataColumns:n,_chartWrapper:t,_controlWrapper:a})}U(!1)}},[H]);const pe=Z.gradientBackgroundColor;let xe,me;var ge,Ae,ve,ye;pe&&(xe="".concat($,"-backgroundGradient"),me=(e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:a}=e;return _({colors:t,optionalMinValue:n,optionalMaxValue:a}).map(e=>({color:e.color,offset:100*e.offset+"%"}))})({colors:M.palette.chart.colorAxes[pe].colors,optionalMinValue:null===(ge=Z.vAxis)||void 0===ge||null===(Ae=ge.viewWindow)||void 0===Ae?void 0:Ae.min,optionalMaxValue:null===(ve=Z.vAxis)||void 0===ve||null===(ye=ve.viewWindow)||void 0===ye?void 0:ye.max}));const be=()=>{z&&L(!1)};return F?(0,C.jsxs)(O,{isPortrait:s,gradientBackgroundId:xe,className:n.chartType,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[z&&(0,C.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,C.jsx)(R.A,{})}),(0,C.jsxs)(A.Ay,{container:!0,alignItems:"start",sx:{},children:[(0,C.jsx)(A.Ay,{lg:2,container:!0,item:!0,sx:{mt:1,ml:2,gap:2,[M.breakpoints.down("lg")]:{gap:1,ml:0}},children:z?null:(0,C.jsxs)(C.Fragment,{children:[oe&&(0,C.jsx)(A.Ay,{item:!0,xs:"auto",lg:12,sx:{[M.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(T,{items:q,allowMultiple:oe.allowMultiple,seriesLabel:oe.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),ie&&(0,C.jsx)(Ie,{minDateOfDataset:new Date(ie.minDate),chartIndex:n.id}),de&&(0,C.jsx)(Le,{chartID:n.id,allowedAxes:de.allowedAxes,selectedAxes:de.selectedAxes,dataType:h}),le&&(0,C.jsx)(A.Ay,{item:!0,xs:"auto",lg:12,sx:{[M.breakpoints.down("sm")]:{width:"100%"}},children:(0,C.jsx)(Ke,{defaultTimeRange:[Ue.allday.start,Ue.allday.end],handleChange:()=>null,isResponsive:!0,hasTitle:!0,chartIndex:n.id})})]})}),(0,C.jsx)(A.Ay,{item:!0,xs:!0,children:(()=>{const e=(0,C.jsx)(i.A,{id:$,sx:{height:c,maxHeight:u}});var t;return ae?(0,C.jsxs)(d.A,{id:"dashboard-".concat($),direction:(null===(t=I[re.controlType])||void 0===t?void 0:t.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,C.jsx)(i.A,{id:"control-".concat($),sx:{height:"calc(".concat(c," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),e]}):e})()})]}),pe?(0,C.jsx)(V,{id:xe,colors:me}):null]}):(0,C.jsx)(Be,{dataType:(0,x.MU)({dataTypeKey:h,dataTypes:p}),selectableAxes:de,height:oe||ae?1.2*parseFloat(c)+"vw":c})}var $e=n(20036);const Je=function(e){let{text:t,wordLimit:n=40,reference:r}=e;const[o,l]=(0,a.useState)(!1),d=(0,v.A)(),c=(0,s.A)(d.breakpoints.down("sm")),u=(0,a.useRef)(null),p=t.split(" ");if(!c||p.length/n<=1.4)return(0,C.jsxs)(i.A,{children:[(0,C.jsx)(h.A,{children:(0,N.Ay)(t,{replace:W.H$})}),r&&(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,N.Ay)(r,{replace:W.H$})})]});let x=p.slice(0,n).join(" ");const m=x.lastIndexOf(".");return-1!==m&&(x=x.slice(0,m+1)),(0,C.jsx)($e.x,{onClickAway:e=>{(e=>{let{target:t}=e;const n=u.current.closest(".MuiContainer-root"),a=new Set(["rect","path","svg","circle"]);for(;null!=t;){var r;if(a.has(null===(r=t)||void 0===r?void 0:r.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||l(!1)},children:(0,C.jsx)(i.A,{ref:u,onClick:()=>l(!o),style:{cursor:"pointer"},children:o?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.A,{children:(0,N.Ay)(t,{replace:W.H$})}),r&&(0,C.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,N.Ay)(r,{replace:W.H$})})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(h.A,{display:"inline",children:[(0,N.Ay)(x,{replace:W.H$}),"..."]}),(0,C.jsx)(h.A,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Ze=n(40430);const et=e=>{let{selectedDataType:t,dataTypes:n,chartID:r}=e;const{updateIndividualChartConfigQueryParams:o}=(0,a.useContext)(m.C),[i,s]=(0,a.useState)(null);if(!(0,W.OP)(n))return null;if(n.length<=1)return(0,C.jsx)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const d=Boolean(i),c=()=>{s(null)};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(Pe.A,{id:"data-type-drop-down-menu-button","aria-controls":d?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{s(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,C.jsx)(h.A,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,x.MU)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,C.jsx)(Ze.A,{})]}),(0,C.jsx)(u.A,{id:"data-type-drop-down-menu",anchorEl:i,open:d,onClose:c,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map((e,t)=>(0,C.jsx)(l.A,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{o(r,{dataType:e}),c()})(e.key),children:e.name_title},t))})]})};var tt=n(14912);const nt=(0,o.Ay)(tt.A,{shouldForwardProp:e=>"smallFontSize"!==e})(e=>{let{theme:t,smallFontSize:n="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:n,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}}),at=(0,o.Ay)(i.A)(e=>{let{theme:t}=e;return(0,r.A)((0,r.A)({},"dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}}),{},{"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}})}),rt=(0,o.Ay)(l.A)(e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}});const ot=function(e){let{chartID:t}=e;const{data:n,isLoading:r,isFetching:o,error:l}=Te(t),{currentSchoolID:g}=(0,a.useContext)(m.C),A=(0,s.A)(e=>e.breakpoints.down("sm")),[v,y]=(0,a.useState)(window.matchMedia("(orientation: portrait)").matches),[b,f]=(0,a.useState)([window.innerWidth,window.innerHeight]),[j,w]=(0,a.useState)(0),[S,k]=(0,a.useState)(0),[T,I]=(0,a.useState)(-1),[M,E]=(0,a.useState)(),[P,O]=(0,a.useState)(null),[z,_]=(0,a.useState)([]),[L,F]=(0,a.useState)(null);let B,H;if((0,a.useEffect)(()=>{if(!n)return;((e,t,n)=>{if(null===e||void 0===e||!e.allowedDataTypes)return;t(e.allowedDataTypes.map(e=>{const{name_title:t,name_short:n,unit:a}=x.Uy[e];return{key:e,name_title:t,name_short:n,unit:a}})),n(e.selectedDataType)})(n,_,F);const e=((e,t,n)=>{let a=null;const r=()=>{clearTimeout(a),a=setTimeout(()=>{t(window.matchMedia("(orientation: portrait)").matches),e([window.innerWidth,window.innerHeight])},n)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}})(f,y,100);return e},[n]),(0,a.useEffect)(()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout(()=>{y(window.matchMedia("(orientation: portrait)").matches),f([window.innerWidth,window.innerHeight])},100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[n]),(0,a.useEffect)(()=>{k(j),w(0)},[g]),"Calendar"!==(null===n||void 0===n?void 0:n.chartType)&&(B=v?"80vw":"35vw",H=v?"800px":"450px"),n)return r?(0,C.jsx)(R.A,{optionalText:"Loading chart ".concat(t+1,"...")}):l?(0,C.jsx)(Be,{customMessage:"Error loading chart ".concat(t+1,", please try later")}):(0,C.jsxs)(i.A,{position:"relative",children:[(0,C.jsxs)(i.A,{children:[(0,C.jsxs)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:[t+1,". ",n.title,"\xa0"]}),(0,C.jsx)(i.A,{display:"inline",children:(0,C.jsx)(et,{selectedDataType:L,dataTypes:z,chartID:t})})]}),(0,C.jsxs)(at,{height:"100%",sx:{filter:o?"blur(1px)":"none",transition:"filter 0.2s",pointerEvents:o?"none":"auto"},children:[(0,W.OP)(n.subcharts)?(()=>{const e=n.subcharts.length>4,t=e?n.subcharts.slice(0,3):n.subcharts,a=e?n.subcharts.slice(3):null,r=e=>-1===j?S===e:j===e;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(nt,{value:j,onChange:(t,n)=>{k(j),w(n),e&&n<3&&n!==T&&(E(),I(-1))},variant:A?"fullWidth":"standard",children:[t.map((e,t)=>(0,C.jsx)(c.A,{value:t,label:n.subcharts[t].subchartTitle,sx:{textDecoration:!(0,W.OP)(n.subcharts[t].dataArray)&&"line-through"}},t)),e&&(0,C.jsx)(c.A,{value:T,label:(0,C.jsxs)(d.A,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,C.jsxs)(i.A,{flex:1,children:["Other sensors",M&&" (".concat(M,")"),"\xa0"]}),(0,C.jsx)(p.A,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>O(e.currentTarget)})]}),e&&(0,C.jsx)(u.A,{id:"submenu",anchorEl:P,open:Boolean(P),onClose:()=>{-1===j&&(k(j),w(S)),O(null)},children:a.map((e,t)=>(0,C.jsx)(rt,{selected:t===j-3,onClick:()=>(e=>{k(j),w(3+e),I(3+e),E(a[e].subchartTitleShort),O(null)})(t),sx:{textDecoration:!(0,W.OP)(n.subcharts[t+3].dataArray)&&"line-through"},children:(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",gap:1,children:[(0,C.jsx)(i.A,{children:a[t].subchartTitle}),t===j-3&&(0,C.jsx)(D.A,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t))}),(0,C.jsx)(i.A,{position:"relative",sx:{overflowX:v&&"auto",WebkitOverflowScrolling:v&&"touch",overflowY:"hidden"},children:n.subcharts.map((e,t)=>(0,C.jsx)(i.A,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:r(t)?"1":"0",pointerEvents:r(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,C.jsx)(Ge,{selectedDataType:L,allowedDataTypes:z,chartData:n,subchartIndex:t,isPortrait:v,windowSize:b,height:n.height?n.height:B,maxHeight:["Calendar"].includes(n.chartType)?"":H,currentSubchart:j})},t))})]})})():(0,W.OP)(n.dataArray)?(0,C.jsx)(Ge,{selectedDataType:L,allowedDataTypes:z,chartData:n,isPortrait:v,windowSize:b,height:n.height?n.height:B}):(0,C.jsx)(Be,{customMessage:"Not enough historical data to display this chart"}),(0,C.jsx)(i.A,{sx:{my:3},children:(0,C.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,C.jsx)(Je,{text:(()=>{var e;let t=n.subtitle||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=n.subcharts[j].subchartSubtitle),t})(),reference:(()=>{var e;let t=n.reference||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.reference&&(t+="<br/>",t+=n.subcharts[j].reference),t})()})})})]}),o&&(0,C.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255,255,255,0.3)",zIndex:10},children:(0,C.jsx)(R.A,{})})]})};var it=n(35197),lt=n(19252),st=n(39336),dt=n(11530),ct=n(8738),ut=n(24010),ht=n(95953),pt=n(56258),xt=n(4710),mt=n(38198),gt=n(97847),At=n(47298);function vt(e){const[t,n]=(0,a.useState)(null),o=e=>{n(e.currentTarget),gt.n(gt.s.airQualityIndexLegendQuickGlance)},i=()=>{n(null)},l=Boolean(t);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(mt.An,(0,r.A)((0,r.A)({},e),{},{distanceFromBottomOfWindow:"5.5rem",children:(0,C.jsx)(ut.A,{sx:{mt:1},"aria-owns":l?gt.s.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:o,onMouseLeave:i,onClick:e=>ct.Fr&&(l?i():o(e)),"aria-label":gt.s.airQualityIndexLegendQuickGlance,color:"primary",children:(0,C.jsxs)(d.A,{direction:"column",alignItems:"center",children:[(0,C.jsx)(xt.A,{fontSize:"1rem"}),(0,C.jsx)(h.A,{variant:"body2",fontWeight:"500",children:"AQI"})]})})})),(0,C.jsx)(ht.A,{id:gt.s.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:l,anchorEl:t,placement:"top-end",onClose:i,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,C.jsx)(pt.A,(0,r.A)((0,r.A)({},t),{},{timeout:350,children:(0,C.jsxs)(K.A,{elevation:8,sx:{py:.5,mb:1},children:[(0,C.jsx)(h.A,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,C.jsx)(At.A,{tiny:!0,hideAQIDescription:!0})]})}))}})]})}var yt=n(74033),bt=n(8051),ft=n(89521),jt=n(65290),wt=n(73605),St=n(83250),Dt=n(73216),Ct=n(93332);const kt=e=>{const{authenticationState:t,user:n}=(0,a.useContext)(Ct.R),r=t.authenticated&&t.checkedAuthentication,{currentSchoolID:o}=(0,a.useContext)(m.C),{enqueueSnackbar:i}=(0,we.dh)(),l=(0,a.useCallback)(t=>r?null!==n&&void 0!==n&&n.allowedSchools.some(e=>e.school_id===o)?(null===t||void 0===t||t(),!0):(i("Your account does not have access to ".concat(o.toUpperCase()," Alerts"),Se.n.error),!1):(null===e||void 0===e||e(),!1),[r,e,o,n,i]);return{loggedIn:r,handleRestrictedAccess:l}};var Tt=n(4967);const It=e=>{let{onButtonClick:t}=e;const{currentSchoolID:n}=(0,a.useContext)(m.C),{data:r}=(0,Tt.A)(),{handleRestrictedAccess:o}=kt(t),[i,s]=(0,a.useState)(null),d=(0,Dt.Zp)();if(!r)return null;const c=r.screens;if(!(0,W.OP)(c))return null;const h=()=>{o(()=>{var e;const t=c&&(null===(e=c[0])||void 0===e?void 0:e.screen_name);d("screen"===t?"/screen/".concat(n):"/screen/".concat(n,"/").concat(t))})};if(c.length<=1)return(0,C.jsxs)(Pe.A,{variant:"contained",size:"small",onClick:h,children:[(0,C.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const p=Boolean(i);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(Pe.A,{id:"basic-button","aria-controls":p?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,onClick:e=>{o(()=>s(e.currentTarget))},variant:"contained",size:"small",children:[(0,C.jsx)(St.A,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,C.jsx)(u.A,{id:"tv-screen-list-menu",anchorEl:i,open:p,onClose:()=>{s(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:c.map((e,t)=>(0,C.jsx)(l.A,{onClick:()=>{return t=e.screen_name,void o(()=>{s(null),d("/screen/".concat(n,"/").concat(t))});var t},sx:{fontSize:"0.8rem"},children:e.location_long},t))})]})};var Mt=n(88446),Et=n(71806),Pt=n(84882),Ot=n(28076),Rt=n(10039),zt=n(73460),Wt=n(41132),_t=n(6519),Lt=n(77739),Ft=n(17392),Bt=n(90035),Ht=n(29347),Vt=n(26600),Ut=n(35316),Nt=n(55896);const Yt=e=>{const{buttonIcon:t,buttonIconAria:n,buttonLabel:r,buttonVariant:o="contained",trackingEvent:i,dialogTitle:l,dialogOpenHandler:d=null,dialogCloseHandler:c=null,displaySchoolID:u=!0,maxWidth:h="lg",children:p,disabled:x}=e;let g;g=!(!t||r);const{currentSchoolID:A}=(0,a.useContext)(m.C),y=(0,s.A)(e=>e.breakpoints.down("sm")),[b,f]=(0,a.useState)(!1),j=()=>{d?d(()=>{f(!0),i&&gt.n(i)}):(f(!0),i&&gt.n(i))},w=()=>{f(!1),c&&c()},D=(0,v.A)();return(0,C.jsxs)(C.Fragment,{children:[g?(0,C.jsx)(Lt.A,{title:n,children:(0,C.jsx)(Ft.A,{onClick:j,"aria-label":n,size:"small",sx:{"&:hover,:focus":{color:D.palette.primary.main}},disabled:x,children:t})}):(0,C.jsxs)(Pe.A,{onClick:j,variant:o,disabled:x,size:"small",children:[t,"\xa0",r]}),(0,C.jsxs)(Bt.A,{open:b,onClose:w,maxWidth:h,fullWidth:!0,fullScreen:y,keepMounted:!0,children:[(0,C.jsx)(Ht.A,{sx:{justifyContent:"start"},children:(0,C.jsxs)(Pe.A,{onClick:w,children:[(0,C.jsx)(Nt.A,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,C.jsxs)(Vt.A,{children:[!0===u?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.A,{label:A?"School: ".concat(A.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,C.jsx)("br",{})]}):null,l]}),(0,C.jsx)(Ut.A,{children:p})]})]})};var qt=n(41e3);function Qt(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=kt(t),{currentSchoolID:r}=(0,a.useContext)(m.C),{data:o}=(0,qt.A)(),[i,l]=(0,a.useState)({}),[s,d]=(0,a.useState)("placeholder");return(0,a.useEffect)(()=>{if(!o)return;const e=o.filter(e=>e&&e.sensor).reduce((e,t)=>{var n;return e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:null===(n=t.sensor.last_seen)||void 0===n?void 0:n.split("T")[0],rawDatasets:Object.keys(ee.A).reverse().reduce((e,t)=>(e[ee.A[t]]={sample:null,full:null},e),{})},e},{});l(e)},[o]),(0,C.jsxs)(Yt,{buttonIcon:(0,C.jsx)(_t.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:gt.s.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),n(e)},children:[(0,C.jsx)(Xt,{sensorsDatasets:i,updateSensorsDatasets:l,previewingDataset:s,setPreviewingDataset:d,schoolID:r}),i&&(0,C.jsxs)(h.A,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["These datasets are provided by ",me.sG," from sensors operated by ",me.sG,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,C.jsx)(Mt.A,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Xt=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,setPreviewingDataset:i,schoolID:l}=e,d=(0,v.A)(),c=(0,s.A)(d.breakpoints.down("sm"));return(0,a.useEffect)(()=>{if(Object.keys(t).length>0&&!o){const e=Object.keys(t)[0],a=ee.A.hour;if(i({sensor:e,datasetType:a}),t[e].rawDatasets[a].sample)return;const o=(0,ke.A4)({school_id:l,sensor_location_short:e,aggregationType:a,isSample:!0});(0,Ce.i)({url:o,extension:ze.Fc.csv,needsAuthorization:!0}).then(o=>{const i=(0,r.A)({},t);i[e].rawDatasets[a].sample=o,n(i)}).catch(e=>console.log(e))}},[t,o]),(0,C.jsxs)(A.Ay,{container:!0,justifyContent:"center",alignItems:"start",spacing:c?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,C.jsx)(A.Ay,{item:!0,sm:12,md:6,children:(0,C.jsx)(Kt,{schoolID:l,sensorsDatasets:t,updateSensorsDatasets:n,smallScreen:c,previewingDataset:o,setPreviewingDataset:i})}),(0,C.jsx)(A.Ay,{item:!0,sm:12,md:6,maxWidth:c?"100%":"unset",sx:{mt:1},children:(0,C.jsx)($t,{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,schoolID:l,smallScreen:c})})]})},Kt=e=>{const{schoolID:t,sensorsDatasets:n,smallScreen:a,previewingDataset:r,setPreviewingDataset:o,updateSensorsDatasets:i}=e;return(0,C.jsxs)(Et.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,C.jsx)(Pt.A,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(Rt.A,{sx:{pl:1},children:"Sensor Location"}),(0,C.jsx)(Rt.A,{sx:{width:a?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,C.jsx)(zt.A,{children:n&&Object.keys(n).map(e=>(0,C.jsx)(Gt,{schoolID:t,smallScreen:a,sensor:e,sensorsDatasets:n,previewingDataset:r,setPreviewingDataset:o,isPreviewing:e===(null===r||void 0===r?void 0:r.sensor),updateSensorsDatasets:i},e))})]})},Gt=e=>{const{schoolID:t,sensorsDatasets:n,sensor:o,previewingDataset:i,setPreviewingDataset:s,isPreviewing:c,updateSensorsDatasets:u}=e,[h,p]=(0,a.useState)(ee.A.hour);(0,a.useEffect)(()=>{h!==ee.A.hour&&p(ee.A.hour)},[t]);const x=e=>{if(!n[o].rawDatasets[e].sample){const a=(0,ke.A4)({school_id:t,sensor_location_short:n[o].location_short,aggregationType:e,isSample:!0});(0,Ce.i)({url:a,extension:ze.Fc.csv,needsAuthorization:!0}).then(t=>{const a=(0,r.A)({},n);a[o].rawDatasets[e].sample=t,u(a)})}},m=(0,v.A)();return(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(Rt.A,{sx:{pl:1,cursor:"pointer",background:c&&m.palette.background.NYUpurpleLight},onClick:()=>{(null===i||void 0===i?void 0:i.sensor)!==o&&(s({datasetType:h,sensor:o}),x(h))},children:n[o].location_long}),(0,C.jsx)(Rt.A,{sx:{position:"relative",background:c&&m.palette.background.NYUpurpleLight},children:(0,C.jsx)(y.A,{size:"small",children:(0,C.jsx)(b.A,{value:h,onChange:e=>{const t=e.target.value;p(t),s({datasetType:t,sensor:o}),x(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(n[o].rawDatasets).reverse().map((e,t)=>(0,C.jsx)(l.A,{value:e,children:(0,C.jsx)(d.A,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t))})})})]},o)})},$t=e=>{const{sensorsDatasets:t,updateSensorsDatasets:n,previewingDataset:o,schoolID:l,smallScreen:s}=e,c=(0,v.A)(),[u,p]=(0,a.useState)("Not previewing any dataset"),[x,m]=(0,a.useState)("No dataset"),[g,A]=(0,a.useState)(!1),y=e=>{const t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=x,document.body.appendChild(a),a.click(),URL.revokeObjectURL(n),document.body.removeChild(a)},[b,f]=(0,a.useState)(""),[j,w]=(0,a.useState)("");return(0,a.useEffect)(()=>{var e,n;if(!o)return;p("Previewing: ".concat(o.sensor," (").concat(o.datasetType,")"));const a=null===(e=t[o.sensor])||void 0===e||null===(n=e.rawDatasets[o.datasetType])||void 0===n?void 0:n.sample;if(!a)return w(null),f(null),m("Loading..."),void A(!0);g&&A(!1);const r=a.split("\n"),i=r[0].split(","),s=r.slice(1);let d;if(w(["",...s.map(e=>e.split(",")[0])].join("\n")),f([i.slice(1).join(","),...s.map(e=>e.split(",").slice(1).join(","))].join("\n")),s.length>0){const e=s[s.length-1].split(",");if(e.length>=2){d=e[1].split("T")[0]}}const c="".concat(l,"-").concat(o.sensor,"-").concat(o.datasetType,"-").concat(d,".csv");m(c)},[o,t]),(0,C.jsxs)(d.A,{spacing:1,children:[(0,C.jsxs)(i.A,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,C.jsx)(d.A,{direction:"row",children:(0,C.jsx)(h.A,{variant:"body2",gutterBottom:!0,fontWeight:500,children:u})}),(0,C.jsx)(i.A,{component:"pre",sx:{overflowX:"auto",color:c.palette.text.secondary,backgroundColor:c.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:s?"11.8rem":"14rem",width:s?"100%":"unset",marginTop:0},children:(0,C.jsx)(d.A,{direction:"row",sx:{fontSize:"0.75rem"},children:b?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(i.A,{sx:{mr:2,userSelect:"none"},children:j}),(0,C.jsx)(i.A,{children:b})]}):(0,C.jsx)(R.A,{optionalText:"Loading"})})})]}),(0,C.jsx)(i.A,{textAlign:"center",children:(0,C.jsxs)(Pe.A,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!o)return;const e=t[o.sensor].rawDatasets[o.datasetType].full;if(e)y(e);else{const e=(0,ke.A4)({school_id:l,sensor_location_short:o.sensor,aggregationType:o.datasetType,isSample:!1});(0,Ce.i)({url:e,extension:ze.Fc.csv,needsAuthorization:!0}).then(e=>{const a=(0,r.A)({},t);a[o.sensor].rawDatasets[o.datasetType].full=e,n(a),y(e)})}})(),gt.n(gt.s.rawDatasetDownloaded,{dataset_type:null===o||void 0===o?void 0:o.datasetType,sensor:null===o||void 0===o?void 0:o.sensor})},disabled:g,children:[(0,C.jsx)(Wt.A,{sx:{fontSize:"1.25rem",mr:.5}}),x]})})]})};var Jt=n(23621),Zt=n(67784),en=n(63248),tn=n(47097);const nn=(e,t)=>JSON.stringify(e)===JSON.stringify(t),an=()=>{const{enqueueSnackbar:e}=(0,we.dh)(),{currentSchoolID:t}=(0,a.useContext)(m.C),{data:n=[]}=(0,De.I)({queryKey:["alertEmails",t],queryFn:async()=>{const e=(0,ke.e9)({endpoint:ze.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:e,extension:"json",needsAuthorization:!0})},enabled:!!t,staleTime:0}),r=(0,en.jE)(),o=(0,tn.n)({mutationFn:async e=>{const n=(0,ke.e9)({endpoint:ze.tK.alertsEmails,school_id:t});return(0,Ce.i)({url:n,restMethod:ze.Xo.POST,body:e})},onSuccess:n=>{r.setQueryData(["alertEmails",t],n),e("Email recipients saved successfully.",Se.n.success)},onError:()=>{e("There was an error saving email recipients. Please try again.",Se.n.error)}}),c=(0,s.A)(e=>e.breakpoints.down("sm")),[p,x]=(0,a.useState)([]),[g,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(""),[f,j]=(0,a.useState)(null),[w,D]=(0,a.useState)("");(0,a.useEffect)(()=>{x(n)},[n]),(0,a.useEffect)(()=>{v(!nn(p,n))},[p]),(0,a.useEffect)(()=>{D(g?"Click to save new changes on server":"No changes detected to save")},[g]);const k=t=>{const n=t.trim().toLowerCase();if((0,W.DT)(n)){const t=[...p,n];if(p.includes(n))return e("Already added: ".concat(n),Se.n.error),void b("");150===t.length&&e("Maximum number of recipients reached",Se.n.warning),x(t),b("")}else e("Invalid email address. Valid format: abc@def.xyz",Se.n.error)},T=e=>{const t=p.filter((t,n)=>n!==e);x(t)},I=()=>{j(null)};return(0,a.useEffect)(()=>{const e=e=>{nn(p,n)||(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[p,n]),(0,C.jsxs)(i.A,{children:[(0,C.jsxs)(A.Ay,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,sx:{p:0,mb:c&&1,mr:!c&&2},children:"Email Recipients:"})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,C.jsxs)(A.Ay,{container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%"},children:[p.map((e,t)=>(0,C.jsx)(A.Ay,{item:!0,sx:{m:.5},children:(0,C.jsx)(S.A,{label:e,onDelete:()=>T(t),onClick:e=>((e,t)=>{j({index:t,element:e.currentTarget})})(e,t)})},t)),p.length<150?(0,C.jsx)(A.Ay,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,C.jsx)(Zt.A,{fullWidth:!0,variant:"standard",value:y,onChange:e=>{const t=e.target.value;b(t),""!==t&&D("Finalize currently edited email by pressing Enter/Return")},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&k(y)},onPaste:e=>{const t=e.clipboardData.getData("text");b(t),k(t),e.preventDefault()},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,C.jsxs)(d.A,{sx:{mt:1},spacing:1,alignItems:c?"stretch":"end",children:[(0,C.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,C.jsxs)(h.A,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[p.length," / ",150," recipient",p.length>1?"s":null," added"]}),(0,C.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),b(""),x([])},children:"Clear All"})]}),0===n.length?(0,C.jsx)(Fe.A,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,C.jsx)(Lt.A,{title:w,enterTouchDelay:0,children:(0,C.jsx)("span",{children:(0,C.jsx)(Pe.A,{onClick:e=>{const t=(0,W.OP)(e)?e:(0,W.OP)(p)?p:[];o.mutate(t)},variant:"contained",sx:{width:c?"100%":"fit-content"},disabled:!g||o.isPending,children:o.isPending?(0,C.jsx)(Me.A,{disableShrink:!0,color:"inherit",size:"1.5rem"}):"SAVE EMAIL LIST"})})})]}),(0,C.jsx)(u.A,{anchorEl:null===f||void 0===f?void 0:f.element,open:Boolean(f),onClose:I,children:(0,C.jsx)(l.A,{onClick:()=>{var e;e=f.index,b(p[e]),T(e),I()},children:"Edit"})})]})};var rn=n(86328),on=n(95540),ln=n(25776),sn=n(38409),dn=n(55722);const cn={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,C.jsx)(sn.A,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,C.jsx)(dn.A,{})}},un={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:"\u2265",name:"above"}},hn=cn,pn=(0,a.createContext)(),xn="id",mn="alert_type",gn="sensor_id",An="location_short",vn="datatypekey",yn="threshold_value",bn="days_of_week",fn="minutespastmidnight",jn="time_range",wn="is_enabled",Sn="excluded_dates",Dn="owner_role",Cn="self_is_owner",kn="is_allowed_to_modify",Tn="message",In="max_once_a_day",Mn="parent_alert_id",En="child_alert",Pn="has_child_alert",On=function(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hn.daily.id;return n===hn.threshold.id&&(e=un.above_threshold.id,t=un.below_threshold.id),{[xn]:"",[mn]:e||n,[gn]:"",[vn]:"",[bn]:[0,1,2,3,4],[jn]:n===hn.threshold.id?[Ue.schoolHour.start,Ue.schoolHour.end]:null,[yn]:-1,[fn]:"",[wn]:!0,[Sn]:[],[Tn]:"",[In]:!0,[Mn]:null,[Pn]:!1,[En]:n===hn.threshold.id?{[mn]:t||n,[yn]:-1,[Tn]:""}:null}};function Rn(e){let{children:t}=e;const{currentSchoolID:n}=(0,a.useContext)(m.C),{data:o}=(0,Tt.A)(),[i,l]=(0,a.useState)(On()),[s,d]=(0,a.useState)(i),[c,u]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[g,A]=(0,a.useState)(),v=(0,a.useCallback)(e=>{if(!o)return[];const{sensors:t}=o;if(!(0,W.OP)(t))return[];const n=t.find(t=>t.sensor_id===e),a=null===n||void 0===n?void 0:n.allowedDataTypes;return a?a.map(e=>({value:e,label:x.Uy[e].name_title})):[]},[o]);(0,a.useEffect)(()=>{d((0,r.A)({},i))},[i]),(0,a.useEffect)(()=>{const e=s[gn];e&&""!==e&&u(v(e))},[s,v]);const y=(0,a.useCallback)(function(){const e=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];return e.forEach(t=>{if(!t)return;if(!!t[Mn]){const n=e.find(e=>e[xn]===t[Mn]);n&&(n[Pn]=!0,n[En]={[xn]:t[xn],[mn]:t[mn],[yn]:t[yn],[Tn]:t[Tn]})}else{if(t[mn]===hn.daily.id)return;t[Pn]=!1,t[En]={[mn]:t[mn]===un.above_threshold.id?un.below_threshold.id:un.above_threshold.id,[yn]:t[yn],[Tn]:""}}}),e},[]),b=(0,a.useCallback)(()=>{n&&(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:n})}).then(e=>{(0,W.OP)(e)&&p(y(e))}).catch(e=>{console.log(e)})},[n,y]);(0,a.useEffect)(()=>{n&&A(!1)},[n,b]);const f=(0,a.useMemo)(()=>({selectedAlert:i,setSelectedAlert:l,editingAlert:s,setEditingAlert:d,allowedDataTypesForSensor:c,setAllowedDataTypesForSensor:u,alerts:h,setAlerts:p,fetchAlerts:b,hasFetchedAlerts:g,setHasFetchedAlerts:A,addChildToAlerts:y}),[i,s,c,h,b,g,A,y]);return(0,C.jsx)(pn.Provider,{value:f,children:t})}const zn=()=>(0,a.useContext)(pn),Wn="ADD",_n="EDIT",Ln="DELETE",Fn="Location",Bn="Data Type",Hn="Days",Vn="Created By";var Un=n(20067),Nn=n.n(Un),Yn=n(98533);function qn(e){const{onConfirmedDelete:t}=e,[n,r]=(0,a.useState)(!1),o=(0,v.A)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Pe.A,{variant:"text",color:"error",onClick:()=>{r(!0)},children:"Delete"}),(0,C.jsxs)(Bt.A,{open:n,onClose:()=>{r(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,C.jsx)(Vt.A,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,C.jsx)(Ut.A,{children:(0,C.jsx)(Yn.A,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,C.jsxs)(Ht.A,{sx:{justifyContent:"end"},children:[(0,C.jsx)(Pe.A,{onClick:()=>{r(!1)},sx:{color:o.palette.text.secondary},children:"Cancel"}),(0,C.jsx)(Pe.A,{onClick:()=>{t(),r(!1)},children:"Delete"})]})]})]})}const Qn={[Wn]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[_n]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[Ln]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}};var Xn=n(39423),Kn=n(20389),Gn=n(69413),$n=n(74605);const Jn=e=>{const{label:t="Optional Message",value:n,handleChange:a,maxLength:r,showTip:o=!0,disabled:l}=e,s=n?n.length:0;return(0,C.jsxs)(d.A,{direction:"column",children:[(0,C.jsx)(Zt.A,{label:t,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:r},value:n||"",onChange:e=>{a(e)},disabled:l}),(0,C.jsxs)(d.A,{direction:"row",gap:1,justifyContent:"space-between",sx:{mx:1,my:.5},children:[o?(0,C.jsx)(h.A,{color:"text.secondary",variant:"caption",children:"Optional message that will appear in the alert"}):(0,C.jsx)(i.A,{}),(0,C.jsxs)(h.A,{color:"text.secondary",variant:"caption",textAlign:"right",children:[s,"/",r]})]})]})},Zn=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];var ea=n(60446),ta=n.n(ea),na=n(34576),aa=n(58390),ra=n(77857),oa=n(64021);const ia=["day","selectedDates"],la=(0,o.Ay)(ra.a,{shouldForwardProp:e=>"selected"!==e})(e=>{let{theme:t,selected:n}=e;return(0,r.A)({},n&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"})}),sa=e=>{const{day:t,selectedDates:n}=e,a=(0,Ye.A)(e,ia),o=n.includes(ta()(t).format("YYYY-MM-DD"));return(0,C.jsx)(la,(0,r.A)((0,r.A)({},a),{},{day:t,selected:o}))};function da(e){const{selectedDates:t,handleChange:n,disabled:a}=e,o=t.map(e=>ta()(e).format("YYYY-MM-DD")),i=t.length,l=i>0?"Excluded Dates (".concat(i," Days)"):"Excluded Dates";return(0,C.jsxs)(Yt,{dialogTitle:l,buttonLabel:l,buttonVariant:"text",disabled:a,maxWidth:"xs",displaySchoolID:!1,children:[(0,C.jsxs)(h.A,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,C.jsx)("b",{children:"NOT"})," want to receive alerts.",(0,C.jsx)("br",{}),"Useful for holidays or school breaks."]}),(0,C.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),n(t)},children:"Clear All"}),(0,C.jsx)(aa.$,{dateAdapter:na.R,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,C.jsx)(oa.x,{displayWeekNumber:!0,slots:{day:e=>(0,C.jsx)(sa,(0,r.A)((0,r.A)({},e),{},{selectedDates:o}))},onChange:(e,t)=>{"finish"===t&&n([ta()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:ta()().startOf("month")})})]})}function ca(e){const{daysOfWeek:t,excludedDates:n,handleDaysOfWeekChange:a,handleExcludedDatesChange:r,disabled:o}=e,l=(0,v.A)();return(0,C.jsxs)(A.Ay,{container:!0,rowSpacing:.5,columnSpacing:2,alignItems:"center",justifyContent:"stretch",children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,C.jsxs)(d.A,{direction:"row",gap:1,alignItems:"start",children:[(0,C.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:o?l.palette.text.secondary:l.palette.primary.main,verticalAlign:"middle"}},children:(0,C.jsx)(dn.A,{sx:{mt:.75}})}),(0,C.jsx)(he.A,{value:t||On()[bn],onChange:a,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:o,color:o?"standard":"primary",children:Zn.map(e=>(0,C.jsx)(Lt.A,{title:e.label,arrow:!0,children:(0,C.jsx)(pe.A,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value))})]})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,md:6,ml:{xs:3,sm:0},children:(0,C.jsx)(da,{selectedDates:n,disabled:o,handleChange:r})})]})}var ua=n(74681),ha=n(3147),pa=n(84834);const xa=e=>{const{min:t=0,max:n=100,value:o,defaultValue:i,stepsForThreshold:l=1,marks:s=null,handleChange:d,disabled:c,backgroundCssGradient:u,invertSelection:p=!1,showInput:x=!0,inputUnit:m,valueLabelDisplay:g="on",showTip:y=!0}=e,b=(0,v.A)(),[f,j]=(0,a.useState)(p?o||i:t),[w,S]=(0,a.useState)(p?n:o||i),[D,k]=(0,a.useState)(-1),[T,I]=(0,a.useState)(!1),[M,E]=(0,a.useState)(""),P=(0,a.useCallback)(e=>{if(!s)return-1;const t=s.filter(t=>t.value>=e);if(0===t.length)return-1;const n=t.reduce((t,n)=>n.value-e<t.value-e?n:t),a=s.indexOf(n);return p?a-1:a},[s,p]);(0,a.useEffect)(()=>{const e=p?o:t,a=p?n:o;j(e),S(a),k(P(p?e:a))},[P,p,o,n,t]);const O="repeating-linear-gradient(-45deg, ".concat(ua.A[800],", ").concat(ua.A[800]," 4px, ").concat(ha.A.white," 4px, ").concat(ha.A.white," 8px)"),R={height:"20vh",minHeight:"250px",maxHeight:"500px",cursor:c?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:ha.A.black},['& .MuiSlider-thumb[data-index="'.concat(p?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:b.palette.background.paper,backgroundImage:b.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:c?ua.A[400]:u},"& .MuiSlider-track":(0,r.A)({background:O},p?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}),['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(D,'"]')]:{color:b.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:b.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(A.Ay,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,C.jsx)(A.Ay,{item:!0,xs:"auto",minWidth:"4.5rem",children:x?(0,C.jsx)(Zt.A,{variant:"standard",type:"number",label:"Threshold",value:p?f:w,onChange:e=>{const a=""===e.target.value?"":Number(e.target.value);a&&""!==a||d(a),""!==a&&a>=t&&a<=n?(j(p?a:t),S(p?n:a),d(a),k(P(a)),I(!1),E("")):(I(!0),E("Threshold must be between ".concat(t," and ").concat(n)))},error:T,helperText:M,size:"small",fullWidth:!0,disabled:c,inputProps:{step:l,min:t,max:n,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),m?(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(h.A,{variant:"body2",children:m})}):null]}),(0,C.jsx)(A.Ay,{item:!0,xs:12,sx:{mt:2,ml:7.5},children:(0,C.jsx)(pa.Ay,{getAriaLabel:()=>"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[f,w],step:null===s?l:null,marks:s,disabled:c,min:t,max:n,onChange:(e,a)=>{const r=a[p?0:1];j(p?r:t),S(p?n:r),d(r),k(P(r))},valueLabelDisplay:g,orientation:"vertical",sx:R})}),(0,C.jsx)(A.Ay,{item:!0,sx:{mt:1,ml:1,visibility:!0===y?"visible":"hidden"},children:(0,C.jsx)(h.A,{color:"text.secondary",variant:"caption",display:"block",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})},ma=e=>{const{value:t,invertSelection:n,handleValueChange:r,placeholderValueBeforeDataTypeSelection:o=.5,disabledSlider:i,showTip:l=!0}=e,{editingAlert:s}=zn(),d=(0,v.A)(),{language:c}=(0,a.useContext)(jt.j);let u=null;const h=s[vn];if(h&&x.Uy[h]){const e=x.Uy[h],a=d.palette.chart.colorAxes[e.color_axis],{colors:o,minValue:p,maxValue:m,defaultValueForAlert:g,stepsForThreshold:A}=a,v=H({gradientDirection:"to top",colors:o});let y,b;switch(h){case x.vV.voc:b=ve.ZS;break;case x.vV.aqi:case x.vV.pm2_5:case x.vV.pm10_raw:case x.vV.co2:b=ve.m7;break;case x.vV.heat_index_C:b=ve.RZ;break;default:b=null}b&&(y=b.filter((e,t)=>0!==t).map(t=>({value:t[e.threshold_mapping_name].low,label:(0,W.sC)(t.category,c)})));const f=Object.keys(x.Uy).filter(e=>e===s[vn]).map(e=>x.Uy[e].unit)[0];u=(0,C.jsx)(xa,{min:p,max:m,marks:y,defaultValue:g,value:t,stepsForThreshold:A,disabled:i,backgroundCssGradient:v,invertSelection:n,handleChange:r,inputUnit:f,showTip:l})}else u=(0,C.jsx)(xa,{min:0,max:1,value:o,disabled:!0,showInput:!1,invertSelection:n,valueLabelDisplay:"off",showTip:l});return u};var ga=n(81673);const Aa=e=>{let{value:t,handleChange:n,disabled:a}=e;return(0,C.jsxs)(y.A,{component:"fieldset",variant:"standard",sx:{mt:{md:-1}},disabled:a,children:[(0,C.jsx)(Gn.A,{children:(0,C.jsx)($n.A,{control:(0,C.jsx)(f.A,{checked:t,onChange:n,size:"small"}),label:(0,C.jsx)(h.A,{color:"text.secondary",fontWeight:500,children:"Max Once a Day"}),color:"text.secondary"})}),(0,C.jsx)(ga.A,{sx:{mt:-.5},children:!0===t?(0,C.jsxs)(C.Fragment,{children:["Send alert ",(0,C.jsx)("strong",{children:"at most once a day"})," when the threshold is breached"]}):(0,C.jsxs)(C.Fragment,{children:["Send alert ",(0,C.jsx)("strong",{children:"every hour"})," for as long as the threshold is breached"]})})]})},va=["currentAlertType","handleChange","disabled"],ya=["currentAlertType"],ba=e=>{let{currentAlertType:t,handleChange:n,disabled:a}=e,o=(0,Ye.A)(e,va);return(0,C.jsx)(he.A,(0,r.A)((0,r.A)({color:a?"standard":"primary",disabled:a,defaultValue:un.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:n},o),{},{children:Object.keys(un).map(e=>{const t=un[e];return(0,C.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)})}))},fa=e=>{let{currentAlertType:t}=e,n=(0,Ye.A)(e,ya);return(0,C.jsx)(he.A,(0,r.A)((0,r.A)({color:"standard",disabled:!0,defaultValue:un.below_threshold.id,value:t,exclusive:!0,"aria-label":"non-interactive button displaying threshold type",size:"small"},n),{},{children:Object.keys(un).map(e=>{const n=un[e];return n.id!==t?null:(0,C.jsxs)(pe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:n.id,"aria-label":n.id,children:[n.sign,"\xa0",n.name]},n.id)})}))},ja=e=>{const t=e[wn]?"enabled":"disabled",n=e[xn]?"is":"will be";return"This alert ".concat(n," ").concat(t)},wa=e=>{var t,n,a,o;let{alertTypeKey:i,crudType:l}=e;const{data:s}=(0,Tt.A)(),{editingAlert:c,allowedDataTypesForSensor:u,setEditingAlert:p}=zn(),m=(0,v.A)(),g=null===s||void 0===s||null===(t=s.sensors)||void 0===t?void 0:t.map(e=>({value:e.sensor_id,label:(0,W.Cn)(e.location_short)})),y=e=>{switch(e){case gn:case wn:return!1;case vn:return c[gn]===On(i)[gn];case En:return!0!==c[Pn];default:return c[vn]===On(i)[vn]}};return(0,C.jsxs)(d.A,{direction:"column",gap:2,mt:1,width:"100%",children:[null!==(n=Qn[l])&&void 0!==n&&n.contentText?(0,C.jsx)(Yn.A,{fontWeight:"500",children:Qn[l].contentText}):null,(0,C.jsxs)(d.A,{direction:"row",gap:1,alignItems:"center",mb:2,children:[(0,C.jsx)(w.A,{size:"small",checked:c[wn],onChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[wn]:e.target.checked}))},disabled:y(wn)}),(0,C.jsx)(h.A,{fontWeight:500,color:"text.secondary",children:ja(c)})]}),(0,C.jsxs)(A.Ay,{container:!0,columnSpacing:2,alignItems:"center",children:[(0,C.jsx)(A.Ay,{item:!0,xs:6,children:(0,C.jsx)(Qe,{icon:(0,C.jsx)(Kn.A,{}),label:Fn,value:c[gn],options:g,disabled:y(gn),handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[gn]:e.target.value,[vn]:""}))}})}),(0,C.jsx)(A.Ay,{item:!0,xs:6,children:(0,C.jsx)(Qe,{label:Bn,value:c[vn],options:u,disabled:y(vn),handleChange:e=>{var t,n;const a=e.target.value,o=x.Uy[a];p((0,r.A)((0,r.A)({},c),{},{[vn]:a,[yn]:null===(t=m.palette.chart.colorAxes[o.color_axis])||void 0===t?void 0:t.defaultValueForAlert,[En]:(0,r.A)((0,r.A)({},c[En]),{},{[yn]:null===(n=m.palette.chart.colorAxes[o.color_axis])||void 0===n?void 0:n.defaultValueForChildAlert})}))},flex:1})})]}),(0,C.jsx)(ca,{daysOfWeek:c[bn],excludedDates:c[Sn]||[],disabled:y(bn),handleDaysOfWeekChange:(e,t)=>{const n=Array.isArray(t)?t:[];p((0,r.A)((0,r.A)({},c),{},{[bn]:n.sort()}))},handleExcludedDatesChange:e=>{const t=c[Sn]||[],n=e.reduce((e,t)=>e.includes(t)?e.filter(e=>e!==t):[...e,t],t);p((0,r.A)((0,r.A)({},c),{},{[Sn]:n}))}}),(()=>{switch(i){case hn.daily.id:return(0,C.jsx)(Qe,{icon:(0,C.jsx)(Xn.A,{}),label:hn.daily.tableColumnHeader,value:c[fn],options:Ve,disabled:y(fn),handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[fn]:e.target.value}))}});case hn.threshold.id:return(0,C.jsxs)(A.Ay,{container:!0,columnSpacing:2,rowSpacing:.5,children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,C.jsx)(Xe,{timeRange:c[jn],defaultTimeRange:On(hn.threshold.id)[jn],disabled:y(jn),handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[jn]:e}))}})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,C.jsx)(Aa,{value:c[In],handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[In]:e.target.checked}))},disabled:y(In)})})]});default:return null}})(),i===hn.threshold.id?(0,C.jsxs)(A.Ay,{container:!0,alignItems:"start",spacing:2,children:[(0,C.jsxs)(A.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,children:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mt:"2px",mb:"12px"},children:"1. Alert if it is:"})}),(0,C.jsx)(A.Ay,{item:!0,sx:{mr:2},children:(0,C.jsx)(ba,{currentAlertType:c[mn],handleChange:e=>{const t=e.target.value,n=t===un.above_threshold.id?un.below_threshold.id:un.above_threshold.id;p((0,r.A)((0,r.A)({},c),{},{[mn]:t,[En]:(0,r.A)((0,r.A)({},c[En]),{},{[mn]:n})}))},disabled:y(mn),sx:{height:"100%"}})}),(0,C.jsx)(ma,{value:c[yn],invertSelection:c[mn]===un.below_threshold.id,handleValueChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[yn]:e}))},disabledToggle:y(mn),disabledSlider:y(yn),placeholderValueBeforeDataTypeSelection:2/3}),(0,C.jsx)(A.Ay,{item:!0,xs:12,mt:2,children:(0,C.jsx)(Jn,{value:c[Tn],handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[Tn]:e.target.value}))},maxLength:200,label:"Optional Message for Main Alert",disabled:y(Tn)})})]}),(0,C.jsxs)(A.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,children:(0,C.jsx)(Gn.A,{children:(0,C.jsx)($n.A,{disabled:y(Pn),control:(0,C.jsx)(f.A,{checked:!!c[Pn],onChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[Pn]:e.target.checked}))},size:"small"}),label:(0,C.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",children:"2. [Optional] Follow-up alert if it changes to:"}),color:"text.secondary"})})}),c[En]&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(A.Ay,{item:!0,sx:{mr:2},children:(0,C.jsx)(fa,{currentAlertType:null===(a=c[En])||void 0===a?void 0:a[mn],sx:{height:"100%"}})}),(0,C.jsx)(ma,{value:c[En][yn],invertSelection:(null===(o=c[En])||void 0===o?void 0:o[mn])===un.below_threshold.id||!0,handleValueChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[En]:(0,r.A)((0,r.A)({},c[En]),{},{[yn]:e})}))},disabledToggle:y(En),disabledSlider:y(En),showTip:!1,placeholderValueBeforeDataTypeSelection:1/3}),(0,C.jsx)(A.Ay,{item:!0,xs:12,mt:2,children:(0,C.jsx)(Jn,{value:c[En][Tn],handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[En]:(0,r.A)((0,r.A)({},c[En]),{},{[Tn]:e.target.value})}))},maxLength:200,label:"Optional Message for Follow-up Alert",showTip:!1,disabled:y(En)})})]})]})]}):(0,C.jsx)(Jn,{value:c[Tn],handleChange:e=>{p((0,r.A)((0,r.A)({},c),{},{[Tn]:e.target.value}))},maxLength:200,disabled:y(Tn)})]})},Sa=e=>{var t;const{alertTypeKey:n,openAlertModificationDialog:o,crudType:i,handleClose:l}=e,{currentSchoolID:c}=(0,a.useContext)(m.C),{selectedAlert:u,setSelectedAlert:h,editingAlert:p,setEditingAlert:x,setAlerts:g,addChildToAlerts:A}=zn(),[y,b]=(0,a.useState)(!1),{enqueueSnackbar:f}=(0,we.dh)(),j=(0,v.A)(),w=()=>{var e;if(n===hn.daily.id)return{valid:!0};if(!p[Pn])return{valid:!0};const t=p[mn]===un.above_threshold.id,a=p[yn],r=null===(e=p[En])||void 0===e?void 0:e[yn];return void 0===r?{valid:!0}:t&&a<=r||!t&&a>=r?{valid:!1,message:"The follow-up alert must have a ".concat(t?"lower":"higher"," threshold than the first alert")}:{valid:!0}},S=e=>{const t=(0,r.A)({},e);return delete t[En],delete t[Pn],t},D=(e,t)=>{const n=(0,r.A)((0,r.A)((0,r.A)({},e),e[En]),{},{[Mn]:t,[xn]:null});return delete n[En],delete n[Pn],n},k=e=>{let{passedCrudType:t}=e;const a=e=>{f(Qn[t].errorMessage,Se.n.error)},r=()=>{f(Qn[t].successMessage,Se.n.success),l()};switch(t){case Wn:{const e=w();if(!e.valid)return void f(e.message,Se.n.error);(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c}),restMethod:ze.Xo.POST,body:S(p)}).then(e=>{g(t=>{const n=[...t,e];return A(n)}),r();const t=On(n);if(h(t),x(t),!p[Pn])return;const o=e[xn];null!==o&&void 0!==o&&(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c}),restMethod:ze.Xo.POST,body:D(p,o)}).then(e=>{g(t=>{const n=[...t,e];return A(n)})}).catch(e=>a())}).catch(e=>a());break}case _n:{const e=w();if(!e.valid)return void f(e.message,Se.n.error);const t=u[xn];(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c,alert_id:t}),restMethod:ze.Xo.PUT,body:S(p)}).then(e=>{var n;g(n=>{const a=n.map(n=>n.id===t?e:n);return A(a)}),r();const o=null===(n=p[En])||void 0===n?void 0:n[xn];p[Pn]?null===o||void 0===o?(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c}),restMethod:ze.Xo.POST,body:D(p,t)}).then(e=>{g(t=>{const n=[...t,e];return A(n)})}).catch(e=>a()):(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c,alert_id:o}),restMethod:ze.Xo.PUT,body:D(p,t)}).then(e=>{g(t=>{const n=t.map(t=>t.id===o?e:t);return A(n)})}).catch(e=>a()):null!==o&&void 0!==o&&(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c,alert_id:o}),restMethod:ze.Xo.DELETE}).then(()=>{g(e=>{const t=e.filter(e=>e.id!==o);return A(t)}),r()}).catch(e=>a())}).catch(e=>a());break}case Ln:(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c,alert_id:u.id}),restMethod:ze.Xo.DELETE}).then(()=>{g(e=>e.filter(e=>e.id!==u.id)),r()}).catch(e=>a())}};(0,a.useEffect)(()=>{var e,t;if((null===(e=p[jn])||void 0===e?void 0:e[0])>(null===(t=p[jn])||void 0===t?void 0:t[1]))b(!0);else switch(i){case Wn:const e=On(n);p[gn]===e[gn]||p[vn]===e[vn]?n===hn.daily.id?b(p[fn]===e[fn]):b(!0):n===hn.daily.id?b(p[fn]===e[fn]):b(!1);break;case _n:let t;t=n===hn.daily.id?p[fn]:p[yn];const a=p[vn];if(!t||""===t||!a||""===a){b(!0);break}b(Nn()(u,p));break;default:b(!1)}},[i,u,p,n]);const T=(0,s.A)(e=>e.breakpoints.down("md"));return(0,C.jsxs)(Bt.A,{open:o,onClose:l,"aria-labelledby":"alert-modification-dialog",maxWidth:"md",fullWidth:!0,fullScreen:T,children:[(0,C.jsx)(Vt.A,{id:"alert-modification-dialog",children:null===(t=Qn[i])||void 0===t?void 0:t.title}),(0,C.jsx)(Ut.A,{children:(0,C.jsx)(wa,{alertTypeKey:n,crudType:i})}),(0,C.jsxs)(Ht.A,{sx:{justifyContent:"space-between"},children:[i===_n?(0,C.jsx)(qn,{onConfirmedDelete:()=>{k({passedCrudType:Ln})}}):null,(0,C.jsxs)(d.A,{direction:"row",width:"100%",justifyContent:"end",children:[(0,C.jsx)(Pe.A,{onClick:l,sx:{color:j.palette.text.secondary},children:"Cancel"}),(0,C.jsx)(Pe.A,{onClick:()=>{k({passedCrudType:i})},color:"primary",disabled:y,children:"Save Edit"})]})]})]})};var Da=n(73523),Ca=n(63572);const ka=e=>{if(!e||!(0,W.OP)(e))return"N/A";if(e.length===Zn.length)return"Everyday";const t=Zn.filter(t=>!e.includes(t.value));return 2===t.length&&t.every(e=>[5,6].includes(e.value))?"Only weekdays":e.map(e=>{var t;return null===(t=Zn.find(t=>t.value===e))||void 0===t?void 0:t.label.slice(0,2)}).join(", ")},Ta=(e,t)=>t?"":e&&Ca.f[e]?"".concat(Ca.f[e].name," added your email to this school-wide alert. For edit or removal, please reach out to ").concat(Ca.f[e].name,"."):void 0,Ia=e=>{var t;const{selectedAlert:n,setSelectedAlert:o,setAlerts:l,addChildToAlerts:s}=zn(),{currentSchoolID:c}=(0,a.useContext)(m.C),{enqueueSnackbar:u}=(0,we.dh)(),{alertTypeKey:h,alertsForTable:p}=e,g=(0,v.A)(),[A,y]=(0,a.useState)(!1),[b,f]=(0,a.useState)(null),j=e=>{let{alert:t,crudType:n}=e;o(t),f(n),y(!0)};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)(d.A,{spacing:2,alignItems:"center",children:[(0,C.jsx)(i.A,{sx:{width:"100%",overflowX:"auto"},children:(0,W.OP)(p)?(0,C.jsxs)(Et.A,{size:"small",sx:{my:1},children:[(0,C.jsx)(Pt.A,{children:(0,C.jsxs)(Ot.A,{children:[(0,C.jsx)(Rt.A,{sx:{px:0}}),(0,C.jsx)(Rt.A,{children:Fn}),(0,C.jsx)(Rt.A,{children:Bn}),(0,C.jsx)(Rt.A,{children:Hn}),(0,C.jsx)(Rt.A,{children:(null===(t=hn[h])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,C.jsx)(Rt.A,{children:Vn})]})}),(0,C.jsx)(Da.A,{component:zt.A,children:(0,W.OP)(p)?p.map((e,t)=>{return(0,C.jsx)(rn.A,{children:(0,C.jsxs)(Ot.A,{sx:{background:e[xn]===n[xn]&&g.palette.background.NYUpurpleLight,textDecoration:!1===e[wn]?"line-through":"none"},children:[(0,C.jsxs)(Rt.A,{sx:{px:0},children:[(0,C.jsx)(Lt.A,{title:!1===e[kn]?Ta(e[Dn],e[kn]):"Click to ".concat(e[wn]?"disable":"enable"," alert"),children:(0,C.jsx)("span",{onClick:()=>{!1!==e[kn]?(e=>{let{alert:t}=e;const n=!t[wn];(0,Ce.i)({url:(0,ke.BW)({endpoint:ze.tK.alerts,school_id:c,alert_id:t[xn]}),restMethod:ze.Xo.PUT,body:(0,r.A)((0,r.A)({},t),{},{[wn]:n})}).then(e=>{l(n=>{const a=n.map(n=>n[xn]===t[xn]?e:n);return s(a)}),u("This alert will be ".concat(n?"enabled":"disabled"),Se.n.success)}).catch(e=>{u(e.message||"There was an error ".concat(n?"enabling":"disabling"," this alert, try again!"),Se.n.error)})})({alert:e}):u(Ta(e[Dn],e[kn]),Se.n.warning)},style:{display:"inline-block"},children:(0,C.jsx)(w.A,{size:"small",disabled:!1===e[kn],checked:e[wn]})})}),(0,C.jsx)(Lt.A,{title:!1===e[kn]?Ta(e[Dn],e[kn]):"Edit alert",children:(0,C.jsx)("span",{onClick:()=>{!1!==e[kn]?j({alert:e,crudType:_n}):u(Ta(e[Dn],e[kn]),Se.n.warning)},style:{display:"inline-block"},children:(0,C.jsx)(Ft.A,{"aria-label":"edit",size:"small",disabled:!1===e[kn],sx:{"&:hover,:focus":{color:g.palette.primary.main}},children:(0,C.jsx)(on.A,{})})})})]}),(0,C.jsx)(Rt.A,{sx:{textTransform:"capitalize"},children:e[An]}),(0,C.jsx)(Rt.A,{children:Object.keys(x.Uy).filter(t=>t===e[vn]).map(e=>x.Uy[e].name_title)[0]}),(0,C.jsx)(Rt.A,{children:ka(e[bn])}),h===hn.threshold.id?(0,C.jsxs)(Rt.A,{children:[un[e[mn]].sign," ",e[yn],"\xa0",Object.keys(x.Uy).filter(t=>t===e[vn]).map(e=>x.Uy[e].unit)[0]]}):null,h===hn.daily.id?(0,C.jsx)(Rt.A,{children:He(e[fn])}):null,(0,C.jsx)(Rt.A,{children:(0,C.jsx)(S.A,{label:(a=e[Dn],o=e[Cn],!0===o?"You":a?Ca.f[a].name:"N/A"),size:"small"})})]})},t);var a,o}):null})]}):(0,C.jsxs)(Fe.A,{severity:"warning",sx:{mt:2},children:["No ",hn[h].name.toLowerCase()," alert has been set up"]})}),(0,C.jsx)(Pe.A,{variant:"outlined",startIcon:(0,C.jsx)(ln.A,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>j({alert:On(h),crudType:Wn}),children:"Add Alert"})]}),(0,C.jsx)(Sa,{alertTypeKey:h,crudType:b,openAlertModificationDialog:A,handleClose:()=>{y(!1),o(On(h))}})]})},Ma=["children","value","index","alertType","alertsArray"];function Ea(e){const{children:t,value:n,index:a,alertType:o,alertsArray:l}=e,s=(0,Ye.A)(e,Ma);return(0,C.jsx)(i.A,(0,r.A)((0,r.A)({role:"tabpanel",hidden:n!==a,id:"alert-tabpanel-".concat(o.id),"aria-labelledby":"alert-tab-".concat(o.id),width:"100%"},s),{},{children:(0,C.jsx)(Ia,{alertTypeKey:o.id,alertsForTable:l})}))}function Pa(){const e=(0,s.A)(e=>e.breakpoints.down("sm")),[t,n]=(0,a.useState)(0),{setSelectedAlert:r}=zn(),{alerts:o}=zn(),l=e=>{const t=o.filter(t=>{var n;if(!t)return null;const a=null===(n=t[mn])||void 0===n?void 0:n.toLowerCase(),r=t[Mn];return!a.includes(e)||null!==r&&void 0!==r?null:t});return{array:t,alertsLength:(0,W.OP)(t)?t.length:"0"}};return(0,C.jsxs)(i.A,{children:[(0,C.jsx)(nt,{value:t,onChange:(e,t)=>{var a,o;n(t),r(On(null===(a=hn[null===(o=Object.keys(hn))||void 0===o?void 0:o[t]])||void 0===a?void 0:a.id))},variant:e?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(hn).map(e=>{const t=l(e.id);return(0,C.jsx)(c.A,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)})}),Object.values(hn).map(e=>{const n=l(e.id);return(0,C.jsx)(Ea,{alertType:e,value:t,index:e.index,alertsArray:n.array},e.id)})]})}function Oa(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=kt(t),{fetchAlerts:r,hasFetchedAlerts:o,setHasFetchedAlerts:i}=zn(),{user:l}=(0,a.useContext)(Ct.R),s=[Ca.f.admin.id,Ca.f.school.id].includes(null===l||void 0===l?void 0:l.user_role);return(0,C.jsx)(Yt,{buttonIcon:(0,C.jsx)(Jt.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:e=>{n(e)&&!o&&(r(),i(!0))},children:(0,C.jsxs)(d.A,{width:"100%",spacing:s?5:2,children:[(0,C.jsx)(Pa,{}),s?(0,C.jsx)(an,{}):(0,C.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,C.jsx)("b",{children:null===l||void 0===l?void 0:l.email})]})]})})}var Ra=n(50269),za=n(21122);const Wa=e=>{let{onLoginSuccess:t,children:n}=e;const r=(0,a.useRef)(null),{enqueueSnackbar:o}=(0,we.dh)(),{setAuthenticationState:i,setUser:l}=(0,a.useContext)(Ct.R),[s,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),h=(0,a.useCallback)(()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,n=window.open(Ra.S.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(n){n.focus(),r.current=n;const e=setInterval(()=>{n.closed&&(clearInterval(e),window.removeEventListener("message",p),r.current=null)},500)}else alert("Popup blocked. Please enable popups for login.")},[]),p=(0,a.useCallback)(e=>{if(e.origin===window.location.origin&&e.data.type===Ca.$.password&&e.data.success){const n=e.data.user;i({checkedAuthentication:!0,authenticated:!0}),l(n),n.message&&o(n.message,Se.n.success),!1===n.is_verified&&(d(!0),u(n.email)),null===t||void 0===t||t()}},[t]);return(0,a.useEffect)(()=>(window.addEventListener("message",p),()=>{window.removeEventListener("message",p)}),[p]),(0,C.jsxs)(C.Fragment,{children:[n({openLoginPopup:h}),(0,C.jsx)(za.A,{open:s,email:c})]})},_a=()=>{const{loggedIn:e}=kt(),{enqueueSnackbar:t}=(0,we.dh)();return(0,C.jsx)(Wa,{onLoginSuccess:()=>{t("You can now access TV Screens, Dataset, and Alerts.",{variant:Se.n.success.name,duration:2*Se.n.success.duration})},children:t=>{let{openLoginPopup:n}=t;return(0,C.jsxs)(A.Ay,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(It,{onButtonClick:e?null:n})}),(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(Qt,{onButtonClick:e?null:n})}),(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(Rn,{children:(0,C.jsx)(Oa,{onButtonClick:e?null:n})})})]})}})};var La=n(30922),Fa=n(78185);const Ba=["tooltipTitle","label"],Ha=e=>{const{tooltipTitle:t,label:n}=e,a=(0,Ye.A)(e,Ba),o=(0,C.jsx)(S.A,(0,r.A)({size:"small",label:n||(0,C.jsx)(Fa.A,{variant:"text",sx:{minWidth:"5rem"}}),sx:{userSelect:"text","& .MuiChip-label":{userSelect:"text"}}},a));return t?(0,C.jsx)(Lt.A,{title:t,enterDelay:0,leaveDelay:200,children:o}):o};var Va=n(84392),Ua=n(39983);const Na=(e,t)=>(0,C.jsxs)(i.A,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[e||"Loading...",t?(0,C.jsx)(Ua.A,{}):(0,C.jsx)(Ze.A,{})]}),Ya=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C),{data:t}=(0,Tt.A)(),{user:n}=(0,a.useContext)(Ct.R),r=(0,Dt.Zp)(),[o,i]=(0,a.useState)(null),s=Boolean(o),d=()=>{i(null)};if(t)return!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1?(0,C.jsx)(Ha,{icon:(0,C.jsx)(Kn.A,{}),label:t.name||"No School Name Given",tooltipTitle:"School"}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Ha,{icon:(0,C.jsx)(Kn.A,{}),label:Na(t.name,s),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{i(e.currentTarget)},"aria-controls":s?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0}),(0,C.jsx)(u.A,{anchorEl:o,open:s,onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,C.jsx)(La.A,{dense:!0,children:n.allowedSchools.map((t,n)=>{return(0,C.jsx)(l.A,{onClick:(a=t.school_id,()=>{e!==a&&(localStorage.setItem(Va.D.schoolID,a),gt.n(gt.s.internalNavigation,{origin_school:e,destination_school_id:a,origin_id:"school_selector"}),r("".concat(Ra.S.dashboard,"/").concat(a))),d()}),children:t.name},n);var a})})})]})};var qa=n(52177);const Qa=()=>{const{data:e}=(0,Tt.A)();if(e)return(0,C.jsxs)(A.Ay,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(Ya,{})}),(0,C.jsx)(A.Ay,{item:!0,children:(0,C.jsx)(Ha,{icon:(0,C.jsx)(qa.A,{}),label:"".concat(e.contactPerson," <").concat(e.contactEmail,">"),tooltipTitle:"Main Contact",component:"a",href:"mailto:".concat(null===e||void 0===e?void 0:e.contactEmail),clickable:!0})})]})},Xa=()=>{const e=(0,v.A)(),{data:t}=(0,Tt.A)();return t?(0,C.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,N.Ay)(t.description||"",{replace:W.H$})}):Array.from({length:3}).map((e,t)=>(0,C.jsx)(Fa.A,{variant:"text"},t))};var Ka=n(54536);const Ga=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,a.useContext)(m.C);return!1===e?(0,C.jsx)(d.A,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,C.jsxs)(Pe.A,{variant:"contained",onClick:()=>{t(!0)},children:[(0,C.jsx)(Ka.A,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null};var $a=n(61413);const Ja=()=>{const{currentSchoolID:e,loadMoreCharts:t}=(0,a.useContext)(m.C),{data:n}=(0,qt.A)(),{data:r}=(0,Tt.A)(),o=t?ze.HG.length:me.JO,{themePreference:l,temperatureUnitPreference:s}=(0,a.useContext)(jt.j);return(0,C.jsxs)(i.A,{width:"100%",children:[(0,C.jsx)(vt,{}),(0,C.jsx)(bt.A,{backgroundColor:"customAlternateBackground",children:(0,C.jsxs)(lt.A,{sx:{pt:2,pb:2},children:[(0,C.jsxs)(A.Ay,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,C.jsx)(A.Ay,{item:!0,xs:12,children:(0,C.jsx)(it.A,{text:(()=>{if(null!==r&&void 0!==r&&r.school_id)return"Air Quality | ".concat(null===r||void 0===r?void 0:r.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,children:(0,C.jsx)(Qa,{})}),(0,C.jsx)(A.Ay,{item:!0,xs:12,children:(0,C.jsx)(_a,{})})]}),!0===(null===r||void 0===r?void 0:r.has_map)&&(0,C.jsx)($a.A,{currentSensorsData:n,schoolID:e,isOnBannerPage:!1,minMapHeight:"250px"}),!1===(null===r||void 0===r?void 0:r.has_map)&&(0,C.jsx)(i.A,{textAlign:"center",sx:{mb:2},children:(0,C.jsx)(ft.A,{currentSensorsData:n,isScreen:!1,temperatureUnitPreference:s,showHeatIndex:e===me.iC&&!1,showWeather:e===me.iC&&!1})}),(0,C.jsx)(Xa,{}),(0,C.jsx)(wt.A,{})]})}),(0,C.jsx)(i.A,{id:yt.charts.id,children:ze.HG.slice(0,o).map((e,n)=>(0,C.jsx)(bt.A,{backgroundColor:n%2!==0?"customAlternateBackground":"",children:(0,C.jsxs)(lt.A,{sx:{pt:4,pb:4},height:"auto",className:l===dt.A.dark?"dark":"",id:"chart-".concat(n+1),children:[(0,C.jsx)(Re,{children:(0,C.jsx)(ot,{chartID:n})}),n===o-1&&!t&&(0,C.jsx)(Ga,{})]})},n))}),(0,C.jsx)(st.A,{})]})};var Za=n(25282);const er=()=>{const{currentSchoolID:e}=(0,a.useContext)(m.C);(0,a.useEffect)(()=>{e&&(document.title="".concat(me.sG," | ").concat(e.toUpperCase()))},[e]);const{setCurrentPage:t}=(0,a.useContext)(Za.B);return(0,a.useEffect)(()=>{t(Ra.S.dashboard)},[t]),(0,C.jsx)(Ja,{})}},35197:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(22555),r=n(80045),o=n(85865),i=n(78185),l=n(70579);const s=["text","sx"];function d(e){let{text:t,sx:n}=e,d=(0,r.A)(e,s);return(0,l.jsx)(o.A,(0,a.A)((0,a.A)({variant:"h4",color:"text.primary",sx:(0,a.A)({fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1},n)},d),{},{children:t||(0,l.jsx)(i.A,{variant:"text"})}))}},47298:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(71806),r=n(96446),o=n(84882),i=n(28076),l=n(10039),s=n(73460),d=n(34535),c=n(85721),u=n(8011),h=n(52687),p=n(65043),x=n(65290),m=n(94922),g=n(70579);const A=(0,d.Ay)(a.A,{shouldForwardProp:e=>"tiny"!==e})(e=>{let{theme:t,tiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}});const v=function(e){const{themePreference:t,language:n}=(0,p.useContext)(x.j),{tiny:a,hideAQIDescription:d}=e,v=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(r.A,{overflow:"auto",children:(0,g.jsxs)(A,{size:"small",tiny:a,children:[(0,g.jsx)(o.A,{children:(0,g.jsxs)(i.A,{children:[(0,g.jsx)(l.A,{sx:{pr:0},children:(0,g.jsx)(r.A,{sx:{width:"1em",height:"1em"}})}),(0,g.jsx)(l.A,{sx:{pl:1},children:"Category"}),(0,g.jsx)(l.A,{align:"right",children:"US AQI"}),(0,g.jsxs)(l.A,{align:"right",children:["PM2.5 (\xb5g/m",(0,g.jsx)("sup",{children:"3"}),")"]}),!d&&(0,g.jsx)(l.A,{align:"left",children:"Description"}),!d&&(0,g.jsxs)(l.A,{align:"left",children:[m.sG,"' Suggested Actions"]})]})}),(0,g.jsx)(s.A,{children:h.m7.map((e,a)=>(0,g.jsxs)(i.A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,g.jsx)(l.A,{sx:{pr:0},children:(0,g.jsx)(r.A,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,g.jsx)(l.A,{sx:{pl:1},children:(0,u.sC)(e.category,n)}),(0,g.jsx)(l.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.aqiUS.low,e.aqiUS.high)}),(0,g.jsx)(l.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.rawPM2_5.low,e.rawPM2_5.high)}),!d&&(0,g.jsx)(l.A,{align:"left",children:e.description}),!d&&(0,g.jsx)(l.A,{align:"left",children:(0,c.Ay)((0,u.sC)(e.healthSuggestions.outdoors,n),{replace:u.H$})})]},a))})]})})})}},51210:(e,t,n)=>{n.d(t,{A:()=>v});var a=n(65043),r=n(34535),o=n(13766),i=n(86605),l=n(40710),s=n(96446),d=n(77739),c=n(85865),u=n(40430),h=n(97847),p=n(70579);const x=(0,r.Ay)(o.A)(e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}}),m=(0,r.Ay)(i.A)(e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(1):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(1),marginBottom:t.spacing(1)}}}),g="Click to expand section",A="Click to collapse section",v=e=>{const{title:t,content:n,icon:r,disabled:o}=e,[i,v]=(0,a.useState)(void 0);return(0,p.jsx)(s.A,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,p.jsxs)(x,{expanded:"panel1"===i,onChange:(y="panel1",(e,n)=>{v(n?y:void 0),h.n(n?h.s.expandSection:h.s.collapseSection,{section:t})}),disabled:o,children:[(0,p.jsx)(m,{expanded:i,expandIcon:(0,p.jsx)(u.A,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,p.jsx)(d.A,{title:i?A:g,enterDelay:0,leaveDelay:200,children:(0,p.jsxs)(c.A,{component:"a",variant:"body1",children:[t,(0,p.jsx)(s.A,{component:"span",sx:{ml:.25},children:r})]})})}),(0,p.jsx)(l.A,{sx:{pt:0},children:n})]})});var y}},73605:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(65043),r=n(96446),o=n(85865),i=n(85721),l=n(8011),s=n(47298),d=n(51210),c=n(65290),u=n(98348),h=n(70579);const p="Explanation of the US Air Quality Index (AQI) for PM2.5",x="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',g=()=>{const{themePreference:e}=(0,a.useContext)(c.j);return(0,h.jsx)(d.A,{title:p,icon:(0,h.jsx)(u.A,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(r.A,{children:[(0,h.jsx)(s.A,{themePreference:e}),(0,h.jsx)(o.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,i.Ay)(x,{replace:l.H$})}),(0,h.jsx)(d.A,{title:"Reference",content:(0,h.jsx)(o.A,{variant:"caption",color:"text.secondary",children:(0,i.Ay)(m,{replace:l.H$})})})]})})}}}]);
//# sourceMappingURL=152.c4f6b6e5.chunk.js.map