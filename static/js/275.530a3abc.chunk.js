"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[275],{3275:(t,e,r)=>{r.r(e),r.d(e,{default:()=>L});var n=r(72791),a=r(57689),o=r(31781),i=r(61889),s=r(36314),c=r(697),l=r(20890),u=r(52069),d=r(29019),h=r(44709),f=r(56593);const p=1,g=2,v=3;var x=r(64377),m=r(30970),y=r(13967),j=r(19132),b=r(80184);const w=t=>{const{data:e}=t,{language:r}=(0,n.useContext)(j.p),a=(0,y.Z)(),o=(0,n.useRef)(),i=(0,n.useRef)(),s=(0,n.useRef)(),l=(0,n.useRef)(),u=(0,n.useRef)();let p,g,v,w,S=200;const q=30,Z=80,_=70,k=d.jvg().x((function(t){return v(t.timestamp)})).y((function(t){return w(t.aqi.val)})).curve(d.YY7.tension(0));return(0,n.useEffect)((()=>{if(!e)return;if(!o.current)return;if(!i.current)return;if(!s.current)return;if(!l.current)return;if(!u.current)return;p=o.current.clientWidth,g=o.current.clientHeight-q,d.Ys(i.current).selectAll("*").remove(),d.Ys(s.current).selectAll("*").remove(),d.Ys(l.current).selectAll("*").remove(),d.Ys(u.current).selectAll("*").remove(),d.Ys(i.current).attr("opacity",.5),d.Ys(s.current).attr("filter","brightness(0.8) contrast(1.2) saturate(1.2)"),Object.entries(e).forEach((t=>{var e;let[r,n]=t;if(null===(e=n.historical)||void 0===e||e.forEach((function(t){t.timestamp=new Date(t.timestamp)})),n.historical&&Array.isArray(n.historical)){const t=d.Fp7(n.historical,(function(t){return t.aqi.val}));t>S&&(S=t)}})),S=50*Math.ceil(S/50);for(let e of h._R)if(S>=e.aqiUS.low&&S<=e.aqiUS.high){S=e.aqiUS.high===1/0?S:e.aqiUS.high;break}let t=new Date,n=new Date;n.setHours(n.getHours()-6),v=d.Xf().domain([n,t]).rangeRound([_,p-Z]),w=d.BYU().domain([0,S]).range([g+q,q]);let c=Math.max(Math.floor((h._R[1].aqiUS.high-h._R[0].aqiUS.high)/S*g/2),20),y=Math.floor(c/5);for(let e=0;e<h._R.length;e++){const t=h._R[e],n=t.aqiUS.high===1/0?S:t.aqiUS.high,a=t.aqiUS.low;if(S<=a)break;const o=50*Math.ceil((n-a)/50);d.Ys(i.current).append("rect").attr("x",0).attr("y",g-n/S*g+q).attr("width",p).attr("height",o/S*g).attr("fill",t.color.Light),d.Ys(s.current).append("text").attr("x",y).attr("y",g-t.aqiUS.low/S*g-3.5*y+q).attr("fill",t.color.Light).attr("font-size",c).text(50*Math.floor(t.aqiUS.low/50)),d.Ys(s.current).append("text").attr("class","category-text-graph-sm").attr("x",y+2).attr("y",g-t.aqiUS.low/S*g-y+q).attr("fill",t.color.Light).attr("font-size",c/2).text((0,x.i0)(t.category,r))}d.Ys(l.current).append("rect").attr("x",0).attr("y",0).attr("width",p).attr("height",q).attr("fill","white");let j=d.i$Z("%H:%M");d.Ys(l.current).append("g").attr("transform","translate(0,".concat(q,")")).call(d.F5q(v).tickSize(-g).ticks(d.Z_i.every(120)).tickFormat((function(t){return j(t)}))).attr("font-size",g/20).attr("color",m.WW.screen).select(".domain").remove(),d.Ys(l.current).selectAll("line").attr("stroke","white").attr("stroke-width",2).attr("opacity",.5),Object.entries(e).forEach((t=>{var e,r,n;let[o,i]=t;d.Ys(u.current).append("path").datum(i.historical||[]).attr("x",_).attr("class","line").attr("d",k).attr("fill","transparent").attr("stroke","black").attr("stroke-width","5px").attr("opacity","outdoors"===(null===(e=i.sensor)||void 0===e?void 0:e.location_type)?1:.5);const s=(null===(r=i.historical)||void 0===r?void 0:r.length)>0?null===(n=i.historical)||void 0===n?void 0:n[0]:null;if(s&&s.aqi&&void 0!==s.aqi.val&&null!==s.aqi.val&&s.timestamp){var c,l,h,p,y;const t=d.Ys(u.current).append("g").attr("transform","translate("+v(s.timestamp)+","+w(s.aqi.val)+")").attr("fill",null!==(null===i||void 0===i||null===(c=i.current)||void 0===c||null===(l=c.aqi)||void 0===l?void 0:l.categoryIndex)?a.palette.text.aqi[i.current.aqi.categoryIndex]:m.WW.screen);(null===(h=i.sensor)||void 0===h?void 0:h.sensor_status)===f.vI.active&&t.append("circle").attr("cx",0).attr("cy",0).attr("filter","brightness(0.5)").attr("class","pulse-ring").attr("r",25),t.append("circle").attr("cx",0).attr("cy",0).attr("stroke","#666").attr("class",(null===(p=i.sensor)||void 0===p?void 0:p.sensor_status)===f.vI.active&&"pulse-dot").attr("r",10),t.append("text").attr("class","location-label").attr("x",15).attr("y",0).attr("fill","black").attr("alignment-baseline","middle").attr("text-anchor","left").attr("font-size",g/25).text((0,x.Fb)(null===(y=i.sensor)||void 0===y?void 0:y.location_short));const e=document.getElementsByClassName("location-label");for(let r=1;r<e.length;r++){const t=e[r-1],n=e[r],a=(j=t.getBoundingClientRect(),b=n.getBoundingClientRect(),j.bottom<b.top||j.top>b.bottom?0:j.top<b.top?-1:1);0!==a&&(t.setAttribute("y",10*a),n.setAttribute("y",10*-a))}}var j,b}))}),[e,r]),(0,b.jsx)(c.Z,{sx:{"& .pulse-ring":{animation:"pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-ring":{"0%":{transform:"scale(0.2)"},"80%":{},"100%":{opacity:0}}},"& .pulse-dot":{animation:"pulse-dot 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-dot":{"0%":{transform:"scale(0.5)"},"50%":{transform:"scale(1)",filter:"brightness(1.2) contrast(1.2) saturate(1.2)"},"100%":{transform:"scale(0.5)"}}}},width:"100%",height:"100%",children:(0,b.jsxs)("svg",{id:"recent-historical-graph",width:"100%",height:"100%",ref:o,children:[(0,b.jsx)("g",{ref:i}),(0,b.jsx)("g",{ref:l}),(0,b.jsx)("g",{ref:s}),(0,b.jsx)("g",{ref:u})]})})};var S=r(1414),q=r(87505),Z=r(63867),_=r(47896),k=r(41009),I=r(85332),R=r(41212),C=r(83165),M=r(71478),P=r(80925);const U=()=>{const{schoolMetadata:t,currentSchoolID:e}=(0,n.useContext)(C.G),r=null===t||void 0===t?void 0:t.is_public,a=document.location.href.split("screen"),o="screen".concat(a.pop()),i=!0===r?"".concat(R.eK,"/dashboard/").concat(e,"?source=").concat(o):"".concat(R.eK,"?source=").concat(o);return(0,b.jsx)(P.ZP,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:i,viewBox:"0 0 256 256"})};var Y=r(84852),W=r(49900),A=r(90493),z=r(53540);const E=t=>{let{data:e}=t;const{language:r}=(0,n.useContext)(j.p);if(!Object.values(e).every((t=>{var e;return(null===(e=t.sensor)||void 0===e?void 0:e.sensor_status)===f.vI.active})))return null;const a=e.find((t=>{var e;return"outdoors"===(null===(e=t.sensor)||void 0===e?void 0:e.location_type)})).current.aqi.val;if(a<=h._R[0].aqiUS.high)return null;const o=e.find((t=>{var e;return null===(e=t.sensor)||void 0===e?void 0:e.location_type.startsWith("indoors")})).current.aqi.val,i=a/o,s=i>=2?"".concat(i.toFixed(1),"x"):i>1.2?"".concat(Math.round((a-o)/o*100),"%"):null;return s?(0,b.jsx)(Y.ZP,{children:(0,b.jsx)(W.Z,{primary:(0,x.i0)(M.screen.content.indoorsVsOutdoors,r,{value:(0,b.jsx)(l.Z,{component:"span",color:"".concat(h._R[0].color.Light," !important"),children:s})})})}):null},F=t=>{let{typeOfScreen:e,data:r}=t;const{language:a}=(0,n.useContext)(j.p),o=new Map;return Object.values(r).forEach((t=>{var r,n;const i=(t=>{var r,n;if(void 0!==(null===t||void 0===t||null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.categoryIndex)){var o;const{healthSuggestions:r,category:n}=h._R[t.current.aqi.categoryIndex],i=(0,x.i0)(r[null===(o=t.sensor)||void 0===o?void 0:o.location_type],a);if(e===v)return i;{const t=(0,x.i0)(n,a);return"".concat(t,": ").concat(i)}}return null})(t);if(!i)return;const s=(null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.val)>=h._R[2].aqiUS.low;o.has(i)?o.set(i,o.get(i)||s):o.set(i,s)})),(0,b.jsxs)(A.Z,{className:"condensedFont",sx:{listStyleType:"disclosure-closed","& .MuiTypography-root":{fontSize:"2rem"},"& .MuiListItem-root":{display:"list-item",ml:3,p:0},"& .MuiTypography-root, .MuiListItem-root":{color:m.WW.screen}},children:[e===v&&(0,b.jsx)(E,{data:r}),[...o.entries()].map(((t,e)=>{let[r,n]=t;return(0,b.jsx)(Y.ZP,{className:n?"flashingRed":"",children:(0,b.jsx)(W.Z,{primary:(0,z.ZP)(r)})},e)}))]})};function D(t){const e=new URLSearchParams(t.search).get("displayHours");if(!e)return!0;const[r,n]=e.split("-").map((t=>parseInt(t.replace(":",""),10))),a=parseInt((new Date).toTimeString().slice(0,5).replace(":",""),10);return r<=n?r<=a&&a<n:a>=r||a<n}const L=t=>{let{title:e}=t;const{school_id_param:r,screen_id_param:d}=(0,a.UO)(),{temperatureUnitPreference:f,language:y,setLanguage:P}=(0,n.useContext)(j.p),{schoolMetadata:Y,currentSchoolID:W}=(0,n.useContext)(C.G),{authenticationState:A}=(0,n.useContext)(o.S),z=(0,a.s0)(),E=(0,a.TH)(),L=E.pathname,[H,O]=(0,n.useState)(D(E)),[T,B]=(0,n.useState)(D(v));(0,n.useEffect)((()=>{if(!Y||!(0,x.qt)(Y.languages))return;const t=Y.languages;if(t.length<=1)return;const e=setInterval((()=>{O(D(E));const e=(new Date).getMinutes();P(t[e%t.length])}),6e4);return()=>clearInterval(e)}),[Y,E,P]),(0,n.useEffect)((()=>{document.title=e}),[e]);const[N,G]=(0,n.useState)(),[$,K]=(0,n.useState)({});(0,n.useEffect)((()=>{function t(){return 0!==[0,0,1,1,0,0,1,1,0,0,1,1][(new Date).getMonth()]}G(t());const e=setInterval((()=>{G(t())}),864e5);return()=>{clearInterval(e)}}),[]),(0,n.useEffect)((()=>{if(!1!==A.checkedAuthentication){if(!0===A.authenticated){if(0!=Object.keys($).length)return;const t=(0,Z.kG)({endpoint:_.eV.screen,school_id:r||W,screen_id:d});(0,k.m)(t).then((t=>{K(t);const e=t.some((t=>{let{sensor:e}=t;return"outdoors"===e.location_type})),r=t.some((t=>{let{sensor:e}=t;return e.location_type.startsWith("indoors")})),n=r&&e?v:r?p:e?g:null;n&&B(n)})).catch((t=>{console.log(t)}));const e=setInterval((()=>{(0,k.m)(t).then((t=>{K(t)})).catch((t=>console.log(t)))}),3e5);return()=>{clearInterval(e)}}z("".concat(I.$.login,"?").concat(I.$.redirectQuery,"=").concat(L))}}),[A]);const Q=(0,x.i0)(M.screen.content.aqiTitle,y),V=(0,x.i0)(M.screen.content.pm25Title,y);return H?(0,b.jsxs)(i.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{overflow:"hidden",background:"white","& *":{fontWeight:"500 !important"},"& .condensedFont":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important","& *":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important"}},"& .flashingRed":{"& .MuiTypography-root ":{color:"".concat(h._R[3].color.Light," !important"),opacity:.8},color:"".concat(h._R[3].color.Light," !important"),animation:"flashingRed 3s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes flashingRed":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}},children:[(0,b.jsx)(i.ZP,{item:!0,xs:6,sx:{py:3,px:2,order:N?1:0,background:"#212529"},children:(0,b.jsxs)(s.Z,{direction:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[(0,b.jsxs)(c.Z,{children:[(0,b.jsx)(l.Z,{variant:"h2",fontWeight:"500",color:"white",children:Q}),(0,b.jsx)(l.Z,{variant:"h3",className:"condensedFont",color:m.WW.screen,children:V})]}),(0,b.jsx)(i.ZP,{container:!0,justifyContent:"space-around",children:(0,b.jsx)(S.Z,{currentSensorsData:$,temperatureUnitPreference:f,isScreen:!0,size:q.l.large,showHeatIndex:W!==R.sH})}),(0,b.jsx)(F,{typeOfScreen:T,data:$})]})}),(0,b.jsxs)(i.ZP,{item:!0,xs:6,sx:{order:N?0:1},children:[(0,b.jsx)(c.Z,{sx:{position:"absolute",top:0,right:!N&&0,left:N&&0,width:"5vw",height:"5vw",m:1},children:(0,b.jsx)(u.Z,{})}),(0,b.jsxs)(i.ZP,{container:!0,alignContent:"space-between",justifyContent:"center",height:"100%",textAlign:"center",children:[(0,b.jsxs)(i.ZP,{item:!0,xs:12,sx:{pt:3,px:2},children:[(0,b.jsx)(l.Z,{variant:"h2",sx:{color:"black"},children:R.DE}),W===R.sH&&(0,b.jsxs)(l.Z,{variant:"h5",color:"text.secondary",children:[(0,x.i0)(M.screen.content.dataProvider,y),": AirQo"]})]}),(0,b.jsx)(i.ZP,{item:!0,xs:2,children:(0,b.jsx)(c.Z,{height:"auto",width:"90%",children:(0,b.jsx)(U,{})})}),(0,b.jsx)(i.ZP,{item:!0,xs:12,height:"70%",className:"condensedFont",sx:{"& *":{fontWeight:"600 !important"}},children:(0,b.jsx)(w,{data:$})})]})]})]}):(0,b.jsx)(i.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{overflow:"hidden",background:"black"}})}}}]);
//# sourceMappingURL=275.530a3abc.chunk.js.map