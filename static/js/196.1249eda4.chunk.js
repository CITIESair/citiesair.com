"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[196],{4967:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(92535),a=n(65043),o=n(9209),i=n(96157),l=n(38119),s=n(22126);const d=()=>{const{currentSchoolID:e}=(0,a.useContext)(i.C);return(0,r.I)({queryKey:[s.tK.schoolmetadata,e],queryFn:async()=>{const t=(0,l.e)({paths:[s.tK.schoolmetadata,e]});return(0,o.i)({url:t})},enabled:!!e,staleTime:36e5,placeholderData:e=>e})}},35197:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(22555),a=n(80045),o=n(85865),i=n(78185),l=n(70579);const s=["text","sx"];function d(e){let{text:t,sx:n}=e,d=(0,a.A)(e,s);return(0,l.jsx)(o.A,(0,r.A)((0,r.A)({variant:"h4",color:"text.primary",sx:(0,r.A)({fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1},n)},d),{},{children:t||(0,l.jsx)(i.A,{variant:"text"})}))}},47298:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(71806),a=n(96446),o=n(84882),i=n(28076),l=n(10039),s=n(73460),d=n(34535),c=n(85721),u=n(8011),h=n(52687),x=n(65043),p=n(65290),m=n(94922),g=n(70579);const A=(0,d.Ay)(r.A,{shouldForwardProp:e=>"tiny"!==e})(e=>{let{theme:t,tiny:n}=e;return{minWidth:n||700,"& th, td":{fontSize:n?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:n?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}});const v=function(e){const{themePreference:t,language:n}=(0,x.useContext)(p.j),{tiny:r,hideAQIDescription:d}=e,v=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(a.A,{overflow:"auto",children:(0,g.jsxs)(A,{size:"small",tiny:r,children:[(0,g.jsx)(o.A,{children:(0,g.jsxs)(i.A,{children:[(0,g.jsx)(l.A,{sx:{pr:0},children:(0,g.jsx)(a.A,{sx:{width:"1em",height:"1em"}})}),(0,g.jsx)(l.A,{sx:{pl:1},children:"Category"}),(0,g.jsx)(l.A,{align:"right",children:"US AQI"}),(0,g.jsxs)(l.A,{align:"right",children:["PM2.5 (\xb5g/m",(0,g.jsx)("sup",{children:"3"}),")"]}),!d&&(0,g.jsx)(l.A,{align:"left",children:"Description"}),!d&&(0,g.jsxs)(l.A,{align:"left",children:[m.sG,"' Suggested Actions"]})]})}),(0,g.jsx)(s.A,{children:h.m7.map((e,r)=>(0,g.jsxs)(i.A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,g.jsx)(l.A,{sx:{pr:0},children:(0,g.jsx)(a.A,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,g.jsx)(l.A,{sx:{pl:1},children:(0,u.sC)(e.category,n)}),(0,g.jsx)(l.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.aqiUS.low,e.aqiUS.high)}),(0,g.jsx)(l.A,{align:"right",sx:{whiteSpace:"nowrap"},children:v(e.rawPM2_5.low,e.rawPM2_5.high)}),!d&&(0,g.jsx)(l.A,{align:"left",children:e.description}),!d&&(0,g.jsx)(l.A,{align:"left",children:(0,c.Ay)((0,u.sC)(e.healthSuggestions.outdoors,n),{replace:u.H$})})]},r))})]})})})}},51210:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(65043),a=n(34535),o=n(13766),i=n(86605),l=n(40710),s=n(96446),d=n(77739),c=n(85865),u=n(40430),h=n(97847),x=n(70579);const p=(0,a.Ay)(o.A)(e=>{let{theme:t,expanded:n}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:n?t.palette.background.default:"transparent",boxShadow:n?t.shadows:"none",transition:"none"}}),m=(0,a.Ay)(i.A)(e=>{let{theme:t,expanded:n}=e;return{marginTop:n?t.spacing(1):0,flexDirection:"row-reverse",paddingLeft:n?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(1),marginBottom:t.spacing(1)}}}),g="Click to expand section",A="Click to collapse section",v=e=>{const{title:t,content:n,icon:a,disabled:o}=e,[i,v]=(0,r.useState)(void 0);return(0,x.jsx)(s.A,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,x.jsxs)(p,{expanded:"panel1"===i,onChange:(y="panel1",(e,n)=>{v(n?y:void 0),h.n(n?h.s.expandSection:h.s.collapseSection,{section:t})}),disabled:o,children:[(0,x.jsx)(m,{expanded:i,expandIcon:(0,x.jsx)(u.A,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,x.jsx)(d.A,{title:i?A:g,enterDelay:0,leaveDelay:200,children:(0,x.jsxs)(c.A,{component:"a",variant:"body1",children:[t,(0,x.jsx)(s.A,{component:"span",sx:{ml:.25},children:a})]})})}),(0,x.jsx)(l.A,{sx:{pt:0},children:n})]})});var y}},70605:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ea});var r=n(65043),a=n(22555),o=n(34535),i=n(96446),l=n(91449),s=n(30344),d=n(88911),c=n(24056),u=n(72437),h=n(85865),x=n(21337),p=n(49881),m=n(96157),g=n(33656),A=n(68903),v=n(26240),y=n(53193),f=n(69285),b=n(51962),j=n(36694),w=n(4598),S=n(43845),C=n(47260),D=n(70579);const T="Show All Sensors";function k(e){const{items:t,selectorID:n,allowMultiple:o,seriesLabel:i,onSeriesSelection:c,displayChip:u=!0}=e,x=(0,v.A)(),p=(0,s.A)(e=>e.breakpoints.up("lg")),m={PaperProps:{style:{maxHeight:274.4,overflow:"visible !important",background:x.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[g,k]=(0,r.useState)(t),[I,E]=(0,r.useState)(o);(0,r.useEffect)(()=>{k(e=>{const n=new Map(e.map(e=>[e.label,e.selected]));return t.map(e=>"boolean"===typeof e.selected?(0,a.A)({},e):(0,a.A)((0,a.A)({},e),{},{selected:n.has(e.label)?n.get(e.label):!!e.selected}))})},[t]),(0,r.useEffect)(()=>{E(g.every(e=>e.selected))},[g]);const M=e=>{const{target:{value:t}}=e;if(t.includes(T)){const e=g.map((e,t)=>(0,a.A)((0,a.A)({},e),{},{selected:0==t||!I}));c({newDataColumns:e}),E(!I)}else{const e=g.filter(e=>t.includes(e.label)),n=g.map(t=>(0,a.A)((0,a.A)({},t),{},{selected:e.some(e=>e.label===t.label)}));c({newDataColumns:n}),E(!1)}},P=e=>{const t=g.map(t=>t.label===e.label?(0,a.A)((0,a.A)({},t),{},{selected:!t.selected}):t);c({newDataColumns:t})};return(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[p?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Show/Hide"}):null,(0,D.jsxs)(d.A,{spacing:1,direction:"row",alignItems:"center",children:[(0,D.jsx)(y.A,{sx:{width:"100%",minWidth:"10rem","& .MuiInputBase-root":{borderRadius:"".concat(x.shape.borderRadius,"px")}},size:"small",children:(0,D.jsxs)(f.A,{labelId:"".concat(n,"-label"),id:n,multiple:o,value:g.filter(e=>e.selected).map(e=>e.label),onChange:M,MenuProps:m,renderValue:e=>(e=>(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",spacing:.5,children:[(0,D.jsx)(C.A,{fontSize:"1.5rem",sx:{color:x.palette.text.secondary}}),(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:o?"".concat(e.length,"/").concat(g.length," ").concat(i||""," shown"):e})]}))(e),sx:{fontSize:"0.75em","& .MuiSelect-select":{py:"6.5px"},"& .MuiSvgIcon-root":{color:"text.secondary"}},children:[g.map(e=>(0,D.jsxs)(l.A,{disabled:!(1!==g.filter(e=>e.selected).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[o?(0,D.jsx)(b.A,{checked:e.selected,onClick:()=>P(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,D.jsx)(j.A,{checked:e.selected,onChange:()=>M(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,D.jsx)(h.A,{variant:"caption",children:e.label})]},e.label)),o?(0,D.jsx)(l.A,{value:T,sx:{borderTop:"solid 0.5px",borderColor:x.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:x.spacing(-1),background:x.palette.customAlternateBackground,"&:hover":{background:x.palette.customAlternateBackground}},children:(0,D.jsxs)(d.A,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,D.jsx)(h.A,{fontWeight:500,variant:"caption",sx:{pl:1},children:T}),(0,D.jsx)(w.A,{checked:I,onClick:()=>P(T),sx:{transform:"scale(0.8)"}})]})},T):null]})}),u&&o&&(0,D.jsx)(A.Ay,{container:!0,spacing:1,sx:{[x.breakpoints.down("sm")]:{display:"none"}},children:g.filter(e=>e.selected).map(e=>(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(S.A,(0,a.A)({label:(0,D.jsx)(h.A,{variant:"caption",children:e.label}),size:"small"},1!==g.filter(e=>e.selected).length&&{onDelete:()=>P(e)}))},e.label))})]})]})}const I={stem:{length:0},textStyle:{opacity:0},boxStyle:null},E=e=>{let{isPortrait:t,isSmaller:n}=e;return n?t?6:8:t?8:10},M=e=>{var t;const{chartControl:n,mainChartData:r,mainChartOptions:o,subchartIndex:i,theme:l,isPortrait:s}=e;let d=(0,a.A)((0,a.A)({},null===(t=n.options)||void 0===t?void 0:t.ui),{},{snapToData:!0});return"ChartRangeFilter"===n.controlType&&(d=(0,a.A)((0,a.A)({},d),{},{chartType:r.chartType,chartView:{columns:r.columns||r.subcharts&&r.subcharts[i].columns||null},chartOptions:(0,a.A)((0,a.A)({},o),{},{hAxis:(0,a.A)((0,a.A)({},o.hAxis),{},{textPosition:"out",textStyle:{color:l.palette.chart.axisText,fontSize:E({isPortrait:s,isSmaller:!0})},title:null}),vAxis:(0,a.A)((0,a.A)({},o.vAxis),{},{title:null}),annotations:I,legend:null,pointSize:0})})),d};var P=n(5362),O=n(66477),R=n(17535),L=n(8011);const z=e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:r}=e;if(!(0,L.OP)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map((t,n)=>({color:t,offset:n/(e-1)}))}{let e=t;n&&(e=t.filter(e=>e.offset>=n)),r&&(e=t.filter(e=>e.offset<=r));const a=e.map(e=>e.offset),o=(e=>{let{offsets:t,minOffset:n,maxOffset:r}=e;return t.map(e=>(e-n)/(r-n))})({offsets:a,minOffset:n||Math.min(...a),maxOffset:r||Math.max(...a)});return e.map((e,t)=>({color:e.color,offset:o[t]}))}};function W(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}function _(e,t,n){if(e.every((e,n)=>e===t[n]))return e;let r=e.slice();for(let a=0;a<3;a++)r[a]=Math.round(r[a]+n*(t[a]-e[a]));return r}const F=e=>{let{colors:t,numSteps:n=100}=e;const r=z({colors:t});r.forEach(e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)});let a=[];const o=Array.from({length:n},(e,t)=>t/(n-1));for(let i=0;i<o.length;i++){const e=o[i];let t,n,l,s;for(let a=0;a<r.length-1;a++)if(e>=r[a].offset&&e<=r[a+1].offset){t=r[a].color,n=r[a+1].color,l=r[a].offset,s=r[a+1].offset;break}const d=_(t,n,(e-l)/(s-l));a.push(W(...d))}return a},B=e=>{let{gradientDirection:t,colors:n,optionalMinValue:r,optionalMaxValue:a}=e;const o=z({colors:n,optionalMinValue:r,optionalMaxValue:a});return"linear-gradient(".concat(t,", ").concat(o.map(e=>"".concat(e.color," ").concat(100*e.offset,"%")).join(", "),")")},H=e=>{let{id:t,colors:n}=e;return(0,D.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,D.jsx)("defs",{children:(0,D.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:n.map((e,t)=>(0,D.jsx)("stop",{offset:e.offset,stopColor:e.color},t))})})})},V=e=>{let{title:t,valueRange:n,colorAxis:r,isPortrait:o}=e;const l=(0,v.A)();if(null===(null===n||void 0===n?void 0:n.min)||null===(null===n||void 0===n?void 0:n.max))return null;const{colors:s,minValue:d,maxValue:c}=r;let u=d,x=c;void 0===d&&(u=n.min),void 0===c&&(x=n.max),n.min<u&&(u=n.min),n.max>x&&(x=n.max);const p=e=>"".concat((e-u)/(x-u)*100,"%"),m={position:"absolute",fontSize:"0.75rem",color:l.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},g={bottom:"-1.25rem",transform:o?"translateX(-100%)":"translateX(-50%)"},A={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},y={top:"-0.5rem",borderTop:"0.25rem solid ".concat(l.palette.text.secondary)},f={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(l.palette.text.secondary)};return(0,D.jsxs)(i.A,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:o?"0":"50px"},children:[(0,D.jsx)(h.A,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,D.jsxs)(i.A,{sx:{background:B({gradientDirection:"to right",colors:s,optionalMaxValue:x}),color:l.palette.text.secondary,border:"1px solid ".concat(l.palette.text.secondary),width:o?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,D.jsxs)("span",{style:(0,a.A)((0,a.A)((0,a.A)({},m),{top:"-1.5rem",transform:"translateX(-50%)"}),{},{left:p(n.min)}),children:["min: ",Math.round(n.min)]}),(0,D.jsxs)("span",{style:(0,a.A)((0,a.A)((0,a.A)({},m),g),{},{left:p(n.max)}),children:["max: ",Math.round(n.max)]}),(0,D.jsx)("div",{style:(0,a.A)((0,a.A)((0,a.A)({},A),y),{},{left:p(n.min)})}),(0,D.jsx)("div",{style:(0,a.A)((0,a.A)((0,a.A)({},A),f),{},{left:p(n.max)})})]})]})};var N=n(85721);const U=e=>{let{day:t,color:n,tooltipText:a,dateRange:o,inFirstTwoRowsOfChart:l}=e;const s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(s.current&&l(t,o)){const e=s.current.parentElement;e&&(e.style.top="11vh")}},[s,l]),(0,D.jsxs)(i.A,{ref:s,className:"nivo-tooltip",children:[(0,D.jsx)(S.A,{sx:{backgroundColor:n,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,N.Ay)(a,{replace:L.H$})]})},Y=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},q=e=>{var t,n,a,o,l;const{dataArray:s,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[x,p]=(0,r.useState)({min:null,max:null}),[m,g]=(0,r.useState)({min:null,max:null}),[A,y]=(0,r.useState)(400);(0,r.useEffect)(()=>{if(!(0,L.OP)(s))return;const e=(e=>({min:e.reduce((e,t)=>t<e?t:e),max:e.reduce((e,t)=>t>e?t:e)}))(s.map(e=>e.day));p(e);const t=s.map(e=>e.value);g((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const n=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,r=Y(c),a=n*(7*Math.min(h[0]/60,20)+40)+r.top+r.bottom;y(a)},[s,h]);const f=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,b=Y(c),j=(0,v.A)(),w=(e,t)=>{const n=new Date(e),r=n.getDay(),a=0===r||1===r,o=new Date(t.min).getFullYear(),i=n.getFullYear()===o;return a&&i},S=F({colors:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.colors,numSteps:null===u||void 0===u||null===(a=u.colorAxis)||void 0===a?void 0:a.gradientSteps});return(0,D.jsxs)(P.A,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[f?(0,D.jsx)(V,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,D.jsx)(i.A,{sx:{height:"".concat(A,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,D.jsx)(i.A,{sx:{height:"".concat(A,"px"),position:"absolute",width:"100%"},children:(0,D.jsx)(R.Zm,{data:s,from:x.min,to:x.max,emptyColor:"transparent",align:"top",theme:{text:{fill:j.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(o=u.colorAxis)||void 0===o?void 0:o.minValue,maxValue:null===u||void 0===u||null===(l=u.colorAxis)||void 0===l?void 0:l.maxValue,margin:b,yearSpacing:40,monthBorderColor:j.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:n,color:r}=e;const a=s.find(e=>e.day===t),o=a?(i=a.tooltip,(new DOMParser).parseFromString(i,"text/html").body.innerHTML):"";var i;return(0,D.jsx)(U,{day:t,color:r,tooltipText:o,dateRange:x,inFirstTwoRowsOfChart:w})}})})})]})};var K=n(86347),Q=(n(87151),n(74864),n(63336)),G=n(76859),X=n(93043),$=n(56036),J=n(36870),Z=n(4006),ee=n(73561);const te=new Date,ne={label:"Yesterday",range:()=>({startDate:(0,G.o)((0,X.L)(te,-48)),endDate:te})},re={label:"Last 14d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-14)),endDate:(0,J.D)(te)})},ae={label:"Last 30d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-30)),endDate:(0,J.D)(te)})},oe={label:"Last 365d",range:()=>({startDate:(0,G.o)((0,$.f)(te,-365)),endDate:(0,J.D)(te)})},ie=e=>{let{minDateOfDataset:t}=e;const n=(0,Z.GP)(t,"MMM yyyy");return{label:"All Time (".concat(n," - Now)"),range:()=>({startDate:t,endDate:(0,J.D)(te)})}},le=e=>{let{minDateOfDataset:t,aggregationType:n}=e;switch(n){case ee.A.minute:return[ne];case ee.A.day:return[ae,oe];case ee.A.month:case ee.A.year:return[ie({minDateOfDataset:t})];default:return[re,ae]}},se={[ee.A.minute]:{maxDays:2,label:"Live"},[ee.A.hour]:{maxDays:30,label:"Hourly"},[ee.A.day]:{maxDays:365,label:"Daily"},[ee.A.month]:{maxDays:1/0,label:"Monthly"},[ee.A.year]:{maxDays:1/0,label:"Yearly"}},de=(0,o.Ay)(Q.A,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})(e=>{let{theme:t,showPickerPanel:n,smallScreen:r}=e;return{zIndex:!0===n&&1,position:"relative",padding:n?t.spacing(1):0,margin:n&&!r?t.spacing(-1):0,maxWidth:"100%",background:n?t.palette.customAlternateBackground:"transparent",boxShadow:!1===n&&"none","& .rdrDateInput::before":{display:"none !important"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none",padding:0},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateDisplayItemActive":{border:!1===n&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"10rem",display:"flex",justifyContent:"center",alignItems:"center",height:"2rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:n?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:n?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===n&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===n&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===n&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===n&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===n&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"9rem",height:"2rem",borderRadius:t.shape.borderRadius,border:n?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:n?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"10.5rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}});var ce,ue=n(57528),he=n(1119),xe=n(84511),pe=n(83290),me=n(87332),ge=n(52687);const Ae=(0,pe.i7)(ce||(ce=(0,ue.A)(["\n  0% { opacity: 1; }\n  50% { opacity: 0.6; }\n  100% { opacity: 1; }\n"])));function ve(e){let{aggregationType:t,setAggregationType:n}=e;const r=(0,v.A)(),o=(0,s.A)(e=>e.breakpoints.up("lg")),i=(0,s.A)(e=>e.breakpoints.down("sm"));return(0,D.jsx)(he.A,{fullWidth:i,color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},"aria-label":"aggregation type toggle for graph average",size:"small",sx:{height:"100%",[r.breakpoints.down("sm")]:{width:"100%"}},orientation:o?"vertical":"horizontal",children:Object.values(ee.A).map(e=>{var t;return(0,D.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5,color:"text.secondary"},value:e,"aria-label":e,children:[e===ee.A.minute&&(0,D.jsx)(me.A,{sx:(0,a.A)((0,a.A)({},o?{position:"absolute",left:"50%",transform:"translateX(calc(-50% - 2.5rem))"}:{mr:.3}),{},{color:ge.m7[3].color.Light,fontSize:"0.75rem",animation:"".concat(Ae," 2s infinite ease-in-out")})}),(null===(t=se[e])||void 0===t?void 0:t.label)||""]},e)})})}var ye=n(46560),fe=n(31021),be=n(46987),je=n(79958),we=n(92535),Se=n(9209),Ce=n(38119);const De=e=>{const{allChartsConfigs:t,currentSchoolID:n}=(0,r.useContext)(m.C),a=t[e];return(0,we.I)({queryKey:[a,n],queryFn:async()=>{const e=(0,Ce.e)({paths:[a.endpoint,n],queryParams:a.queryParams});return(0,Se.i)({url:e})},enabled:!!n&&!(null===a||void 0===a||!a.endpoint),staleTime:6e5,placeholderData:e=>e})},Te=e=>{const{minDateOfDataset:t,chartIndex:n}=e,[o,l]=(0,r.useState)(!0),{enqueueSnackbar:c}=(0,be.dh)(),{isFetching:u}=De(n),{allChartsConfigs:x,updateIndividualChartConfigQueryParams:p}=(0,r.useContext)(m.C),g=(x[n]||{}).queryParams||{},[y,f]=(0,r.useState)(g.aggregationType||ee.A.hour),[b,j]=(0,r.useState)(()=>{const{startDate:e,endDate:t}=g;return e&&t?{startDate:new Date(e),endDate:new Date(t),key:"selection"}:{startDate:null,endDate:null,key:"selection"}}),w=new Date,S=(0,v.A)(),C=(0,s.A)(S.breakpoints.down("sm")),T=(0,s.A)(e=>e.breakpoints.up("lg"));(0,r.useEffect)(()=>{const e=(0,a.A)((0,a.A)({},le({aggregationType:y||ee.A.hour,minDateOfDataset:t})[0].range()),{},{key:"selection"});j(e)},[y]),(0,r.useEffect)(()=>{var e;if(o)return void l(!1);const{startDate:t,endDate:r}=b||{};if(!t||!r)return;if((0,ye.r)(t,r))return;const a=null===(e=se[y])||void 0===e?void 0:e.maxDays;if((0,fe.c)(r,t)>a)return void c("".concat(se[y].label," data is limited to maximum ").concat(a," day").concat(a>1?"s":""),je.n.error);const i=(e=>{let{startDateObject:t,endDateObject:n}=e;return{startDate:(0,Z.GP)(t,"yyyy-MM-dd"),endDate:(0,Z.GP)(n,"yyyy-MM-dd")}})({startDateObject:t,endDateObject:r});p(n,{aggregationType:y,startDate:i.startDate,endDate:i.endDate})},[b]);const[k,I]=(0,r.useState)(!1),E=(0,r.useRef)(null);return(0,r.useEffect)(()=>{const e=e=>{E.current&&!E.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[E]),(0,r.useEffect)(()=>{!u&&k&&I(!1)},[u]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A.Ay,{item:!0,alignItems:k?"start":"stretch",xs:!0,sm:"auto",lg:!0,children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,width:"100%",children:[T?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Averaging Period"}):null,(0,D.jsx)(ve,{aggregationType:y,setAggregationType:f,smallScreen:C})]})}),(0,D.jsx)(A.Ay,{item:!0,sx:{height:"2rem",flex:1,[S.breakpoints.up("lg")]:{minHeight:"4rem"}},children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:.5,children:[T?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Date Range"}):null,(0,D.jsx)(de,{showPickerPanel:k,smallScreen:C,ref:E,elevation:8,onClick:()=>I(!0),sx:{position:"relative"},children:(0,D.jsx)(i.A,{sx:{transition:"filter 0.2s ease-in-out"},children:(0,D.jsx)(K.Ur,{ranges:[b],onChange:e=>{e&&j(e.selection)},staticRanges:(0,K.hs)(le({minDateOfDataset:t,aggregationType:y})),inputRanges:[],rangeColors:[S.palette.primary.main,S.palette.secondary.main,S.palette.text.secondary],minDate:t,maxDate:w,months:1,showMonthAndYearPickers:!0,direction:"vertical",fixedHeight:!0,preventSnapRefocus:!0,startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0,weekStartsOn:1})})})]})})]})};var ke=n(79190),Ie=n(11906);const Ee=(0,r.createContext)();function Me(e){let{children:t}=e;const[n,a]=(0,r.useState)(),[o,i]=(0,r.useState)(),l=(0,r.useMemo)(()=>({hAxis:n,setHAxis:a,vAxis:o,setVAxis:i}),[n,o]);return(0,D.jsx)(Ee.Provider,{value:l,children:t})}const Pe="150px",Oe=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Pe,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"}},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}}),Re=(0,o.Ay)(y.A)(e=>{let{theme:t}=e;return{textTransform:"capitalize",minWidth:Pe,[t.breakpoints.between("sm","lg")]:{"& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderLeft:"none"}}}}),Le=e=>{const{currentSchoolID:t,allChartsConfigs:n,setIndividualChartConfig:o}=(0,r.useContext)(m.C),{chartID:i,allowedAxes:c,selectedAxes:u,dataType:x}=e,{hAxis:p,vAxis:g,setHAxis:v,setVAxis:y}=(0,r.useContext)(Ee),{isFetching:b}=De(i),[j,w]=(0,r.useState)(!0);(0,r.useEffect)(()=>{const{hAxis:e,vAxis:t}=u||{};e&&t?(v(e),y(t)):w(!0)},[u,v,y]),(0,r.useEffect)(()=>{const{hAxis:e,vAxis:t}=u;e&&t&&w(p===e&&g===t)},[p,g,u]);const S=e=>!e.allowedDataTypes.includes(x),C=(0,s.A)(e=>e.breakpoints.up("lg"));return(0,D.jsxs)(d.A,{direction:"column",alignItems:"stretch",gap:1.5,width:"100%",children:[C?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Sensor Pair Selection"}):null,(0,D.jsxs)(A.Ay,{container:!0,item:!0,rowGap:1.5,columnGap:1,alignItems:"center",children:[(0,D.jsxs)(A.Ay,{container:!0,item:!0,rowGap:1.5,children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsxs)(Oe,{fullWidth:!0,size:"small",children:[(0,D.jsx)(ke.A,{id:"x-axis-select-label",children:"Horizontal Axis"}),(0,D.jsx)(f.A,{labelId:"x-axis-select-label",value:p||(null===u||void 0===u?void 0:u.hAxis)||null,label:"Horizontal Axis",onChange:e=>{v(e.target.value)},autoWidth:!0,children:null===c||void 0===c?void 0:c.map(e=>(0,D.jsxs)(l.A,{value:e.sensor,disabled:e.sensor===g||S(e),sx:{textTransform:"capitalize"},children:[e.sensor,S(e)&&" (No Data)"]},e.sensor))})]})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsxs)(Re,{fullWidth:!0,size:"small",children:[(0,D.jsx)(ke.A,{id:"y-axis-select-label",children:"Vertical Axis"}),(0,D.jsx)(f.A,{labelId:"y-axis-select-label",value:g||(null===u||void 0===u?void 0:u.vAxis)||null,label:"Vertical Axis",onChange:e=>{y(e.target.value)},autoWidth:!0,children:null===c||void 0===c?void 0:c.map(e=>(0,D.jsxs)(l.A,{value:e.sensor,disabled:e.sensor===p||S(e),sx:{textTransform:"capitalize"},children:[e.sensor,S(e)&&" (No Data)"]},e.sensor))})]})})]}),(0,D.jsx)(A.Ay,{item:!0,xs:12,sm:"auto",lg:!0,children:(0,D.jsx)(Ie.A,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{g&&p&&o(i,(0,a.A)((0,a.A)({},n[i]),{},{queryParams:{dataType:x,sensorX:p,sensorY:g}}))},disabled:j||b,children:"APPLY"})})]})]})};var ze=n(14194);const We=e=>{let{customMessage:t,dataType:n,height:r,selectableAxes:a}=e,o="This sensor ",l=" data. Choose a different sensor or data type.";return a&&(o="This pair of sensors ",l=" correlation data. Choose another pair or a different data type."),(0,D.jsx)(i.A,{height:r,children:(0,D.jsx)(ze.A,{severity:"error",sx:{my:2},children:t||(0,D.jsxs)(D.Fragment,{children:[o,"does not have\xa0",(0,D.jsx)(i.A,{component:"span",textTransform:"capitalize",children:n}),l]})})})},_e=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",Fe=Array.from({length:24},(e,t)=>{const n=60*t;return{label:_e(n),value:n}}),Be={allday:{id:"allday",label:"All Day",start:Fe[0].value,end:Fe[Fe.length-1].value,timeRangeLabel:"0-23h"},schoolHour:{id:"schoolHour",label:"School Hour",start:Fe[7].value,end:Fe[17].value,timeRangeLabel:"7-17h"},custom:{id:"custom",label:"Custom"}};var He=n(51715),Ve=n(80045);const Ne=["icon","label","value","options","handleChange","disabled","isExtraSmall"],Ue=e=>{const{icon:t,label:n,value:r,options:o,handleChange:s,disabled:c,isExtraSmall:u}=e,h=(0,Ve.A)(e,Ne),x=(0,v.A)();return(0,D.jsxs)(d.A,(0,a.A)((0,a.A)({direction:"row",gap:t?1:0,alignItems:"center"},h),{},{children:[(0,D.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:c?x.palette.text.secondary:x.palette.primary.main,verticalAlign:"middle"}},children:t}),(0,D.jsxs)(y.A,{fullWidth:!0,size:"small",disabled:c,sx:{minWidth:"5rem",marginLeft:"0 !important","& .MuiInputBase-root":{[x.breakpoints.down("sm")]:{fontSize:null!==u&&void 0!==u?u:"0.75rem"}}},children:[(0,D.jsx)(ke.A,{id:"".concat(n,"-picker-label"),children:n}),(0,D.jsx)(f.A,{labelId:"".concat(n,"-picker-label"),id:"".concat(n,"-picker"),value:r,label:n,onChange:s,children:(0,L.OP)(o)&&o.map(e=>(0,D.jsx)(l.A,{value:e.value,is:!0,children:e.label},e.value))})]})]}))},Ye=e=>{const{timeRange:t,defaultTimeRange:n,disabled:a,handleChange:o,isResponsive:l=!1,hasTitle:c=!1}=e,u=(0,v.A)(),x=(0,s.A)(e=>e.breakpoints.up("lg")),[p,m]=(0,r.useState)(!1),[g,A]=(0,L.OP)(t)?t:n,[y,f]=(0,r.useState)(()=>{const e=Object.values(Be).find(e=>e.start===g&&e.end===A);return e?e.id:Be.custom.id});(0,r.useEffect)(()=>{const e=Object.values(Be).find(e=>e.start===g&&e.end===A);f(e?e.id:Be.custom.id)},[g,A]);const b=(0,r.useCallback)((e,t)=>{if(!t)return;f(t);const n=Be[t];null!=n.start&&null!=n.end&&o([n.start,n.end]),m(t===Be.custom.id)},[o]),j=(0,s.A)(e=>e.breakpoints.down("sm"));return(0,D.jsxs)(d.A,{direction:c?"column":"row",alignItems:"start",gap:.5,width:"100%",children:[c?x&&l?(0,D.jsx)(h.A,{color:"text.secondary",sx:{textTransform:"uppercase"},children:"Time Range"}):null:(0,D.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:a?u.palette.text.secondary:u.palette.primary.main,verticalAlign:"-webkit-baseline-middle"}},children:(0,D.jsx)(He.A,{sx:{mt:.75}})}),(0,D.jsxs)(d.A,{direction:"column",width:"100%",gap:1.5,children:[(0,D.jsx)(he.A,{fullWidth:j,color:a?"standard":"primary",value:y,exclusive:!0,onChange:b,size:"small",disabled:a,orientation:l&&x?"vertical":"horizontal",children:Object.values(Be).map((e,t,n)=>(0,D.jsxs)(xe.A,{value:e.id,"aria-label":e.label,sx:{color:"text.secondary",textTransform:"none",px:t===n.length-1?2:1,py:.5,flex:t===n.length-1?1:void 0},size:"small",children:[e.label,e.timeRangeLabel&&(0,D.jsxs)(D.Fragment,{children:["\xa0(",e.timeRangeLabel,")"]})]},e.id))}),p?(0,D.jsxs)(d.A,{direction:"row",flex:1,gap:1,children:[(0,D.jsx)(Ue,{label:"From",value:g,options:Fe,disabled:a||"custom"!==y,handleChange:e=>{e.target.value>A?o([e.target.value,null]):o([e.target.value,A])},flex:1}),(0,D.jsx)(Ue,{label:"To",value:A,options:Fe.filter(e=>e.value>g),disabled:a||"custom"!==y,handleChange:e=>o([g,e.target.value]),flex:1})]}):null]})]})},qe=e=>{const{defaultTimeRange:t,isResponsive:n,hasTitle:a,chartIndex:o}=e,{allChartsConfigs:i,updateIndividualChartConfigQueryParams:l}=(0,r.useContext)(m.C),s=(i[o]||{}).queryParams||{},{startTime:d,endTime:c}=s,[u,h]=(0,r.useState)([null!==d&&void 0!==d?d:t.startTime,null!==c&&void 0!==c?c:t.endTime]);return(0,D.jsx)(Ye,{timeRange:u,defaultTimeRange:t,handleChange:e=>{h(e);const[t,n]=e||[];null===t||null===n||t>n||(t===Be.allday.start&&n===Be.allday.end?l(o,{startTime:null,endTime:null}):l(o,{startTime:t,endTime:n}))},isResponsive:n,hasTitle:a})};function Ke(e){var t;const{chartData:n,subchartIndex:o,windowSize:l,isPortrait:s,height:c,maxHeight:u,selectedDataType:h,allowedDataTypes:x}=e,m=(0,r.useContext)(g.d),[y,f]=(0,r.useState)(),[b,j]=(0,r.useState)(),[w,S]=(0,r.useState)(),[C,T]=(0,r.useState)(),I=(0,v.A)(),[R,W]=(0,r.useState)(!0),[_,F]=(0,r.useState)(!0),[B,V]=(0,r.useState)(!1),[N,U]=(0,r.useState)(),[Y,K]=(0,r.useState)(),[Q,G]=(0,r.useState)(),[X,$]=(0,r.useState)(Math.random().toString(36).substr(2,9)),J=(0,r.useMemo)(()=>(e=>{var t,n,r,o,i,l,s,d,c,u,h,x,p,m,g,A,v,y,f,b,j,w,S,C,D,T,k,I,M,P,O,R,L,z,W,_,F,B,H,V,N,U,Y,q,K,Q,G,X,$,J;const{chartData:Z,subchartIndex:ee,isPortrait:te,theme:ne}=e,re={italic:!1,bold:!0,color:ne.palette.chart.axisTitle,fontSize:E({isPortrait:te})},ae={color:ne.palette.chart.axisText,fontSize:E({isPortrait:te})};let oe=null!==(t=Z.subcharts)&&void 0!==t&&null!==(n=t[ee])&&void 0!==n&&n.options?(0,a.A)({},Z.subcharts[ee].options):{};if(oe=(0,a.A)((0,a.A)((0,a.A)({},oe),Z.options),{},{theme:"material",curveType:oe.curveType||(null===(r=Z.options)||void 0===r?void 0:r.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(o=Z.options)||void 0===o||null===(i=o.backgroundColor)||void 0===i?void 0:i.fill)||"transparent"},chartArea:(0,a.A)((0,a.A)({},null===(l=Z.options)||void 0===l?void 0:l.chartArea),{},{width:te?(null===(s=Z.options)||void 0===s||null===(d=s.chartArea)||void 0===d||null===(c=d.width)||void 0===c?void 0:c.portrait)||"80%":(null===(u=Z.options)||void 0===u||null===(h=u.chartArea)||void 0===h||null===(x=h.width)||void 0===x?void 0:x.landscape)||"80%",height:te?(null===(p=Z.options)||void 0===p||null===(m=p.chartArea)||void 0===m||null===(g=m.height)||void 0===g?void 0:g.portrait)||"60%":(null===(A=Z.options)||void 0===A||null===(v=A.chartArea)||void 0===v||null===(y=v.height)||void 0===y?void 0:y.landscape)||"80%",top:!te&&20}),width:te?(null===(f=Z.options)||void 0===f||null===(b=f.width)||void 0===b?void 0:b.portrait)||"100%":(null===(j=Z.options)||void 0===j||null===(w=j.width)||void 0===w?void 0:w.landscape)||"100%",height:Z.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:te?"center":"start",position:null!==(S=null===(C=Z.options)||void 0===C||null===(D=C.legend)||void 0===D?void 0:D.position)&&void 0!==S?S:te?"top":"right",scrollArrows:{activeColor:ne.palette.chart.axisTitle,inactiveColor:ne.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ne.palette.chart.axisTitle,bold:!0}}}),oe.vAxis=(0,a.A)((0,a.A)({},oe.vAxis),{},{format:null!==(T=null===(k=oe.vAxis)||void 0===k?void 0:k.format)&&void 0!==T?T:"decimal",title:null!==(I=null===(M=oe.vAxis)||void 0===M?void 0:M.title)&&void 0!==I?I:"",viewWindow:{min:null!==(P=null===(O=oe.vAxis)||void 0===O||null===(R=O.viewWindow)||void 0===R?void 0:R.min)&&void 0!==P?P:0,max:null!==(L=null===(z=oe.vAxis)||void 0===z||null===(W=z.viewWindow)||void 0===W?void 0:W.max)&&void 0!==L?L:null,max:null!==(_=null===(F=oe.vAxis)||void 0===F||null===(B=F.viewWindow)||void 0===B?void 0:B.max)&&void 0!==_?_:null}}),oe.hAxis=(0,a.A)((0,a.A)({},oe.hAxis),{},{title:null!==(H=null===(V=oe.hAxis)||void 0===V?void 0:V.title)&&void 0!==H?H:""}),te&&(oe.hAxis=(0,a.A)((0,a.A)({},oe.hAxis),{},{slantedText:!0,slantedTextAngle:30})),"string"!==typeof oe.colors&&oe.colors||(oe.colors=ne.palette.chart.optionsColors[oe.colors||"multiColor"]),oe.series&&Object.values(oe.series).forEach(e=>{const t=e;"default"===t.color&&(t.color=ne.palette.primary.main)}),oe.trendlines&&oe.trendlines.forEach(e=>{e.color=ne.palette.primary.main}),oe.colorAxis)switch(oe.colorAxis.colors){case"matchingColor":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.chart.optionsColors.multiColor[oe.colorAxis.colorIndex]];break;case"default":oe.colorAxis.colors=[ne.palette.chart.colorAxisFirstColor,ne.palette.NYUpurple];break;default:try{oe.colorAxis=ne.palette.chart.colorAxes[oe.colorAxis.colors]}catch(ie){oe.colorAxis=[]}}return oe.vAxis=(0,a.A)((0,a.A)({},oe.vAxis),{},{titleTextStyle:re,textStyle:ae,gridlines:(0,a.A)((0,a.A)({},null===(N=oe.vAxis)||void 0===N?void 0:N.gridlines),{},{color:(null===(U=oe.vAxis)||void 0===U||null===(Y=U.gridlines)||void 0===Y?void 0:Y.color)||ne.palette.chart.gridlines}),minorGridlines:{count:0}}),oe.hAxis=(0,a.A)((0,a.A)({},oe.hAxis),{},{titleTextStyle:re,textStyle:ae,gridlines:(0,a.A)((0,a.A)({},null===(q=oe.hAxis)||void 0===q?void 0:q.gridlines),{},{color:(null===(K=oe.hAxis)||void 0===K||null===(Q=K.gridlines)||void 0===Q?void 0:Q.color)||ne.palette.chart.gridlines}),minorGridlines:(0,a.A)((0,a.A)({},null===(G=oe.hAxis)||void 0===G?void 0:G.minorGridlines),{},{color:(null===(X=oe.hAxis)||void 0===X||null===($=X.gridlines)||void 0===$?void 0:$.color)||ne.palette.chart.gridlines})}),oe.legend=(0,a.A)((0,a.A)({},oe.legend),{},{textStyle:ae}),oe.annotations=(0,a.A)((0,a.A)({},oe.annotations),{},{highContrast:!0,textStyle:{color:ne.palette.primary.contrastText,fontSize:E({isPortrait:te,isSmaller:!0}),opacity:.8},stem:(0,a.A)((0,a.A)({},null===(J=oe.annotations)||void 0===J?void 0:J.stem),{},{color:ne.palette.chart.axisTitle,thickness:2}),boxStyle:{rx:ne.shape.borderRadius,ry:ne.shape.borderRadius,fill:ne.palette.chart.annotationBoxFill,fillOpacity:.5}}),te&&"LineChart"===(null===Z||void 0===Z?void 0:Z.chartType)&&(oe.pointSize=0),oe})((0,a.A)((0,a.A)({},e),{},{theme:I})),[e,I,n.chartType]),[Z,ee]=(0,r.useState)(null);if("Calendar"===n.chartType)return(0,r.useEffect)(()=>{const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null;(0,L.OP)(e)?(ee(e),F(!0)):F(!1)},[n]),Z?_?(0,D.jsx)(q,{dataArray:Z,valueRangeBoxTitle:(0,p.MU)({dataTypeKey:h,dataTypes:x,showUnit:!0}),isPortrait:s,options:J,windowSize:l}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(We,{dataType:(0,p.MU)({dataTypeKey:h,dataTypes:x})}),(0,D.jsx)(q,{dataArray:[],valueRangeBoxTitle:(0,p.MU)({dataTypeKey:h,dataTypes:x,showUnit:!0}),isPortrait:s,options:J,windowSize:l})]}):(0,D.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,D.jsx)(O.A,{})});let te,ne=!1,re=n.control||(null===(t=n.subcharts)||void 0===t?void 0:t[o].control);re&&(ne=!0,te=(0,a.A)((0,a.A)({},re.options),{},{ui:M({chartControl:re,mainChartData:n,mainChartOptions:J,subchartIndex:o,theme:I,isPortrait:s})}),"ChartRangeFilter"===re.controlType&&(0,r.useEffect)(()=>{const e=(e=>{let{controlWrapper:t,chartID:n}=e;const r=e=>{var t=e.changedTouches[0],n="";switch(e.type){case"touchstart":n="mousedown";break;case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}var r=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(r),e.preventDefault()};let a=!0;if(!t)return;const o=document.querySelector("#other-chart-control-".concat(n));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.addEventListener(e,r,{capture:!0})}),()=>{a=!1,["touchstart","touchmove","touchend","touchcancel"].forEach(e=>{o.removeEventListener(e,r,{capture:!0})})}):void 0})({controlWrapper:w,chartID:X});return e},[w]));const ae=J.seriesSelector||!1,oe=J.dateRangePicker||null,ie=J.timeRangeSelector||null,le=J.formatters||null;let se=n.selectableAxes||null;se&&(0,L.OP)(se.allowedAxes)&&se.allowedAxes.length<=2&&(se=null);const de=ae||oe||se||ie;(0,r.useEffect)(()=>{ae?he({newDataColumns:Y}):(null===b||void 0===b||b.setOptions((0,a.A)({},J)),null===b||void 0===b||b.draw(),ne&&(null===w||void 0===w||w.setOptions(te),null===w||void 0===w||w.draw()))},[I,s,l]),(0,r.useEffect)(()=>{Y&&ae&&"setViewColumn"==ae.method&&(ce({dataColumns:Y}),he({newDataColumns:Y}))},[I]);const ce=e=>{let{dataColumns:t}=e;t.forEach(e=>{var t;e.color=J.colors[e.seriesIndex%J.colors.length],e.serieAttribute=null===(t=J.series)||void 0===t?void 0:t[e.seriesIndex]})},ue=e=>{let t,n,{dataTable:r,allInitialColumns:a}=e;return a.forEach((e,a)=>{if(0===a)return;const o=r.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(n=n?Math.max(n,o.max):o.max)}),{min:t,max:n}},he=(0,r.useCallback)(e=>{let{newDataColumns:t,_allInitialColumns:n=N,_chartWrapper:r=b,_controlWrapper:o=w}=e;if(n){if(K(t),"toggleVisibility"===ae.method||null===ae.method){const e={};if(t.forEach(t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})}),null===r||void 0===r||r.setOptions((0,a.A)((0,a.A)({},J),{},{series:(0,a.A)((0,a.A)({},J.series),e)})),ne){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,a.A)((0,a.A)({},t),{},{ui:(0,a.A)((0,a.A)({},t.ui),{},{chartOptions:(0,a.A)((0,a.A)({},t.ui.chartOptions),{},{series:(0,a.A)((0,a.A)({},J.series),e)})})}))}}else if("setViewColumn"===ae.method){let e=[];e.push(0),t.forEach(t=>{if(t.selected&&(e.push(t),(0,L.OP)(n)))for(let r=t.indexIn_+1;r<n.length&&"data"!==n[r].role;r++)e.push(n[r])}),null===r||void 0===r||r.setView({columns:e});const i=(0,a.A)({},J);i.colors=t.filter(e=>e.selected).map(e=>e.color);const l={};let s=0;if(t.forEach(e=>{e.selected&&(null!=e.serieAttribute&&(l[s]=e.serieAttribute),s++)}),i.series=l,null===r||void 0===r||r.setOptions(i),ne){const t=null===o||void 0===o?void 0:o.getOptions();null===o||void 0===o||o.setOptions((0,a.A)((0,a.A)({},t),{},{ui:(0,a.A)((0,a.A)({},t.ui),{},{chartOptions:(0,a.A)((0,a.A)({},t.ui.chartOptions),{},{colors:i.colors,series:i.series}),chartView:{columns:e}})}))}}null===r||void 0===r||r.draw(),ne&&(null===o||void 0===o||o.draw())}},[N,J,ae,b,w,Q,ne]);(0,r.useEffect)(()=>{if(m&&n){if(JSON.stringify(n)===JSON.stringify(C))return;T(n);const e=n.dataArray||n.subcharts&&n.subcharts[o].dataArray||null,t=(0,L.OP)(e);if(F(t),!0===t){V(!0);const t=m.visualization.arrayToDataTable(e);if(le&&"object"===typeof le&&le.hasOwnProperty("numberFormatter")){const e=new m.visualization.NumberFormat(le.numberFormatter.numberFormat);le.numberFormatter.columns.forEach(n=>e.format(t,n))}f(t)}}},[m,n]),(0,r.useEffect)(()=>{if(!0===B){const e=(e=>{if(!e)return;const t=[];for(const n of e)if("number"===typeof n)t.push(n);else if("object"===typeof n)if(n.calc&&"stringify"!==n.calc){const e=new Function("dataTable","rowNum",n.calc);t.push((0,a.A)((0,a.A)({},n),{},{calc:e}))}else t.push(n);return t})(n.columns||n.subcharts&&n.subcharts[o].columns||null),t=new m.visualization.ChartWrapper({chartType:n.chartType,dataTable:ne?void 0:y,options:J,view:{columns:e},containerId:X});let r;if(j(t),ne){const e=new m.visualization.Dashboard(document.getElementById("dashboard-".concat(X)));m.visualization.events.addListener(e,"ready",fe),r=new m.visualization.ControlWrapper({controlType:re.controlType,options:te,containerId:"".concat("CategoryFilter"===re.controlType?"CategoryFilter":"other-chart-control","-").concat(X)}),S(r),e.bind(r,t),e.draw(y)}else m.visualization.events.addListener(t,"ready",fe),t.draw();if(ae){const{initAllInitialColumns:e,initDataColumns:n}=(e=>{let{chartWrapper:t,dataTable:n,seriesSelector:r}=e;const a=(null===Y||void 0===Y?void 0:Y.map(e=>({label:e.label,selected:e.selected})))||[];let o=t.getView();if(null==o.columns){const e=new m.visualization.DataView(n);t.setView({columns:e.columns}),o=t.getView()}let i=!0,l=0;const s=o.columns.map((e,t)=>{if("number"===typeof e&&(e={role:i?"domain":"data",sourceColumn:e}),e.label=n.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,i=!1,"data"===e.role){const n=a.find(t=>t.label===e.label);n?e.selected=n.selected:r.defaultSeriesToDisplayInitially?e.selected=r.defaultSeriesToDisplayInitially.includes(t):r.allowMultiple?e.selected=!0:e.selected=0===l,e.seriesIndex=l,l++}return e});U(s);const d=ue({dataTable:n,allInitialColumns:s});G(d);const c=s.filter(e=>{var t,n;return"data"===e.role&&!1!==(null===(t=J.series)||void 0===t||null===(n=t[e.seriesIndex])||void 0===n?void 0:n.visibleInLegend)});return"setViewColumn"===r.method&&ce({dataColumns:c}),K(c),{initAllInitialColumns:s,initDataColumns:c}})({chartWrapper:t,dataTable:y,seriesSelector:ae});he({_allInitialColumns:e,newDataColumns:n,_chartWrapper:t,_controlWrapper:r})}V(!1)}},[B]);const xe=J.gradientBackgroundColor;let pe,me;var ge,Ae,ve,ye;xe&&(pe="".concat(X,"-backgroundGradient"),me=(e=>{let{colors:t,optionalMinValue:n,optionalMaxValue:r}=e;return z({colors:t,optionalMinValue:n,optionalMaxValue:r}).map(e=>({color:e.color,offset:100*e.offset+"%"}))})({colors:I.palette.chart.colorAxes[xe].colors,optionalMinValue:null===(ge=J.vAxis)||void 0===ge||null===(Ae=ge.viewWindow)||void 0===Ae?void 0:Ae.min,optionalMaxValue:null===(ve=J.vAxis)||void 0===ve||null===(ye=ve.viewWindow)||void 0===ye?void 0:ye.max}));const fe=()=>{R&&W(!1)};return _?(0,D.jsxs)(P.A,{isPortrait:s,gradientBackgroundId:pe,className:n.chartType,position:"relative",height:"100%",minHeight:"Calendar"===n.chartType&&"200px",children:[R&&(0,D.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,D.jsx)(O.A,{})}),(0,D.jsxs)(A.Ay,{id:"dashboard-".concat(X),container:!0,alignItems:"start",children:[de&&(0,D.jsxs)(A.Ay,{lg:2,container:!0,item:!0,sx:{mt:1,ml:2,gap:2,[I.breakpoints.down("lg")]:{gap:1,ml:0}},children:[!1===R&&(0,D.jsxs)(D.Fragment,{children:[ae&&(0,D.jsx)(A.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(k,{items:Y,allowMultiple:ae.allowMultiple,seriesLabel:ae.seriesLabel,selectorID:"".concat(n.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),oe&&(0,D.jsx)(Te,{minDateOfDataset:new Date(oe.minDate),chartIndex:n.id}),se&&(0,D.jsx)(Le,{chartID:n.id,allowedAxes:se.allowedAxes,selectedAxes:se.selectedAxes,dataType:h}),ie&&(0,D.jsx)(A.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(qe,{defaultTimeRange:[Be.allday.start,Be.allday.end],handleChange:()=>null,isResponsive:!0,hasTitle:!0,chartIndex:n.id})})]}),(0,D.jsx)(A.Ay,{item:!0,xs:"auto",lg:12,sx:{[I.breakpoints.down("sm")]:{width:"100%"}},children:(0,D.jsx)(i.A,{id:"CategoryFilter-".concat(X),sx:{display:ne&&"CategoryFilter"===re.controlType?"block":"none"}})})]}),(0,D.jsx)(A.Ay,{item:!0,xs:!0,children:(0,D.jsxs)(d.A,{children:[(0,D.jsx)(i.A,{id:X,sx:{height:c,maxHeight:u}}),(0,D.jsx)(i.A,{id:"other-chart-control-".concat(X),sx:{display:ne&&"CategoryFilter"!==re.controlType?"block":"none",height:"calc(".concat(c," / 8)"),filter:"saturate(0.3)",opacity:.7}})]})})]}),xe?(0,D.jsx)(H,{id:pe,colors:me}):null]}):(0,D.jsx)(We,{dataType:(0,p.MU)({dataTypeKey:h,dataTypes:x}),selectableAxes:se,height:ae||ne?1.2*parseFloat(c)+"vw":c})}var Qe=n(20036);const Ge=function(e){let{text:t,wordLimit:n=40,reference:a}=e;const[o,l]=(0,r.useState)(!1),d=(0,v.A)(),c=(0,s.A)(d.breakpoints.down("sm")),u=(0,r.useRef)(null),x=t.split(" ");if(!c||x.length/n<=1.4)return(0,D.jsxs)(i.A,{children:[(0,D.jsx)(h.A,{children:(0,N.Ay)(t,{replace:L.H$})}),a&&(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,N.Ay)(a,{replace:L.H$})})]});let p=x.slice(0,n).join(" ");const m=p.lastIndexOf(".");return-1!==m&&(p=p.slice(0,m+1)),(0,D.jsx)(Qe.x,{onClickAway:e=>{(e=>{let{target:t}=e;const n=u.current.closest(".MuiContainer-root"),r=new Set(["rect","path","svg","circle"]);for(;null!=t;){var a;if(r.has(null===(a=t)||void 0===a?void 0:a.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||l(!1)},children:(0,D.jsx)(i.A,{ref:u,onClick:()=>l(!o),style:{cursor:"pointer"},children:o?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(h.A,{children:(0,N.Ay)(t,{replace:L.H$})}),a&&(0,D.jsx)(h.A,{variant:"caption",color:"text.secondary",children:(0,N.Ay)(a,{replace:L.H$})})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(h.A,{display:"inline",children:[(0,N.Ay)(p,{replace:L.H$}),"..."]}),(0,D.jsx)(h.A,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var Xe=n(40430);const $e=e=>{let{selectedDataType:t,dataTypes:n,chartID:a}=e;const{updateIndividualChartConfigQueryParams:o}=(0,r.useContext)(m.C),[i,s]=(0,r.useState)(null);if(!(0,L.OP)(n))return null;if(n.length<=1)return(0,D.jsx)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:n[0].name_title});const d=Boolean(i),c=()=>{s(null)};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Ie.A,{id:"data-type-drop-down-menu-button","aria-controls":d?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{s(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,D.jsx)(h.A,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,p.MU)({dataTypeKey:t,dataTypes:n,showUnit:!0})}),(0,D.jsx)(Xe.A,{})]}),(0,D.jsx)(u.A,{id:"data-type-drop-down-menu",anchorEl:i,open:d,onClose:c,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:n.map((e,t)=>(0,D.jsx)(l.A,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{o(a,{dataType:e}),c()})(e.key),children:e.name_title},t))})]})};var Je=n(14912);const Ze=(0,o.Ay)(Je.A,{shouldForwardProp:e=>"smallFontSize"!==e})(e=>{let{theme:t,smallFontSize:n="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:n,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}}),et=(0,o.Ay)(i.A)(e=>{let{theme:t}=e;return(0,a.A)((0,a.A)({},"dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}}),{},{"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}})}),tt=(0,o.Ay)(l.A)(e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}});const nt=function(e){let{chartID:t}=e;const{data:n,isLoading:a,isFetching:o,error:l}=De(t),{currentSchoolID:g}=(0,r.useContext)(m.C),A=(0,s.A)(e=>e.breakpoints.down("sm")),[v,y]=(0,r.useState)(window.matchMedia("(orientation: portrait)").matches),[f,b]=(0,r.useState)([window.innerWidth,window.innerHeight]),[j,w]=(0,r.useState)(0),[S,T]=(0,r.useState)(0),[k,I]=(0,r.useState)(-1),[E,M]=(0,r.useState)(),[P,R]=(0,r.useState)(null),[z,W]=(0,r.useState)([]),[_,F]=(0,r.useState)(null);let B,H;if((0,r.useEffect)(()=>{if(!n)return;((e,t,n)=>{if(null===e||void 0===e||!e.allowedDataTypes)return;t(e.allowedDataTypes.map(e=>{const{name_title:t,name_short:n,unit:r}=p.Uy[e];return{key:e,name_title:t,name_short:n,unit:r}})),n(e.selectedDataType)})(n,W,F);const e=((e,t,n)=>{let r=null;const a=()=>{clearTimeout(r),r=setTimeout(()=>{t(window.matchMedia("(orientation: portrait)").matches),e([window.innerWidth,window.innerHeight])},n)};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}})(b,y,100);return e},[n]),(0,r.useEffect)(()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout(()=>{y(window.matchMedia("(orientation: portrait)").matches),b([window.innerWidth,window.innerHeight])},100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[n]),(0,r.useEffect)(()=>{T(j),w(0)},[g]),"Calendar"!==(null===n||void 0===n?void 0:n.chartType)&&(B=v?"80vw":"35vw",H=v?"800px":"450px"),n)return a?(0,D.jsx)(O.A,{optionalText:"Loading chart ".concat(t+1,"...")}):l?(0,D.jsx)(We,{customMessage:"Error loading chart ".concat(t+1,", please try later")}):(0,D.jsxs)(i.A,{position:"relative",children:[(0,D.jsxs)(i.A,{children:[(0,D.jsxs)(h.A,{display:"inline",variant:"h6",color:"text.primary",children:[t+1,". ",n.title,"\xa0"]}),(0,D.jsx)(i.A,{display:"inline",children:(0,D.jsx)($e,{selectedDataType:_,dataTypes:z,chartID:t})})]}),(0,D.jsxs)(et,{height:"100%",sx:{filter:o?"blur(1px)":"none",transition:"filter 0.2s",pointerEvents:o?"none":"auto"},children:[(0,L.OP)(n.subcharts)?(()=>{const e=n.subcharts.length>4,t=e?n.subcharts.slice(0,3):n.subcharts,r=e?n.subcharts.slice(3):null,a=e=>-1===j?S===e:j===e;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Ze,{value:j,onChange:(t,n)=>{T(j),w(n),e&&n<3&&n!==k&&(M(),I(-1))},variant:A?"fullWidth":"standard",children:[t.map((e,t)=>(0,D.jsx)(c.A,{value:t,label:n.subcharts[t].subchartTitle,sx:{textDecoration:!(0,L.OP)(n.subcharts[t].dataArray)&&"line-through"}},t)),e&&(0,D.jsx)(c.A,{value:k,label:(0,D.jsxs)(d.A,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,D.jsxs)(i.A,{flex:1,children:["Other sensors",E&&" (".concat(E,")"),"\xa0"]}),(0,D.jsx)(x.A,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>R(e.currentTarget)})]}),e&&(0,D.jsx)(u.A,{id:"submenu",anchorEl:P,open:Boolean(P),onClose:()=>{-1===j&&(T(j),w(S)),R(null)},children:r.map((e,t)=>(0,D.jsx)(tt,{selected:t===j-3,onClick:()=>(e=>{T(j),w(3+e),I(3+e),M(r[e].subchartTitleShort),R(null)})(t),sx:{textDecoration:!(0,L.OP)(n.subcharts[t+3].dataArray)&&"line-through"},children:(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",gap:1,children:[(0,D.jsx)(i.A,{children:r[t].subchartTitle}),t===j-3&&(0,D.jsx)(C.A,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t))}),(0,D.jsx)(i.A,{position:"relative",sx:{overflowX:v&&"auto",WebkitOverflowScrolling:v&&"touch",overflowY:"hidden"},children:n.subcharts.map((e,t)=>(0,D.jsx)(i.A,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:a(t)?"1":"0",pointerEvents:a(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,D.jsx)(Ke,{selectedDataType:_,allowedDataTypes:z,chartData:n,subchartIndex:t,isPortrait:v,windowSize:f,height:n.height?n.height:B,maxHeight:["Calendar"].includes(n.chartType)?"":H,currentSubchart:j})},t))})]})})():(0,L.OP)(n.dataArray)?(0,D.jsx)(Ke,{selectedDataType:_,allowedDataTypes:z,chartData:n,isPortrait:v,windowSize:f,height:n.height?n.height:B}):(0,D.jsx)(We,{customMessage:"Not enough historical data to display this chart"}),(0,D.jsx)(i.A,{sx:{my:3},children:(0,D.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,D.jsx)(Ge,{text:(()=>{var e;let t=n.subtitle||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=n.subcharts[j].subchartSubtitle),t})(),reference:(()=>{var e;let t=n.reference||"";return n.subcharts&&null!==(e=n.subcharts[j])&&void 0!==e&&e.reference&&(t+="<br/>",t+=n.subcharts[j].reference),t})()})})})]}),o&&(0,D.jsx)(i.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255,255,255,0.3)",zIndex:10},children:(0,D.jsx)(O.A,{})})]})};var rt=n(35197),at=n(19252),ot=n(39336),it=n(11530),lt=n(8738),st=n(24010),dt=n(95953),ct=n(56258),ut=n(4710),ht=n(38198),xt=n(97847),pt=n(47298);function mt(e){const[t,n]=(0,r.useState)(null),o=e=>{n(e.currentTarget),xt.n(xt.s.airQualityIndexLegendQuickGlance)},i=()=>{n(null)},l=Boolean(t);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(ht.An,(0,a.A)((0,a.A)({},e),{},{distanceFromBottomOfWindow:"5.5rem",children:(0,D.jsx)(st.A,{sx:{mt:1},"aria-owns":l?xt.s.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:o,onMouseLeave:i,onClick:e=>lt.Fr&&(l?i():o(e)),"aria-label":xt.s.airQualityIndexLegendQuickGlance,color:"primary",children:(0,D.jsxs)(d.A,{direction:"column",alignItems:"center",children:[(0,D.jsx)(ut.A,{fontSize:"1rem"}),(0,D.jsx)(h.A,{variant:"body2",fontWeight:"500",children:"AQI"})]})})})),(0,D.jsx)(dt.A,{id:xt.s.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:l,anchorEl:t,placement:"top-end",onClose:i,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,D.jsx)(ct.A,(0,a.A)((0,a.A)({},t),{},{timeout:350,children:(0,D.jsxs)(Q.A,{elevation:8,sx:{py:.5,mb:1},children:[(0,D.jsx)(h.A,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,D.jsx)(pt.A,{tiny:!0,hideAQIDescription:!0})]})}))}})]})}var gt=n(74033),At=n(8051),vt=n(89521),yt=n(65290),ft=n(73605),bt=n(94922),jt=n(83250),wt=n(73216),St=n(4967);const Ct=()=>{const{currentSchoolID:e}=(0,r.useContext)(m.C),{data:t}=(0,St.A)(),[n,a]=(0,r.useState)(null),o=(0,wt.Zp)();if(!t)return null;const i=t.screens;if(!(0,L.OP)(i))return null;const s=()=>{var t;const n=i&&(null===(t=i[0])||void 0===t?void 0:t.screen_name);o("screen"===n?"/screen/".concat(e):"/screen/".concat(e,"/").concat(n))};if(i.length<=1)return(0,D.jsxs)(Ie.A,{variant:"contained",size:"small",onClick:s,children:[(0,D.jsx)(jt.A,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const d=Boolean(n);return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(Ie.A,{id:"basic-button","aria-controls":d?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,onClick:e=>{a(e.currentTarget)},variant:"contained",size:"small",children:[(0,D.jsx)(jt.A,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,D.jsx)(u.A,{id:"tv-screen-list-menu",anchorEl:n,open:d,onClose:()=>{a(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:i.map((t,n)=>(0,D.jsx)(l.A,{onClick:()=>{return n=t.screen_name,void o("/screen/".concat(e,"/").concat(n));var n},sx:{fontSize:"0.8rem"},children:t.location_long},n))})]})};var Dt=n(71806),Tt=n(84882),kt=n(28076),It=n(10039),Et=n(73460),Mt=n(88446),Pt=n(41132),Ot=n(6519),Rt=n(77739),Lt=n(17392),zt=n(90035),Wt=n(29347),_t=n(26600),Ft=n(35316),Bt=n(55896);const Ht=e=>{const{buttonIcon:t,buttonIconAria:n,buttonLabel:a,buttonVariant:o="contained",trackingEvent:i,dialogTitle:l,dialogOpenHandler:d=null,dialogCloseHandler:c=null,displaySchoolID:u=!0,maxWidth:h="lg",children:x,disabled:p}=e;let g;g=!(!t||a);const{currentSchoolID:A}=(0,r.useContext)(m.C),y=(0,s.A)(e=>e.breakpoints.down("sm")),[f,b]=(0,r.useState)(!1),j=()=>{d?d(()=>{b(!0),i&&xt.n(i)}):(b(!0),i&&xt.n(i))},w=()=>{b(!1),c&&c()},C=(0,v.A)();return(0,D.jsxs)(D.Fragment,{children:[g?(0,D.jsx)(Rt.A,{title:n,children:(0,D.jsx)(Lt.A,{onClick:j,"aria-label":n,size:"small",sx:{"&:hover,:focus":{color:C.palette.primary.main}},disabled:p,children:t})}):(0,D.jsxs)(Ie.A,{onClick:j,variant:o,disabled:p,size:"small",children:[t,"\xa0",a]}),(0,D.jsxs)(zt.A,{open:f,onClose:w,maxWidth:h,fullWidth:!0,fullScreen:y,keepMounted:!0,children:[(0,D.jsx)(Wt.A,{sx:{justifyContent:"start"},children:(0,D.jsxs)(Ie.A,{onClick:w,children:[(0,D.jsx)(Bt.A,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,D.jsxs)(_t.A,{children:[!0===u?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(S.A,{label:A?"School: ".concat(A.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,D.jsx)("br",{})]}):null,l]}),(0,D.jsx)(Ft.A,{children:x})]})]})};var Vt=n(93332);const Nt=e=>{const{authenticationState:t,user:n}=(0,r.useContext)(Vt.R),a=t.authenticated&&t.checkedAuthentication,{currentSchoolID:o}=(0,r.useContext)(m.C),{enqueueSnackbar:i}=(0,be.dh)(),l=(0,r.useCallback)(t=>a?null!==n&&void 0!==n&&n.allowedSchools.some(e=>e.school_id===o)?(null===t||void 0===t||t(),!0):(i("Your account does not have access to ".concat(o.toUpperCase()," Alerts"),je.n.error),!1):(null===e||void 0===e||e(),!1),[a,e,o,n,i]);return{loggedIn:a,handleRestrictedAccess:l}};var Ut=n(41e3),Yt=n(22126);const qt=e=>{let{sensor:t,aggregationType:n,isSample:a,enabled:o=!0}=e;const{currentSchoolID:i}=(0,r.useContext)(m.C);return(0,we.I)({queryKey:[Yt.tK.raw,i,t,n,a],queryFn:async()=>{const e=(0,Ce.e)({paths:[Yt.tK.raw,i,t],queryParams:{aggregationType:n,isSample:a}});return(0,Se.i)({url:e,extension:Yt.Fc.csv})},enabled:!!i&&!!t&&!!o,staleTime:3e5,retry:!1})};function Kt(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Nt(t),{data:a}=(0,Ut.A)(),[o,i]=(0,r.useState)({}),[l,d]=(0,r.useState)();(0,r.useEffect)(()=>{if(!a)return;const e=a.filter(e=>e&&e.sensor).reduce((e,t)=>(e[t.sensor.location_short]={location_short:t.sensor.location_short,location_long:t.sensor.location_long},e),{});i(e),Object.keys(e).length>0&&!l&&d({sensor:Object.keys(e)[0],aggregationType:ee.A.hour})},[a,l]);const c=(0,v.A)(),u=(0,s.A)(c.breakpoints.down("sm"));return(0,D.jsxs)(Ht,{buttonIcon:(0,D.jsx)(Ot.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:xt.s.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),n(e)},children:[(0,D.jsxs)(A.Ay,{container:!0,justifyContent:"center",alignItems:"start",spacing:u?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,D.jsx)(A.Ay,{item:!0,sm:12,md:6,children:(0,D.jsxs)(Dt.A,{size:"small",sx:{tableLayout:"fixed"},children:[(0,D.jsx)(Tt.A,{children:(0,D.jsxs)(kt.A,{children:[(0,D.jsx)(It.A,{sx:{pl:1},children:"Sensor Location"}),(0,D.jsx)(It.A,{sx:{width:u?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,D.jsx)(Et.A,{children:o&&Object.keys(o).map(e=>(0,D.jsx)(Qt,{sensor:e,sensorsList:o,previewingDataset:l,setPreviewingDataset:d,isPreviewing:e===(null===l||void 0===l?void 0:l.sensor),setSensorsList:i},e))})]})}),(0,D.jsx)(A.Ay,{item:!0,sm:12,md:6,maxWidth:u?"100%":"unset",sx:{mt:1},children:(0,D.jsx)(Gt,{sensorsList:o,setSensorsList:i,previewingDataset:l})})]}),(0,D.jsxs)(h.A,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["Raw datasets are provided by ",bt.sG," from sensors operated by ",bt.sG,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,D.jsx)(Mt.A,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Qt=e=>{const{sensorsList:t,sensor:n,previewingDataset:a,setPreviewingDataset:o,isPreviewing:i}=e,[s,c]=(0,r.useState)(ee.A.hour),{currentSchoolID:u}=(0,r.useContext)(m.C),h=(0,v.A)();(0,r.useEffect)(()=>{s!==ee.A.hour&&c(ee.A.hour)},[u]);return(0,D.jsx)(D.Fragment,{children:(0,D.jsxs)(kt.A,{children:[(0,D.jsx)(It.A,{sx:{pl:1,cursor:"pointer",background:i&&h.palette.background.NYUpurpleLight},onClick:()=>{(null===a||void 0===a?void 0:a.sensor)!==n&&o({aggregationType:s,sensor:n})},children:t[n].location_long}),(0,D.jsx)(It.A,{sx:{position:"relative",background:i&&h.palette.background.NYUpurpleLight},children:(0,D.jsx)(y.A,{size:"small",children:(0,D.jsx)(f.A,{value:s,onChange:e=>{const t=e.target.value;c(t),o({aggregationType:t,sensor:n})},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(ee.A).map((e,t)=>(0,D.jsx)(l.A,{value:e,children:(0,D.jsx)(d.A,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t))})})})]},n)})},Gt=e=>{let{previewingDataset:t}=e;const{data:n,isLoading:a}=qt({sensor:null===t||void 0===t?void 0:t.sensor,aggregationType:null===t||void 0===t?void 0:t.aggregationType,isSample:!0}),{refetch:o}=qt({sensor:null===t||void 0===t?void 0:t.sensor,aggregationType:null===t||void 0===t?void 0:t.aggregationType,isSample:!1,enabled:!1}),l=(0,v.A)(),c=(0,s.A)(l.breakpoints.down("sm")),[u,x]=(0,r.useState)("Not previewing any dataset"),[p,m]=(0,r.useState)("No dataset"),[g,A]=(0,r.useState)(""),[y,f]=(0,r.useState)("");(0,r.useEffect)(()=>{if(!n||!t)return;if(x("Previewing: ".concat(t.sensor," (").concat(t.aggregationType,")")),!n||a)return f(null),A(null),void m("Loading...");const e=n.split("\n"),r=e[0].split(","),o=e.slice(1);let i;if(f(["",...o.map(e=>e.split(",")[0])].join("\n")),A([r.slice(1).join(","),...o.map(e=>e.split(",").slice(1).join(","))].join("\n")),o.length>0){const e=o[o.length-1].split(",");if(e.length>=2){i=e[1].split("T")[0]}}const l="".concat(t.sensor,"-").concat(t.aggregationType,"-").concat(i,".csv");m(l)},[n]);return(0,D.jsxs)(d.A,{spacing:1,children:[(0,D.jsxs)(i.A,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,D.jsx)(d.A,{direction:"row",children:(0,D.jsx)(h.A,{variant:"body2",gutterBottom:!0,fontWeight:500,children:u})}),(0,D.jsx)(i.A,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:c?"11.8rem":"14rem",width:c?"100%":"unset",marginTop:0},children:(0,D.jsx)(d.A,{direction:"row",sx:{fontSize:"0.75rem"},children:g?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(i.A,{sx:{mr:2,userSelect:"none"},children:y}),(0,D.jsx)(i.A,{children:g})]}):(0,D.jsx)(O.A,{optionalText:"Loading"})})})]}),(0,D.jsx)(i.A,{textAlign:"center",children:(0,D.jsxs)(Ie.A,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:async()=>{try{const{data:e}=await o(),n=new Blob([e],{type:"application/octet-stream"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=p,document.body.appendChild(a),a.click(),URL.revokeObjectURL(r),document.body.removeChild(a),xt.n(xt.s.rawDatasetDownloaded,{dataset_type:null===t||void 0===t?void 0:t.aggregationType,sensor:null===t||void 0===t?void 0:t.sensor})}catch(e){(0,be.M8)("Error fetching the full dataset",je.n.error)}},disabled:a,children:[(0,D.jsx)(Pt.A,{sx:{fontSize:"1.25rem",mr:.5}}),p]})})]})};var Xt=n(23621),$t=n(67784),Jt=n(81637),Zt=n(63248),en=n(47097);const tn=(e,t)=>JSON.stringify(e)===JSON.stringify(t),nn=()=>{const{enqueueSnackbar:e}=(0,be.dh)(),{currentSchoolID:t}=(0,r.useContext)(m.C),n=[Yt.tK.alertsEmails,t],{data:a=[]}=(0,we.I)({queryKey:n,queryFn:async()=>(0,Se.i)({url:(0,Ce.e)({paths:n}),extension:"json",needsAuthorization:!0}),enabled:!!t,staleTime:0}),o=(0,Zt.jE)(),c=(0,en.n)({mutationFn:async e=>(0,Se.i)({url:(0,Ce.e)({paths:n}),restMethod:Yt.Xo.POST,body:e}),onSuccess:n=>{o.setQueryData([Yt.tK.alertsEmails,t],n),e("Email recipients saved successfully.",je.n.success)},onError:()=>{e("There was an error saving email recipients. Please try again.",je.n.error)}}),x=(0,s.A)(e=>e.breakpoints.down("sm")),[p,g]=(0,r.useState)([]),[v,y]=(0,r.useState)(!1),[f,b]=(0,r.useState)(""),[j,w]=(0,r.useState)(null),[C,T]=(0,r.useState)("");(0,r.useEffect)(()=>{g(a)},[a]),(0,r.useEffect)(()=>{y(!tn(p,a))},[p,a]),(0,r.useEffect)(()=>{T(v?"Click to save new changes on server":"No changes detected to save")},[v]);const k=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.trim().toLowerCase();r.startsWith("<")&&r.endsWith(">")&&(r=r.slice(1,-1).trim()),r&&((0,L.DT)(r)?p.includes(r)?e(n?"Some pasted email addresses already existed":"Already existed: ".concat(r),je.n.error):p.length>=150?e("Maximum number of recipients reached",je.n.warning):(g(e=>[...e,r]),b("")):n||e("Invalid email address: ".concat(r),je.n.error))},I=e=>{const t=p.filter((t,n)=>n!==e);g(t)},E=(0,r.useRef)(null),M=(0,r.useRef)(null),P=(0,r.useRef)(""),[O,R]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const t=t=>{if(null===t||void 0===t||!t.key)return;const n=t.key.toLowerCase(),r=t.metaKey||t.ctrlKey,a=document.activeElement===M.current;if(!r||"a"!==n){if(r&&"c"===n&&O)return t.preventDefault(),0===p.length?void e("No emails to copy.",je.n.warning):void navigator.clipboard.writeText(p.join(", ")).then(()=>e("All emails copied to clipboard.",je.n.success)).catch(()=>e("Failed to copy emails.",je.n.error));if(O&&("backspace"===n||"delete"===n)){if(t.preventDefault(),0===p.length)return;return g([]),R(!1),void e("All emails deleted.",je.n.info)}return"escape"===n&&O?(t.preventDefault(),void R(!1)):void 0}a&&""===f.trim()&&(t.preventDefault(),R(!0),E.current&&E.current.focus({preventScroll:!0}))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[f,O,p,e]),(0,r.useEffect)(()=>{const e=e=>{E.current&&(E.current.contains(e.target)||O&&R(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[O]),(0,r.useEffect)(()=>{""!==f&&O&&R(!1)},[f,O]);const z=(e,t)=>{w({index:t,element:e.currentTarget})},W=()=>{w(null)};return(0,r.useEffect)(()=>{const e=e=>{tn(p,a)||(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[p,a]),(0,D.jsxs)(i.A,{children:[(0,D.jsxs)(A.Ay,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,sx:{p:0,mb:x&&1,mr:!x&&2},children:"Email Recipients:"})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,D.jsxs)(A.Ay,{ref:E,id:"emails-container",tabIndex:-1,container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%",outline:"none"},children:[p.map((e,t)=>(0,D.jsx)(A.Ay,{item:!0,sx:{m:.5},children:(0,D.jsx)(S.A,{label:e,onDelete:()=>I(t),onClick:e=>z(e,t),onContextMenu:e=>{e.preventDefault(),z(e,t)},color:O||Boolean(j)&&j.index===t?"primary":"default"})},t)),p.length<150?(0,D.jsx)(A.Ay,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,D.jsx)($t.A,{inputRef:M,fullWidth:!0,variant:"standard",value:f,onChange:e=>{const t=e.target.value,n=e.nativeEvent||{},r=(n.inputType||"").toString(),a=!!n.isComposing||!!e.isComposing;if(b(t),""!==t&&T("Finalize currently edited email by pressing Enter/Return"),a)return void(P.current=t);const o=t.trim(),i=/insertReplacementText|insertFromPaste|insertFromDrop|insertFromAutocomplete/i.test(r),l=""===P.current&&t.length>1&&"insertText"!==r;(0,L.DT)(o)&&(i||l)&&setTimeout(()=>k(t),0),P.current=t},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&k(f)},onPaste:e=>{const t=e.clipboardData.getData("text");e.preventDefault();const n=t.split(/[\s,;\t]+/).map(e=>e.trim()).filter(e=>""!==e);n.forEach(e=>k(e,n.length>1)),b("")},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,D.jsxs)(d.A,{sx:{mt:1},spacing:1,alignItems:x?"stretch":"end",children:[(0,D.jsxs)(d.A,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,D.jsxs)(h.A,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[p.length," / ",150," recipient",p.length>1?"s":null," added"]}),(0,D.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),b(""),g([])},children:"Clear All"})]}),0===a.length?(0,D.jsx)(ze.A,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,D.jsx)(Rt.A,{title:C,enterTouchDelay:0,children:(0,D.jsx)("span",{children:(0,D.jsx)(Ie.A,{onClick:e=>{const t=(0,L.OP)(e)?e:(0,L.OP)(p)?p:[];c.mutate(t)},variant:"contained",sx:{width:x?"100%":"fit-content"},disabled:!v||c.isPending,children:c.isPending?(0,D.jsx)(Jt.A,{disableShrink:!0,color:"inherit",size:"1.5rem"}):"SAVE EMAIL LIST"})})})]}),(0,D.jsxs)(u.A,{anchorEl:null===j||void 0===j?void 0:j.element,open:Boolean(j),onClose:W,children:[(0,D.jsx)(l.A,{onClick:()=>{var e;e=j.index,b(p[e]),I(e),W()},children:"Edit"}),(0,D.jsx)(l.A,{onClick:()=>{(t=>{const n=p[t];n&&navigator.clipboard.writeText(n).then(()=>{e("Copied to clipboard: ".concat(n),je.n.success)}).catch(()=>{e("Failed to copy email to clipboard.",je.n.error)})})(j.index),W()},children:"Copy"})]})]})};var rn=n(86328),an=n(95540),on=n(25776),ln=n(38409),sn=n(55722);const dn={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,D.jsx)(ln.A,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,D.jsx)(sn.A,{})}},cn={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:"\u2265",name:"above"}},un=dn,hn="ADD",xn="EDIT",pn="DELETE",mn="Location",gn="Data Type",An="Days",vn="Created By",yn="id",fn="alert_type",bn="sensor_id",jn="location_short",wn="datatypekey",Sn="threshold_value",Cn="days_of_week",Dn="minutespastmidnight",Tn="time_range",kn="is_enabled",In="excluded_dates",En="owner_role",Mn="self_is_owner",Pn="is_allowed_to_modify",On="message",Rn="max_once_a_day",Ln="parent_alert_id",zn="child_alert",Wn="has_child_alert",_n=function(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un.daily.id;return n===un.threshold.id&&(e=cn.above_threshold.id,t=cn.below_threshold.id),{[yn]:"",[fn]:e||n,[bn]:"",[wn]:"",[Cn]:[0,1,2,3,4],[Tn]:n===un.threshold.id?[Be.schoolHour.start,Be.schoolHour.end]:null,[Sn]:-1,[Dn]:"",[kn]:!0,[In]:[],[On]:"",[Rn]:!0,[Ln]:null,[Wn]:!1,[zn]:n===un.threshold.id?{[fn]:t||n,[Sn]:-1,[On]:""}:null}},Fn=function(){const e=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];return e.forEach(t=>{if(!t)return;if(!!t[Ln]){const n=e.find(e=>e[yn]===t[Ln]);n&&(n[Wn]=!0,n[zn]={[yn]:t[yn],[fn]:t[fn],[Sn]:t[Sn],[On]:t[On]})}else{if(t[fn]===un.daily.id)return;t[Wn]=!1,t[zn]={[fn]:t[fn]===cn.above_threshold.id?cn.below_threshold.id:cn.above_threshold.id,[Sn]:t[Sn],[On]:""}}}),e};var Bn=n(20067),Hn=n.n(Bn),Vn=n(98533);function Nn(e){const{onConfirmedDelete:t}=e,[n,a]=(0,r.useState)(!1),o=(0,v.A)();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Ie.A,{variant:"text",color:"error",onClick:()=>{a(!0)},children:"Delete"}),(0,D.jsxs)(zt.A,{open:n,onClose:()=>{a(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,D.jsx)(_t.A,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,D.jsx)(Ft.A,{children:(0,D.jsx)(Vn.A,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,D.jsxs)(Wt.A,{sx:{justifyContent:"end"},children:[(0,D.jsx)(Ie.A,{onClick:()=>{a(!1)},sx:{color:o.palette.text.secondary},children:"Cancel"}),(0,D.jsx)(Ie.A,{onClick:()=>{t(),a(!1)},children:"Delete"})]})]})]})}const Un={[hn]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[xn]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[pn]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}};var Yn=n(39423),qn=n(20389),Kn=n(69413),Qn=n(74605);const Gn=e=>{const{label:t="Optional Message",value:n,handleChange:r,maxLength:a,showTip:o=!0,disabled:l}=e,s=n?n.length:0;return(0,D.jsxs)(d.A,{direction:"column",children:[(0,D.jsx)($t.A,{label:t,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:a},value:n||"",onChange:e=>{r(e)},disabled:l}),(0,D.jsxs)(d.A,{direction:"row",gap:1,justifyContent:"space-between",sx:{mx:1,my:.5},children:[o?(0,D.jsx)(h.A,{color:"text.secondary",variant:"caption",children:"Optional message that will appear in the alert"}):(0,D.jsx)(i.A,{}),(0,D.jsxs)(h.A,{color:"text.secondary",variant:"caption",textAlign:"right",children:[s,"/",a]})]})]})},Xn=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];var $n=n(60446),Jn=n.n($n),Zn=n(34576),er=n(58390),tr=n(77857),nr=n(64021);const rr=["day","selectedDates"],ar=(0,o.Ay)(tr.a,{shouldForwardProp:e=>"selected"!==e})(e=>{let{theme:t,selected:n}=e;return(0,a.A)({},n&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"})}),or=e=>{const{day:t,selectedDates:n}=e,r=(0,Ve.A)(e,rr),o=n.includes(Jn()(t).format("YYYY-MM-DD"));return(0,D.jsx)(ar,(0,a.A)((0,a.A)({},r),{},{day:t,selected:o}))};function ir(e){const{selectedDates:t,handleChange:n,disabled:r}=e,o=t.map(e=>Jn()(e).format("YYYY-MM-DD")),i=t.length,l=i>0?"Excluded Dates (".concat(i," Days)"):"Excluded Dates";return(0,D.jsxs)(Ht,{dialogTitle:l,buttonLabel:l,buttonVariant:"text",disabled:r,maxWidth:"xs",displaySchoolID:!1,children:[(0,D.jsxs)(h.A,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,D.jsx)("b",{children:"NOT"})," want to receive alerts.",(0,D.jsx)("br",{}),"Useful for holidays or school breaks."]}),(0,D.jsx)(Mt.A,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),n(t)},children:"Clear All"}),(0,D.jsx)(er.$,{dateAdapter:Zn.R,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,D.jsx)(nr.x,{displayWeekNumber:!0,slots:{day:e=>(0,D.jsx)(or,(0,a.A)((0,a.A)({},e),{},{selectedDates:o}))},onChange:(e,t)=>{"finish"===t&&n([Jn()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:Jn()().startOf("month")})})]})}function lr(e){const{daysOfWeek:t,excludedDates:n,handleDaysOfWeekChange:r,handleExcludedDatesChange:a,disabled:o}=e,l=(0,v.A)();return(0,D.jsxs)(A.Ay,{container:!0,rowSpacing:.5,columnSpacing:2,alignItems:"center",justifyContent:"stretch",children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,D.jsxs)(d.A,{direction:"row",gap:1,alignItems:"start",children:[(0,D.jsx)(i.A,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:o?l.palette.text.secondary:l.palette.primary.main,verticalAlign:"middle"}},children:(0,D.jsx)(sn.A,{sx:{mt:.75}})}),(0,D.jsx)(he.A,{value:t||_n()[Cn],onChange:r,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:o,color:o?"standard":"primary",children:Xn.map(e=>(0,D.jsx)(Rt.A,{title:e.label,arrow:!0,children:(0,D.jsx)(xe.A,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value))})]})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,md:6,ml:{xs:3,sm:0},children:(0,D.jsx)(ir,{selectedDates:n,disabled:o,handleChange:a})})]})}var sr=n(74681),dr=n(3147),cr=n(84834);const ur=e=>{const{min:t=0,max:n=100,value:o,defaultValue:i,stepsForThreshold:l=1,marks:s=null,handleChange:d,disabled:c,backgroundCssGradient:u,invertSelection:x=!1,showInput:p=!0,inputUnit:m,valueLabelDisplay:g="on",showTip:y=!0}=e,f=(0,v.A)(),[b,j]=(0,r.useState)(x?o||i:t),[w,S]=(0,r.useState)(x?n:o||i),[C,T]=(0,r.useState)(-1),[k,I]=(0,r.useState)(!1),[E,M]=(0,r.useState)(""),P=(0,r.useCallback)(e=>{if(!s)return-1;const t=s.filter(t=>t.value>=e);if(0===t.length)return-1;const n=t.reduce((t,n)=>n.value-e<t.value-e?n:t),r=s.indexOf(n);return x?r-1:r},[s,x]);(0,r.useEffect)(()=>{const e=x?o:t,r=x?n:o;j(e),S(r),T(P(x?e:r))},[P,x,o,n,t]);const O="repeating-linear-gradient(-45deg, ".concat(sr.A[800],", ").concat(sr.A[800]," 4px, ").concat(dr.A.white," 4px, ").concat(dr.A.white," 8px)"),R={height:"20vh",minHeight:"250px",maxHeight:"500px",cursor:c?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:dr.A.black},['& .MuiSlider-thumb[data-index="'.concat(x?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:f.palette.background.paper,backgroundImage:f.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:c?sr.A[400]:u},"& .MuiSlider-track":(0,a.A)({background:O},x?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}),['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(C,'"]')]:{color:f.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:f.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(A.Ay,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,D.jsx)(A.Ay,{item:!0,xs:"auto",minWidth:"4.5rem",children:p?(0,D.jsx)($t.A,{variant:"standard",type:"number",label:"Threshold",value:x?b:w,onChange:e=>{const r=""===e.target.value?"":Number(e.target.value);r&&""!==r||d(r),""!==r&&r>=t&&r<=n?(j(x?r:t),S(x?n:r),d(r),T(P(r)),I(!1),M("")):(I(!0),M("Threshold must be between ".concat(t," and ").concat(n)))},error:k,helperText:E,size:"small",fullWidth:!0,disabled:c,inputProps:{step:l,min:t,max:n,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),m?(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(h.A,{variant:"body2",children:m})}):null]}),(0,D.jsx)(A.Ay,{item:!0,xs:12,sx:{mt:2,ml:7.5},children:(0,D.jsx)(cr.Ay,{getAriaLabel:()=>"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[b,w],step:null===s?l:null,marks:s,disabled:c,min:t,max:n,onChange:(e,r)=>{const a=r[x?0:1];j(x?a:t),S(x?n:a),d(a),T(P(a))},valueLabelDisplay:g,orientation:"vertical",sx:R})}),(0,D.jsx)(A.Ay,{item:!0,sx:{mt:1,ml:1,visibility:!0===y?"visible":"hidden"},children:(0,D.jsx)(h.A,{color:"text.secondary",variant:"caption",display:"block",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})},hr=(0,r.createContext)();function xr(e){let{children:t}=e;const{data:n}=(0,St.A)(),[o,i]=(0,r.useState)(_n()),[l,s]=(0,r.useState)(o),[d,c]=(0,r.useState)([]),u=(0,r.useCallback)(e=>{if(!n)return[];const{sensors:t}=n;if(!(0,L.OP)(t))return[];const r=t.find(t=>t.sensor_id===e),a=null===r||void 0===r?void 0:r.allowedDataTypes;return a?a.map(e=>({value:e,label:p.Uy[e].name_title})):[]},[n]);(0,r.useEffect)(()=>{s((0,a.A)({},o))},[o]),(0,r.useEffect)(()=>{const e=l[bn];e&&""!==e&&c(u(e))},[l,u]);const h=(0,r.useMemo)(()=>({selectedAlert:o,setSelectedAlert:i,editingAlert:l,setEditingAlert:s,allowedDataTypesForSensor:d,setAllowedDataTypesForSensor:c}),[o,l,d]);return(0,D.jsx)(hr.Provider,{value:h,children:t})}const pr=e=>{const{value:t,invertSelection:n,handleValueChange:a,placeholderValueBeforeDataTypeSelection:o=.5,disabledSlider:i,showTip:l=!0}=e,{editingAlert:s}=(0,r.useContext)(hr),{language:d}=(0,r.useContext)(yt.j),c=(0,v.A)();let u=null;const h=s[wn];if(h&&p.Uy[h]){const e=p.Uy[h],r=c.palette.chart.colorAxes[e.color_axis],{colors:o,minValue:x,maxValue:m,defaultValueForAlert:g,stepsForThreshold:A}=r,v=B({gradientDirection:"to top",colors:o});let y,f;switch(h){case p.vV.voc:f=ge.ZS;break;case p.vV.aqi:case p.vV.pm2_5:case p.vV.pm10_raw:case p.vV.co2:f=ge.m7;break;case p.vV.heat_index_C:f=ge.RZ;break;default:f=null}f&&(y=f.filter((e,t)=>0!==t).map(t=>({value:t[e.threshold_mapping_name].low,label:(0,L.sC)(t.category,d)})));const b=Object.keys(p.Uy).filter(e=>e===s[wn]).map(e=>p.Uy[e].unit)[0];u=(0,D.jsx)(ur,{min:x,max:m,marks:y,defaultValue:g,value:t,stepsForThreshold:A,disabled:i,backgroundCssGradient:v,invertSelection:n,handleChange:a,inputUnit:b,showTip:l})}else u=(0,D.jsx)(ur,{min:0,max:1,value:o,disabled:!0,showInput:!1,invertSelection:n,valueLabelDisplay:"off",showTip:l});return u};var mr=n(81673);const gr=e=>{let{value:t,handleChange:n,disabled:r}=e;return(0,D.jsxs)(y.A,{component:"fieldset",variant:"standard",sx:{mt:{md:-1}},disabled:r,children:[(0,D.jsx)(Kn.A,{children:(0,D.jsx)(Qn.A,{control:(0,D.jsx)(b.A,{checked:t,onChange:n,size:"small"}),label:(0,D.jsx)(h.A,{color:"text.secondary",fontWeight:500,children:"Max Once a Day"}),color:"text.secondary"})}),(0,D.jsx)(mr.A,{sx:{mt:-.5},children:!0===t?(0,D.jsxs)(D.Fragment,{children:["Send alert ",(0,D.jsx)("strong",{children:"at most once a day"})," when the threshold is breached"]}):(0,D.jsxs)(D.Fragment,{children:["Send alert ",(0,D.jsx)("strong",{children:"every hour"})," for as long as the threshold is breached"]})})]})},Ar=["currentAlertType","handleChange","disabled"],vr=["currentAlertType"],yr=e=>{let{currentAlertType:t,handleChange:n,disabled:r}=e,o=(0,Ve.A)(e,Ar);return(0,D.jsx)(he.A,(0,a.A)((0,a.A)({color:r?"standard":"primary",disabled:r,defaultValue:cn.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:n},o),{},{children:Object.keys(cn).map(e=>{const t=cn[e];return(0,D.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)})}))},fr=e=>{let{currentAlertType:t}=e,n=(0,Ve.A)(e,vr);return(0,D.jsx)(he.A,(0,a.A)((0,a.A)({color:"standard",disabled:!0,defaultValue:cn.below_threshold.id,value:t,exclusive:!0,"aria-label":"non-interactive button displaying threshold type",size:"small"},n),{},{children:Object.keys(cn).map(e=>{const n=cn[e];return n.id!==t?null:(0,D.jsxs)(xe.A,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:n.id,"aria-label":n.id,children:[n.sign,"\xa0",n.name]},n.id)})}))},br=e=>{const t=e[kn]?"enabled":"disabled",n=e[yn]?"is":"will be";return"This alert ".concat(n," ").concat(t)},jr=e=>{var t,n,o,i;let{alertTypeKey:l,crudType:s}=e;const{data:c}=(0,St.A)(),{editingAlert:u,allowedDataTypesForSensor:x,setEditingAlert:m}=(0,r.useContext)(hr),g=(0,v.A)(),y=null===c||void 0===c||null===(t=c.sensors)||void 0===t?void 0:t.map(e=>({value:e.sensor_id,label:(0,L.Cn)(e.location_short)})),f=e=>{switch(e){case bn:case kn:return!1;case wn:return u[bn]===_n(l)[bn];case zn:return!0!==u[Wn];default:return u[wn]===_n(l)[wn]}};return(0,D.jsxs)(d.A,{direction:"column",gap:2,mt:1,width:"100%",children:[null!==(n=Un[s])&&void 0!==n&&n.contentText?(0,D.jsx)(Vn.A,{fontWeight:"500",children:Un[s].contentText}):null,(0,D.jsxs)(d.A,{direction:"row",gap:1,alignItems:"center",mb:2,children:[(0,D.jsx)(w.A,{size:"small",checked:u[kn],onChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[kn]:e.target.checked}))},disabled:f(kn)}),(0,D.jsx)(h.A,{fontWeight:500,color:"text.secondary",children:br(u)})]}),(0,D.jsxs)(A.Ay,{container:!0,columnSpacing:2,alignItems:"center",children:[(0,D.jsx)(A.Ay,{item:!0,xs:6,children:(0,D.jsx)(Ue,{icon:(0,D.jsx)(qn.A,{}),label:mn,value:u[bn],options:y,disabled:f(bn),handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[bn]:e.target.value,[wn]:""}))}})}),(0,D.jsx)(A.Ay,{item:!0,xs:6,children:(0,D.jsx)(Ue,{label:gn,value:u[wn],options:x,disabled:f(wn),handleChange:e=>{var t,n;const r=e.target.value,o=p.Uy[r];m((0,a.A)((0,a.A)({},u),{},{[wn]:r,[Sn]:null===(t=g.palette.chart.colorAxes[o.color_axis])||void 0===t?void 0:t.defaultValueForAlert,[zn]:(0,a.A)((0,a.A)({},u[zn]),{},{[Sn]:null===(n=g.palette.chart.colorAxes[o.color_axis])||void 0===n?void 0:n.defaultValueForChildAlert})}))},flex:1})})]}),(0,D.jsx)(lr,{daysOfWeek:u[Cn],excludedDates:u[In]||[],disabled:f(Cn),handleDaysOfWeekChange:(e,t)=>{const n=Array.isArray(t)?t:[];m((0,a.A)((0,a.A)({},u),{},{[Cn]:n.sort()}))},handleExcludedDatesChange:e=>{const t=u[In]||[],n=e.reduce((e,t)=>e.includes(t)?e.filter(e=>e!==t):[...e,t],t);m((0,a.A)((0,a.A)({},u),{},{[In]:n}))}}),(()=>{switch(l){case un.daily.id:return(0,D.jsx)(Ue,{icon:(0,D.jsx)(Yn.A,{}),label:un.daily.tableColumnHeader,value:u[Dn],options:Fe,disabled:f(Dn),handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[Dn]:e.target.value}))}});case un.threshold.id:return(0,D.jsxs)(A.Ay,{container:!0,columnSpacing:2,rowSpacing:.5,children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,D.jsx)(Ye,{timeRange:u[Tn],defaultTimeRange:_n(un.threshold.id)[Tn],disabled:f(Tn),handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[Tn]:e}))}})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,md:6,children:(0,D.jsx)(gr,{value:u[Rn],handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[Rn]:e.target.checked}))},disabled:f(Rn)})})]});default:return null}})(),l===un.threshold.id?(0,D.jsxs)(A.Ay,{container:!0,alignItems:"start",spacing:2,children:[(0,D.jsxs)(A.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,children:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mt:"2px",mb:"12px"},children:"1. Alert if it is:"})}),(0,D.jsx)(A.Ay,{item:!0,sx:{mr:2},children:(0,D.jsx)(yr,{currentAlertType:u[fn],handleChange:e=>{const t=e.target.value,n=t===cn.above_threshold.id?cn.below_threshold.id:cn.above_threshold.id;m((0,a.A)((0,a.A)({},u),{},{[fn]:t,[zn]:(0,a.A)((0,a.A)({},u[zn]),{},{[fn]:n})}))},disabled:f(fn),sx:{height:"100%"}})}),(0,D.jsx)(pr,{value:u[Sn],invertSelection:u[fn]===cn.below_threshold.id,handleValueChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[Sn]:e}))},disabledToggle:f(fn),disabledSlider:f(Sn),placeholderValueBeforeDataTypeSelection:2/3}),(0,D.jsx)(A.Ay,{item:!0,xs:12,mt:2,children:(0,D.jsx)(Gn,{value:u[On],handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[On]:e.target.value}))},maxLength:200,label:"Optional Message for Main Alert",disabled:f(On)})})]}),(0,D.jsxs)(A.Ay,{container:!0,item:!0,xs:12,sm:6,children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,children:(0,D.jsx)(Kn.A,{children:(0,D.jsx)(Qn.A,{disabled:f(Wn),control:(0,D.jsx)(b.A,{checked:!!u[Wn],onChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[Wn]:e.target.checked}))},size:"small"}),label:(0,D.jsx)(h.A,{variant:"body1",fontWeight:500,color:"text.secondary",children:"2. [Optional] Follow-up alert if it changes to:"}),color:"text.secondary"})})}),u[zn]&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(A.Ay,{item:!0,sx:{mr:2},children:(0,D.jsx)(fr,{currentAlertType:null===(o=u[zn])||void 0===o?void 0:o[fn],sx:{height:"100%"}})}),(0,D.jsx)(pr,{value:u[zn][Sn],invertSelection:(null===(i=u[zn])||void 0===i?void 0:i[fn])===cn.below_threshold.id||!0,handleValueChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[zn]:(0,a.A)((0,a.A)({},u[zn]),{},{[Sn]:e})}))},disabledToggle:f(zn),disabledSlider:f(zn),showTip:!1,placeholderValueBeforeDataTypeSelection:1/3}),(0,D.jsx)(A.Ay,{item:!0,xs:12,mt:2,children:(0,D.jsx)(Gn,{value:u[zn][On],handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[zn]:(0,a.A)((0,a.A)({},u[zn]),{},{[On]:e.target.value})}))},maxLength:200,label:"Optional Message for Follow-up Alert",showTip:!1,disabled:f(zn)})})]})]})]}):(0,D.jsx)(Gn,{value:u[On],handleChange:e=>{m((0,a.A)((0,a.A)({},u),{},{[On]:e.target.value}))},maxLength:200,disabled:f(On)})]})},wr=()=>{const e=(0,Zt.jE)(),{currentSchoolID:t}=(0,r.useContext)(m.C),{user:n}=(0,r.useContext)(Vt.R);return(0,en.n)({mutationFn:async e=>{let{alertId:n,alertToEdit:r}=e;const a=(0,Ce.e)({paths:[Yt.tK.alerts,t,n]});return(0,Se.i)({url:a,restMethod:Yt.Xo.PUT,body:r})},onSuccess:(r,a)=>{let{alertId:o}=a;e.setQueryData([Yt.tK.alerts,t,n.username||n.email],function(){return Fn((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(e=>e[yn]===o?r:e))})}})},Sr=e=>{var t;const{alertTypeKey:n,openAlertModificationDialog:o,crudType:i,handleClose:l}=e,{selectedAlert:c,setSelectedAlert:u,editingAlert:h,setEditingAlert:x}=(0,r.useContext)(hr),[p,g]=(0,r.useState)(!1),{enqueueSnackbar:A}=(0,be.dh)(),y=(0,v.A)(),f=e=>{const t=(0,a.A)({},e);return delete t[zn],delete t[Wn],t},b=(e,t)=>{const n=(0,a.A)((0,a.A)((0,a.A)({},e),e[zn]),{},{[Ln]:t,[yn]:null});return delete n[zn],delete n[Wn],n},j=e=>{A(Un[e].successMessage,je.n.success),l()},w=e=>{A(Un[e].errorMessage,je.n.error)},S=e=>{let{passedCrudType:t}=e;const r=(()=>{var e;if(n===un.daily.id)return{valid:!0};if(!h[Wn])return{valid:!0};const t=h[fn]===cn.above_threshold.id,r=h[Sn],a=null===(e=h[zn])||void 0===e?void 0:e[Sn];return void 0===a?{valid:!0}:t&&r<=a||!t&&r>=a?{valid:!1,message:"The follow-up alert must have a ".concat(t?"lower":"higher"," threshold than the first alert")}:{valid:!0}})();if(r.valid)switch(t){case hn:T.mutate({alertToCreate:f(h)},{onSuccess:e=>{if(j(t),c[fn]===un.daily.id)return;const r=_n(n);if(u(r),x(r),!h[Wn])return;const a=e[yn];null!==a&&void 0!==a&&T.mutate({alertToCreate:b(h,a)},{onError:()=>w(t)})}});break;case xn:{const e=c[yn];k.mutate({alertId:e,alertToEdit:f(h)},{onSuccess:()=>{var n;if(j(t),c[fn]===un.daily.id)return;const r=null===(n=h[zn])||void 0===n?void 0:n[yn];if(h[Wn]||null===r||void 0===r){const t=b(h,e);null===r||void 0===r?T.mutate({alertId:e,alertToCreate:t}):k.mutate({alertId:r,alertToEdit:t})}else I.mutate({alertId:r},{onSuccess:()=>j(pn),onError:()=>w(pn)})}});break}}else A(r.message,je.n.error)};(0,r.useEffect)(()=>{var e,t;if((null===(e=h[Tn])||void 0===e?void 0:e[0])>(null===(t=h[Tn])||void 0===t?void 0:t[1]))g(!0);else switch(i){case hn:const e=_n(n);h[bn]===e[bn]||h[wn]===e[wn]?n===un.daily.id?g(h[Dn]===e[Dn]):g(!0):n===un.daily.id?g(h[Dn]===e[Dn]):g(!1);break;case xn:let t;t=n===un.daily.id?h[Dn]:h[Sn];const r=h[wn];if(!t||""===t||!r||""===r){g(!0);break}g(Hn()(c,h));break;default:g(!1)}},[i,c,h,n]);const C=(0,s.A)(e=>e.breakpoints.down("md")),T=(()=>{const e=(0,Zt.jE)(),{currentSchoolID:t}=(0,r.useContext)(m.C),{user:n}=(0,r.useContext)(Vt.R);return(0,en.n)({mutationFn:async e=>{let{alertToCreate:n}=e;const r=(0,Ce.e)({paths:[Yt.tK.alerts,t]});return(0,Se.i)({url:r,restMethod:Yt.Xo.POST,body:n})},onSuccess:r=>{e.setQueryData([Yt.tK.alerts,t,n.username||n.email],function(){return Fn([...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r])})}})})(),k=wr(),I=(()=>{const e=(0,Zt.jE)(),{currentSchoolID:t}=(0,r.useContext)(m.C),{user:n}=(0,r.useContext)(Vt.R);return(0,en.n)({mutationFn:async e=>{let{alertId:n}=e;const r=(0,Ce.e)({paths:[Yt.tK.alerts,t,n]});return(0,Se.i)({url:r,restMethod:Yt.Xo.DELETE})},onSuccess:(r,a)=>{let{alertId:o}=a;e.setQueryData([Yt.tK.alerts,t,n.username||n.email],function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(e=>e[yn]!==o);return Fn(e)})}})})();return(0,D.jsxs)(zt.A,{open:o,onClose:l,"aria-labelledby":"alert-modification-dialog",maxWidth:"md",fullWidth:!0,fullScreen:C,children:[(0,D.jsx)(_t.A,{id:"alert-modification-dialog",children:null===(t=Un[i])||void 0===t?void 0:t.title}),(0,D.jsx)(Ft.A,{children:(0,D.jsx)(jr,{alertTypeKey:n,crudType:i})}),(0,D.jsxs)(Wt.A,{sx:{justifyContent:"space-between"},children:[i===xn?(0,D.jsx)(Nn,{onConfirmedDelete:()=>{I.mutate({alertId:c.id},{onSuccess:()=>j(pn),onError:()=>w(pn)})}}):null,(0,D.jsxs)(d.A,{direction:"row",width:"100%",justifyContent:"end",children:[(0,D.jsx)(Ie.A,{onClick:l,sx:{color:y.palette.text.secondary},children:"Cancel"}),(0,D.jsx)(Ie.A,{onClick:()=>{S({passedCrudType:i})},color:"primary",disabled:p,children:"Save Edit"})]})]})]})};var Cr=n(73523),Dr=n(63572);const Tr=e=>{if(!e||!(0,L.OP)(e))return"N/A";if(e.length===Xn.length)return"Everyday";const t=Xn.filter(t=>!e.includes(t.value));return 2===t.length&&t.every(e=>[5,6].includes(e.value))?"Only weekdays":e.map(e=>{var t;return null===(t=Xn.find(t=>t.value===e))||void 0===t?void 0:t.label.slice(0,2)}).join(", ")},kr=(e,t)=>t?"":e&&Dr.fo[e]?"".concat(Dr.fo[e].name," added your email to this school-wide alert. For edit or removal, please reach out to ").concat(Dr.fo[e].name,"."):void 0,Ir=e=>{var t;const{selectedAlert:n,setSelectedAlert:o}=(0,r.useContext)(hr),{enqueueSnackbar:l}=(0,be.dh)(),{alertTypeKey:s,alertsForTable:c}=e,u=(0,v.A)(),[h,x]=(0,r.useState)(!1),[m,g]=(0,r.useState)(null),A=e=>{let{alert:t,crudType:n}=e;o(t),g(n),x(!0)},y=wr();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(d.A,{spacing:2,alignItems:"center",children:[(0,D.jsx)(i.A,{sx:{width:"100%",overflowX:"auto"},children:(0,L.OP)(c)?(0,D.jsxs)(Dt.A,{size:"small",sx:{my:1},children:[(0,D.jsx)(Tt.A,{children:(0,D.jsxs)(kt.A,{children:[(0,D.jsx)(It.A,{sx:{px:0}}),(0,D.jsx)(It.A,{children:mn}),(0,D.jsx)(It.A,{children:gn}),(0,D.jsx)(It.A,{children:An}),(0,D.jsx)(It.A,{children:(null===(t=un[s])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,D.jsx)(It.A,{children:vn})]})}),(0,D.jsx)(Cr.A,{component:Et.A,children:(0,L.OP)(c)?c.map((e,t)=>{return(0,D.jsx)(rn.A,{children:(0,D.jsxs)(kt.A,{sx:{background:e[yn]===n[yn]&&u.palette.background.NYUpurpleLight,textDecoration:!1===e[kn]?"line-through":"none"},children:[(0,D.jsxs)(It.A,{sx:{px:0},children:[(0,D.jsx)(Rt.A,{title:!1===e[Pn]?kr(e[En],e[Pn]):"Click to ".concat(e[kn]?"disable":"enable"," alert"),children:(0,D.jsx)("span",{onClick:()=>{(e=>{if(!1===e[Pn])return void l(kr(e[En],e[Pn]),je.n.warning);const t=!e[kn];y.mutate({alertId:e[yn],alertToEdit:(0,a.A)((0,a.A)({},e),{},{[kn]:t})},{onSuccess:()=>l("This alert is now ".concat(t?"enabled":"disabled"),je.n.success),onError:e=>l((null===e||void 0===e?void 0:e.message)||"There was an error ".concat(t?"enabling":"disabling"," this alert, try again!"),je.n.error)})})(e)},style:{display:"inline-block"},children:(0,D.jsx)(w.A,{size:"small",disabled:!1===e[Pn],checked:e[kn]})})}),(0,D.jsx)(Rt.A,{title:!1===e[Pn]?kr(e[En],e[Pn]):"Edit alert",children:(0,D.jsx)("span",{onClick:()=>{!1!==e[Pn]?A({alert:e,crudType:xn}):l(kr(e[En],e[Pn]),je.n.warning)},style:{display:"inline-block"},children:(0,D.jsx)(Lt.A,{"aria-label":"edit",size:"small",disabled:!1===e[Pn],sx:{"&:hover,:focus":{color:u.palette.primary.main}},children:(0,D.jsx)(an.A,{})})})})]}),(0,D.jsx)(It.A,{sx:{textTransform:"capitalize"},children:e[jn]}),(0,D.jsx)(It.A,{children:Object.keys(p.Uy).filter(t=>t===e[wn]).map(e=>p.Uy[e].name_title)[0]}),(0,D.jsx)(It.A,{children:Tr(e[Cn])}),s===un.threshold.id?(0,D.jsxs)(It.A,{children:[cn[e[fn]].sign," ",e[Sn],"\xa0",Object.keys(p.Uy).filter(t=>t===e[wn]).map(e=>p.Uy[e].unit)[0]]}):null,s===un.daily.id?(0,D.jsx)(It.A,{children:_e(e[Dn])}):null,(0,D.jsx)(It.A,{children:(0,D.jsx)(S.A,{label:(r=e[En],o=e[Mn],!0===o?"You":r?Dr.fo[r].name:"N/A"),size:"small"})})]})},t);var r,o}):null})]}):(0,D.jsxs)(ze.A,{severity:"warning",sx:{mt:2},children:["No ",un[s].name.toLowerCase()," alert has been set up"]})}),(0,D.jsx)(Ie.A,{variant:"outlined",startIcon:(0,D.jsx)(on.A,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>A({alert:_n(s),crudType:hn}),children:"Add Alert"})]}),(0,D.jsx)(Sr,{alertTypeKey:s,crudType:m,openAlertModificationDialog:h,handleClose:()=>{x(!1),o(_n(s))}})]})},Er=["children","value","index","alertType","alertsArray"];function Mr(e){const{children:t,value:n,index:r,alertType:o,alertsArray:l}=e,s=(0,Ve.A)(e,Er);return(0,D.jsx)(i.A,(0,a.A)((0,a.A)({role:"tabpanel",hidden:n!==r,id:"alert-tabpanel-".concat(o.id),"aria-labelledby":"alert-tab-".concat(o.id),width:"100%"},s),{},{children:(0,D.jsx)(Ir,{alertTypeKey:o.id,alertsForTable:l})}))}function Pr(){const{setSelectedAlert:e}=(0,r.useContext)(hr),{data:t}=(()=>{var e;const{currentSchoolID:t}=(0,r.useContext)(m.C),{authenticationState:n,user:o}=(0,r.useContext)(Vt.R),i=(0,we.I)({queryKey:[Yt.tK.alerts,t,o.username||o.email],queryFn:async()=>{const e=await(0,Se.i)({url:(0,Ce.e)({paths:[Yt.tK.alerts,t]})});return(0,L.OP)(e)?Fn(e):[]},enabled:!!t&&!!n.authenticated,staleTime:0,retry:!1,refetchOnWindowFocus:!1});return(0,a.A)((0,a.A)({},i),{},{data:null!==(e=i.data)&&void 0!==e?e:[]})})(),n=(0,s.A)(e=>e.breakpoints.down("sm")),[o,l]=(0,r.useState)(0),d=e=>{const n=t.filter(t=>{var n;if(!t)return null;const r=null===(n=t[fn])||void 0===n?void 0:n.toLowerCase(),a=t[Ln];return!r.includes(e)||null!==a&&void 0!==a?null:t});return{array:n,alertsLength:(0,L.OP)(n)?n.length:"0"}};return(0,D.jsxs)(i.A,{children:[(0,D.jsx)(Ze,{value:o,onChange:(t,n)=>{var r,a;l(n),e(_n(null===(r=un[null===(a=Object.keys(un))||void 0===a?void 0:a[n]])||void 0===r?void 0:r.id))},variant:n?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(un).map(e=>{const t=d(e.id);return(0,D.jsx)(c.A,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)})}),Object.values(un).map(e=>{const t=d(e.id);return(0,D.jsx)(Mr,{alertType:e,value:o,index:e.index,alertsArray:t.array},e.id)})]})}function Or(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:n}=Nt(t),{user:a}=(0,r.useContext)(Vt.R),o=[Dr.fo.admin.id,Dr.fo.school.id].includes(null===a||void 0===a?void 0:a.user_role);return(0,D.jsx)(Ht,{buttonIcon:(0,D.jsx)(Xt.A,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:n,children:(0,D.jsxs)(d.A,{width:"100%",spacing:o?5:2,children:[(0,D.jsx)(xr,{children:(0,D.jsx)(Pr,{})}),o?(0,D.jsx)(nn,{}):(0,D.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,D.jsx)("b",{children:null===a||void 0===a?void 0:a.email})]})]})})}var Rr=n(50269),Lr=n(21122);const zr=e=>{let{onLoginSuccess:t,children:n}=e;const a=(0,r.useRef)(null),{enqueueSnackbar:o}=(0,be.dh)(),{setAuthenticationState:i,setUser:l}=(0,r.useContext)(Vt.R),[s,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),h=(0,r.useCallback)(()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,n=window.open(Rr.S.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(n){n.focus(),a.current=n;const e=setInterval(()=>{n.closed&&(clearInterval(e),window.removeEventListener("message",x),a.current=null)},500)}else alert("Popup blocked. Please enable popups for login.")},[]),x=(0,r.useCallback)(e=>{if(e.origin===window.location.origin&&e.data.type===Dr.$_.password&&e.data.success){const n=e.data.user;i({checkedAuthentication:!0,authenticated:!0}),l(n),n.message&&o(n.message,je.n.success),!1===n.is_verified&&(d(!0),u(n.email)),null===t||void 0===t||t()}},[t]);return(0,r.useEffect)(()=>(window.addEventListener("message",x),()=>{window.removeEventListener("message",x)}),[x]),(0,D.jsxs)(D.Fragment,{children:[n({openLoginPopup:h}),(0,D.jsx)(Lr.A,{open:s,email:c})]})},Wr=()=>{const{loggedIn:e}=Nt(),{enqueueSnackbar:t}=(0,be.dh)();return(0,D.jsx)(zr,{onLoginSuccess:()=>{t("You can now access Dataset and Alerts.",{variant:je.n.success.variant,duration:2*je.n.success.duration})},children:t=>{let{openLoginPopup:n}=t;return(0,D.jsxs)(A.Ay,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(Ct,{onButtonClick:null})}),(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(Kt,{onButtonClick:e?null:n})}),(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(xr,{children:(0,D.jsx)(Or,{onButtonClick:e?null:n})})})]})}})};var _r=n(30922),Fr=n(78185);const Br=["tooltipTitle","label"],Hr=e=>{const{tooltipTitle:t,label:n}=e,r=(0,Ve.A)(e,Br),o=(0,D.jsx)(S.A,(0,a.A)({size:"small",label:n||(0,D.jsx)(Fr.A,{variant:"text",sx:{minWidth:"5rem"}}),sx:{userSelect:"text","& .MuiChip-label":{userSelect:"text"}}},r));return t?(0,D.jsx)(Rt.A,{title:t,enterDelay:0,leaveDelay:200,children:o}):o};var Vr=n(84392),Nr=n(39983);const Ur=(e,t)=>(0,D.jsxs)(i.A,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[e||"Loading...",t?(0,D.jsx)(Nr.A,{}):(0,D.jsx)(Xe.A,{})]}),Yr=()=>{const{currentSchoolID:e}=(0,r.useContext)(m.C),{data:t}=(0,St.A)(),{user:n}=(0,r.useContext)(Vt.R),a=(0,wt.Zp)(),[o,i]=(0,r.useState)(null),s=Boolean(o),d=()=>{i(null)};if(t)return!Array.isArray(n.allowedSchools)||n.allowedSchools.length<=1?(0,D.jsx)(Hr,{icon:(0,D.jsx)(qn.A,{}),label:t.name||"No School Name Given",tooltipTitle:"School"}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(Hr,{icon:(0,D.jsx)(qn.A,{}),label:Ur(t.name,s),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{i(e.currentTarget)},"aria-controls":s?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0}),(0,D.jsx)(u.A,{anchorEl:o,open:s,onClose:d,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,D.jsx)(_r.A,{dense:!0,children:n.allowedSchools.map((t,n)=>{return(0,D.jsx)(l.A,{onClick:(r=t.school_id,()=>{e!==r&&(localStorage.setItem(Vr.D.schoolID,r),xt.n(xt.s.internalNavigation,{origin_school:e,destination_school_id:r,origin_id:"school_selector"}),a("".concat(Rr.S.dashboard,"/").concat(r))),d()}),children:t.name},n);var r})})})]})};var qr=n(52177);const Kr=()=>{const{data:e}=(0,St.A)();if(e)return(0,D.jsxs)(A.Ay,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(Yr,{})}),(0,D.jsx)(A.Ay,{item:!0,children:(0,D.jsx)(Hr,{icon:(0,D.jsx)(qr.A,{}),label:"".concat(e.contactPerson," <").concat(e.contactEmail,">"),tooltipTitle:"Main Contact",component:"a",href:"mailto:".concat(null===e||void 0===e?void 0:e.contactEmail),clickable:!0})})]})},Qr=()=>{const e=(0,v.A)(),{data:t}=(0,St.A)();return t?(0,D.jsx)(h.A,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,N.Ay)(t.description||"",{replace:L.H$})}):Array.from({length:3}).map((e,t)=>(0,D.jsx)(Fr.A,{variant:"text"},t))};var Gr=n(54536);const Xr=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,r.useContext)(m.C);return!1===e?(0,D.jsx)(d.A,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,D.jsxs)(Ie.A,{variant:"contained",onClick:()=>{t(!0)},children:[(0,D.jsx)(Gr.A,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null};var $r=n(61413);const Jr=()=>{const{currentSchoolID:e,loadMoreCharts:t}=(0,r.useContext)(m.C),{data:n}=(0,Ut.A)(),{data:a}=(0,St.A)(),o=t?Yt.HG.length:bt.JO,{themePreference:l}=(0,r.useContext)(yt.j);return(0,D.jsxs)(i.A,{width:"100%",children:[(0,D.jsx)(mt,{}),(0,D.jsxs)(At.A,{backgroundColor:"customAlternateBackground",children:[(0,D.jsx)(at.A,{sx:{pt:2},children:(0,D.jsxs)(A.Ay,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,D.jsx)(A.Ay,{item:!0,xs:12,children:(0,D.jsx)(rt.A,{text:(()=>{if(null!==a&&void 0!==a&&a.school_id)return"Air Quality | ".concat(null===a||void 0===a?void 0:a.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,children:(0,D.jsx)(Kr,{})}),(0,D.jsx)(A.Ay,{item:!0,xs:12,children:(0,D.jsx)(Wr,{})})]})}),!0===(null===a||void 0===a?void 0:a.has_map)?(0,D.jsx)($r.A,{currentSensorsData:n,schoolID:e,isOnBannerPage:!1,minMapHeight:"250px"}):(0,D.jsx)(at.A,{sx:{mb:2},children:(0,D.jsx)(vt.A,{currentSensorsData:n,isScreen:!1})}),(0,D.jsxs)(at.A,{sx:{pb:2},children:[(0,D.jsx)(Qr,{}),(0,D.jsx)(ft.A,{})]})]}),(0,D.jsx)(i.A,{id:gt.charts.id,children:Yt.HG.slice(0,o).map((e,n)=>(0,D.jsx)(At.A,{backgroundColor:n%2!==0?"customAlternateBackground":"",children:(0,D.jsxs)(at.A,{sx:{pt:4,pb:4},height:"auto",className:l===it.A.dark?"dark":"",id:"chart-".concat(n+1),children:[(0,D.jsx)(Me,{children:(0,D.jsx)(nt,{chartID:n})}),n===o-1&&!t&&(0,D.jsx)(Xr,{})]})},n))}),(0,D.jsx)(ot.A,{})]})};var Zr=n(25282);const ea=()=>{const{currentSchoolID:e}=(0,r.useContext)(m.C);(0,r.useEffect)(()=>{e&&(document.title="".concat(bt.sG," | ").concat(e.toUpperCase()))},[e]);const{setCurrentPage:t}=(0,r.useContext)(Zr.B);return(0,r.useEffect)(()=>{t(Rr.S.dashboard)},[t]),(0,D.jsx)(Jr,{})}},73605:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(65043),a=n(96446),o=n(85865),i=n(85721),l=n(8011),s=n(47298),d=n(51210),c=n(65290),u=n(98348),h=n(70579);const x="Explanation of the US Air Quality Index (AQI) for PM2.5",p="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',g=()=>{const{themePreference:e}=(0,r.useContext)(c.j);return(0,h.jsx)(d.A,{title:x,icon:(0,h.jsx)(u.A,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(a.A,{children:[(0,h.jsx)(s.A,{themePreference:e}),(0,h.jsx)(o.A,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,i.Ay)(p,{replace:l.H$})}),(0,h.jsx)(d.A,{title:"Reference",content:(0,h.jsx)(o.A,{variant:"caption",color:"text.secondary",children:(0,i.Ay)(m,{replace:l.H$})})})]})})}}}]);
//# sourceMappingURL=196.1249eda4.chunk.js.map