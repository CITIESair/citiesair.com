"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[275],{3275:(t,e,r)=>{r.r(e),r.d(e,{default:()=>F});var n=r(72791),a=r(57689),o=r(31781),s=r(61889),i=r(36314),c=r(697),l=r(20890),u=r(52069),h=r(29019),d=r(44709),p=r(56593);const f=1,g=2,v=3;var x=r(64377),m=r(30970),y=r(13967),j=r(19132),w=r(80184);const b=t=>{const{data:e}=t,{language:r}=(0,n.useContext)(j.p),a=(0,y.Z)(),o=(0,n.useRef)(),s=(0,n.useRef)(),i=(0,n.useRef)(),l=(0,n.useRef)(),u=(0,n.useRef)();let f,g,v,b,S=200;const q=30,Z=80,_=70,k=h.jvg().x((function(t){return v(t.timestamp)})).y((function(t){return b(t.aqi.val)})).curve(h.YY7.tension(0));return(0,n.useEffect)((()=>{if(!e)return;if(!o.current)return;if(!s.current)return;if(!i.current)return;if(!l.current)return;if(!u.current)return;f=o.current.clientWidth,g=o.current.clientHeight-q,h.Ys(s.current).selectAll("*").remove(),h.Ys(i.current).selectAll("*").remove(),h.Ys(l.current).selectAll("*").remove(),h.Ys(u.current).selectAll("*").remove(),h.Ys(s.current).attr("opacity",.5),h.Ys(i.current).attr("filter","brightness(0.8) contrast(1.2) saturate(1.2)"),Object.entries(e).forEach((t=>{var e;let[r,n]=t;if(null===(e=n.historical)||void 0===e||e.forEach((function(t){t.timestamp=new Date(t.timestamp)})),n.historical&&Array.isArray(n.historical)){const t=h.Fp7(n.historical,(function(t){return t.aqi.val}));t>S&&(S=t)}})),S=50*Math.ceil(S/50);for(let e of d._R)if(S>=e.aqiUS.low&&S<=e.aqiUS.high){S=e.aqiUS.high===1/0?S:e.aqiUS.high;break}let t=new Date,n=new Date;n.setHours(n.getHours()-6),v=h.Xf().domain([n,t]).rangeRound([_,f-Z]),b=h.BYU().domain([0,S]).range([g+q,q]);let c=Math.max(Math.floor((d._R[1].aqiUS.high-d._R[0].aqiUS.high)/S*g/2),20),y=Math.floor(c/5);for(let e=0;e<d._R.length;e++){const t=d._R[e],n=t.aqiUS.high===1/0?S:t.aqiUS.high,a=t.aqiUS.low;if(S<=a)break;const o=50*Math.ceil((n-a)/50);h.Ys(s.current).append("rect").attr("x",0).attr("y",g-n/S*g+q).attr("width",f).attr("height",o/S*g).attr("fill",t.color.Light),h.Ys(i.current).append("text").attr("x",y).attr("y",g-t.aqiUS.low/S*g-3.5*y+q).attr("fill",t.color.Light).attr("font-size",c).text(50*Math.floor(t.aqiUS.low/50)),h.Ys(i.current).append("text").attr("class","category-text-graph-sm").attr("x",y+2).attr("y",g-t.aqiUS.low/S*g-y+q).attr("fill",t.color.Light).attr("font-size",c/2).text((0,x.i0)(t.category,r))}h.Ys(l.current).append("rect").attr("x",0).attr("y",0).attr("width",f).attr("height",q).attr("fill","white");let j=h.i$Z("%H:%M");h.Ys(l.current).append("g").attr("transform","translate(0,".concat(q,")")).call(h.F5q(v).tickSize(-g).ticks(h.Z_i.every(120)).tickFormat((function(t){return j(t)}))).attr("font-size",g/20).attr("color",m.WW.screen).select(".domain").remove(),h.Ys(l.current).selectAll("line").attr("stroke","white").attr("stroke-width",2).attr("opacity",.5),Object.entries(e).forEach((t=>{var e,r,n;let[o,s]=t;h.Ys(u.current).append("path").datum(s.historical||[]).attr("x",_).attr("class","line").attr("d",k).attr("fill","transparent").attr("stroke","black").attr("stroke-width","5px").attr("opacity","outdoors"===(null===(e=s.sensor)||void 0===e?void 0:e.location_type)?1:.5);const i=(null===(r=s.historical)||void 0===r?void 0:r.length)>0?null===(n=s.historical)||void 0===n?void 0:n[0]:null;if(i&&i.aqi&&void 0!==i.aqi.val&&null!==i.aqi.val&&i.timestamp){var c,l,d,f,y;const t=h.Ys(u.current).append("g").attr("transform","translate("+v(i.timestamp)+","+b(i.aqi.val)+")").attr("fill",null!==(null===s||void 0===s||null===(c=s.current)||void 0===c||null===(l=c.aqi)||void 0===l?void 0:l.categoryIndex)?a.palette.text.aqi[s.current.aqi.categoryIndex]:m.WW.screen);(null===(d=s.sensor)||void 0===d?void 0:d.sensor_status)===p.vI.active&&t.append("circle").attr("cx",0).attr("cy",0).attr("filter","brightness(0.5)").attr("class","pulse-ring").attr("r",25),t.append("circle").attr("cx",0).attr("cy",0).attr("stroke","#666").attr("class",(null===(f=s.sensor)||void 0===f?void 0:f.sensor_status)===p.vI.active&&"pulse-dot").attr("r",10),t.append("text").attr("class","location-label").attr("x",15).attr("y",0).attr("fill","black").attr("alignment-baseline","middle").attr("text-anchor","left").attr("font-size",g/25).text((0,x.Fb)(null===(y=s.sensor)||void 0===y?void 0:y.location_short));const e=document.getElementsByClassName("location-label");for(let r=1;r<e.length;r++){const t=e[r-1],n=e[r],a=(j=t.getBoundingClientRect(),w=n.getBoundingClientRect(),j.bottom<w.top||j.top>w.bottom?0:j.top<w.top?-1:1);0!==a&&(t.setAttribute("y",10*a),n.setAttribute("y",10*-a))}}var j,w}))}),[e,r]),(0,w.jsx)(c.Z,{sx:{"& .pulse-ring":{animation:"pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-ring":{"0%":{transform:"scale(0.2)"},"80%":{},"100%":{opacity:0}}},"& .pulse-dot":{animation:"pulse-dot 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-dot":{"0%":{transform:"scale(0.5)"},"50%":{transform:"scale(1)",filter:"brightness(1.2) contrast(1.2) saturate(1.2)"},"100%":{transform:"scale(0.5)"}}}},width:"100%",height:"100%",children:(0,w.jsxs)("svg",{id:"recent-historical-graph",width:"100%",height:"100%",ref:o,children:[(0,w.jsx)("g",{ref:s}),(0,w.jsx)("g",{ref:l}),(0,w.jsx)("g",{ref:i}),(0,w.jsx)("g",{ref:u})]})})};var S=r(1414),q=r(87505),Z=r(63867),_=r(47896),k=r(41009),I=r(41212),R=r(83165),M=r(71478),C=r(80925);const P=()=>{const{schoolMetadata:t,currentSchoolID:e}=(0,n.useContext)(R.G),r=null===t||void 0===t?void 0:t.is_public,a=document.location.href.split("screen"),o="screen".concat(a.pop()),s=!0===r?"".concat(I.eK,"/dashboard/").concat(e,"?source=").concat(o):"".concat(I.eK,"?source=").concat(o);return(0,w.jsx)(C.ZP,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:s,viewBox:"0 0 256 256"})};var U=r(84852),Y=r(49900),W=r(90493),A=r(53540);const z=t=>{let{data:e}=t;const{language:r}=(0,n.useContext)(j.p);if(!Object.values(e).every((t=>{var e;return(null===(e=t.sensor)||void 0===e?void 0:e.sensor_status)===p.vI.active})))return null;const a=e.find((t=>{var e;return"outdoors"===(null===(e=t.sensor)||void 0===e?void 0:e.location_type)})).current.aqi.val;if(a<=d._R[0].aqiUS.high)return null;const o=e.find((t=>{var e;return null===(e=t.sensor)||void 0===e?void 0:e.location_type.startsWith("indoors")})).current.aqi.val,s=a/o,i=s>=2?"".concat(s.toFixed(1),"x"):s>1.2?"".concat(Math.round((a-o)/o*100),"%"):null;return i?(0,w.jsx)(U.ZP,{children:(0,w.jsx)(Y.Z,{primary:(0,x.i0)(M.screen.content.indoorsVsOutdoors,r,{value:(0,w.jsx)(l.Z,{component:"span",color:"".concat(d._R[0].color.Light," !important"),children:i})})})}):null},D=t=>{let{typeOfScreen:e,data:r}=t;const{language:a}=(0,n.useContext)(j.p),o=new Map;return Object.values(r).forEach((t=>{var r,n;const s=(t=>{var r,n;if(void 0!==(null===t||void 0===t||null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.categoryIndex)){var o;const{healthSuggestions:r,category:n}=d._R[t.current.aqi.categoryIndex],s=(0,x.i0)(r[null===(o=t.sensor)||void 0===o?void 0:o.location_type],a);if(e===v)return s;{const t=(0,x.i0)(n,a);return"".concat(t,": ").concat(s)}}return null})(t);if(!s)return;const i=(null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.val)>=d._R[2].aqiUS.low;o.has(s)?o.set(s,o.get(s)||i):o.set(s,i)})),(0,w.jsxs)(W.Z,{className:"condensedFont",sx:{listStyleType:"disclosure-closed","& .MuiTypography-root":{fontSize:"2rem"},"& .MuiListItem-root":{display:"list-item",ml:3,p:0,pr:3},"& .MuiTypography-root, .MuiListItem-root":{color:m.WW.screen}},children:[e===v&&(0,w.jsx)(z,{data:r}),[...o.entries()].map(((t,e)=>{let[r,n]=t;return(0,w.jsx)(U.ZP,{className:n?"flashingRed":"",children:(0,w.jsx)(Y.Z,{primary:(0,A.ZP)(r)})},e)}))]})};function E(t){const e=new URLSearchParams(t.search).get("displayHours");if(!e)return!0;const[r,n]=e.split("-").map((t=>parseInt(t.replace(":",""),10))),a=parseInt((new Date).toTimeString().slice(0,5).replace(":",""),10);return r<=n?r<=a&&a<n:a>=r||a<n}const F=t=>{let{title:e}=t;const{school_id_param:r,screen_id_param:h}=(0,a.UO)(),{temperatureUnitPreference:p,language:y,setLanguage:C}=(0,n.useContext)(j.p),{schoolMetadata:U,currentSchoolID:Y}=(0,n.useContext)(R.G),{authenticationState:W}=(0,n.useContext)(o.S),A=((0,a.s0)(),(0,a.TH)()),[z,F]=(A.pathname,(0,n.useState)(E(A))),[H,L]=(0,n.useState)(E(v));(0,n.useEffect)((()=>{if(!U||!(0,x.qt)(U.languages))return;const t=U.languages;if(t.length<=1)return;F(E(A));const e=(new Date).getMinutes();C(t[e%t.length]);const r=setInterval((()=>{F(E(A));const e=(new Date).getMinutes();C(t[e%t.length])}),6e4);return()=>clearInterval(r)}),[U,A,C]),(0,n.useEffect)((()=>{document.title=e}),[e]);const[O,T]=(0,n.useState)(),[B,N]=(0,n.useState)({});(0,n.useEffect)((()=>{function t(){return 0!==[0,0,1,1,0,0,1,1,0,0,1,1][(new Date).getMonth()]}T(t());const e=setInterval((()=>{T(t())}),864e5);return()=>{clearInterval(e)}}),[]),(0,n.useEffect)((()=>{if(0!=Object.keys(B).length)return;const t=(0,Z.kG)({endpoint:_.eV.screen,school_id:r||Y,screen_id:h});(0,k.m)(t).then((t=>{N(t);const e=t.some((t=>{let{sensor:e}=t;return"outdoors"===e.location_type})),r=t.some((t=>{let{sensor:e}=t;return e.location_type.startsWith("indoors")})),n=r&&e?v:r?f:e?g:null;n&&L(n)})).catch((t=>{console.log(t)}));const e=setInterval((()=>{(0,k.m)(t).then((t=>{N(t)})).catch((t=>console.log(t)))}),3e5);return()=>{clearInterval(e)}}),[]);const G=(0,x.i0)(M.screen.content.aqiTitle,y),K=(0,x.i0)(M.screen.content.pm25Title,y);return z?(0,w.jsxs)(s.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{overflow:"hidden",background:"white","& *":{fontWeight:"500 !important"},"& .condensedFont":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important","& *":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important"}},"& .flashingRed":{"& .MuiTypography-root ":{color:"".concat(d._R[3].color.Light," !important"),opacity:.8},color:"".concat(d._R[3].color.Light," !important"),animation:"flashingRed 3s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes flashingRed":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}},children:[(0,w.jsx)(s.ZP,{item:!0,xs:6,sx:{py:3,px:2,order:O?1:0,background:"#212529"},children:(0,w.jsxs)(i.Z,{direction:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[(0,w.jsxs)(c.Z,{children:[(0,w.jsx)(l.Z,{variant:"h2",fontWeight:"500",color:"white",children:G}),(0,w.jsx)(l.Z,{variant:"h3",className:"condensedFont",color:m.WW.screen,children:K})]}),(0,w.jsx)(s.ZP,{container:!0,justifyContent:"space-around",children:(0,w.jsx)(S.Z,{currentSensorsData:B,temperatureUnitPreference:p,isScreen:!0,size:q.l.large,showWeather:Y!==I.sH,showHeatIndex:Y!==I.sH})}),(0,w.jsx)(D,{typeOfScreen:H,data:B})]})}),(0,w.jsxs)(s.ZP,{item:!0,xs:6,sx:{order:O?0:1},children:[(0,w.jsx)(c.Z,{sx:{position:"absolute",top:0,right:!O&&0,left:O&&0,width:"5vw",height:"5vw",m:1},children:(0,w.jsx)(u.Z,{})}),(0,w.jsxs)(s.ZP,{container:!0,alignContent:"space-between",justifyContent:"center",height:"100%",textAlign:"center",children:[(0,w.jsxs)(s.ZP,{item:!0,xs:12,sx:{pt:3,px:2},children:[(0,w.jsx)(l.Z,{variant:"h2",sx:{color:"black"},children:I.DE}),Y===I.sH&&(0,w.jsxs)(l.Z,{variant:"h5",color:"text.secondary",children:[(0,x.i0)(M.screen.content.dataProvider,y),": AirQo"]})]}),(0,w.jsx)(s.ZP,{item:!0,xs:2,children:(0,w.jsx)(c.Z,{height:"auto",width:"90%",children:(0,w.jsx)(P,{})})}),(0,w.jsx)(s.ZP,{item:!0,xs:12,height:"70%",className:"condensedFont",sx:{"& *":{fontWeight:"600 !important"}},children:(0,w.jsx)(b,{data:B})})]})]})]}):(0,w.jsx)(s.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{overflow:"hidden",background:"black"}})}}}]);
//# sourceMappingURL=275.23add3a0.chunk.js.map