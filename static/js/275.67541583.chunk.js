"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[275],{3275:(t,e,r)=>{r.r(e),r.d(e,{default:()=>D});var n=r(72791),a=r(57689),o=r(61889),s=r(36314),i=r(697),l=r(20890),c=r(52069),u=r(42609),d=r(44709),h=r(56593);const p=1,g=2,f=3;var v=r(64377),x=r(30970),m=r(13967),y=r(19132),j=r(62573),w=r(80184);const b=t=>{const{data:e}=t,{language:r}=(0,n.useContext)(y.p),a=(0,m.Z)(),o=(0,n.useRef)(),s=(0,n.useRef)(),l=(0,n.useRef)(),c=(0,n.useRef)(),p=(0,n.useRef)();let g,f,b,q,Z=200;const _=30,S=80,k=70,R=u.jvg().x((function(t){return b(t.timestamp)})).y((function(t){return q(t.aqi.val)})).curve(u.YY7.tension(0));return(0,n.useEffect)((()=>{var t,n,i,m;if(!e)return;if(!o.current)return;if(!s.current)return;if(!l.current)return;if(!c.current)return;if(!p.current)return;const y=(null===e||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.metadata)||void 0===n?void 0:n.viewHours)||6,w=(null===e||void 0===e||null===(i=e[0])||void 0===i||null===(m=i.metadata)||void 0===m?void 0:m.aggregationType)===j.Z.hour?4:1;g=o.current.clientWidth,f=o.current.clientHeight-_,u.Ys(s.current).selectAll("*").remove(),u.Ys(l.current).selectAll("*").remove(),u.Ys(c.current).selectAll("*").remove(),u.Ys(p.current).selectAll("*").remove(),u.Ys(s.current).attr("opacity",.5),u.Ys(l.current).attr("filter","brightness(0.8) contrast(1.2) saturate(1.2)"),Object.entries(e).forEach((t=>{var e;let[r,n]=t;if(null===(e=n.historical)||void 0===e||e.forEach((function(t){t.timestamp=new Date(t.timestamp)})),n.historical&&Array.isArray(n.historical)){const t=u.Fp7(n.historical,(function(t){return t.aqi.val}));t>Z&&(Z=t)}})),Z=50*Math.ceil(Z/50);for(let e of d._R)if(Z>=e.aqiUS.low&&Z<=e.aqiUS.high){Z=e.aqiUS.high===1/0?Z:e.aqiUS.high;break}let M=new Date,C=new Date;C.setHours(C.getHours()-y),b=u.Xf().domain([C,M]).rangeRound([k,g-S]),q=u.BYU().domain([0,Z]).range([f+_,_]);let I=Math.max(Math.floor((d._R[1].aqiUS.high-d._R[0].aqiUS.high)/Z*f/2),20),U=Math.floor(I/5);for(let e=0;e<d._R.length;e++){const t=d._R[e],n=t.aqiUS.high===1/0?Z:t.aqiUS.high,a=t.aqiUS.low;if(Z<=a)break;const o=50*Math.ceil((n-a)/50);u.Ys(s.current).append("rect").attr("x",0).attr("y",f-n/Z*f+_).attr("width",g).attr("height",o/Z*f).attr("fill",t.color.Light),u.Ys(l.current).append("text").attr("x",U).attr("y",f-t.aqiUS.low/Z*f-3.5*U+_).attr("fill",t.color.Light).attr("font-size",I).text(50*Math.floor(t.aqiUS.low/50)),u.Ys(l.current).append("text").attr("class","category-text-graph-sm").attr("x",U+2).attr("y",f-t.aqiUS.low/Z*f-U+_).attr("fill",t.color.Light).attr("font-size",I/2).text((0,v.i0)(t.category,r))}u.Ys(c.current).append("rect").attr("x",0).attr("y",0).attr("width",g).attr("height",_).attr("fill","white"),M.setMinutes(0,0,0);const P=[];for(let e=new Date(M);e>=C;e.setHours(e.getHours()-w))P.push(new Date(e));P.reverse(),u.Ys(c.current).append("g").attr("transform","translate(0,".concat(_,")")).call(u.F5q(b).tickSize(-f).tickValues(P).tickFormat(u.i$Z("%H:%M"))).attr("font-size",f/20).attr("color",x.WW.screen).select(".domain").remove(),u.Ys(c.current).selectAll("line").attr("stroke","white").attr("stroke-width",2).attr("opacity",.5),Object.entries(e).forEach((t=>{var e,r,n;let[o,s]=t;u.Ys(p.current).append("path").datum(s.historical||[]).attr("x",k).attr("class","line").attr("d",R).attr("fill","transparent").attr("stroke","black").attr("stroke-width","5px").attr("opacity","outdoors"===(null===(e=s.sensor)||void 0===e?void 0:e.location_type)?1:.5);const i=(null===(r=s.historical)||void 0===r?void 0:r.length)>0?null===(n=s.historical)||void 0===n?void 0:n[0]:null;if(i&&i.aqi&&void 0!==i.aqi.val&&null!==i.aqi.val&&i.timestamp){var l,c,d,g,m;const t=u.Ys(p.current).append("g").attr("transform","translate("+b(i.timestamp)+","+q(i.aqi.val)+")").attr("fill",null!==(null===s||void 0===s||null===(l=s.current)||void 0===l||null===(c=l.aqi)||void 0===c?void 0:c.categoryIndex)?a.palette.text.aqi[s.current.aqi.categoryIndex]:x.WW.screen);(null===(d=s.sensor)||void 0===d?void 0:d.sensor_status)===h.vI.active&&t.append("circle").attr("cx",0).attr("cy",0).attr("filter","brightness(0.5)").attr("class","pulse-ring").attr("r",25),t.append("circle").attr("cx",0).attr("cy",0).attr("stroke","#666").attr("class",(null===(g=s.sensor)||void 0===g?void 0:g.sensor_status)===h.vI.active&&"pulse-dot").attr("r",10),t.append("text").attr("class","location-label").attr("x",15).attr("y",0).attr("fill","black").attr("alignment-baseline","middle").attr("text-anchor","left").attr("font-size",f/25).text((0,v.Fb)(null===(m=s.sensor)||void 0===m?void 0:m.location_short));const e=document.getElementsByClassName("location-label");for(let r=1;r<e.length;r++){const t=e[r-1],n=e[r],a=(y=t.getBoundingClientRect(),j=n.getBoundingClientRect(),y.bottom<j.top||y.top>j.bottom?0:y.top<j.top?-1:1);0!==a&&(t.setAttribute("y",10*a),n.setAttribute("y",10*-a))}}var y,j}))}),[e,r]),(0,w.jsx)(i.Z,{sx:{"& .pulse-ring":{animation:"pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-ring":{"0%":{transform:"scale(0.2)"},"80%":{},"100%":{opacity:0}}},"& .pulse-dot":{animation:"pulse-dot 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-dot":{"0%":{transform:"scale(0.5)"},"50%":{transform:"scale(1)",filter:"brightness(1.2) contrast(1.2) saturate(1.2)"},"100%":{transform:"scale(0.5)"}}}},width:"100%",height:"100%",children:(0,w.jsxs)("svg",{id:"recent-historical-graph",width:"100%",height:"100%",ref:o,children:[(0,w.jsx)("g",{ref:s}),(0,w.jsx)("g",{ref:c}),(0,w.jsx)("g",{ref:l}),(0,w.jsx)("g",{ref:p})]})})};var q=r(10738),Z=r(26013),_=r(63867),S=r(47896),k=r(41009),R=r(41212),M=r(83165),C=r(71478),I=r(80925);const U=()=>{const{schoolMetadata:t,currentSchoolID:e}=(0,n.useContext)(M.G),r=null===t||void 0===t?void 0:t.is_public,a=document.location.href.split("screen"),o="screen".concat(a.pop()).split("?")[0],s=!0===r?"https://".concat(R.eK,"/dashboard/").concat(e,"?source=").concat(o):"https://".concat(R.eK,"?source=").concat(o);return(0,w.jsx)(I.ZP,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:s,viewBox:"0 0 256 256"})};var P=r(84852),Y=r(49900),W=r(90493),H=r(53540);const A=t=>{let{data:e}=t;const{language:r}=(0,n.useContext)(y.p);if(!Object.values(e).length||!Object.values(e).every((t=>{var e;return(null===(e=t.sensor)||void 0===e?void 0:e.sensor_status)===h.vI.active})))return null;const a=e.find((t=>{var e;return"outdoors"===(null===(e=t.sensor)||void 0===e?void 0:e.location_type)})).current.aqi.val;if(a<=d._R[0].aqiUS.high)return null;const o=e.find((t=>{var e;return null===(e=t.sensor)||void 0===e?void 0:e.location_type.startsWith("indoors")})).current.aqi.val,s=a/o,i=s>=2?"".concat(s.toFixed(1),"x"):s>1.2?"".concat(Math.round((a-o)/o*100),"%"):null;return i?(0,w.jsx)(P.ZP,{children:(0,w.jsx)(Y.Z,{primary:(0,v.i0)(C.screen.content.indoorsVsOutdoors,r,{value:(0,w.jsx)(l.Z,{component:"span",color:"".concat(d._R[0].color.Light," !important"),children:i})})})}):null},L=t=>{let{typeOfScreen:e,data:r}=t;const{language:a}=(0,n.useContext)(y.p),o=new Map;return Object.values(r).forEach((t=>{var r,n;const s=(t=>{var r,n;if(void 0!==(null===t||void 0===t||null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.categoryIndex)){var o;const{healthSuggestions:r,category:n}=d._R[t.current.aqi.categoryIndex],s=(0,v.i0)(r[null===(o=t.sensor)||void 0===o?void 0:o.location_type],a);if(e===f)return s;{const t=(0,v.i0)(n,a);return"".concat(t,": ").concat(s)}}return null})(t);if(!s)return;const i=(null===(r=t.current)||void 0===r||null===(n=r.aqi)||void 0===n?void 0:n.val)>=d._R[2].aqiUS.low;o.has(s)?o.set(s,o.get(s)||i):o.set(s,i)})),(0,w.jsxs)(W.Z,{className:"condensedFont",sx:{listStyleType:"disclosure-closed","& .MuiTypography-root":{fontSize:"2rem"},"& .MuiListItem-root":{display:"list-item",ml:3,p:0,pr:3},"& .MuiTypography-root, .MuiListItem-root":{color:x.WW.screen}},children:[e===f&&(0,w.jsx)(A,{data:r}),[...o.entries()].map(((t,e)=>{let[r,n]=t;return(0,w.jsx)(P.ZP,{className:n?"flashingRed":"",children:(0,w.jsx)(Y.Z,{primary:(0,H.ZP)(r)})},e)}))]})};var z=r(42140);const D=t=>{let{title:e}=t;const{school_id_param:r,screen_id_param:u}=(0,a.UO)(),{isLayoutReversed:h}=(0,n.useContext)(z.s),{temperatureUnitPreference:m,language:I,setLanguage:P}=(0,n.useContext)(y.p),{schoolMetadata:Y,currentSchoolID:W}=(0,n.useContext)(M.G),[H,A]=(0,n.useState)(f);(0,n.useEffect)((()=>{if(!Y||!(0,v.qt)(Y.languages))return;const t=Y.languages;if(t.length<=1)return;const e=(new Date).getMinutes();P(t[e%t.length]);const r=setInterval((()=>{const e=(new Date).getMinutes();P(t[e%t.length])}),6e4);return()=>clearInterval(r)}),[Y,P]),(0,n.useEffect)((()=>{document.title=e}),[e]);const[D,F]=(0,n.useState)({});(0,n.useEffect)((()=>{if(0!=Object.keys(D).length)return;const t=r||W,e=t===R.sH?j.Z.hour:null,n=(0,_.kG)({endpoint:S.eV.screen,school_id:t,screen_id:u,aggregationType:e});(0,k.m)(n,e).then((t=>{F(t);const e=t.some((t=>{let{sensor:e}=t;return"outdoors"===e.location_type})),r=t.some((t=>{let{sensor:e}=t;return e.location_type.startsWith("indoors")})),n=r&&e?f:r?p:e?g:null;n&&A(n)})).catch((t=>{console.log(t)}));const a=setInterval((()=>{(0,k.m)(n).then((t=>{F(t)})).catch((t=>console.log(t)))}),R.aL);return()=>{clearInterval(a)}}),[]);const E=(0,v.i0)(C.screen.content.aqiTitle,I),O=(0,v.i0)(C.screen.content.pm25Title,I);return(0,w.jsxs)(o.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{cursor:"none",overflow:"hidden",background:"white","& *":{fontWeight:"500 !important"},"& .condensedFont":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important","& *":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important"}},"& .flashingRed":{"& .MuiTypography-root ":{color:"".concat(d._R[3].color.Light," !important"),opacity:.8},color:"".concat(d._R[3].color.Light," !important"),animation:"flashingRed 3s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes flashingRed":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}},children:[(0,w.jsx)(o.ZP,{item:!0,xs:6,sx:{py:3,px:2,order:h?1:0,background:"#212529"},children:(0,w.jsxs)(s.Z,{direction:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[(0,w.jsxs)(i.Z,{children:[(0,w.jsx)(l.Z,{variant:"h2",fontWeight:"500",color:"white",children:E}),(0,w.jsx)(l.Z,{variant:"h3",className:"condensedFont",color:x.WW.screen,children:O})]}),(0,w.jsx)(o.ZP,{container:!0,justifyContent:"space-around",children:(0,w.jsx)(q.Z,{currentSensorsData:D,temperatureUnitPreference:m,isScreen:!0,size:Z.l.large,showWeather:W!==R.sH,showHeatIndex:W!==R.sH,showLastUpdate:W===R.sH})}),(0,w.jsx)(L,{typeOfScreen:H,data:D})]})}),(0,w.jsxs)(o.ZP,{item:!0,xs:6,sx:{order:h?0:1},children:[(0,w.jsx)(i.Z,{sx:{position:"absolute",top:0,right:!h&&0,left:h&&0,width:"5vw",height:"5vw",m:1},children:(0,w.jsx)(c.Z,{})}),(0,w.jsxs)(o.ZP,{container:!0,alignContent:"space-between",justifyContent:"center",height:"100%",textAlign:"center",children:[(0,w.jsxs)(o.ZP,{item:!0,xs:12,sx:{pt:3,px:2},children:[(0,w.jsx)(l.Z,{variant:"h2",sx:{color:"black"},children:R.DE}),W===R.sH&&(0,w.jsxs)(l.Z,{variant:"h5",color:"text.secondary",children:[(0,v.i0)(C.screen.content.dataProvider,I),": AirQo"]})]}),(0,w.jsx)(o.ZP,{item:!0,xs:2,children:(0,w.jsx)(i.Z,{height:"auto",width:"90%",children:(0,w.jsx)(U,{})})}),(0,w.jsx)(o.ZP,{item:!0,xs:12,height:"70%",className:"condensedFont",sx:{"& *":{fontWeight:"600 !important"}},children:(0,w.jsx)(b,{data:D})})]})]})]})}}}]);
//# sourceMappingURL=275.67541583.chunk.js.map