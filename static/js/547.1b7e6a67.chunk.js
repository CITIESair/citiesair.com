"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[547],{35429:(e,t,a)=>{a.d(t,{Z:()=>g});var r=a(72791),n=a(697),o=a(20890),l=a(53540),i=a(64377),s=a(80223),d=a(62070),c=a(19132),u=a(25878),h=a(80184);const p="Explanation of the US Air Quality Index (AQI) for PM2.5",x="CITIESair uses the <a href='https://www.airnow.gov/aqi/aqi-basics/'>Air Quality Index (AQI)</a> developed by the United States Environmental Protection Agency (EPA) to effectively communicate different levels of PM2.5 air pollution. To calculate the AQI from the raw measurement of PM2.5 concentration (\xb5g/m\xb3), different breakpoints and piecewise linear function are utilized (read more <a href='https://en.wikipedia.org/wiki/Air_quality_index#United_States'>here</a>). Higher AQI values correspond to poorer air quality and greater heath risks to humans.<br><br>The US EPA sets thresholds for PM2.5 concentration, recently updated in February 2024: <sup>[1]</sup><ul><li><b>Annual average</b>: 9.0 \xb5g/m\xb3, corresponding to US AQI <b>50</b></li><li><b>24-hour average</b>: 35.0 \xb5g/m\xb3, corresponding to US AQI <b>100</b></li></ul>In 2021, the World's Heath Organization (WHO) proposed a new guideline for PM2.5<sup>[2]</sup> with stricter thresholds than those of the US EPA:<ul><li><b>Annual average</b>: 5.0 \xb5g/m\xb3, corresponding to US AQI <b>21</b></li><li><b>24-hour average</b>: 15.0 \xb5g/m\xb3, corresponding to US AQI <b>56</b></li></ul>",m='[1] "National Ambient Air Quality Standards (NAAQS) for PM." EPA, Environmental Protection Agency, https://www.epa.gov/pm-pollution/national-ambient-air-quality-standards-naaqs-pm.<br>[2] World Health Organization. "WHO global air quality guidelines: particulate matter (PM2. 5 and PM10), ozone, nitrogen dioxide, sulfur dioxide and carbon monoxide: executive summary." (2021).',g=()=>{const{themePreference:e}=(0,r.useContext)(c.p);return(0,h.jsx)(d.Z,{title:p,icon:(0,h.jsx)(u.Z,{sx:{fontSize:"1rem"}}),content:(0,h.jsxs)(n.Z,{children:[(0,h.jsx)(s.Z,{themePreference:e}),(0,h.jsx)(o.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mt:2},children:(0,l.ZP)(x,{replace:i.T1})}),(0,h.jsx)(d.Z,{title:"Reference",content:(0,h.jsx)(o.Z,{variant:"caption",color:"text.secondary",children:(0,l.ZP)(m,{replace:i.T1})})})]})})}},80223:(e,t,a)=>{a.d(t,{Z:()=>b});var r=a(66934),n=a(79836),o=a(697),l=a(56890),i=a(35855),s=a(53994),d=a(53382),c=a(53540),u=a(64377),h=a(44709),p=a(72791),x=a(19132),m=a(41212),g=a(80184);const v=(0,r.ZP)(n.Z,{shouldForwardProp:e=>"tiny"!==e})((e=>{let{theme:t,tiny:a}=e;return{minWidth:a||700,"& th, td":{fontSize:a?"0.625rem":"0.6875rem",color:t.palette.text.secondary,[t.breakpoints.down("sm")]:{fontSize:a?"0.5rem":"0.6875rem"}},"& th":{fontWeight:500,color:t.palette.text.primary,lineHeight:"1rem"}}}));const b=function(e){const{themePreference:t,language:a}=(0,p.useContext)(x.p),{tiny:r,hideAQIDescription:n}=e,b=(e,t)=>t===1/0?"".concat(e,"+"):"".concat(e," - ").concat(t);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(o.Z,{overflow:"auto",children:(0,g.jsxs)(v,{size:"small",tiny:r,children:[(0,g.jsx)(l.Z,{children:(0,g.jsxs)(i.Z,{children:[(0,g.jsx)(s.Z,{sx:{pr:0},children:(0,g.jsx)(o.Z,{sx:{width:"1em",height:"1em"}})}),(0,g.jsx)(s.Z,{sx:{pl:1},children:"Category"}),(0,g.jsx)(s.Z,{align:"right",children:"US AQI"}),(0,g.jsxs)(s.Z,{align:"right",children:["PM2.5 (\xb5g/m",(0,g.jsx)("sup",{children:"3"}),")"]}),!n&&(0,g.jsx)(s.Z,{align:"left",children:"Description"}),!n&&(0,g.jsxs)(s.Z,{align:"left",children:[m.DE,"' Suggested Actions"]})]})}),(0,g.jsx)(d.Z,{children:h._R.map(((e,r)=>(0,g.jsxs)(i.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,g.jsx)(s.Z,{sx:{pr:0},children:(0,g.jsx)(o.Z,{sx:{width:"1em",height:"1em",backgroundColor:e.color[t]}})}),(0,g.jsx)(s.Z,{sx:{pl:1},children:(0,u.i0)(e.category,a)}),(0,g.jsx)(s.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:b(e.aqiUS.low,e.aqiUS.high)}),(0,g.jsx)(s.Z,{align:"right",sx:{whiteSpace:"nowrap"},children:b(e.rawPM2_5.low,e.rawPM2_5.high)}),!n&&(0,g.jsx)(s.Z,{align:"left",children:e.description}),!n&&(0,g.jsx)(s.Z,{align:"left",children:(0,c.ZP)((0,u.i0)(e.healthSuggestions.outdoors,a),{replace:u.T1})})]},r)))})]})})})}},62070:(e,t,a)=>{a.d(t,{Z:()=>b});var r=a(72791),n=a(66934),o=a(40911),l=a(55818),i=a(3721),s=a(697),d=a(20068),c=a(20890),u=a(26759),h=a(47438),p=a(80184);const x=(0,n.ZP)(o.Z)((e=>{let{theme:t,expanded:a}=e;return{color:t.palette.text.secondary,backgroundImage:"none",backgroundColor:a?t.palette.background.default:"transparent",boxShadow:a?t.shadows:"none",transition:"none"}})),m=(0,n.ZP)(l.Z)((e=>{let{theme:t,expanded:a}=e;return{marginTop:a?t.spacing(1):0,flexDirection:"row-reverse",paddingLeft:a?t.spacing(1):0,"& .MuiTypography-root":{color:t.palette.text.primary,textDecoration:"underline",transition:"none","&:hover":{color:t.palette.primary.main}},"& .MuiAccordionSummary-content.Mui-expanded":{marginTop:t.spacing(1),marginBottom:t.spacing(1)}}})),g="Click to expand section",v="Click to collapse section",b=e=>{const{title:t,content:a,icon:n,disabled:o}=e,[l,b]=(0,r.useState)(void 0);return(0,p.jsx)(s.Z,{sx:{"& .MuiAccordion-root.Mui-disabled":{backgroundColor:"transparent"}},children:(0,p.jsxs)(x,{expanded:"panel1"===l,onChange:(y="panel1",(e,a)=>{b(a?y:void 0),h.y(a?h.z.expandSection:h.z.collapseSection,{section:t})}),disabled:o,children:[(0,p.jsx)(m,{expanded:l,expandIcon:(0,p.jsx)(u.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,p.jsx)(d.Z,{title:l?v:g,enterDelay:0,leaveDelay:200,children:(0,p.jsxs)(c.Z,{component:"a",variant:"body1",children:[t,(0,p.jsx)(s.Z,{component:"span",sx:{ml:.25},children:n})]})})}),(0,p.jsx)(i.Z,{sx:{pt:0},children:a})]})});var y}},61745:(e,t,a)=>{a.d(t,{Z:()=>l});var r=a(20890),n=a(47047),o=a(80184);function l(e){let{text:t,sx:a,...l}=e;return(0,o.jsx)(r.Z,{variant:"h4",color:"text.primary",sx:{fontWeight:"medium",display:"block",textTransform:"uppercase",pb:3,lineHeight:1,...a},...l,children:t||(0,o.jsx)(n.Z,{variant:"text"})})}},50899:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_r});var r=a(72791),n=a(66934),o=a(697),l=a(5022),i=a(95193),s=a(36314),d=a(43896),c=a(65117),u=a(20890),h=a(47047),p=a(81131),x=a(67761),m=a(41009),g=a(63867),v=a(47896),b=a(83165),y=a(26084),f=a(61889),j=a(13967),w=a(68096),Z=a(99321),S=a(94454),D=a(19055),_=a(9955),k=a(81918),C=a(3746),T=a(80184);const A="Display All Series",P=48,I=8;function M(e){const{items:t,selectorID:a,allowMultiple:n,seriesLabel:o,onSeriesSelection:i,displayChip:d=!0}=e,c=(0,j.Z)(),h={PaperProps:{style:{maxHeight:5.55*P+I,overflow:"visible !important",background:c.palette.customAlternateBackground}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null},[p,x]=(0,r.useState)(t),[m,g]=(0,r.useState)(n);(0,r.useEffect)((()=>{x(t)}),[t]),(0,r.useEffect)((()=>{g(p.every((e=>e.selected)))}),[p]);const v=e=>{const{target:{value:t}}=e;if(t.includes(A)){const e=p.map(((e,t)=>({...e,selected:0==t||!m})));i({newDataColumns:e}),g(!m)}else{const e=p.filter((e=>t.includes(e.label))),a=p.map((t=>({...t,selected:e.some((e=>e.label===t.label))})));i({newDataColumns:a}),g(!1)}},b=e=>{const t=p.map((t=>t.label===e.label?{...t,selected:!t.selected}:t));i({newDataColumns:t})};return(0,T.jsxs)(s.Z,{spacing:1,direction:"row",alignItems:"center",children:[(0,T.jsx)(w.Z,{sx:{[c.breakpoints.down("sm")]:{width:"100%"},minWidth:"200px","& .MuiInputBase-root":{borderRadius:"".concat(c.shape.borderRadius,"px")}},size:"small",children:(0,T.jsxs)(Z.Z,{labelId:"".concat(a,"-label"),id:a,multiple:n,value:p.filter((e=>e.selected)).map((e=>e.label)),onChange:v,MenuProps:h,renderValue:e=>(e=>(0,T.jsxs)(s.Z,{direction:"row",alignItems:"center",spacing:.5,children:[(0,T.jsx)(C.Z,{fontSize:"1.5rem",sx:{color:c.palette.text.secondary}}),(0,T.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:n?"".concat(e.length,"/").concat(p.length," ").concat(o||""," displayed"):e})]}))(e),sx:{fontSize:"0.75em"},children:[p.map((e=>(0,T.jsxs)(l.Z,{disabled:!(1!==p.filter((e=>e.selected)).length||!e.selected),value:e.label,sx:{backgroundColor:"unset !important","&:hover":{backgroundColor:"inherit !important"}},children:[n?(0,T.jsx)(S.Z,{checked:e.selected,onClick:()=>b(e),sx:{p:.25,transform:"scale(0.8)"}}):(0,T.jsx)(D.Z,{checked:e.selected,onChange:()=>v(e),sx:{p:.25,transform:"scale(0.8)"}}),(0,T.jsx)(u.Z,{variant:"caption",children:e.label})]},e.label))),n?(0,T.jsx)(l.Z,{value:A,sx:{borderTop:"solid 0.5px",borderColor:c.palette.text.secondary,position:"sticky",bottom:0,zIndex:1,marginBottom:c.spacing(-1),background:c.palette.customAlternateBackground,"&:hover":{background:c.palette.customAlternateBackground}},children:(0,T.jsxs)(s.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between",children:[(0,T.jsx)(u.Z,{fontWeight:500,variant:"caption",sx:{pl:1},children:A}),(0,T.jsx)(_.Z,{checked:m,onClick:()=>b(A),sx:{transform:"scale(0.8)"}})]})},A):null]})}),d&&n&&(0,T.jsx)(f.ZP,{container:!0,spacing:1,sx:{[c.breakpoints.down("sm")]:{display:"none"}},children:p.filter((e=>e.selected)).map((e=>(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(k.Z,{label:(0,T.jsx)(u.Z,{variant:"caption",children:e.label}),size:"small",...1!==p.filter((e=>e.selected)).length&&{onDelete:()=>b(e)}})},e.label)))})]})}const E={CategoryFilter:{position:"top",stackDirection:"column"},DateRangeFilter:{position:"bottom",stackDirection:"column-reverse"},ChartRangeFilter:{position:"bottom",stackDirection:"column-reverse"},NumberRangeFilter:{position:"top",stackDirection:"column"}},z=()=>Math.random().toString(36).substr(2,9),O={stem:{length:0},textStyle:{opacity:0},boxStyle:null},R=e=>{let{isPortrait:t,isSmaller:a}=e;return a?t?6:8:t?8:10},W=e=>{var t,a,r,n,o,l,i,s,d,c,u,h,p,x,m,g,v,b,y,f,j,w,Z,S,D,_,k,C,T,A,P,I,M,E,z,O,W,L,F,B,V,H,N,Y,U,q,G,Q,X;const{chartData:K,subchartIndex:$,isPortrait:J,theme:ee}=e,te={italic:!1,bold:!0,color:ee.palette.chart.axisTitle,fontSize:R({isPortrait:J})},ae={color:ee.palette.chart.axisText,fontSize:R({isPortrait:J})};let re=null!==(t=K.subcharts)&&void 0!==t&&t[$].options?{...K.subcharts[$].options}:{};if(re={...re,...K.options,theme:"material",curveType:re.curveType||(null===(a=K.options)||void 0===a?void 0:a.curveType)||"function",crosshair:{orientation:"both",trigger:"focus",opacity:.5},backgroundColor:{fill:(null===(r=K.options)||void 0===r||null===(n=r.backgroundColor)||void 0===n?void 0:n.fill)||"transparent"},chartArea:{...null===(o=K.options)||void 0===o?void 0:o.chartArea,width:J?(null===(l=K.options)||void 0===l||null===(i=l.chartArea)||void 0===i||null===(s=i.width)||void 0===s?void 0:s.portrait)||"80%":(null===(d=K.options)||void 0===d||null===(c=d.chartArea)||void 0===c||null===(u=c.width)||void 0===u?void 0:u.landscape)||"75%",height:J?(null===(h=K.options)||void 0===h||null===(p=h.chartArea)||void 0===p||null===(x=p.height)||void 0===x?void 0:x.portrait)||"60%":(null===(m=K.options)||void 0===m||null===(g=m.chartArea)||void 0===g||null===(v=g.height)||void 0===v?void 0:v.landscape)||"70%"},width:J?(null===(b=K.options)||void 0===b||null===(y=b.width)||void 0===y?void 0:y.portrait)||"100%":(null===(f=K.options)||void 0===f||null===(j=f.width)||void 0===j?void 0:j.landscape)||"100%",height:K.height||"100%",tooltip:{isHtml:!0,showColorCode:!1},legend:{alignment:J?"center":"start",position:null!==(w=null===(Z=K.options)||void 0===Z||null===(S=Z.legend)||void 0===S?void 0:S.position)&&void 0!==w?w:J?"top":"right",scrollArrows:{activeColor:ee.palette.chart.axisTitle,inactiveColor:ee.palette.text.secondary},pagingTextStyle:{fontSize:10,color:ee.palette.chart.axisTitle,bold:!0}}},re.vAxis={...re.vAxis,format:null!==(D=null===(_=re.vAxis)||void 0===_?void 0:_.format)&&void 0!==D?D:"decimal",title:null!==(k=null===(C=re.vAxis)||void 0===C?void 0:C.title)&&void 0!==k?k:"",viewWindow:{min:null!==(T=null===(A=re.vAxis)||void 0===A||null===(P=A.viewWindow)||void 0===P?void 0:P.min)&&void 0!==T?T:0,max:null!==(I=null===(M=re.vAxis)||void 0===M||null===(E=M.viewWindow)||void 0===E?void 0:E.max)&&void 0!==I?I:null,max:null!==(z=null===(O=re.vAxis)||void 0===O||null===(W=O.viewWindow)||void 0===W?void 0:W.max)&&void 0!==z?z:null}},re.hAxis={...re.hAxis,title:null!==(L=null===(F=re.hAxis)||void 0===F?void 0:F.title)&&void 0!==L?L:""},J&&(re.hAxis={...re.hAxis,slantedText:!0,slantedTextAngle:30}),"string"!==typeof re.colors&&re.colors||(re.colors=ee.palette.chart.optionsColors[re.colors||"multiColor"]),re.series&&Object.values(re.series).forEach((e=>{const t=e;"default"===t.color&&(t.color=ee.palette.primary.main)})),re.trendlines&&re.trendlines.forEach((e=>{e.color=ee.palette.primary.main})),re.colorAxis)switch(re.colorAxis.colors){case"matchingColor":re.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.chart.optionsColors.multiColor[re.colorAxis.colorIndex]];break;case"default":re.colorAxis.colors=[ee.palette.chart.colorAxisFirstColor,ee.palette.NYUpurple];break;default:try{re.colorAxis=ee.palette.chart.colorAxes[re.colorAxis.colors]}catch{re.colorAxis=[]}}return re.vAxis={...re.vAxis,titleTextStyle:te,textStyle:ae,gridlines:{...null===(B=re.vAxis)||void 0===B?void 0:B.gridlines,color:(null===(V=re.vAxis)||void 0===V||null===(H=V.gridlines)||void 0===H?void 0:H.color)||ee.palette.chart.gridlines},minorGridlines:{count:0}},re.hAxis={...re.hAxis,titleTextStyle:te,textStyle:ae,gridlines:{...null===(N=re.hAxis)||void 0===N?void 0:N.gridlines,color:(null===(Y=re.hAxis)||void 0===Y||null===(U=Y.gridlines)||void 0===U?void 0:U.color)||ee.palette.chart.gridlines},minorGridlines:{...null===(q=re.hAxis)||void 0===q?void 0:q.minorGridlines,color:(null===(G=re.hAxis)||void 0===G||null===(Q=G.gridlines)||void 0===Q?void 0:Q.color)||ee.palette.chart.gridlines}},re.legend={...re.legend,textStyle:ae},re.annotations={...re.annotations,highContrast:!0,textStyle:{color:ee.palette.primary.contrastText,fontSize:R({isPortrait:J,isSmaller:!0}),opacity:.8},stem:{...null===(X=re.annotations)||void 0===X?void 0:X.stem,color:ee.palette.chart.axisTitle,thickness:2},boxStyle:{rx:ee.shape.borderRadius,ry:ee.shape.borderRadius,fill:ee.palette.chart.annotationBoxFill,fillOpacity:.5}},J&&(re.pointSize=0),re},L=e=>{var t;const{chartControl:a,mainChartData:r,mainChartOptions:n,subchartIndex:o,theme:l,isPortrait:i}=e;let s={...null===(t=a.options)||void 0===t?void 0:t.ui,snapToData:!0};return"ChartRangeFilter"===a.controlType&&(s={...s,chartType:r.chartType,chartView:{columns:r.columns||r.subcharts&&r.subcharts[o].columns||null},chartOptions:{...n,hAxis:{...n.hAxis,textPosition:"out",textStyle:{color:l.palette.chart.axisText,fontSize:R({isPortrait:i,isSmaller:!0})},title:null},vAxis:{...n.vAxis,title:null},annotations:O,legend:null,pointSize:0}}),s},F=e=>{let{controlWrapper:t,chartID:a}=e;const r=e=>{var t=e.changedTouches[0],a="";switch(e.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var r=new MouseEvent(a,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,button:0,relatedTarget:null});t.target.dispatchEvent(r),e.preventDefault()};let n=!0;if(!t)return;const o=document.querySelector("#control-".concat(a));return o?(["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.addEventListener(e,r,{capture:!0})})),()=>{n=!1,["touchstart","touchmove","touchend","touchcancel"].forEach((e=>{o.removeEventListener(e,r,{capture:!0})}))}):void 0},B=(0,n.ZP)(o.Z,{shouldForwardProp:e=>"gradientBackgroundId"!==e&&"isPortrait"!==e})((e=>{let{theme:t,isPortrait:a,gradientBackgroundId:r}=e;return{"& svg>g:nth-of-type(2)>rect:first-of-type":{fill:"url(#".concat(r,")"),fillOpacity:1,filter:"contrast(0.4) brightness(1.4)"},"& .google-visualization-tooltip, .nivo-tooltip":{width:"unset !important",maxWidth:"350px",height:"unset",padding:"1em",boxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",mozBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",webkitBoxShadow:"0px 2px 2px 0px rgba(204, 204, 204, 0.6)",border:"solid 1px",borderColor:t.palette.text.secondaryRGB,fontSize:"".concat(a?9:12,"px"),color:t.palette.chart.tooltip.text,background:t.palette.chart.tooltip.background,borderRadius:t.shape.borderRadius,"& ul":{margin:"0 !important","& li":{margin:"0 !important",padding:"0 !important","& span":{fontSize:"".concat(a?9:12,"px !important"),color:"".concat(t.palette.chart.tooltip.text," !important")}}}},"& .goog-menuitem-highlight, .goog-menuitem-hover":{backgroundColor:"".concat(t.palette.primary," !important")},"& .google-visualization-controls-categoryfilter":{fontSize:"0.85rem",marginTop:"0.75rem",marginBottom:"-0.75rem","& .goog-inline-block > .goog-menu-button":{marginTop:0},"& .goog-menu-button-hover .goog-menu-button-outer-box, .goog-menu-button-hover .goog-menu-button-inner-box":{borderColor:"inherit !important"},"& .google-visualization-controls-label":{color:t.palette.text.secondary,fontWeight:500,verticalAlign:"middle",marginBottom:"0.25rem"},"& .goog-menu-button-outer-box":{backgroundColor:t.palette.background.paper,border:"unset","& .goog-menu-button-inner-box":{paddingTop:t.spacing(.5),paddingBottom:t.spacing(.5),paddingLeft:t.spacing(2),paddingRight:t.spacing(2),border:"solid",borderWidth:"0.5px",borderRadius:t.shape.borderRadius,borderColor:t.palette.text.secondary,"& .goog-menu-button-caption":{color:t.palette.text.secondary}}}},"& .google-visualization-controls-rangefilter":{width:"100%",fontSize:"0.75rem","& .goog-inline-block":{width:"100%"},"& .google-visualization-controls-slider-horizontal":{width:"90%",margin:"0 5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(1)":{position:"absolute",top:"1.5em",left:"5%"},"& .google-visualization-controls-rangefilter-thumblabel:nth-of-type(2)":{position:"absolute",top:"1.5em",right:"5%"},"& .google-visualization-controls-slider-handle":{background:t.palette.primary.main},"& .google-visualization-controls-rangefilter-thumblabel":{color:t.palette.text.secondary,padding:0,fontWeight:500},"& .google-visualization-controls-slider-thumb":{background:t.palette.primary.main,border:"unset",borderRadius:t.shape.borderRadius}},'& path[stroke-opacity="0.3"], path[stroke-opacity="0.1"], path[stroke-opacity="0.05"], rect[stroke-opacity]':{stroke:t.palette.text.primary,strokeWidth:3},"& [column-id]:not(:empty)":{cursor:"pointer",":hover":{fontWeight:600}}}}));var V=a(6694),H=a(18970),N=a(64377);const Y=e=>{let{colors:t,optionalMinValue:a,optionalMaxValue:r}=e;if(!(0,N.qt)(t))return[{color:"#fff",offset:0},{color:"#fff",offset:1}];if("string"===typeof t[0]){const e=t.length;return t.map(((t,a)=>({color:t,offset:a/(e-1)})))}{let e=t;a&&(e=t.filter((e=>e.offset>=a))),r&&(e=t.filter((e=>e.offset<=r)));const n=e.map((e=>e.offset)),o=(e=>{let{offsets:t,minOffset:a,maxOffset:r}=e;return t.map((e=>(e-a)/(r-a)))})({offsets:n,minOffset:a||Math.min(...n),maxOffset:r||Math.max(...n)});return e.map(((e,t)=>({color:e.color,offset:o[t]})))}};function U(e,t,a){return"#"+[e,t,a].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function q(e,t,a){if(e.every(((e,a)=>e===t[a])))return e;let r=e.slice();for(let n=0;n<3;n++)r[n]=Math.round(r[n]+a*(t[n]-e[n]));return r}const G=e=>{let{colors:t,numSteps:a=100}=e;const r=Y({colors:t});r.forEach((e=>{e.color=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,a,r){return t+t+a+a+r+r}));const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[null,null,null]}(e.color)}));let n=[];const o=Array.from({length:a},((e,t)=>t/(a-1)));for(let l=0;l<o.length;l++){const e=o[l];let t,a,i,s;for(let n=0;n<r.length-1;n++)if(e>=r[n].offset&&e<=r[n+1].offset){t=r[n].color,a=r[n+1].color,i=r[n].offset,s=r[n+1].offset;break}const d=q(t,a,(e-i)/(s-i));n.push(U(...d))}return n},Q=e=>{let{gradientDirection:t,colors:a,optionalMinValue:r,optionalMaxValue:n}=e;const o=Y({colors:a,optionalMinValue:r,optionalMaxValue:n});return"linear-gradient(".concat(t,", ").concat(o.map((e=>"".concat(e.color," ").concat(100*e.offset,"%"))).join(", "),")")},X=e=>{let{colors:t,optionalMinValue:a,optionalMaxValue:r}=e;return Y({colors:t,optionalMinValue:a,optionalMaxValue:r}).map((e=>({color:e.color,offset:100*e.offset+"%"})))},K=e=>{let{id:t,colors:a}=e;return(0,T.jsx)("svg",{width:0,height:0,visibility:"hidden",children:(0,T.jsx)("defs",{children:(0,T.jsx)("linearGradient",{id:t,x1:"0",y1:"1",x2:"0",y2:"0",children:a.map(((e,t)=>(0,T.jsx)("stop",{offset:e.offset,stopColor:e.color},t)))})})})},$=e=>{let{title:t,valueRange:a,colorAxis:r,isPortrait:n}=e;const l=(0,j.Z)();if(null===(null===a||void 0===a?void 0:a.min)||null===(null===a||void 0===a?void 0:a.max))return null;const{colors:i,minValue:s,maxValue:d}=r;let c=s,h=d;void 0===s&&(c=a.min),void 0===d&&(h=a.max),a.min<c&&(c=a.min),a.max>h&&(h=a.max);const p=e=>"".concat((e-c)/(h-c)*100,"%"),x={position:"absolute",fontSize:"0.75rem",color:l.palette.text.secondary,lineHeight:1,textAlign:"center",transform:"translateX(-50%)",minWidth:"75px",whiteSpace:"nowrap"},m={bottom:"-1.25rem",transform:n?"translateX(-100%)":"translateX(-50%)"},g={position:"absolute",width:0,height:0,borderLeft:"0.25rem solid transparent",borderRight:"0.25rem solid transparent",transform:"translateX(-50%)"},v={top:"-0.5rem",borderTop:"0.25rem solid ".concat(l.palette.text.secondary)},b={bottom:"-0.5rem",borderBottom:"0.25rem solid ".concat(l.palette.text.secondary)};return(0,T.jsxs)(o.Z,{sx:{position:"sticky",width:"fit-content",my:4,float:"right",right:n?"0":"50px"},children:[(0,T.jsx)(u.Z,{sx:{display:"inline",position:"absolute",textAlign:"right",transform:"translateX(calc(-100% - 0.5rem))",fontSize:"0.75rem",lineHeight:1.25,fontWeight:500,color:"text.secondary"},children:t}),(0,T.jsxs)(o.Z,{sx:{background:Q({gradientDirection:"to right",colors:i,optionalMaxValue:h}),color:l.palette.text.secondary,border:"1px solid ".concat(l.palette.text.secondary),width:n?"250px":"300px",height:"1rem",position:"relative",justifyContent:"space-between"},children:[(0,T.jsxs)("span",{style:{...x,top:"-1.5rem",transform:"translateX(-50%)",left:p(a.min)},children:["min: ",Math.round(a.min)]}),(0,T.jsxs)("span",{style:{...x,...m,left:p(a.max)},children:["max: ",Math.round(a.max)]}),(0,T.jsx)("div",{style:{...g,...v,left:p(a.min)}}),(0,T.jsx)("div",{style:{...g,...b,left:p(a.max)}})]})]})};var J=a(53540);const ee=e=>{let{day:t,color:a,tooltipText:n,dateRange:l,inFirstTwoRowsOfChart:i}=e;const s=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(s.current&&i(t,l)){const e=s.current.parentElement;e&&(e.style.top="11vh")}}),[s,i]),(0,T.jsxs)(o.Z,{ref:s,className:"nivo-tooltip",children:[(0,T.jsx)(k.Z,{sx:{backgroundColor:a,mr:.5,height:"10px",width:"10px",borderRadius:"50%"}}),(0,J.ZP)(n,{replace:N.T1})]})},te=e=>e?{top:30,right:0,bottom:20,left:20}:{top:30,right:40,bottom:20,left:40},ae=e=>{var t,a,n,l,i;const{dataArray:s,valueRangeBoxTitle:d,isPortrait:c,options:u,windowSize:h}=e,[p,x]=(0,r.useState)({min:null,max:null}),[m,g]=(0,r.useState)({min:null,max:null}),[v,b]=(0,r.useState)(400);(0,r.useEffect)((()=>{if(!(0,N.qt)(s))return;const e=(e=>({min:e.reduce(((e,t)=>t<e?t:e)),max:e.reduce(((e,t)=>t>e?t:e))}))(s.map((e=>e.day)));x(e);const t=s.map((e=>e.value));g((e=>({min:Math.min(...e),max:Math.max(...e)}))(t));const a=new Date(e.max).getFullYear()-new Date(e.min).getFullYear()+1,r=te(c),n=a*(7*Math.min(h[0]/60,20)+40)+r.top+r.bottom;b(n)}),[s,h]);const y=(null===u||void 0===u||null===(t=u.legend)||void 0===t?void 0:t.position)&&"none"!==u.legend.position,f=te(c),w=(0,j.Z)(),Z=(e,t)=>{const a=new Date(e),r=a.getDay(),n=0===r||1===r,o=new Date(t.min).getFullYear(),l=a.getFullYear()===o;return n&&l},S=G({colors:null===u||void 0===u||null===(a=u.colorAxis)||void 0===a?void 0:a.colors,numSteps:null===u||void 0===u||null===(n=u.colorAxis)||void 0===n?void 0:n.gradientSteps});return(0,T.jsxs)(B,{isPortrait:c,className:"Calendar",position:"relative",minWidth:"550px",height:"100%",children:[y?(0,T.jsx)($,{title:d,valueRange:m,colorAxis:null===u||void 0===u?void 0:u.colorAxis,isPortrait:c}):null,(0,T.jsx)(o.Z,{sx:{height:"".concat(v,"px"),maxHeight:"450px",overflowY:"auto",width:"100%",position:"relative"},children:(0,T.jsx)(o.Z,{sx:{height:"".concat(v,"px"),position:"absolute",width:"100%"},children:(0,T.jsx)(H.DQ,{data:s,from:p.min,to:p.max,emptyColor:"transparent",align:"top",theme:{text:{fill:w.palette.text.secondary},fontSize:"0.75rem"},colors:S,minValue:null===u||void 0===u||null===(l=u.colorAxis)||void 0===l?void 0:l.minValue,maxValue:null===u||void 0===u||null===(i=u.colorAxis)||void 0===i?void 0:i.maxValue,margin:f,yearSpacing:40,monthBorderColor:w.palette.text.primary,monthBorderWidth:1,daySpacing:.25,dayBorderWidth:0,tooltip:e=>{let{day:t,value:a,color:r}=e;const n=s.find((e=>e.day===t)),o=n?(l=n.tooltip,(new DOMParser).parseFromString(l,"text/html").body.innerHTML):"";var l;return(0,T.jsx)(ee,{day:t,color:r,tooltipText:o,dateRange:p,inFirstTwoRowsOfChart:Z})}})})})]})};var re=a(7161),ne=(a(42978),a(666),a(13239)),oe=a(35527),le=a(42755),ie=a(3874),se=a(4531),de=a(87210),ce=a(62573);const ue=new Date,he={label:"Last 14d",range:()=>({startDate:(0,le.b)((0,ie.E)(ue,-14)),endDate:(0,se.i)(ue)})},pe={label:"Last 30d",range:()=>({startDate:(0,le.b)((0,ie.E)(ue,-30)),endDate:(0,se.i)(ue)})},xe={label:"Last 365d",range:()=>({startDate:(0,le.b)((0,ie.E)(ue,-365)),endDate:(0,se.i)(ue)})},me=e=>{let{minDateOfDataset:t}=e;const a=(0,de.WU)(t,"MMM yyyy");return{label:"All Time (".concat(a," - Now)"),range:()=>({startDate:t,endDate:(0,se.i)(ue)})}},ge=e=>{let{minDateOfDataset:t,aggregationType:a}=e;switch(a){case ce.Z.day:return[pe,xe];case ce.Z.month:case ce.Z.year:return[me({minDateOfDataset:t})];default:return[he,pe]}},ve={[ce.Z.hour]:{maxDays:30,label:"Hourly"},[ce.Z.day]:{maxDays:365,label:"Daily"},[ce.Z.month]:{maxDays:1/0,label:"Monthly"},[ce.Z.year]:{maxDays:1/0,label:"Yearly"}},be=(0,n.ZP)(oe.Z,{shouldForwardProp:e=>"showPickerPanel"!==e&&"smallScreen"!==e})((e=>{let{theme:t,showPickerPanel:a,smallScreen:r}=e;return{zIndex:!0===a&&1,position:"relative",padding:a?t.spacing(1):0,margin:a&&!r?t.spacing(-1):0,maxWidth:"100%",background:a?t.palette.customAlternateBackground:"transparent",boxShadow:!1===a&&"none","& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary},"& .rdrDateDisplayWrapper, .rdrCalendarWrapper, .rdrDefinedRangesWrapper, .rdrStaticRange, .rdrDateDisplayItem":{background:"transparent"},"& .rdrDateInput":{borderRadius:t.shape.borderRadius,boxShadow:"none"},"& .rdrDateDisplayItemActive":{border:!1===a&&"none"},"& .rdrDateDisplay":{margin:0,minWidth:"20rem"},"& .rdrDateDisplayItem":{margin:0,borderRadius:a?t.shape.borderRadius:0,"&:hover:not(.rdrDateDisplayItemActive)":{border:a?"1px solid ".concat(t.palette.action.disabled):"none"}},"& .rdrDateDisplayItem:hover:not(.rdrDateDisplayItemActive)":{border:!1===a&&"1px solid transparent"},"& .rdrDateDisplayItem + .rdrDateDisplayItem":{margin:0},"& .rdrDateDisplayItem:first-of-type":{borderRight:!1===a&&"1px solid ".concat(t.palette.action.disabled," !important")},"& .rdrMonthAndYearWrapper, .rdrInputRanges":{display:!1===a&&"none !important",padding:0},"& .rdrMonthName":{display:"none"},"& .rdrDefinedRangesWrapper, .rdrMonths":{display:!1===a&&"none"},"&  .rdrInfiniteMonths":{visibility:!1===a&&"hidden",width:"100% !important",maxWidth:"675px",margin:"auto"},"& .rdrDateDisplayWrapper":{minWidth:"18rem",borderRadius:t.shape.borderRadius,border:a?"none":"1px solid ".concat(t.palette.action.disabled),"&:hover":{border:a?"none":"1px solid ".concat(t.palette.text.primary)}},"& .rdrDateRangePickerWrapper":{width:"100%",flexDirection:"column-reverse"},"& .rdrStaticRanges":{flexDirection:"row",minWidth:"21rem"},"& .rdrStaticRangeLabel":{color:t.palette.text.secondary,borderRadius:t.shape.borderRadius,padding:"".concat(t.spacing(.5)," ").concat(t.spacing(1))},"& .rdrDefinedRangesWrapper":{border:"none",width:"100%"},"& .rdrNextPrevButton":{background:t.palette.primary.main,borderRadius:t.shape.borderRadius,opacity:1,"&:hover":{opacity:.5,background:t.palette.primary.main}},"& .rdrNextPrevButton > i":{color:"white"},"& .rdrNextButton > i":{borderColor:"transparent transparent transparent white"},"& .rdrPprevButton > i":{borderColor:"transparent white transparent transparent"},"& .rdrStaticRange":{border:"none"},"& .rdrStaticRangeSelected > .rdrStaticRangeLabel, .rdrMonthAndYearPickers":{color:t.palette.primary.main},"& .rdrMonthAndYearPickers":{fontSize:"1rem"},"& .rdrStaticRange:hover .rdrStaticRangeLabel, .rdrStaticRange:focus .rdrStaticRangeLabel":{background:t.palette.customBackground.toString()},"& .rdrDayNumber span":{color:t.palette.text.primary.toString()},"& .rdrDayPassive .rdrDayNumber span":{opacity:.5},"& .rdrMonthAndYearWrapper select":{color:t.palette.text.secondary.toString(),background:"none",padding:"".concat(t.spacing(1)," ").concat(t.spacing(2)),"&:hover":{border:"1px solid ".concat(t.palette.text.secondary)}},"& .rdrDateDisplayItem input":{color:t.palette.text.secondary},"& .rdrDayDisabled":{backgroundColor:t.palette.customBackground},"& .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfMonth .rdrStartEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge, .rdrEndEdge, .rdrDayEndOfMonth .rdrDayInPreview, .rdrDayEndOfMonth .rdrDayStartPreview, .rdrDayEndOfWeek .rdrDayInPreview, .rdrDayEndOfWeek .rdrDayStartPreview, .rdrDayEndPreview":{borderTopRightRadius:"2rem",borderBottomRightRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfWeek .rdrEndEdge, .rdrDayStartOfMonth .rdrDayInPreview, .rdrDayStartOfMonth .rdrDayEndPreview, .rdrDayStartOfWeek .rdrDayInPreview, .rdrDayStartOfWeek .rdrDayEndPreview, .rdrDayStartPreview":{borderTopLeftRadius:"2rem",borderBottomLeftRadius:"2rem"},"& .rdrStartEdge, .rdrDayStartOfWeek .rdrInRange, .rdrDayStartOfMonth .rdrInRange, .rdrDayStartOfMonth .rdrEndEdge, .rdrDayStartOfWeek .rdrEndEdge":{left:0},"& .rdrEndEdge, .rdrDayEndOfWeek .rdrInRange, .rdrDayEndOfMonth .rdrInRange, .rdrDayEndOfWeek .rdrStartEdge":{right:0},"& .rdrSelected, .rdrInRange, .rdrStartEdge, .rdrEndEdge":{top:"0px",bottom:"0px"},"& .rdrMonths":{justifyContent:"center",alignItems:"center"},"& .rdrDay":{marginBottom:"1px","& span":{top:"0px",bottom:"0px"}},"& .rdrMonthsHorizontal":{overflowY:"hidden"},"& .rdrDateInput:first-of-type:before":{content:'""',backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' class='MuiSvgIcon-root' focusable='false' aria-hidden='true' viewBox='0 0 24 24' data-testid='DateRangeIcon'%3E%3Cpath d='M9 11H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V9h14z' fill='".concat(t.palette.text.secondary,"'/%3E%3C/svg%3E\")"),width:"0.75rem",height:"0.75rem",display:"block",position:"absolute",top:"50%",transform:"translateY(-50%)",left:"0.75rem"},"& .rdrStaticRangeSelected span":{color:t.palette.primary.main},"& .rdrDayToday .rdrDayNumber span:after":{background:t.palette.secondary.main,width:"0.25rem",height:"0.25rem",borderRadius:"50%"}}})),ye=e=>{let{startDateObject:t,endDateObject:a}=e;return{startDate:(0,de.WU)(t,"yyyy-MM-dd"),endDate:(0,de.WU)(a,"yyyy-MM-dd")}};var fe=a(77997),je=a(40630);function we(e){let{aggregationType:t,setAggregationType:a}=e;return(0,T.jsx)(fe.Z,{color:"primary",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&a(t)},"aria-label":"aggregation type toggle for graph average",size:"small",fullWidth:!0,sx:{height:"100%"},children:Object.values(ce.Z).map((e=>{var t;return(0,T.jsx)(je.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25,py:.5},value:e,"aria-label":e,children:(null===(t=ve[e])||void 0===t?void 0:t.label)||""},e)}))})}var Ze=a(2165),Se=a(33026);const De=(0,r.createContext)(),_e={startDate:null,endDate:null,key:"selection"};function ke(e){let{children:t}=e;const[a,n]=(0,r.useState)(_e),[o,l]=(0,r.useState)(ce.Z.hour),i=(0,r.useMemo)((()=>({dateRange:a,setDateRange:n,aggregationType:o,setAggregationType:l})),[a,o]);return(0,T.jsx)(De.Provider,{value:i,children:t})}const Ce=()=>(0,r.useContext)(De);var Te=a(35552),Ae=a(63501);const Pe=v.aT.findIndex((e=>e===v.Xh.historical)),Ie=e=>{const{enqueueSnackbar:t}=(0,Te.Ds)(),{minDateOfDataset:a,dataType:n}=e,{currentSchoolID:l,setIndividualChartData:s}=(0,r.useContext)(b.G),d=new Date,c=(0,j.Z)(),u=(0,i.Z)(c.breakpoints.down("sm")),{dateRange:h,setDateRange:p,aggregationType:x,setAggregationType:y}=Ce();(0,r.useEffect)((()=>{var e;const{startDate:a,endDate:r}=h||{};a&&r&&((0,Ze.K)(a,r)||((0,Se.j)(r,a)>(null===(e=ve[x])||void 0===e?void 0:e.maxDays)?t("".concat(ve[x]," average is limited to max ").concat(maxAllowedDays,"d"),Ae.P.error):A()))}),[h]);const[w,Z]=(0,r.useState)(),[S,D]=(0,r.useState)(!1),_=(0,r.useRef)(null),[k,C]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=e=>{_.current&&!_.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[_]),(0,r.useEffect)((()=>{x||y(ce.Z.hour);const e={...ge({aggregationType:x||ce.Z.hour,minDateOfDataset:a})[0].range(),key:"selection"};p(e),A(e)}),[x]);const A=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||h;if(!e||!e.startDate||!e.endDate)return;const a=ye({startDateObject:e.startDate,endDateObject:e.endDate}),r=(0,g.kq)({endpoint:v.Xh.historical,school_id:l,aggregationType:x,dataType:n,startDate:a.startDate,endDate:a.endDate});r!==w&&(C(!0),(0,m.d)({url:r}).then((e=>{C(!1),D(!1),s(Pe,e),Z(r)})).catch((e=>{C(!1),t("Error fetching historical data, please try again",Ae.P.error),console.log(e)})))};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(f.ZP,{item:!0,alignItems:S?"start":"stretch",xs:12,sm:"auto",children:(0,T.jsx)(we,{aggregationType:x,setAggregationType:y,smallScreen:u})}),(0,T.jsx)(f.ZP,{item:!0,sx:{height:"2rem",width:{[c.breakpoints.down("sm")]:{width:"100%"}}},children:(0,T.jsxs)(be,{showPickerPanel:S,smallScreen:u,ref:_,elevation:8,onClick:()=>D(!0),sx:{position:"relative"},children:[(0,T.jsx)(o.Z,{sx:{filter:k&&S?"blur(2px)":"none",pointerEvents:k?"none":"auto",transition:"filter 0.2s ease-in-out"},children:(0,T.jsx)(re.Dw,{ranges:[h],onChange:e=>{e&&p(e.selection)},staticRanges:(0,re.$z)(ge({minDateOfDataset:a,aggregationType:x})),inputRanges:[],rangeColors:[c.palette.primary.main,c.palette.secondary.main,c.palette.text.secondary],minDate:a,maxDate:d,months:1,showMonthAndYearPickers:!0,direction:"horizontal",fixedHeight:!0,preventSnapRefocus:!0,startDatePlaceholder:"Start Date",endDatePlaceholder:"End Date",editableDateInputs:!0,showMonthArrow:!0,weekStartsOn:1})}),k&&(0,T.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.5)",zIndex:10},children:(0,T.jsx)(ne.Z,{disableShrink:!0,size:S?"2.5rem":"1.25rem",color:"primary"})})]})})]})};var Me=a(94925),Ee=a(94294);const ze=(0,r.createContext)();function Oe(e){let{children:t}=e;const[a,n]=(0,r.useState)(),[o,l]=(0,r.useState)(),i=(0,r.useMemo)((()=>({hAxis:a,setHAxis:n,vAxis:o,setVAxis:l})),[a,o]);return(0,T.jsx)(ze.Provider,{value:i,children:t})}const Re=()=>(0,r.useContext)(ze),We=v.aT.findIndex((e=>e===v.Xh.correlationDailyAverage)),Le=(0,n.ZP)(w.Z)((e=>{let{theme:t}=e;return{borderTopRightRadius:0,borderBottomRightRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopRightRadius:0,borderBottomRightRadius:0},"& .MuiOutlinedInput-notchedOutline":{borderRight:"none"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderRight:"2px solid ".concat(t.palette.primary.main)}}})),Fe=(0,n.ZP)(w.Z)((e=>{let{theme:t}=e;return{borderTopLeftRadius:0,borderBottomLeftRadius:0,textTransform:"capitalize",minWidth:"150px",maxWidth:"250px","& .MuiOutlinedInput-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0}}})),Be=e=>{const{currentSchoolID:t,setIndividualChartData:a}=(0,r.useContext)(b.G),{allowedAxes:n,selectedAxes:o,dataType:i}=e,{hAxis:d,vAxis:c,setHAxis:u,setVAxis:h}=Re(),[p,x]=(0,r.useState)(),[y,j]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!0);(0,r.useEffect)((()=>{const{hAxis:e,vAxis:t}=o;e&&t?d===e&&c===t||(h(t),u(e)):S(!0)}),[o,d,c,u,h]);(0,r.useEffect)((()=>{const{hAxis:e,vAxis:t}=o;e&&t&&S(d===e&&c===t)}),[d,c,o]);const D=e=>!e.allowedDataTypes.includes(i);return(0,T.jsxs)(f.ZP,{container:!0,item:!0,spacing:1,alignItems:"center",children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,sm:"auto",children:(0,T.jsxs)(s.Z,{direction:"row",spacing:0,children:[(0,T.jsxs)(Le,{fullWidth:!0,size:"small",children:[(0,T.jsx)(Me.Z,{id:"x-axis-select-label",children:"X Axis"}),(0,T.jsx)(Z.Z,{labelId:"x-axis-select-label",value:d||(null===o||void 0===o?void 0:o.hAxis)||null,label:"X Axis",onChange:e=>{const t=e.target.value;u(t),t===c&&h("")},autoWidth:!0,children:null===n||void 0===n?void 0:n.map((e=>(0,T.jsxs)(l.Z,{value:e.sensor,disabled:e.sensor===c||D(e),sx:{textTransform:"capitalize"},children:[e.sensor,D(e)&&" (No Data)"]},e.sensor)))})]}),(0,T.jsxs)(Fe,{fullWidth:!0,size:"small",children:[(0,T.jsx)(Me.Z,{id:"y-axis-select-label",children:"Y Axis"}),(0,T.jsx)(Z.Z,{labelId:"y-axis-select-label",value:c||(null===o||void 0===o?void 0:o.vAxis)||null,label:"Y Axis",onChange:e=>{h(e.target.value),e.target.value===d&&u("")},autoWidth:!0,children:null===n||void 0===n?void 0:n.map((e=>(0,T.jsxs)(l.Z,{value:e.sensor,disabled:e.sensor===d||D(e),sx:{textTransform:"capitalize"},children:[e.sensor,D(e)&&" (No Data)"]},e.sensor)))})]})]})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,sm:"auto",children:(0,T.jsx)(Ee.Z,{variant:"contained",color:"primary",fullWidth:!0,sx:{height:"100%"},onClick:()=>{if(!c||!d)return;const e=(0,g.Qo)({endpoint:v.Xh.correlationDailyAverage,school_id:t,dataType:i,sensorX:d,sensorY:c});e!==p&&(j(!0),(0,m.d)({url:e}).then((t=>{a(We,t),x(e),j(!1)})).catch((e=>{console.log(e)})))},disabled:w,children:y?(0,T.jsx)(ne.Z,{disableShrink:!0,size:"1.4375rem",color:"inherit"}):"APPLY"})})]})};var Ve=a(19658);const He=e=>{let{dataType:t,height:a,selectableAxes:r}=e,n="This sensor ",l=" data. Choose a different sensor or data type.";return r&&(n="This pair of sensors ",l=" correlation data. Choose another pair or a different data type."),(0,T.jsx)(o.Z,{height:a,children:(0,T.jsxs)(Ve.Z,{severity:"error",sx:{my:2},children:[n,"does not have\xa0",(0,T.jsx)(o.Z,{component:"span",textTransform:"capitalize",children:t}),l]})})};function Ne(e){var t;const{chartData:a,subchartIndex:n,windowSize:l,isPortrait:i,height:d,maxHeight:c,selectedDataType:u,allowedDataTypes:h}=e,p=(0,r.useContext)(y.R),[m,g]=(0,r.useState)(),[v,b]=(0,r.useState)(),[w,Z]=(0,r.useState)(),[S,D]=(0,r.useState)(),_=(0,j.Z)(),[k,C]=(0,r.useState)(!0),[A,P]=(0,r.useState)(!0),[I,O]=(0,r.useState)(!1),[R,H]=(0,r.useState)(),[Y,U]=(0,r.useState)(),[q,G]=(0,r.useState)(),[Q,$]=(0,r.useState)(z()),J=(0,r.useMemo)((()=>W({...e,theme:_})),[e,_,a.chartType]),[ee,te]=(0,r.useState)(null);if("Calendar"===a.chartType)return(0,r.useEffect)((()=>{const e=a.dataArray||a.subcharts&&a.subcharts[n].dataArray||null;(0,N.qt)(e)?(te(e),P(!0)):P(!1)}),[a]),ee?A?(0,T.jsx)(ae,{dataArray:ee,valueRangeBoxTitle:(0,x.UT)({dataTypeKey:u,dataTypes:h,showUnit:!0}),isPortrait:i,options:J,windowSize:l}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(He,{dataType:(0,x.UT)({dataTypeKey:u,dataTypes:h})}),(0,T.jsx)(ae,{dataArray:[],valueRangeBoxTitle:(0,x.UT)({dataTypeKey:u,dataTypes:h,showUnit:!0}),isPortrait:i,options:J,windowSize:l})]}):(0,T.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,T.jsx)(V.Z,{})});let re,ne=!1,oe=a.control||(null===(t=a.subcharts)||void 0===t?void 0:t[n].control);oe&&(ne=!0,re={...oe.options,ui:L({chartControl:oe,mainChartData:a,mainChartOptions:J,subchartIndex:n,theme:_,isPortrait:i})},"ChartRangeFilter"===oe.controlType&&(0,r.useEffect)((()=>F({controlWrapper:w,chartID:Q})),[w]));const le=J.seriesSelector||!1,ie=J.dateRangePicker||null,se=J.formatters||null;let de=a.selectableAxes||null;de&&(0,N.qt)(de.allowedAxes)&&de.allowedAxes.length<=2&&(de=null),(0,r.useEffect)((()=>{le?he({newDataColumns:Y}):(null===v||void 0===v||v.setOptions({...J}),null===v||void 0===v||v.draw(),ne&&(null===w||void 0===w||w.setOptions(re),null===w||void 0===w||w.draw()))}),[_,i,l]),(0,r.useEffect)((()=>{Y&&le&&"setViewColumn"==le.method&&(ce({dataColumns:Y}),he({newDataColumns:Y}))}),[_]);const ce=e=>{let{dataColumns:t}=e;t.forEach((e=>{var t;e.color=J.colors[e.seriesIndex%J.colors.length],e.serieAttribute=null===(t=J.series)||void 0===t?void 0:t[e.seriesIndex]}))},ue=e=>{let t,a,{dataTable:r,allInitialColumns:n}=e;return n.forEach(((e,n)=>{if(0===n)return;const o=r.getColumnRange(e.sourceColumn);!isNaN(o.min)&&o.min&&(t=t?Math.min(t,o.min):o.min),!isNaN(o.max)&&o.max&&(a=a?Math.max(a,o.max):o.max)})),{min:t,max:a}},he=(0,r.useCallback)((e=>{let{newDataColumns:t,_allInitialColumns:a=R,_chartWrapper:r=v,_controlWrapper:n=w}=e;if(a){if(U(t),"toggleVisibility"===le.method||null===le.method){const e={};if(t.forEach((t=>{t.selected||(e[t.seriesIndex]={color:"transparent",enableInteractivity:!1,visibleInLegend:!1})})),null===r||void 0===r||r.setOptions({...J,series:{...J.series,...e}}),ne){const t=null===n||void 0===n?void 0:n.getOptions();null===n||void 0===n||n.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,series:{...J.series,...e}}}})}}else if("setViewColumn"===le.method){let e=[];e.push(0),t.forEach((t=>{if(t.selected&&(e.push(t),(0,N.qt)(a)))for(let r=t.indexIn_+1;r<a.length&&"data"!==a[r].role;r++)e.push(a[r])})),null===r||void 0===r||r.setView({columns:e});const o={...J};o.colors=t.filter((e=>e.selected)).map((e=>e.color));const l={};let i=0;if(t.forEach((e=>{e.selected&&(null!=e.serieAttribute&&(l[i]=e.serieAttribute),i++)})),o.series=l,null===r||void 0===r||r.setOptions(o),ne){const t=null===n||void 0===n?void 0:n.getOptions();null===n||void 0===n||n.setOptions({...t,ui:{...t.ui,chartOptions:{...t.ui.chartOptions,colors:o.colors,series:o.series},chartView:{columns:e}}})}}null===r||void 0===r||r.draw(),ne&&(null===n||void 0===n||n.draw())}}),[R,J,le,v,w,q,ne]);(0,r.useEffect)((()=>{if(p&&a){if(JSON.stringify(a)===JSON.stringify(S))return;D(a);const e=a.dataArray||a.subcharts&&a.subcharts[n].dataArray||null,t=(0,N.qt)(e);if(P(t),!0===t){O(!0);const t=p.visualization.arrayToDataTable(e);if(se&&"object"===typeof se&&se.hasOwnProperty("numberFormatter")){const e=new p.visualization.NumberFormat(se.numberFormatter.numberFormat);se.numberFormatter.columns.forEach((a=>e.format(t,a)))}g(t)}}}),[p,a]),(0,r.useEffect)((()=>{if(!0===I){const e=(e=>{if(!e)return;const t=[];for(const a of e)if("number"===typeof a)t.push(a);else if("object"===typeof a)if(a.calc&&"stringify"!==a.calc){const e=new Function("dataTable","rowNum",a.calc);t.push({...a,calc:e})}else t.push(a);return t})(a.columns||a.subcharts&&a.subcharts[n].columns||null),t=new p.visualization.ChartWrapper({chartType:a.chartType,dataTable:ne?void 0:m,options:J,view:{columns:e},containerId:Q});let r;if(b(t),ne){const e=new p.visualization.Dashboard(document.getElementById("dashboard-".concat(Q)));p.visualization.events.addListener(e,"ready",fe),r=new p.visualization.ControlWrapper({controlType:oe.controlType,options:re,containerId:"control-".concat(Q)}),Z(r),e.bind(r,t),e.draw(m)}else p.visualization.events.addListener(t,"ready",fe),t.draw();if(le){const{initAllInitialColumns:e,initDataColumns:a}=(e=>{let{chartWrapper:t,dataTable:a,seriesSelector:r}=e;var n=t.getView();if(null==n.columns){const e=new p.visualization.DataView(a);t.setView({columns:e.columns}),n=t.getView()}let o=!0,l=0;const i=n.columns.map(((e,t)=>("number"===typeof e&&(e={role:o?"domain":"data",sourceColumn:e}),e.label=a.getColumnLabel(e.sourceColumn),e.indexInAllInitialColumns=t,o=o&&!1,"data"===e.role&&(r.defaultSeriesToDisplayInitially?r.defaultSeriesToDisplayInitially.includes(t)?e.selected=!0:e.selected=!1:r.allowMultiple?e.selected=!0:e.selected=0===l,e.seriesIndex=l,l++),e)));H(i);const s=ue({dataTable:a,allInitialColumns:i});G(s);const d=i.filter((e=>{var t,a;return"data"===e.role&&!1!==(null===(t=J.series)||void 0===t||null===(a=t[e.seriesIndex])||void 0===a?void 0:a.visibleInLegend)}));return"setViewColumn"===r.method&&ce({dataColumns:d}),U(d),{initAllInitialColumns:i,initDataColumns:d}})({chartWrapper:t,dataTable:m,seriesSelector:le});he({_allInitialColumns:e,newDataColumns:a,_chartWrapper:t,_controlWrapper:r})}O(!1)}}),[I]);const pe=J.gradientBackgroundColor;let xe,me;var ge,ve,be,ye;pe&&(xe="".concat(Q,"-backgroundGradient"),me=X({colors:_.palette.chart.colorAxes[pe].colors,optionalMinValue:null===(ge=J.vAxis)||void 0===ge||null===(ve=ge.viewWindow)||void 0===ve?void 0:ve.min,optionalMaxValue:null===(be=J.vAxis)||void 0===be||null===(ye=be.viewWindow)||void 0===ye?void 0:ye.max}));const fe=()=>{k&&C(!1)};return A?(0,T.jsxs)(B,{isPortrait:i,gradientBackgroundId:xe,className:a.chartType,position:"relative",height:"100%",minHeight:"Calendar"===a.chartType&&"200px",children:[k&&(0,T.jsx)(o.Z,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:(0,T.jsx)(V.Z,{})}),k?null:(0,T.jsxs)(f.ZP,{container:!0,mt:1,sx:{gap:2,[_.breakpoints.down("sm")]:{gap:1}},children:[le&&(0,T.jsx)(f.ZP,{item:!0,xs:"auto",sx:{[_.breakpoints.down("sm")]:{width:"100%"}},children:(0,T.jsx)(M,{items:Y,allowMultiple:le.allowMultiple,seriesLabel:le.seriesLabel,selectorID:"".concat(a.title,"-selector"),onSeriesSelection:he,displayChip:!1})}),ie&&(0,T.jsx)(f.ZP,{container:!0,item:!0,xs:"auto",justifyContent:"stretch",sx:{gap:2,[_.breakpoints.down("sm")]:{gap:1,width:"100%"}},children:(0,T.jsx)(Ie,{dataType:u,minDateOfDataset:new Date(ie.minDate)})}),de&&(0,T.jsx)(Be,{allowedAxes:de.allowedAxes,selectedAxes:de.selectedAxes,dataType:u})]}),(()=>{const e=(0,T.jsx)(o.Z,{id:Q,sx:{height:d,maxHeight:c}});var t;return ne?(0,T.jsxs)(s.Z,{id:"dashboard-".concat(Q),direction:(null===(t=E[oe.controlType])||void 0===t?void 0:t.stackDirection)||"column-reverse",sx:{height:"100%"},children:[(0,T.jsx)(o.Z,{id:"control-".concat(Q),sx:{height:"calc(".concat(d," / 8)"),opacity:.8,filter:"saturate(0.3)"}}),e]}):e})(),pe?(0,T.jsx)(K,{id:xe,colors:me}):null]}):(0,T.jsxs)(T.Fragment,{children:[de&&(0,T.jsx)(o.Z,{mt:1,children:(0,T.jsx)(Be,{allowedAxes:de.allowedAxes,selectedAxes:de.selectedAxes,dataType:u})}),(0,T.jsx)(He,{dataType:(0,x.UT)({dataTypeKey:u,dataTypes:h}),selectableAxes:de,height:le||ne?1.2*parseFloat(d)+"vw":d})]})}var Ye=a(53767);const Ue=function(e){let{text:t,wordLimit:a=40,reference:n}=e;const[l,s]=(0,r.useState)(!1),d=(0,j.Z)(),c=(0,i.Z)(d.breakpoints.down("sm")),h=(0,r.useRef)(null),p=t.split(" ");if(!c||p.length/a<=1.4)return(0,T.jsxs)(o.Z,{children:[(0,T.jsx)(u.Z,{children:(0,J.ZP)(t,{replace:N.T1})}),n&&(0,T.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:(0,J.ZP)(n,{replace:N.T1})})]});let x=p.slice(0,a).join(" ");const m=x.lastIndexOf(".");return-1!==m&&(x=x.slice(0,m+1)),(0,T.jsx)(Ye.d,{onClickAway:e=>{(e=>{let{target:t}=e;const a=h.current.closest(".MuiContainer-root"),r=new Set(["rect","path","svg","circle"]);for(;null!=t;){if(r.has(t.tagName))return t.closest(".MuiContainer-root")===a;t=t.parentNode}return!1})(e)||s(!1)},children:(0,T.jsx)(o.Z,{ref:h,onClick:()=>s(!l),style:{cursor:"pointer"},children:l?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(u.Z,{children:(0,J.ZP)(t,{replace:N.T1})}),n&&(0,T.jsx)(u.Z,{variant:"caption",color:"text.secondary",children:(0,J.ZP)(n,{replace:N.T1})})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(u.Z,{display:"inline",children:[(0,J.ZP)(x,{replace:N.T1}),"..."]}),(0,T.jsx)(u.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})};var qe=a(26759);const Ge=e=>{let{selectedDataType:t,dataTypes:a,fetchChartDataType:n}=e;const[o,i]=(0,r.useState)(null);if(!(0,N.qt)(a))return null;if(a.length<=1)return(0,T.jsx)(u.Z,{display:"inline",variant:"h6",color:"text.primary",children:a[0].name_title});const s=Boolean(o),d=()=>{i(null)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Ee.Z,{id:"data-type-drop-down-menu-button","aria-controls":s?"data-type-drop-down-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:e=>{i(e.currentTarget)},variant:"text",size:"small",sx:{p:0,minWidth:"unset",borderRadius:0,verticalAlign:"top",textTransform:"unset"},children:[(0,T.jsx)(u.Z,{display:"inline",variant:"h6",borderBottom:"dotted",children:(0,x.UT)({dataTypeKey:t,dataTypes:a,showUnit:!0})}),(0,T.jsx)(qe.Z,{})]}),(0,T.jsx)(c.Z,{id:"data-type-drop-down-menu",anchorEl:o,open:s,onClose:d,MenuListProps:{"aria-labelledby":"data-type-drop-down-menu-button"},children:a.map(((e,t)=>(0,T.jsx)(l.Z,{sx:{fontSize:"0.8rem"},onClick:()=>(e=>{n(e),d()})(e.key),children:e.name_title},t)))})]})};var Qe=a(25228);const Xe=(0,n.ZP)(Qe.Z,{shouldForwardProp:e=>"smallFontSize"!==e})((e=>{let{theme:t,smallFontSize:a="0.625rem"}=e;return{"& .MuiTabScrollButton-root":{color:t.palette.text.primary},"& .MuiTab-root":{[t.breakpoints.down("sm")]:{fontSize:a,padding:t.spacing(.5)}},"& .MuiSvgIcon-root ":{[t.breakpoints.down("sm")]:{fontSize:"1rem"}}}})),Ke=(0,n.ZP)(o.Z)((e=>{let{theme:t}=e;return{..."dark"===t.palette.mode&&{filter:"saturate(0.85)","& .heat-map-iframe":{filter:"invert(0.848) hue-rotate(180deg)"}},"& .Calendar [dir]:not(:empty)":{margin:"auto"},"& .Calendar > div > div:last-of-type > div":{overflowX:"auto",overflowY:"hidden",scrollbarGutter:"stable"}}})),$e=(0,n.ZP)(l.Z)((e=>{let{theme:t}=e;return{"& .MuiBox-root ":{[t.breakpoints.down("sm")]:{fontSize:"0.75rem"}}}}));const Je=function(e){const{chartTitle:t,generalChartSubtitle:a,generalChartReference:n,chartData:l,chartHeight:y,chartID:f,chartIndex:j}=e,{currentSchoolID:w,setIndividualChartData:Z}=(0,r.useContext)(b.G),S=(0,i.Z)((e=>e.breakpoints.down("sm"))),[D,_]=(0,r.useState)(window.matchMedia("(orientation: portrait)").matches),[k,A]=(0,r.useState)([window.innerWidth,window.innerHeight]);let P,I=y;const M=l,[E,z]=(0,r.useState)(0),[O,R]=(0,r.useState)(0),[W,L]=(0,r.useState)(-1),[F,B]=(0,r.useState)(),[V,H]=(0,r.useState)(null),[Y,U]=(0,r.useState)([]),[q,G]=(0,r.useState)(null),{dateRange:Q,aggregationType:X}=Ce(),{hAxis:K,vAxis:$}=Re();return(0,r.useEffect)((()=>{if(M.allowedDataTypes){const e=[];for(let t of M.allowedDataTypes){const{name_title:a,name_short:r,unit:n}=x.oS[t];e.push({key:t,name_title:a,name_short:r,unit:n})}U(e)}G(M.selectedDataType)}),[M]),(0,r.useEffect)((()=>{let e=null;const t=()=>{clearTimeout(e),e=setTimeout((()=>{_(window.matchMedia("(orientation: portrait)").matches),A([window.innerWidth,window.innerHeight])}),100)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[M]),(0,r.useEffect)((()=>{R(E),z(0)}),[w]),"Calendar"===M.chartType||I||(I=D?"80vw":"35vw",P=D?"800px":"500px"),t?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(o.Z,{children:[(0,T.jsxs)(u.Z,{display:"inline",variant:"h6",color:"text.primary",children:[j+1,". ",t,"\xa0"]}),(0,T.jsx)(o.Z,{display:"inline",children:(0,T.jsx)(Ge,{selectedDataType:q,dataTypes:Y,fetchChartDataType:async e=>{const t=v.aT[f];let a;if(t===v.Xh.historical){const{startDate:r,endDate:n}=Q||{};if(!r||!n)return;const o=ye({startDateObject:r,endDateObject:n});a=(0,g.kq)({endpoint:t,school_id:w,startDate:o.startDate,endDate:o.endDate,aggregationType:X,dataType:e})}else a=t===v.Xh.correlationDailyAverage?(0,g.Qo)({endpoint:v.Xh.correlationDailyAverage,school_id:w,dataType:e,sensorX:K,sensorY:$}):(0,g.Eh)({endpoint:t,school_id:w,dataType:e});a&&(0,m.d)({url:a}).then((e=>{Z(f,e),G(e.selectedDataType)})).catch((e=>{console.log(e)}))}})})]}),(0,T.jsxs)(Ke,{height:"100%",children:[M.subcharts?(()=>{const e=M.subcharts.length>4,t=e?M.subcharts.slice(0,3):M.subcharts,a=e?M.subcharts.slice(3):null,r=e=>-1===E?O===e:E===e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Xe,{value:E,onChange:(t,a)=>{R(E),z(a),e&&a<3&&a!==W&&(B(),L(-1))},variant:S?"fullWidth":"standard",children:[t.map(((e,t)=>(0,T.jsx)(d.Z,{value:t,label:M.subcharts[t].subchartTitle,sx:{textDecoration:!(0,N.qt)(M.subcharts[t].dataArray)&&"line-through"}},t))),e&&(0,T.jsx)(d.Z,{value:W,label:(0,T.jsxs)(s.Z,{direction:"row",justifyContent:"center",alignItems:"center",children:[(0,T.jsxs)(o.Z,{flex:1,children:["Other sensors",F&&" (".concat(F,")"),"\xa0"]}),(0,T.jsx)(p.Z,{})]}),"aria-controls":"submenu","aria-haspopup":"true",onClick:e=>H(e.currentTarget)})]}),e&&(0,T.jsx)(c.Z,{id:"submenu",anchorEl:V,open:Boolean(V),onClose:()=>{-1===E&&(R(E),z(O)),H(null)},children:a.map(((e,t)=>(0,T.jsx)($e,{selected:t===E-3,onClick:()=>(e=>{R(E),z(3+e),L(3+e),B(a[e].subchartTitleShort),H(null)})(t),sx:{textDecoration:!(0,N.qt)(M.subcharts[t+3].dataArray)&&"line-through"},children:(0,T.jsxs)(s.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,T.jsx)(o.Z,{children:a[t].subchartTitle}),t===E-3&&(0,T.jsx)(C.Z,{fontSize:"1rem",sx:{color:"text.secondary"}})]})},t)))}),(0,T.jsx)(o.Z,{position:"relative",sx:{overflowX:D&&"auto",WebkitOverflowScrolling:D&&"touch",overflowY:"hidden"},children:M.subcharts.map(((e,t)=>(0,T.jsx)(o.Z,{width:"100%",height:"100%",role:"tabpanel",sx:{transition:"0.35s",position:0===t?"":"absolute",opacity:r(t)?"1":"0",pointerEvents:r(t)?"auto":"none",top:0===t?"":0,overflowX:"auto",overflowY:"hidden"},children:(0,T.jsx)(Ne,{selectedDataType:q,allowedDataTypes:Y,chartData:M,subchartIndex:t,isPortrait:D,windowSize:k,height:M.height?M.height:I,maxHeight:["Calendar"].includes(M.chartType)?"":P,currentSubchart:E})},t)))})]})})():(0,T.jsx)(Ne,{selectedDataType:q,allowedDataTypes:Y,chartData:M,isPortrait:D,windowSize:k,height:M.height?M.height:I}),(0,T.jsx)(o.Z,{sx:{my:3},children:(0,T.jsx)(u.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:(0,T.jsx)(Ue,{text:(()=>{var e;let t=a||"";return M.subcharts&&null!==(e=M.subcharts[E])&&void 0!==e&&e.subchartSubtitle&&(t+="<br/>",t+=M.subcharts[E].subchartSubtitle),t})(),reference:(()=>{var e;let t=n||"";return M.subcharts&&null!==(e=M.subcharts[E])&&void 0!==e&&e.reference&&(t+="<br/>",t+=M.subcharts[E].reference),t})()})})})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.Z,{variant:"text",sx:{width:"100%",fontSize:"2rem"}}),(0,T.jsx)(h.Z,{variant:"rounded",width:"100%",height:300})]})};var et=a(61745),tt=a(89164),at=a(94721),rt=a(30604),nt=a(60173),ot=a(49877),lt=a(55396),it=a(60627),st=a(61162),dt=a(53524),ct=a(47438),ut=a(80223);function ht(e){const[t,a]=(0,r.useState)(null),n=e=>{a(e.currentTarget),ct.y(ct.z.airQualityIndexLegendQuickGlance)},o=()=>{a(null)},l=Boolean(t);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(dt.TF,{...e,distanceFromBottomOfWindow:"5.5rem",children:(0,T.jsx)(ot.Z,{sx:{mt:1},"aria-owns":l?ct.z.airQualityIndexLegendQuickGlance:void 0,"aria-haspopup":"true",onMouseEnter:n,onMouseLeave:o,onClick:e=>nt.tq&&(l?o():n(e)),"aria-label":ct.z.airQualityIndexLegendQuickGlance,color:"primary",children:(0,T.jsxs)(s.Z,{direction:"column",alignItems:"center",children:[(0,T.jsx)(st.Z,{fontSize:"1rem"}),(0,T.jsx)(u.Z,{variant:"body2",fontWeight:"500",children:"AQI"})]})})}),(0,T.jsx)(lt.Z,{id:ct.z.airQualityIndexLegendQuickGlance,sx:{pointerEvents:"none",mt:-1},open:l,anchorEl:t,placement:"top-end",onClose:o,keepMounted:!0,transition:!0,children:e=>{let{TransitionProps:t}=e;return(0,T.jsx)(it.Z,{...t,timeout:350,children:(0,T.jsxs)(oe.Z,{elevation:8,sx:{py:.5,mb:1},children:[(0,T.jsx)(u.Z,{sx:{mx:2,mt:1},color:"text.disabled",variant:"body1",fontWeight:500,children:"AQI at quick glance"}),(0,T.jsx)(ut.Z,{tiny:!0,hideAQIDescription:!0})]})})}})]})}var pt=a(71478),xt=a(16344),mt=a(1414),gt=a(74475),vt=a(26459),bt=a(19132),yt=a(35429),ft=a(41212),jt=a(22981),wt=a(57689),Zt=a(31781);const St=e=>{const{authenticationState:t,user:a}=(0,r.useContext)(Zt.S),n=t.authenticated&&t.checkedAuthentication,{currentSchoolID:o}=(0,r.useContext)(b.G),{enqueueSnackbar:l}=(0,Te.Ds)(),i=(0,r.useCallback)((t=>n?null!==a&&void 0!==a&&a.allowedSchools.some((e=>e.school_id===o))?(null===t||void 0===t||t(),!0):(l("Your account does not have access to ".concat(o.toUpperCase()," Alerts"),Ae.P.error),!1):(null===e||void 0===e||e(),!1)),[n,e,o,a,l]);return{loggedIn:n,handleRestrictedAccess:i}},Dt=e=>{let{onButtonClick:t}=e;const{currentSchoolID:a,schoolMetadata:n}=(0,r.useContext)(b.G),{handleRestrictedAccess:o}=St(t),[i,s]=(0,r.useState)(null),d=(0,wt.s0)();if(!n)return null;const u=n.screens;if(!(0,N.qt)(u))return null;const h=()=>{o((()=>{var e;const t=u&&(null===(e=u[0])||void 0===e?void 0:e.screen_name);d("screen"===t?"/screen/".concat(a):"/screen/".concat(a,"/").concat(t))}))};if(u.length<=1)return(0,T.jsxs)(Ee.Z,{variant:"contained",size:"small",onClick:h,children:[(0,T.jsx)(jt.Z,{sx:{fontSize:"1rem"}}),"\xa0TV Screen"]});const p=Boolean(i);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(Ee.Z,{id:"basic-button","aria-controls":p?"tv-screen-list-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,onClick:e=>{o((()=>s(e.currentTarget)))},variant:"contained",size:"small",children:[(0,T.jsx)(jt.Z,{sx:{fontSize:"1rem"}}),"\xa0 TV Screens"]}),(0,T.jsx)(c.Z,{id:"tv-screen-list-menu",anchorEl:i,open:p,onClose:()=>{s(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:u.map(((e,t)=>(0,T.jsx)(l.Z,{onClick:()=>{return t=e.screen_name,void o((()=>{s(null),d("/screen/".concat(a,"/").concat(t))}));var t},sx:{fontSize:"0.8rem"},children:e.location_long},t)))})]})};var _t=a(50533),kt=a(79836),Ct=a(56890),Tt=a(35855),At=a(53994),Pt=a(53382),It=a(73518),Mt=a(71566),Et=a(20068),zt=a(13400),Ot=a(5289),Rt=a(97123),Wt=a(65661),Lt=a(39157),Ft=a(31009);const Bt=e=>{const{buttonIcon:t,buttonIconAria:a,buttonLabel:n,buttonVariant:o="contained",trackingEvent:l,dialogTitle:s,dialogOpenHandler:d=null,dialogCloseHandler:c=null,displaySchoolID:u=!0,maxWidth:h="lg",children:p,disabled:x}=e;let m;m=!(!t||n);const{currentSchoolID:g}=(0,r.useContext)(b.G),v=(0,i.Z)((e=>e.breakpoints.down("sm"))),[y,f]=(0,r.useState)(!1),w=()=>{d?d((()=>{f(!0),l&&ct.y(l)})):(f(!0),l&&ct.y(l))},Z=()=>{f(!1),c&&c()},S=(0,j.Z)();return(0,T.jsxs)(T.Fragment,{children:[m?(0,T.jsx)(Et.Z,{title:a,children:(0,T.jsx)(zt.Z,{onClick:w,"aria-label":a,size:"small",sx:{"&:hover,:focus":{color:S.palette.primary.main}},disabled:x,children:t})}):(0,T.jsxs)(Ee.Z,{onClick:w,variant:o,disabled:x,size:"small",children:[t,"\xa0",n]}),(0,T.jsxs)(Ot.Z,{open:y,onClose:Z,maxWidth:h,fullWidth:!0,fullScreen:v,keepMounted:!0,children:[(0,T.jsx)(Rt.Z,{sx:{justifyContent:"start"},children:(0,T.jsxs)(Ee.Z,{onClick:Z,children:[(0,T.jsx)(Ft.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,T.jsxs)(Wt.Z,{children:[!0===u?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(k.Z,{label:g?"School: ".concat(g.toUpperCase()):"No School",size:"small",display:"block",sx:{mb:1}}),(0,T.jsx)("br",{})]}):null,s]}),(0,T.jsx)(Lt.Z,{children:p})]})]})};function Vt(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:a}=St(t),{currentSchoolID:n,currentSensorMeasurements:o}=(0,r.useContext)(b.G),[l,i]=(0,r.useState)({}),[s,d]=(0,r.useState)("placeholder");return(0,r.useEffect)((()=>{if(!o)return;const e=o.filter((e=>e&&e.sensor)).reduce(((e,t)=>{var a;return e[t.sensor.location_short]={location_type:t.sensor.location_type,location_short:t.sensor.location_short,location_long:t.sensor.location_long,last_seen:null===(a=t.sensor.last_seen)||void 0===a?void 0:a.split("T")[0],rawDatasets:Object.keys(ce.Z).reverse().reduce(((e,t)=>(e[ce.Z[t]]={sample:null,full:null},e)),{})},e}),{});i(e)}),[o]),(0,T.jsxs)(Bt,{buttonIcon:(0,T.jsx)(Mt.Z,{sx:{fontSize:"1rem"}}),buttonLabel:"Dataset",trackingEvent:ct.z.rawDatasetButtonClicked,dialogTitle:"Preview and download raw dataset(s)",dialogOpenHandler:e=>{d(null),a(e)},children:[(0,T.jsx)(Ht,{sensorsDatasets:l,updateSensorsDatasets:i,previewingDataset:s,setPreviewingDataset:d,schoolID:n}),l&&(0,T.jsxs)(u.Z,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["These datasets are provided by ",ft.DE," from sensors operated by ",ft.DE,". Should you intend to utilize them for your project, research, or publication, we kindly request that you notify us at ",(0,T.jsx)(_t.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})}const Ht=e=>{const{sensorsDatasets:t,updateSensorsDatasets:a,previewingDataset:n,setPreviewingDataset:o,schoolID:l}=e,s=(0,j.Z)(),d=(0,i.Z)(s.breakpoints.down("sm"));return(0,r.useEffect)((()=>{if(Object.keys(t).length>0&&!n){const e=Object.keys(t)[0],r=ce.Z.hour;if(o({sensor:e,datasetType:r}),t[e].rawDatasets[r].sample)return;const n=(0,g.OM)({school_id:l,sensor_location_short:e,aggregationType:r,isSample:!0});(0,m.d)({url:n,extension:v.j.csv,needsAuthorization:!0}).then((n=>{const o={...t};o[e].rawDatasets[r].sample=n,a(o)})).catch((e=>console.log(e)))}}),[t,n]),(0,T.jsxs)(f.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:d?1:2,sx:{mt:0,overflowY:"scroll",overflowX:"hidden"},children:[(0,T.jsx)(f.ZP,{item:!0,sm:12,md:6,children:(0,T.jsx)(Nt,{schoolID:l,sensorsDatasets:t,updateSensorsDatasets:a,smallScreen:d,previewingDataset:n,setPreviewingDataset:o})}),(0,T.jsx)(f.ZP,{item:!0,sm:12,md:6,maxWidth:d?"100%":"unset",sx:{mt:1},children:(0,T.jsx)(Ut,{sensorsDatasets:t,updateSensorsDatasets:a,previewingDataset:n,schoolID:l,smallScreen:d})})]})},Nt=e=>{const{schoolID:t,sensorsDatasets:a,smallScreen:r,previewingDataset:n,setPreviewingDataset:o,updateSensorsDatasets:l}=e;return(0,T.jsxs)(kt.Z,{size:"small",sx:{tableLayout:"fixed"},children:[(0,T.jsx)(Ct.Z,{children:(0,T.jsxs)(Tt.Z,{children:[(0,T.jsx)(At.Z,{sx:{pl:1},children:"Sensor Location"}),(0,T.jsx)(At.Z,{sx:{width:r?"9.5rem":"11rem"},children:"Average Period"})]})}),(0,T.jsx)(Pt.Z,{children:a&&Object.keys(a).map((e=>(0,T.jsx)(Yt,{schoolID:t,smallScreen:r,sensor:e,sensorsDatasets:a,previewingDataset:n,setPreviewingDataset:o,isPreviewing:e===(null===n||void 0===n?void 0:n.sensor),updateSensorsDatasets:l},e)))})]})},Yt=e=>{const{schoolID:t,sensorsDatasets:a,sensor:n,previewingDataset:o,setPreviewingDataset:i,isPreviewing:d,updateSensorsDatasets:c}=e,[u,h]=(0,r.useState)(ce.Z.hour);(0,r.useEffect)((()=>{u!==ce.Z.hour&&h(ce.Z.hour)}),[t]);const p=e=>{if(!a[n].rawDatasets[e].sample){const r=(0,g.OM)({school_id:t,sensor_location_short:a[n].location_short,aggregationType:e,isSample:!0});(0,m.d)({url:r,extension:v.j.csv,needsAuthorization:!0}).then((t=>{const r={...a};r[n].rawDatasets[e].sample=t,c(r)}))}},x=(0,j.Z)();return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)(Tt.Z,{children:[(0,T.jsx)(At.Z,{sx:{pl:1,cursor:"pointer",background:d&&x.palette.background.NYUpurpleLight},onClick:()=>{(null===o||void 0===o?void 0:o.sensor)!==n&&(i({datasetType:u,sensor:n}),p(u))},children:a[n].location_long}),(0,T.jsx)(At.Z,{sx:{position:"relative",background:d&&x.palette.background.NYUpurpleLight},children:(0,T.jsx)(w.Z,{size:"small",children:(0,T.jsx)(Z.Z,{value:u,onChange:e=>{const t=e.target.value;h(t),i({datasetType:t,sensor:n}),p(t)},variant:"standard",MenuProps:{disablePortal:!0},children:Object.keys(a[n].rawDatasets).reverse().map(((e,t)=>(0,T.jsx)(l.Z,{value:e,children:(0,T.jsx)(s.Z,{direction:"row",alignItems:"center",children:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})},t)))})})})]},n)})},Ut=e=>{const{sensorsDatasets:t,updateSensorsDatasets:a,previewingDataset:n,schoolID:l,smallScreen:i}=e,d=(0,j.Z)(),[c,h]=(0,r.useState)("Not previewing any dataset"),[p,x]=(0,r.useState)("No dataset"),[b,y]=(0,r.useState)(!1),f=e=>{const t=new Blob([e],{type:"application/octet-stream"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=p,document.body.appendChild(r),r.click(),URL.revokeObjectURL(a),document.body.removeChild(r)},[w,Z]=(0,r.useState)(""),[S,D]=(0,r.useState)("");return(0,r.useEffect)((()=>{var e,a;if(!n)return;h("Previewing: ".concat(n.sensor," (").concat(n.datasetType,")"));const r=null===(e=t[n.sensor])||void 0===e||null===(a=e.rawDatasets[n.datasetType])||void 0===a?void 0:a.sample;if(!r)return D(null),Z(null),x("Loading..."),void y(!0);b&&y(!1);const o=r.split("\n"),i=o[0].split(","),s=o.slice(1);let d;if(D(["",...s.map((e=>e.split(",")[0]))].join("\n")),Z([i.slice(1).join(","),...s.map((e=>e.split(",").slice(1).join(",")))].join("\n")),s.length>0){const e=s[s.length-1].split(",");if(e.length>=2){d=e[1].split("T")[0]}}const c="".concat(l,"-").concat(n.sensor,"-").concat(n.datasetType,"-").concat(d,".csv");x(c)}),[n,t]),(0,T.jsxs)(s.Z,{spacing:1,children:[(0,T.jsxs)(o.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,T.jsx)(s.Z,{direction:"row",children:(0,T.jsx)(u.Z,{variant:"body2",gutterBottom:!0,fontWeight:500,children:c})}),(0,T.jsx)(o.Z,{component:"pre",sx:{overflowX:"auto",color:d.palette.text.secondary,backgroundColor:d.palette.customBackground,p:2,pt:1.5,borderRadius:1,height:i?"11.8rem":"14rem",width:i?"100%":"unset",marginTop:0},children:(0,T.jsx)(s.Z,{direction:"row",sx:{fontSize:"0.75rem"},children:w?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(o.Z,{sx:{mr:2,userSelect:"none"},children:S}),(0,T.jsx)(o.Z,{children:w})]}):(0,T.jsx)(V.Z,{optionalText:"Loading"})})})]}),(0,T.jsx)(o.Z,{textAlign:"center",children:(0,T.jsxs)(Ee.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:()=>{(()=>{if(!n)return;const e=t[n.sensor].rawDatasets[n.datasetType].full;if(e)f(e);else{const e=(0,g.OM)({school_id:l,sensor_location_short:n.sensor,aggregationType:n.datasetType,isSample:!1});(0,m.d)({url:e,extension:v.j.csv,needsAuthorization:!0}).then((e=>{const r={...t};r[n.sensor].rawDatasets[n.datasetType].full=e,a(r),f(e)}))}})(),ct.y(ct.z.rawDatasetDownloaded,{dataset_type:null===n||void 0===n?void 0:n.datasetType,sensor:null===n||void 0===n?void 0:n.sensor})},disabled:b,children:[(0,T.jsx)(It.Z,{sx:{fontSize:"1.25rem",mr:.5}}),p]})})]})};var qt=a(21805),Gt=a(48550),Qt=a(12600),Xt=a(90772);const Kt={threshold:{id:"threshold",index:0,name:"Threshold",tableColumnHeader:"Threshold",icon:(0,T.jsx)(Qt.Z,{})},daily:{id:"daily",index:1,name:"Daily",tableColumnHeader:"Alert Hour",icon:(0,T.jsx)(Xt.Z,{})}},$t={below_threshold:{id:"below_threshold",sign:"<",name:"below"},above_threshold:{id:"above_threshold",sign:"\u2265",name:"above"}},Jt=Kt,ea=e=>Math.floor(e/60).toString().padStart(2,"0")+":00",ta="ADD",aa="EDIT",ra="DELETE",na="Location",oa="Data Type",la="Days",ia="Created By",sa=Array.from({length:24},((e,t)=>{const a=60*t;return{label:ea(a),value:a}})),da={allday:{id:"allday",label:"All Day",from:sa[0].value,to:sa[sa.length-1].value,fromToLabel:"00-23h"},schoolHour:{id:"schoolHour",label:"School Hour",from:sa[7].value,to:sa[17].value,fromToLabel:"07-17h"},custom:{id:"custom",label:"Custom"}},ca=(0,r.createContext)(),ua={id:"id",alert_type:"alert_type",sensor_id:"sensor_id",location_short:"location_short",datatypekey:"datatypekey",threshold_value:"threshold_value",days_of_week:"days_of_week",minutespastmidnight:"minutespastmidnight",time_range:"time_range",is_enabled:"is_enabled",excluded_dates:"excluded_dates",owner_role:"owner_role",self_is_owner:"self_is_owner",is_allowed_to_modify:"is_allowed_to_modify",message:"message",max_once_a_day:"max_once_a_day",parent_alert_id:"parent_alert_id",child_alert:"child_alert",has_child_alert:"has_child_alert"},ha=function(){let e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jt.daily.id;return a===Jt.threshold.id&&(e=$t.above_threshold.id,t=$t.below_threshold.id),{[ua.id]:"",[ua.alert_type]:e||a,[ua.sensor_id]:"",[ua.datatypekey]:"",[ua.days_of_week]:[0,1,2,3,4],[ua.time_range]:a===Jt.threshold.id?[da.schoolHour.from,da.schoolHour.to]:null,[ua.threshold_value]:-1,[ua.minutespastmidnight]:"",[ua.is_enabled]:!0,[ua.excluded_dates]:[],[ua.message]:"",[ua.max_once_a_day]:!0,[ua.parent_alert_id]:null,[ua.has_child_alert]:!1,[ua.child_alert]:a===Jt.threshold.id?{[ua.alert_type]:t||a,[ua.threshold_value]:-1,[ua.message]:""}:null}};function pa(e){let{children:t}=e;const{schoolMetadata:a,currentSchoolID:n}=(0,r.useContext)(b.G),[o,l]=(0,r.useState)(ha()),[i,s]=(0,r.useState)(o),[d,c]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[p,y]=(0,r.useState)(),[f,j]=(0,r.useState)([]),w=(0,r.useCallback)((e=>{if(!a)return[];const{sensors:t}=a;if(!(0,N.qt)(t))return[];const r=t.find((t=>t.sensor_id===e)),n=null===r||void 0===r?void 0:r.allowedDataTypes;return n?n.map((e=>({value:e,label:x.oS[e].name_title}))):[]}),[a]);(0,r.useEffect)((()=>{s({...o})}),[o]),(0,r.useEffect)((()=>{const e=i[ua.sensor_id];e&&""!==e&&c(w(e))}),[i,w]);const Z=(0,r.useCallback)((function(){const e=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];return e.forEach((t=>{if(!t)return;if(!!t[ua.parent_alert_id]){const a=e.find((e=>e[ua.id]===t[ua.parent_alert_id]));a&&(a[ua.has_child_alert]=!0,a[ua.child_alert]={[ua.id]:t[ua.id],[ua.alert_type]:t[ua.alert_type],[ua.threshold_value]:t[ua.threshold_value],[ua.message]:t[ua.message]})}else{if(t[ua.alert_type]===Jt.daily.id)return;t[ua.has_child_alert]=!1,t[ua.child_alert]={[ua.alert_type]:t[ua.alert_type]===$t.above_threshold.id?$t.below_threshold.id:$t.above_threshold.id,[ua.threshold_value]:t[ua.threshold_value],[ua.message]:""}}})),e}),[]),S=(0,r.useCallback)((()=>{n&&((0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:n})}).then((e=>{(0,N.qt)(e)&&h(Z(e))})).catch((e=>{console.log(e)})),(0,m.d)({url:(0,g.kG)({endpoint:v.eV.alertsEmails,school_id:n}),extension:"json",needsAuthorization:!0}).then((e=>{j(e)})).catch((e=>{(0,Te.yv)("There was an error loading the alert email list, please try again",Ae.P.error)})))}),[n,Z]);(0,r.useEffect)((()=>{n&&y(!1)}),[n,S]);const D=(0,r.useMemo)((()=>({selectedAlert:o,setSelectedAlert:l,editingAlert:i,setEditingAlert:s,allowedDataTypesForSensor:d,setAllowedDataTypesForSensor:c,alerts:u,setAlerts:h,fetchAlerts:S,hasFetchedAlerts:p,setHasFetchedAlerts:y,alertEmails:f,setAlertEmails:j,addChildToAlerts:Z})),[o,i,d,u,S,p,y,f,j,Z]);return(0,T.jsx)(ca.Provider,{value:D,children:t})}const xa=()=>(0,r.useContext)(ca),ma=()=>{const{currentSchoolID:e}=(0,r.useContext)(b.G),{alertEmails:t,setAlertEmails:a}=xa(),{enqueueSnackbar:n}=(0,Te.Ds)(),d=(0,i.Z)((e=>e.breakpoints.down("sm"))),[h,p]=(0,r.useState)([]),[x,y]=(0,r.useState)(!1),[j,w]=(0,r.useState)(""),[Z,S]=(0,r.useState)(null),[D,_]=(0,r.useState)("");(0,r.useEffect)((()=>{p(t)}),[t]),(0,r.useEffect)((()=>{var e,a;y((e=h,a=t,!(JSON.stringify(e)===JSON.stringify(a))))}),[h]),(0,r.useEffect)((()=>{_(x?"Click to save new changes on server":"No changes detected to save")}),[x]);const C=e=>{const t=e.trim().toLowerCase();if((0,N.oH)(t)){const e=[...h,t];if(h.includes(t))return n("Already added: ".concat(t),Ae.P.error),void w("");150===e.length&&n("Maximum number of recipients reached",Ae.P.warning),p(e),w("")}else n("Invalid email address. Valid format: abc@def.xyz",Ae.P.error)},A=e=>{const t=h.filter(((t,a)=>a!==e));p(t)},P=()=>{S(null)};return(0,r.useEffect)((()=>{const e=e=>{h!==t&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[h,t]),(0,T.jsxs)(o.Z,{children:[(0,T.jsxs)(f.ZP,{container:!0,alignItems:"center",wrap:"wrap",children:[(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(u.Z,{variant:"body1",fontWeight:500,sx:{p:0,mb:d&&1,mr:!d&&2},children:"Email Recipients:"})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,lg:!0,sx:{overflowY:"scroll",maxHeight:"300px"},children:(0,T.jsxs)(f.ZP,{container:!0,alignItems:"center",sx:{border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:2,p:.5,flexWrap:"wrap",width:"100%"},children:[h.map(((e,t)=>(0,T.jsx)(f.ZP,{item:!0,sx:{m:.5},children:(0,T.jsx)(k.Z,{label:e,onDelete:()=>A(t),onClick:e=>((e,t)=>{S({index:t,element:e.currentTarget})})(e,t)})},t))),h.length<150?(0,T.jsx)(f.ZP,{item:!0,xs:12,sm:!0,minWidth:"200px",children:(0,T.jsx)(Gt.Z,{fullWidth:!0,variant:"standard",value:j,onChange:e=>{const t=e.target.value;w(t),""!==t&&_("Finalize currently edited email by pressing Enter/Return")},onKeyUp:e=>{["Enter","Spacebar"," "].includes(e.key)&&C(j)},onPaste:e=>{const t=e.clipboardData.getData("text");w(t),C(t),e.preventDefault()},placeholder:"Add recipient",sx:{mx:.5},InputProps:{disableUnderline:!0,style:{textTransform:"lowercase"}}})}):null]})})]}),(0,T.jsxs)(s.Z,{sx:{mt:1},spacing:1,alignItems:d?"stretch":"end",children:[(0,T.jsxs)(s.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",gap:1,children:[(0,T.jsxs)(u.Z,{variant:"caption",display:"block",color:"text.secondary",textAlign:"right",children:[h.length," / ",150," recipient",h.length>1?"s":null," added"]}),(0,T.jsx)(_t.Z,{variant:"caption",sx:{cursor:"pointer"},onClick:e=>{e.preventDefault(),w(""),p([])},children:"Clear All"})]}),0===t.length?(0,T.jsx)(Ve.Z,{severity:"error",sx:{mt:1},children:"The alert(s) above will not be sent unless at least one email recipient is saved"}):null,(0,T.jsx)(Et.Z,{title:D,enterTouchDelay:0,children:(0,T.jsx)("span",{children:(0,T.jsx)(Ee.Z,{onClick:t=>{const r=(0,N.qt)(t)?t:(0,N.qt)(h)?h:[];(0,m.d)({url:(0,g.kG)({endpoint:v.eV.alertsEmails,school_id:e}),restMethod:v.j2.POST,body:r}).then((e=>{a(e),n("Email list saved successfully!",Ae.P.success)})).catch((()=>{n("There was an error saving the email. Please try again.",Ae.P.error)}))},variant:"contained",sx:{width:d?"100%":"fit-content"},disabled:!x,children:"SAVE EMAIL LIST"})})})]}),(0,T.jsx)(c.Z,{anchorEl:null===Z||void 0===Z?void 0:Z.element,open:Boolean(Z),onClose:P,children:(0,T.jsx)(l.Z,{onClick:()=>{var e;e=Z.index,w(h[e]),A(e),P()},children:"Edit"})})]})};var ga=a(13208),va=a(41286),ba=a(51859),ya=a(32467),fa=a.n(ya),ja=a(51691);function wa(e){const{onConfirmedDelete:t}=e,[a,n]=(0,r.useState)(!1),o=(0,j.Z)();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Ee.Z,{variant:"text",color:"error",onClick:()=>{n(!0)},children:"Delete"}),(0,T.jsxs)(Ot.Z,{open:a,onClose:()=>{n(!1)},"aria-labelledby":"alert-deletion-confirmation-dialog-title","aria-describedby":"alert-deletion-confirmation-dialog-description",maxWidth:"xs",children:[(0,T.jsx)(Wt.Z,{id:"alert-deletion-confirmation-dialog-title",children:"Are you sure?"}),(0,T.jsx)(Lt.Z,{children:(0,T.jsx)(ja.Z,{id:"alert-deletion-confirmation-dialog-description",children:"Deletion is permanent. If you simply wish to pause this alert, disable it with the toggle switch instead."})}),(0,T.jsxs)(Rt.Z,{sx:{justifyContent:"end"},children:[(0,T.jsx)(Ee.Z,{onClick:()=>{n(!1)},sx:{color:o.palette.text.secondary},children:"Cancel"}),(0,T.jsx)(Ee.Z,{onClick:()=>{t(),n(!1)},children:"Delete"})]})]})]})}const Za={[ta]:{title:"Add A New Alert",primaryButtonLabel:"Save Alert",errorMessage:"Server error: new alert was not saved. Please try again",successMessage:"New alert added successfully"},[aa]:{title:"Edit Alert",primaryButtonLabel:"Save Edit",errorMessage:"Server error: changes were not saved. Please try again",successMessage:"Changes saved successfully"},[ra]:{title:"Delete Alert",contentText:"Are you sure you want to delete this alert?",primaryButtonLabel:"Delete",errorMessage:"Server error: alert not deleted. Please try again.",successMessage:"Alert deleted successfully"}},Sa=e=>{const{icon:t,label:a,value:r,options:n,handleChange:i,disabled:d,...c}=e,u=(0,j.Z)();return(0,T.jsxs)(s.Z,{direction:"row",gap:t?1:0,alignItems:"center",...c,children:[(0,T.jsx)(o.Z,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:d?u.palette.text.secondary:u.palette.primary.main,verticalAlign:"middle"}},children:t}),(0,T.jsxs)(w.Z,{fullWidth:!0,size:"small",disabled:d,sx:{minWidth:"100px",marginLeft:"0 !important"},children:[(0,T.jsx)(Me.Z,{id:"".concat(a,"-picker-label"),children:a}),(0,T.jsx)(Z.Z,{labelId:"".concat(a,"-picker-label"),id:"".concat(a,"-picker"),value:r,label:a,onChange:i,children:(0,N.qt)(n)&&n.map((e=>(0,T.jsx)(l.Z,{value:e.value,children:e.label},e.value)))})]})]})};var Da=a(69212),_a=a(58562),ka=a(32686);const Ca=e=>{let{value:t,disabled:a,handleChange:n}=e;const l=(0,j.Z)(),[d,c]=(0,r.useState)(!1),[u,h]=(0,N.qt)(t)?t:ha(Jt.threshold.id)[ua.time_range],[p,x]=(0,r.useState)((()=>{const e=Object.values(da).find((e=>e.from===u&&e.to===h));return e?e.id:da.custom.id}));(0,r.useEffect)((()=>{const e=Object.values(da).find((e=>e.from===u&&e.to===h));x(e?e.id:da.custom.id)}),[u,h]);const m=(0,r.useCallback)(((e,t)=>{if(!t)return;x(t);const a=da[t];null!=a.from&&null!=a.to&&n([a.from,a.to]),c(t===da.custom.id)}),[n]),g=(0,i.Z)((e=>e.breakpoints.down("md"))),v=(0,i.Z)((e=>e.breakpoints.down("sm")));return(0,T.jsxs)(s.Z,{direction:"row",alignItems:"start",gap:1,width:"100%",children:[(0,T.jsx)(o.Z,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:a?l.palette.text.secondary:l.palette.primary.main,verticalAlign:"-webkit-baseline-middle"}},children:(0,T.jsx)(ka.Z,{sx:{mt:.75}})}),(0,T.jsxs)(s.Z,{direction:"column",width:"100%",gap:1.5,children:[(0,T.jsx)(fe.Z,{fullWidth:g,color:a?"standard":"primary",value:p,exclusive:!0,onChange:m,size:"small",disabled:a,children:Object.values(da).map(((e,t,a)=>(0,T.jsxs)(je.Z,{value:e.id,"aria-label":e.label,sx:{textTransform:"none",px:1.5,flex:t===a.length-1?1:void 0,lineHeight:v?1.3:void 0},size:"small",children:[e.label,e.fromToLabel&&(v?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("br",{}),e.fromToLabel]}):(0,T.jsxs)(T.Fragment,{children:[" ",e.fromToLabel]}))]},e.id)))}),d?(0,T.jsxs)(s.Z,{direction:"row",flex:1,gap:1,children:[(0,T.jsx)(Sa,{label:"From",value:u,options:sa,disabled:a||"custom"!==p,handleChange:e=>n([e.target.value,h]),flex:1}),(0,T.jsx)(Sa,{label:"To",value:h,options:sa.filter((e=>e.value>u)),disabled:a||"custom"!==p,handleChange:e=>n([u,e.target.value]),flex:1})]}):null]})]})};var Ta=a(79012),Aa=a(85523);const Pa=e=>{const{label:t="Optional Message",value:a,handleChange:r,maxLength:n,showTip:l=!0,disabled:i}=e,d=a?a.length:0;return(0,T.jsxs)(s.Z,{direction:"column",children:[(0,T.jsx)(Gt.Z,{label:t,multiline:!0,minRows:2,maxRows:4,inputProps:{maxLength:n},value:a||"",onChange:e=>{r(e)},disabled:i}),(0,T.jsxs)(s.Z,{direction:"row",gap:1,justifyContent:"space-between",sx:{mx:1,my:.5},children:[l?(0,T.jsx)(u.Z,{color:"text.secondary",variant:"caption",children:"Optional message that will appear in the alert"}):(0,T.jsx)(o.Z,{}),(0,T.jsxs)(u.Z,{color:"text.secondary",variant:"caption",textAlign:"right",children:[d,"/",n]})]})]})},Ia=[{value:0,label:"Monday"},{value:1,label:"Tuesday"},{value:2,label:"Wednesday"},{value:3,label:"Thursday"},{value:4,label:"Friday"},{value:5,label:"Saturday"},{value:6,label:"Sunday"}];var Ma=a(97892),Ea=a.n(Ma),za=a(23634),Oa=a(71652),Ra=a(84639),Wa=a(86767);const La=(0,n.ZP)(Ra.H,{shouldForwardProp:e=>"selected"!==e})((e=>{let{theme:t,selected:a}=e;return{...a&&{backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover, &:focus":{backgroundColor:t.palette.primary.dark},borderRadius:"50%"}}})),Fa=e=>{const{day:t,selectedDates:a,...r}=e,n=a.includes(Ea()(t).format("YYYY-MM-DD"));return(0,T.jsx)(La,{...r,day:t,selected:n})};function Ba(e){const{selectedDates:t,handleChange:a,disabled:r}=e,n=t.map((e=>Ea()(e).format("YYYY-MM-DD"))),o=t.length,l=o>0?"Excluded Dates (".concat(o," Days)"):"Excluded Dates";return(0,T.jsxs)(Bt,{dialogTitle:l,buttonLabel:l,buttonVariant:"text",disabled:r,maxWidth:"xs",displaySchoolID:!1,children:[(0,T.jsxs)(u.Z,{color:"text.secondary",variant:"body2",gutterBottom:!0,children:["Select dates when you do ",(0,T.jsx)("b",{children:"NOT"})," want to receive alerts.",(0,T.jsx)("br",{}),"Useful for holidays or school breaks."]}),(0,T.jsx)(_t.Z,{variant:"caption",sx:{cursor:"pointer",display:"block",textAlign:"right"},onClick:e=>{e.preventDefault(),a(t)},children:"Clear All"}),(0,T.jsx)(Oa._,{dateAdapter:za.y,localeText:{calendarWeekNumberHeaderText:"Week",calendarWeekNumberText:e=>"".concat(e,".")},children:(0,T.jsx)(Wa.W,{displayWeekNumber:!0,slots:{day:e=>(0,T.jsx)(Fa,{...e,selectedDates:n})},onChange:(e,t)=>{"finish"===t&&a([Ea()(e).format("YYYY-MM-DD")])},disableHighlightToday:!0,minDate:Ea()().startOf("month")})})]})}function Va(e){const{daysOfWeek:t,excludedDates:a,handleDaysOfWeekChange:r,handleExcludedDatesChange:n,disabled:l}=e,i=(0,j.Z)();return(0,T.jsxs)(f.ZP,{container:!0,rowSpacing:.5,columnSpacing:2,alignItems:"center",justifyContent:"stretch",children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,md:6,children:(0,T.jsxs)(s.Z,{direction:"row",gap:1,alignItems:"start",children:[(0,T.jsx)(o.Z,{"aria-hidden":!0,sx:{"& .MuiSvgIcon-root":{color:l?i.palette.text.secondary:i.palette.primary.main,verticalAlign:"middle"}},children:(0,T.jsx)(Xt.Z,{sx:{mt:.75}})}),(0,T.jsx)(fe.Z,{value:t||ha()[ua.days_of_week],onChange:r,"aria-label":"days of the week to receive alert",sx:{display:"flex",justifyContent:"center"},size:"small",fullWidth:!0,disabled:l,color:l?"standard":"primary",children:Ia.map((e=>(0,T.jsx)(Et.Z,{title:e.label,arrow:!0,children:(0,T.jsx)(je.Z,{value:e.value,"aria-label":e.label,sx:{textTransform:"none"},children:e.label.slice(0,3)})},e.value)))})]})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,md:6,ml:{xs:3,sm:0},children:(0,T.jsx)(Ba,{selectedDates:a,disabled:l,handleChange:n})})]})}var Ha=a(5519),Na=a(90375),Ya=a(49768);const Ua=e=>{const{min:t=0,max:a=100,value:n,defaultValue:o,stepsForThreshold:l=1,marks:i=null,handleChange:s,disabled:d,backgroundCssGradient:c,invertSelection:h=!1,showInput:p=!0,inputUnit:x,valueLabelDisplay:m="on",showTip:g=!0}=e,v=(0,j.Z)(),[b,y]=(0,r.useState)(h?n||o:t),[w,Z]=(0,r.useState)(h?a:n||o),[S,D]=(0,r.useState)(-1),[_,k]=(0,r.useState)(!1),[C,A]=(0,r.useState)(""),P=(0,r.useCallback)((e=>{if(!i)return-1;const t=i.filter((t=>t.value>=e));if(0===t.length)return-1;const a=t.reduce(((t,a)=>a.value-e<t.value-e?a:t)),r=i.indexOf(a);return h?r-1:r}),[i,h]);(0,r.useEffect)((()=>{const e=h?n:t,r=h?a:n;y(e),Z(r),D(P(h?e:r))}),[P,h,n,a,t]);const I="repeating-linear-gradient(-45deg, ".concat(Ha.Z[800],", ").concat(Ha.Z[800]," 4px, ").concat(Na.Z.white," 4px, ").concat(Na.Z.white," 8px)"),M={height:"20vh",minHeight:"250px",maxHeight:"500px",cursor:d?"not-allowed":"inherit",pointerEvents:"all","& *":{transition:"none !important"},"& .MuiSlider-thumb":{width:"2rem",height:"4px",borderRadius:1,color:Na.Z.black},['& .MuiSlider-thumb[data-index="'.concat(h?1:0,'"]')]:{display:"none"},"& .MuiSlider-mark, .MuiSlider-markActive":{width:"2rem",height:"3px",background:v.palette.background.paper,backgroundImage:v.palette.background.paperBackgroundGradient},"& .MuiSlider-thumb, .MuiSlider-mark":{transform:"translate(-50%,50%})"},"& .MuiSlider-rail, .MuiSlider-track":{width:"1rem",opacity:.75,border:"none"},"& .MuiSlider-rail":{background:d?Ha.Z[400]:c},"& .MuiSlider-track":{background:I,...h?{borderBottomLeftRadius:0,borderBottomRightRadius:0}:{borderTopLeftRadius:0,borderTopRightRadius:0}},['& .MuiSlider-markLabel, .MuiSlider-markLabel[data-index="'.concat(S,'"]')]:{color:v.palette.text.primary,fontWeight:500,textDecoration:"underline"},"& .MuiSlider-markLabelActive":{color:v.palette.text.secondary,fontWeight:"inherit",textDecoration:"inherit"},"& .MuiSlider-valueLabel":{transform:"translate(-10px, -50%)"}};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(f.ZP,{container:!0,item:!0,xs:"auto",alignItems:"end",spacing:.5,children:[(0,T.jsx)(f.ZP,{item:!0,xs:"auto",minWidth:"4.5rem",children:p?(0,T.jsx)(Gt.Z,{variant:"standard",type:"number",label:"Threshold",value:h?b:w,onChange:e=>{const r=""===e.target.value?"":Number(e.target.value);r&&""!==r||s(r),""!==r&&r>=t&&r<=a?(y(h?r:t),Z(h?a:r),s(r),D(P(r)),k(!1),A("")):(k(!0),A("Threshold must be between ".concat(t," and ").concat(a)))},error:_,helperText:C,size:"small",fullWidth:!0,disabled:d,inputProps:{step:l,min:t,max:a,type:"number","aria-labelledby":"input-threshold-slider"}}):null}),x?(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(u.Z,{variant:"body2",children:x})}):null]}),(0,T.jsx)(f.ZP,{item:!0,xs:12,sx:{mt:2,ml:7.5},children:(0,T.jsx)(Ya.ZP,{getAriaLabel:()=>"Alert Threshold Slider","aria-labelledby":"input-threshold-slider",value:[b,w],step:null===i?l:null,marks:i,disabled:d,min:t,max:a,onChange:(e,r)=>{const n=r[h?0:1];y(h?n:t),Z(h?a:n),s(n),D(P(n))},valueLabelDisplay:m,orientation:"vertical",sx:M})}),(0,T.jsx)(f.ZP,{item:!0,sx:{mt:1,ml:1,visibility:!0===g?"visible":"hidden"},children:(0,T.jsx)(u.Z,{color:"text.secondary",variant:"caption",display:"block",children:"Move the slider to change the alert's threshold value or use the text input box for more precise control."})})]})};var qa=a(44709);const Ga=e=>{const{value:t,invertSelection:a,handleValueChange:r,placeholderValueBeforeDataTypeSelection:n=.5,disabledSlider:o,showTip:l=!0}=e,{editingAlert:i}=xa(),s=(0,j.Z)();let d=null;const c=i[ua.datatypekey];if(c&&x.oS[c]){const e=x.oS[c],n=s.palette.chart.colorAxes[e.color_axis],{colors:u,minValue:h,maxValue:p,defaultValueForAlert:m,stepsForThreshold:g}=n,v=Q({gradientDirection:"to top",colors:u});let b,y;switch(c){case x.Yx.voc:y=qa.MS;break;case x.Yx.aqi:case x.Yx.pm2_5:case x.Yx.pm10_raw:case x.Yx.co2:y=qa._R;break;case x.Yx.heat_index_C:y=qa.pl;break;default:y=null}y&&(b=y.filter(((e,t)=>0!==t)).map((t=>({value:t[e.threshold_mapping_name].low,label:t.category}))));const f=Object.keys(x.oS).filter((e=>e===i[ua.datatypekey])).map((e=>x.oS[e].unit))[0];d=(0,T.jsx)(Ua,{min:h,max:p,marks:b,defaultValue:m,value:t,stepsForThreshold:g,disabled:o,backgroundCssGradient:v,invertSelection:a,handleChange:r,inputUnit:f,showTip:l})}else d=(0,T.jsx)(Ua,{min:0,max:1,value:n,disabled:!0,showInput:!1,invertSelection:a,valueLabelDisplay:"off",showTip:l});return d};var Qa=a(47071);const Xa=e=>{let{value:t,handleChange:a,disabled:r}=e;return(0,T.jsxs)(w.Z,{component:"fieldset",variant:"standard",sx:{mt:{md:-1}},disabled:r,children:[(0,T.jsx)(Ta.Z,{children:(0,T.jsx)(Aa.Z,{control:(0,T.jsx)(S.Z,{checked:t,onChange:a,size:"small"}),label:(0,T.jsx)(u.Z,{color:"text.secondary",fontWeight:500,children:"Max Once a Day"}),color:"text.secondary"})}),(0,T.jsx)(Qa.Z,{sx:{mt:-.5},children:!0===t?(0,T.jsxs)(T.Fragment,{children:["Send alert ",(0,T.jsx)("strong",{children:"at most once a day"})," when the threshold is breached"]}):(0,T.jsxs)(T.Fragment,{children:["Send alert ",(0,T.jsx)("strong",{children:"every hour"})," for as long as the threshold is breached"]})})]})},Ka=e=>{let{currentAlertType:t,handleChange:a,disabled:r,...n}=e;return(0,T.jsx)(fe.Z,{color:r?"standard":"primary",disabled:r,defaultValue:$t.above_threshold.id,value:t,exclusive:!0,"aria-label":"toggle to choose alert below or above a threshold",size:"small",onChange:a,...n,children:Object.keys($t).map((e=>{const t=$t[e];return(0,T.jsxs)(je.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:t.id,"aria-label":t.id,children:[t.sign,"\xa0",t.name]},t.id)}))})},$a=e=>{let{currentAlertType:t,...a}=e;return(0,T.jsx)(fe.Z,{color:"standard",disabled:!0,defaultValue:$t.below_threshold.id,value:t,exclusive:!0,"aria-label":"non-interactive button displaying threshold type",size:"small",...a,children:Object.keys($t).map((e=>{const a=$t[e];return a.id!==t?null:(0,T.jsxs)(je.Z,{size:"small",sx:{textTransform:"capitalize !important",px:1.25},value:a.id,"aria-label":a.id,children:[a.sign,"\xa0",a.name]},a.id)}))})},Ja=e=>{const t=e[ua.is_enabled]?"enabled":"disabled",a=e[ua.id]?"is":"will be";return"This alert ".concat(a," ").concat(t)},er=e=>{var t,a,n,o;let{alertTypeKey:l,crudType:i}=e;const{schoolMetadata:d}=(0,r.useContext)(b.G),{editingAlert:c,allowedDataTypesForSensor:h,setEditingAlert:p}=xa(),m=(0,j.Z)(),g=null===d||void 0===d||null===(t=d.sensors)||void 0===t?void 0:t.map((e=>({value:e.sensor_id,label:(0,N.Fb)(e.location_short)}))),v=e=>{switch(e){case ua.sensor_id:case ua.is_enabled:return!1;case ua.datatypekey:return c[ua.sensor_id]===ha(l)[ua.sensor_id];case ua.child_alert:return!0!==c[ua.has_child_alert];default:return c[ua.datatypekey]===ha(l)[ua.datatypekey]}};return(0,T.jsxs)(s.Z,{direction:"column",gap:2,mt:1,width:"100%",children:[null!==(a=Za[i])&&void 0!==a&&a.contentText?(0,T.jsx)(ja.Z,{fontWeight:"500",children:Za[i].contentText}):null,(0,T.jsxs)(s.Z,{direction:"row",gap:1,alignItems:"center",mb:2,children:[(0,T.jsx)(_.Z,{size:"small",checked:c[ua.is_enabled],onChange:e=>{p({...c,[ua.is_enabled]:e.target.checked})},disabled:v(ua.is_enabled)}),(0,T.jsx)(u.Z,{fontWeight:500,color:"text.secondary",children:Ja(c)})]}),(0,T.jsxs)(f.ZP,{container:!0,columnSpacing:2,alignItems:"center",children:[(0,T.jsx)(f.ZP,{item:!0,xs:6,children:(0,T.jsx)(Sa,{icon:(0,T.jsx)(_a.Z,{}),label:na,value:c[ua.sensor_id],options:g,disabled:v(ua.sensor_id),handleChange:e=>{p({...c,[ua.sensor_id]:e.target.value,[ua.datatypekey]:""})}})}),(0,T.jsx)(f.ZP,{item:!0,xs:6,children:(0,T.jsx)(Sa,{label:oa,value:c[ua.datatypekey],options:h,disabled:v(ua.datatypekey),handleChange:e=>{var t,a;const r=e.target.value,n=x.oS[r];p({...c,[ua.datatypekey]:r,[ua.threshold_value]:null===(t=m.palette.chart.colorAxes[n.color_axis])||void 0===t?void 0:t.defaultValueForAlert,[ua.child_alert]:{...c[ua.child_alert],[ua.threshold_value]:null===(a=m.palette.chart.colorAxes[n.color_axis])||void 0===a?void 0:a.defaultValueForChildAlert}})},flex:1})})]}),(0,T.jsx)(Va,{daysOfWeek:c[ua.days_of_week],excludedDates:c[ua.excluded_dates]||[],disabled:v(ua.days_of_week),handleDaysOfWeekChange:(e,t)=>{const a=Array.isArray(t)?t:[];p({...c,[ua.days_of_week]:a.sort()})},handleExcludedDatesChange:e=>{const t=c[ua.excluded_dates]||[],a=e.reduce(((e,t)=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]),t);p({...c,[ua.excluded_dates]:a})}}),(()=>{switch(l){case Jt.daily.id:return(0,T.jsx)(Sa,{icon:(0,T.jsx)(Da.Z,{}),label:Jt.daily.tableColumnHeader,value:c[ua.minutespastmidnight],options:sa,disabled:v(ua.minutespastmidnight),handleChange:e=>{p({...c,[ua.minutespastmidnight]:e.target.value})}});case Jt.threshold.id:return(0,T.jsxs)(f.ZP,{container:!0,columnSpacing:2,rowSpacing:.5,children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,md:6,children:(0,T.jsx)(Ca,{value:c[ua.time_range],disabled:v(ua.time_range),handleChange:e=>{p({...c,[ua.time_range]:e})}})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,md:6,children:(0,T.jsx)(Xa,{value:c[ua.max_once_a_day],handleChange:e=>{p({...c,[ua.max_once_a_day]:e.target.checked})},disabled:v(ua.max_once_a_day)})})]});default:return null}})(),l===Jt.threshold.id?(0,T.jsxs)(f.ZP,{container:!0,alignItems:"start",spacing:2,children:[(0,T.jsxs)(f.ZP,{container:!0,item:!0,xs:12,sm:6,children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,children:(0,T.jsx)(u.Z,{variant:"body1",fontWeight:500,color:"text.secondary",sx:{mt:"2px",mb:"12px"},children:"1. Alert if it is:"})}),(0,T.jsx)(f.ZP,{item:!0,sx:{mr:2},children:(0,T.jsx)(Ka,{currentAlertType:c[ua.alert_type],handleChange:e=>{const t=e.target.value,a=t===$t.above_threshold.id?$t.below_threshold.id:$t.above_threshold.id;p({...c,[ua.alert_type]:t,[ua.child_alert]:{...c[ua.child_alert],[ua.alert_type]:a}})},disabled:v(ua.alert_type),sx:{height:"100%"}})}),(0,T.jsx)(Ga,{value:c[ua.threshold_value],invertSelection:c[ua.alert_type]===$t.below_threshold.id,handleValueChange:e=>{p({...c,[ua.threshold_value]:e})},disabledToggle:v(ua.alert_type),disabledSlider:v(ua.threshold_value),placeholderValueBeforeDataTypeSelection:2/3}),(0,T.jsx)(f.ZP,{item:!0,xs:12,mt:2,children:(0,T.jsx)(Pa,{value:c[ua.message],handleChange:e=>{p({...c,[ua.message]:e.target.value})},maxLength:200,label:"Optional Message for Main Alert",disabled:v(ua.message)})})]}),(0,T.jsxs)(f.ZP,{container:!0,item:!0,xs:12,sm:6,children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,children:(0,T.jsx)(Ta.Z,{children:(0,T.jsx)(Aa.Z,{disabled:v(ua.has_child_alert),control:(0,T.jsx)(S.Z,{checked:!!c[ua.has_child_alert],onChange:e=>{p({...c,[ua.has_child_alert]:e.target.checked})},size:"small"}),label:(0,T.jsx)(u.Z,{variant:"body1",fontWeight:500,color:"text.secondary",children:"2. [Optional] Follow-up alert if it changes to:"}),color:"text.secondary"})})}),c[ua.child_alert]&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(f.ZP,{item:!0,sx:{mr:2},children:(0,T.jsx)($a,{currentAlertType:null===(n=c[ua.child_alert])||void 0===n?void 0:n[ua.alert_type],sx:{height:"100%"}})}),(0,T.jsx)(Ga,{value:c[ua.child_alert][ua.threshold_value],invertSelection:(null===(o=c[ua.child_alert])||void 0===o?void 0:o[ua.alert_type])===$t.below_threshold.id||!0,handleValueChange:e=>{p({...c,[ua.child_alert]:{...c[ua.child_alert],[ua.threshold_value]:e}})},disabledToggle:v(ua.child_alert),disabledSlider:v(ua.child_alert),showTip:!1,placeholderValueBeforeDataTypeSelection:1/3}),(0,T.jsx)(f.ZP,{item:!0,xs:12,mt:2,children:(0,T.jsx)(Pa,{value:c[ua.child_alert][ua.message],handleChange:e=>{p({...c,[ua.child_alert]:{...c[ua.child_alert],[ua.message]:e.target.value}})},maxLength:200,label:"Optional Message for Follow-up Alert",showTip:!1,disabled:v(ua.child_alert)})})]})]})]}):(0,T.jsx)(Pa,{value:c[ua.message],handleChange:e=>{p({...c,[ua.message]:e.target.value})},maxLength:200,disabled:v(ua.message)})]})},tr=e=>{var t;const{alertTypeKey:a,openAlertModificationDialog:n,crudType:o,handleClose:l}=e,{currentSchoolID:d}=(0,r.useContext)(b.G),{selectedAlert:c,setSelectedAlert:u,editingAlert:h,setEditingAlert:p,setAlerts:x,addChildToAlerts:y}=xa(),[f,w]=(0,r.useState)(!1),{enqueueSnackbar:Z}=(0,Te.Ds)(),S=(0,j.Z)(),D=()=>{var e;if(a===Jt.daily.id)return{valid:!0};if(!h[ua.has_child_alert])return{valid:!0};const t=h[ua.alert_type]===$t.above_threshold.id,r=h[ua.threshold_value],n=null===(e=h[ua.child_alert])||void 0===e?void 0:e[ua.threshold_value];return void 0===n?{valid:!0}:t&&r<=n||!t&&r>=n?{valid:!1,message:"The follow-up alert must have a ".concat(t?"lower":"higher"," threshold than the first alert")}:{valid:!0}},_=e=>{const t={...e};return delete t[ua.child_alert],delete t[ua.has_child_alert],t},k=(e,t)=>{const a={...e,...e[ua.child_alert],[ua.parent_alert_id]:t,[ua.id]:null};return delete a[ua.child_alert],delete a[ua.has_child_alert],a},C=e=>{let{passedCrudType:t}=e;const r=e=>{Z(Za[t].errorMessage,Ae.P.error)},n=()=>{Z(Za[t].successMessage,Ae.P.success),l()};switch(t){case ta:{const e=D();if(!e.valid)return void Z(e.message,Ae.P.error);(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d}),restMethod:v.j2.POST,body:_(h)}).then((e=>{x((t=>{const a=[...t,e];return y(a)})),n();const t=ha(a);if(u(t),p(t),!h[ua.has_child_alert])return;const o=e[ua.id];null!==o&&void 0!==o&&(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d}),restMethod:v.j2.POST,body:k(h,o)}).then((e=>{x((t=>{const a=[...t,e];return y(a)}))})).catch((e=>r()))})).catch((e=>r()));break}case aa:{const e=D();if(!e.valid)return void Z(e.message,Ae.P.error);const t=c[ua.id];(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d,alert_id:t}),restMethod:v.j2.PUT,body:_(h)}).then((e=>{var a;x((a=>{const r=a.map((a=>a.id===t?e:a));return y(r)})),n();const o=null===(a=h[ua.child_alert])||void 0===a?void 0:a[ua.id];h[ua.has_child_alert]?null===o||void 0===o?(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d}),restMethod:v.j2.POST,body:k(h,t)}).then((e=>{x((t=>{const a=[...t,e];return y(a)}))})).catch((e=>r())):(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d,alert_id:o}),restMethod:v.j2.PUT,body:k(h,t)}).then((e=>{x((t=>{const a=t.map((t=>t.id===o?e:t));return y(a)}))})).catch((e=>r())):null!==o&&void 0!==o&&(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d,alert_id:o}),restMethod:v.j2.DELETE}).then((()=>{x((e=>{const t=e.filter((e=>e.id!==o));return y(t)})),n()})).catch((e=>r()))})).catch((e=>r()));break}case ra:(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d,alert_id:c.id}),restMethod:v.j2.DELETE}).then((()=>{x((e=>e.filter((e=>e.id!==c.id)))),n()})).catch((e=>r()))}};(0,r.useEffect)((()=>{switch(o){case ta:const e=ha(a);h[ua.sensor_id]===e[ua.sensor_id]||h[ua.datatypekey]===e[ua.datatypekey]?a===Jt.daily.id?w(h[ua.minutespastmidnight]===e[ua.minutespastmidnight]):w(!0):a===Jt.daily.id?w(h[ua.minutespastmidnight]===e[ua.minutespastmidnight]):w(!1);break;case aa:let t;t=a===Jt.daily.id?h[ua.minutespastmidnight]:h[ua.threshold_value];const r=h[ua.datatypekey];if(!t||""===t||!r||""===r){w(!0);break}w(fa()(c,h));break;default:w(!1)}}),[o,c,h,a]);const A=(0,i.Z)((e=>e.breakpoints.down("md")));return(0,T.jsxs)(Ot.Z,{open:n,onClose:l,"aria-labelledby":"alert-modification-dialog",maxWidth:"md",fullWidth:!0,fullScreen:A,children:[(0,T.jsx)(Wt.Z,{id:"alert-modification-dialog",children:null===(t=Za[o])||void 0===t?void 0:t.title}),(0,T.jsx)(Lt.Z,{children:(0,T.jsx)(er,{alertTypeKey:a,crudType:o})}),(0,T.jsxs)(Rt.Z,{sx:{justifyContent:"space-between"},children:[o===aa?(0,T.jsx)(wa,{onConfirmedDelete:()=>{C({passedCrudType:ra})}}):null,(0,T.jsxs)(s.Z,{direction:"row",width:"100%",justifyContent:"end",children:[(0,T.jsx)(Ee.Z,{onClick:l,sx:{color:S.palette.text.secondary},children:"Cancel"}),(0,T.jsx)(Ee.Z,{onClick:()=>{C({passedCrudType:o})},color:"primary",disabled:f,children:"Save Edit"})]})]})]})};var ar=a(50255),rr=a(12569);const nr=e=>{if(!e||!(0,N.qt)(e))return"N/A";if(e.length===Ia.length)return"Everyday";const t=Ia.filter((t=>!e.includes(t.value)));return 2===t.length&&t.every((e=>[5,6].includes(e.value)))?"Only weekdays":e.map((e=>{var t;return null===(t=Ia.find((t=>t.value===e)))||void 0===t?void 0:t.label.slice(0,2)})).join(", ")},or=(e,t)=>t?"":e&&rr.v[e]?"".concat(rr.v[e].name," added your email to this school-wide alert. For edit or removal, please reach out to ").concat(rr.v[e].name,"."):void 0,lr=e=>{var t;const{selectedAlert:a,setSelectedAlert:n,setAlerts:l,addChildToAlerts:i}=xa(),{currentSchoolID:d}=(0,r.useContext)(b.G),{enqueueSnackbar:c}=(0,Te.Ds)(),{alertTypeKey:u,alertsForTable:h}=e,p=(0,j.Z)(),[y,f]=(0,r.useState)(!1),[w,Z]=(0,r.useState)(null),S=e=>{let{alert:t,crudType:a}=e;n(t),Z(a),f(!0)};return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(s.Z,{spacing:2,alignItems:"center",children:[(0,T.jsx)(o.Z,{sx:{width:"100%",overflowX:"auto"},children:(0,N.qt)(h)?(0,T.jsxs)(kt.Z,{size:"small",sx:{my:1},children:[(0,T.jsx)(Ct.Z,{children:(0,T.jsxs)(Tt.Z,{children:[(0,T.jsx)(At.Z,{sx:{px:0}}),(0,T.jsx)(At.Z,{children:na}),(0,T.jsx)(At.Z,{children:oa}),(0,T.jsx)(At.Z,{children:la}),(0,T.jsx)(At.Z,{children:(null===(t=Jt[u])||void 0===t?void 0:t.tableColumnHeader)||""}),(0,T.jsx)(At.Z,{children:ia})]})}),(0,T.jsx)(ar.Z,{component:Pt.Z,children:(0,N.qt)(h)?h.map(((e,t)=>{return(0,T.jsx)(ga.Z,{children:(0,T.jsxs)(Tt.Z,{sx:{background:e[ua.id]===a[ua.id]&&p.palette.background.NYUpurpleLight,textDecoration:!1===e[ua.is_enabled]?"line-through":"none"},children:[(0,T.jsxs)(At.Z,{sx:{px:0},children:[(0,T.jsx)(Et.Z,{title:!1===e[ua.is_allowed_to_modify]?or(e[ua.owner_role],e[ua.is_allowed_to_modify]):"Click to ".concat(e[ua.is_enabled]?"disable":"enable"," alert"),children:(0,T.jsx)("span",{onClick:()=>{!1!==e[ua.is_allowed_to_modify]?(e=>{let{alert:t}=e;const a=!t[ua.is_enabled];(0,m.d)({url:(0,g.HM)({endpoint:v.eV.alerts,school_id:d,alert_id:t[ua.id]}),restMethod:v.j2.PUT,body:{...t,[ua.is_enabled]:a}}).then((e=>{l((a=>{const r=a.map((a=>a[ua.id]===t[ua.id]?e:a));return i(r)})),c("This alert will be ".concat(a?"enabled":"disabled"),Ae.P.success)})).catch((e=>{c(e.message||"There was an error ".concat(a?"enabling":"disabling"," this alert, try again!"),Ae.P.error)}))})({alert:e}):c(or(e[ua.owner_role],e[ua.is_allowed_to_modify]),Ae.P.warning)},style:{display:"inline-block"},children:(0,T.jsx)(_.Z,{size:"small",disabled:!1===e[ua.is_allowed_to_modify],checked:e[ua.is_enabled]})})}),(0,T.jsx)(Et.Z,{title:!1===e[ua.is_allowed_to_modify]?or(e[ua.owner_role],e[ua.is_allowed_to_modify]):"Edit alert",children:(0,T.jsx)("span",{onClick:()=>{!1!==e[ua.is_allowed_to_modify]?S({alert:e,crudType:aa}):c(or(e[ua.owner_role],e[ua.is_allowed_to_modify]),Ae.P.warning)},style:{display:"inline-block"},children:(0,T.jsx)(zt.Z,{"aria-label":"edit",size:"small",disabled:!1===e[ua.is_allowed_to_modify],sx:{"&:hover,:focus":{color:p.palette.primary.main}},children:(0,T.jsx)(va.Z,{})})})})]}),(0,T.jsx)(At.Z,{sx:{textTransform:"capitalize"},children:e[ua.location_short]}),(0,T.jsx)(At.Z,{children:Object.keys(x.oS).filter((t=>t===e[ua.datatypekey])).map((e=>x.oS[e].name_title))[0]}),(0,T.jsx)(At.Z,{children:nr(e[ua.days_of_week])}),u===Jt.threshold.id?(0,T.jsxs)(At.Z,{children:[$t[e[ua.alert_type]].sign," ",e[ua.threshold_value],"\xa0",Object.keys(x.oS).filter((t=>t===e[ua.datatypekey])).map((e=>x.oS[e].unit))[0]]}):null,u===Jt.daily.id?(0,T.jsx)(At.Z,{children:ea(e[ua.minutespastmidnight])}):null,(0,T.jsx)(At.Z,{children:(0,T.jsx)(k.Z,{label:(r=e[ua.owner_role],n=e[ua.self_is_owner],!0===n?"You":r?rr.v[r].name:"N/A"),size:"small"})})]})},t);var r,n})):null})]}):(0,T.jsxs)(Ve.Z,{severity:"warning",sx:{mt:2},children:["No ",Jt[u].name.toLowerCase()," alert has been set up"]})}),(0,T.jsx)(Ee.Z,{variant:"outlined",startIcon:(0,T.jsx)(ba.Z,{}),fullWidth:!0,sx:{maxWidth:"sm",textTransform:"uppercase"},onClick:()=>S({alert:ha(u),crudType:ta}),children:"Add Alert"})]}),(0,T.jsx)(tr,{alertTypeKey:u,crudType:w,openAlertModificationDialog:y,handleClose:()=>{f(!1),n(ha(u))}})]})};function ir(e){const{children:t,value:a,index:r,alertType:n,alertsArray:l,...i}=e;return(0,T.jsx)(o.Z,{role:"tabpanel",hidden:a!==r,id:"alert-tabpanel-".concat(n.id),"aria-labelledby":"alert-tab-".concat(n.id),width:"100%",...i,children:(0,T.jsx)(lr,{alertTypeKey:n.id,alertsForTable:l})})}function sr(){const e=(0,i.Z)((e=>e.breakpoints.down("sm"))),[t,a]=(0,r.useState)(0),{setSelectedAlert:n}=xa(),{alerts:l}=xa(),s=e=>{const t=l.filter((t=>{var a;if(!t)return null;const r=null===(a=t[ua.alert_type])||void 0===a?void 0:a.toLowerCase(),n=t[ua.parent_alert_id];return!r.includes(e)||null!==n&&void 0!==n?null:t}));return{array:t,alertsLength:(0,N.qt)(t)?t.length:"0"}};return(0,T.jsxs)(o.Z,{children:[(0,T.jsx)(Xe,{value:t,onChange:(e,t)=>{var r,o;a(t),n(ha(null===(r=Jt[null===(o=Object.keys(Jt))||void 0===o?void 0:o[t]])||void 0===r?void 0:r.id))},variant:e?"fullWidth":"standard",smallFontSize:"0.825rem",children:Object.values(Jt).map((e=>{const t=s(e.id);return(0,T.jsx)(d.Z,{value:e.index,icon:e.icon,label:"".concat(e.name," (").concat(null===t||void 0===t?void 0:t.alertsLength,")"),iconPosition:"start",sx:{py:0}},e.id)}))}),Object.values(Jt).map((e=>{const a=s(e.id);return(0,T.jsx)(ir,{alertType:e,value:t,index:e.index,alertsArray:a.array},e.id)}))]})}function dr(e){let{onButtonClick:t}=e;const{handleRestrictedAccess:a}=St(t),{fetchAlerts:n,hasFetchedAlerts:o,setHasFetchedAlerts:l}=xa(),{user:i}=(0,r.useContext)(Zt.S),d=[rr.v.admin.id,rr.v.school.id].includes(null===i||void 0===i?void 0:i.user_role);return(0,T.jsx)(Bt,{buttonIcon:(0,T.jsx)(qt.Z,{sx:{fontSize:"1rem"}}),buttonLabel:"Alerts",dialogTitle:"Air quality alerts",dialogOpenHandler:e=>{a(e)&&!o&&(n(),l(!0))},children:(0,T.jsxs)(s.Z,{width:"100%",spacing:d?5:2,children:[(0,T.jsx)(sr,{}),d?(0,T.jsx)(ma,{}):(0,T.jsxs)(u.Z,{variant:"body2",color:"text.secondary",children:["Alerts will be sent to your email address: ",(0,T.jsx)("b",{children:null===i||void 0===i?void 0:i.email})]})]})})}var cr=a(85332),ur=a(40655);const hr=e=>{let{onLoginSuccess:t,children:a}=e;const n=(0,r.useRef)(null),{enqueueSnackbar:o}=(0,Te.Ds)(),{setAuthenticationState:l,setUser:i}=(0,r.useContext)(Zt.S),[s,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),h=(0,r.useCallback)((()=>{const e=(window.screen.width-500)/2,t=(window.screen.height-600)/2,a=window.open(cr.$.login,"Login","width=".concat(500,",height=").concat(600,",top=").concat(t,",left=").concat(e));if(a){a.focus(),n.current=a;const e=setInterval((()=>{a.closed&&(clearInterval(e),window.removeEventListener("message",p),n.current=null)}),500)}else alert("Popup blocked. Please enable popups for login.")}),[]),p=(0,r.useCallback)((e=>{if(e.origin===window.location.origin&&e.data.type===rr.$.password&&e.data.success){const a=e.data.user;l({checkedAuthentication:!0,authenticated:!0}),i(a),a.message&&o(a.message,Ae.P.success),!1===a.is_verified&&(d(!0),u(a.email)),null===t||void 0===t||t()}}),[t]);return(0,r.useEffect)((()=>(window.addEventListener("message",p),()=>{window.removeEventListener("message",p)})),[p]),(0,T.jsxs)(T.Fragment,{children:[a({openLoginPopup:h}),(0,T.jsx)(ur.Z,{open:s,email:c})]})},pr=()=>{const{loggedIn:e}=St(),{enqueueSnackbar:t}=(0,Te.Ds)();return(0,T.jsx)(hr,{onLoginSuccess:()=>{t("You can now access TV Screens, Dataset, and Alerts.",{variant:Ae.P.success.name,duration:2*Ae.P.success.duration})},children:t=>{let{openLoginPopup:a}=t;return(0,T.jsxs)(f.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(Dt,{onButtonClick:e?null:a})}),(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(Vt,{onButtonClick:e?null:a})}),(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(pa,{children:(0,T.jsx)(dr,{onButtonClick:e?null:a})})})]})}})};var xr=a(25028);const mr=e=>{const{tooltipTitle:t,label:a,...r}=e,n=(0,T.jsx)(k.Z,{size:"small",label:a||(0,T.jsx)(h.Z,{variant:"text",sx:{minWidth:"5rem"}}),...r});return t?(0,T.jsx)(Et.Z,{title:t,enterDelay:0,leaveDelay:200,children:n}):n};var gr=a(16071),vr=a(70366);const br=()=>{const{currentSchoolID:e,schoolMetadata:t}=(0,r.useContext)(b.G),{user:a}=(0,r.useContext)(Zt.S);if(!Array.isArray(a.allowedSchools)||a.allowedSchools.length<=1)return(0,T.jsx)(mr,{icon:(0,T.jsx)(_a.Z,{}),label:(null===t||void 0===t?void 0:t.name)||"No School Name Given",tooltipTitle:"School"});const[n,i]=(0,r.useState)(null),s=()=>{i(null)},d=(0,wt.s0)();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(mr,{icon:(0,T.jsx)(_a.Z,{}),label:(0,T.jsxs)(o.Z,{sx:{"& svg":{fontSize:"1rem",verticalAlign:"sub",marginLeft:"0.25rem"}},children:[(null===t||void 0===t?void 0:t.name)||"Loading...",Boolean(n)?(0,T.jsx)(vr.Z,{}):(0,T.jsx)(qe.Z,{})]}),tooltipTitle:"Click to Select School",clickable:!0,onClick:e=>{i(e.currentTarget)},"aria-controls":open?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":open?"true":void 0}),(0,T.jsx)(c.Z,{anchorEl:n,open:Boolean(n),onClose:s,MenuListProps:{"aria-labelledby":"basic-button"},children:(0,T.jsx)(xr.Z,{dense:!0,children:a.allowedSchools.map(((t,a)=>{return(0,T.jsx)(l.Z,{onClick:(r=t.school_id,()=>{e!==r&&(localStorage.setItem(gr.m.schoolID,r),ct.y(ct.z.internalNavigation,{origin_school:e,destination_school_id:r,origin_id:"school_selector"}),d("".concat(cr.$.dashboard,"/").concat(r))),s()}),children:t.name},a);var r}))})})]})};var yr=a(40501),fr=a(44281);const jr=()=>{const{schoolMetadata:e}=(0,r.useContext)(b.G);return(0,T.jsxs)(f.ZP,{container:!0,item:!0,spacing:1,justifyContent:"center",children:[(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(br,{})}),(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(mr,{icon:(0,T.jsx)(yr.Z,{}),label:null===e||void 0===e?void 0:e.contactPerson,tooltipTitle:"Contact Person"})}),(0,T.jsx)(f.ZP,{item:!0,children:(0,T.jsx)(mr,{icon:(0,T.jsx)(fr.Z,{}),label:null===e||void 0===e?void 0:e.contactEmail,tooltipTitle:"Contact Email",component:"a",href:"mailto:".concat(null===e||void 0===e?void 0:e.contactEmail),clickable:!0})})]})},wr=()=>{const e=(0,j.Z)(),{schoolMetadata:t}=(0,r.useContext)(b.G);return t?(0,T.jsx)(u.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:2,mb:0,"& table *":{color:"".concat(e.palette.text.secondary)}},gutterBottom:!0,children:(0,J.ZP)(t.description||"",{replace:N.T1})}):Array.from({length:3}).map(((e,t)=>(0,T.jsx)(h.Z,{variant:"text"},t)))};var Zr=a(85172);const Sr=()=>{const{loadMoreCharts:e,setLoadMoreCharts:t}=(0,r.useContext)(b.G);return!1===e?(0,T.jsx)(s.Z,{sx:{mt:6,mx:"auto",maxWidth:"sm"},children:(0,T.jsxs)(Ee.Z,{variant:"contained",onClick:()=>{t(!0)},children:[(0,T.jsx)(Zr.Z,{sx:{fontSize:"1rem"}}),"\xa0Load More Charts"]})}):null},Dr=()=>{const{setChartsTitlesList:e}=(0,r.useContext)(gt.s),{schoolMetadata:t,currentSensorMeasurements:a,allChartsData:n}=(0,r.useContext)(b.G),{themePreference:l,temperatureUnitPreference:i}=(0,r.useContext)(bt.p),[s,d]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(!t)return;const e=t.school_id===ft.Ki;d(e)}),[t]),(0,r.useEffect)((()=>{if(!n)return;const t=Object.keys(n).map(((e,t)=>{var a;return{chartTitle:(null===(a=n[e])||void 0===a?void 0:a.title)||"",chartID:"chart-".concat(t+1)}}));e(t)}),[n]);return(0,T.jsxs)(o.Z,{width:"100%",children:[(0,T.jsx)(ht,{}),(0,T.jsx)(xt.Z,{backgroundColor:"customAlternateBackground",children:(0,T.jsxs)(tt.Z,{sx:{pt:2,pb:2},children:[(0,T.jsxs)(f.ZP,{container:!0,spacing:1.5,sx:{mb:4},children:[(0,T.jsx)(f.ZP,{item:!0,xs:12,children:(0,T.jsx)(et.Z,{text:(()=>{if(null!==t&&void 0!==t&&t.school_id)return"Air Quality | ".concat(null===t||void 0===t?void 0:t.school_id)})(),textAlign:"center",sx:{pb:0}})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,children:(0,T.jsx)(jr,{})}),(0,T.jsx)(f.ZP,{item:!0,xs:12,children:(0,T.jsx)(pr,{})})]}),!0===s&&(0,T.jsx)(vt.Z,{initialNyuadCurrentData:a,isOnBannerPage:!1,themePreference:l,minMapHeight:"250px"}),!1===s&&(0,T.jsx)(o.Z,{textAlign:"center",sx:{mb:2},children:(0,T.jsx)(mt.Z,{currentSensorsData:a,isScreen:!1,temperatureUnitPreference:i})}),(0,T.jsx)(wr,{}),(0,T.jsx)(yt.Z,{})]})}),(0,T.jsx)(o.Z,{id:pt.charts.id,children:Object.keys(n).length>0?(0,T.jsx)(T.Fragment,{children:Object.keys(n).map(((e,t)=>(0,T.jsx)(xt.Z,{backgroundColor:t%2!==0?"customAlternateBackground":"",children:(0,T.jsxs)(tt.Z,{sx:{pt:4,pb:4},height:"auto",className:l===rt.Z.dark?"dark":"",id:"chart-".concat(t+1),children:[(0,T.jsx)(Oe,{children:(0,T.jsx)(ke,{children:(0,T.jsx)(Je,{chartTitle:n[e].title,generalChartSubtitle:n[e].subtitle,generalChartReference:n[e].reference,chartData:{chartIndex:t,...n[e]},chartID:e,chartIndex:t})})}),t===Object.keys(n).length-1?(0,T.jsx)(Sr,{}):null]})},e)))}):(0,T.jsx)(V.Z,{optionalText:"Loading Visualizations"})}),(0,T.jsx)(at.Z,{})]})},_r=()=>{const{user:e}=(0,r.useContext)(Zt.S),{loadMoreCharts:t,setIndividualChartData:a,currentSchoolID:n}=(0,r.useContext)(b.G);(0,r.useEffect)((()=>{n&&(document.title="".concat(ft.DE," | ").concat(n.toUpperCase()))}),[n]);const{setCurrentPage:o}=(0,r.useContext)(gt.s);return(0,r.useEffect)((()=>{o(cr.$.dashboard)}),[]),(0,r.useEffect)((()=>{if(!n)return;(t?v.aT:v.aT.slice(0,ft.oX)).forEach(((e,t)=>{a(t,{}),(0,m.d)({url:(0,g.Eh)({endpoint:e,school_id:n})}).then((e=>{a(t,e)})).catch((e=>{console.log(e)}))}))}),[e,n]),(0,T.jsx)(Dr,{})}}}]);
//# sourceMappingURL=547.1b7e6a67.chunk.js.map